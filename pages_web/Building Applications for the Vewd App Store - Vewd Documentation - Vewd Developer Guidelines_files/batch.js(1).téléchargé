WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'soy/pagetree.soy' */
// This file was automatically generated from pagetree.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Pagetree.Macro.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Pagetree == 'undefined') { Confluence.Templates.Pagetree = {}; }
if (typeof Confluence.Templates.Pagetree.Macro == 'undefined') { Confluence.Templates.Pagetree.Macro = {}; }


Confluence.Templates.Pagetree.Macro.loadingIndicator = function(opt_data, opt_ignored) {
  return '<div class="plugin_pagetree_children_loading_wrapper"><div class="spinner"/><span class="plugin_pagetree_children_loading">' + soy.$$escapeHtml("Chargement en cours...") + '</span></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Pagetree.Macro.loadingIndicator.soyTemplateName = 'Confluence.Templates.Pagetree.Macro.loadingIndicator';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'com/atlassian/confluence/plugins/pagetree/resource/javascript/pagetree.js' */
(function(){var a=function(m){this.$=m;var h=this.$;var B=999;var C=true;var k=false;var w={};var d={};var n=function(K,J,F,I,E){if(J==undefined||J==null){J=!b(K)}if(F==undefined||F==null){F=0}if(!l(K,J)){var H=h("#children"+K);if(z(H)){var G=h("#plusminus"+K);if(J==C){G.removeClass("icon-section-closed").addClass("icon-section-opened")}else{G.removeClass("icon-section-opened").addClass("icon-section-closed")}if(J==C){if(E==false){H.slideDown(300)}else{H.removeClass("plugin-pagetree-hide-children");H.animate({opacity:1})}}else{if(E==false){H.slideUp(300)}else{H.animate({opacity:0},{complete:function(){H.addClass("plugin-pagetree-hide-children")}})}}if(I){r(K)}}else{j(K,new Array(),F,"",I,E)}}if(I){r(K)}};var z=function(E){return E.children("ul[id]").length>0};var b=function(F){var E=h("#plusminus"+F);return(E.length>0)?(E.hasClass("icon-minus")||E.hasClass("icon-section-opened")):k};var l=function(F,E){return b(F)==E};var i=function(G,F,E){A(G,C,F,E)};var x=function(G,F,E){A(G,k,F,E)};var A=function(J,H,G,F){g(J);var I=h("#"+J);var E=I.find("div.plugin_pagetree_children_container");E.each(function(K){var L=v(this.id);n(L,H,B,K==E.length-1,F)});G.preventDefault();G.stopPropagation()};var v=function(E){if(!E||E==undefined){return null}if(E.indexOf("plusminus")!=-1){return E.substring("plusminus".length)}if(E.indexOf("children")!=-1){return E.substring("children".length)}return null};var c=function(E){if(!E||E==undefined){return null}return s(E)[1]};var s=function(E){if(!E||E==undefined){return null}return E.split("-")};var g=function(F){var E=c(F);h("div.plugin_pagetree").each(function(G){if(G==E){h(this).find("span.plugin_pagetree_status").removeClass("hidden");h(this).find("div.plugin_pagetree_expandcollapse").addClass("hidden")}})};var r=function(F){var E=c(F);h("div.plugin_pagetree").each(function(G){if(G==E){h(this).find("span.plugin_pagetree_status").addClass("hidden");h(this).find("div.plugin_pagetree_expandcollapse").removeClass("hidden")}})};var f=function(L,F,I,H,K,E,G){var J=w[L];if(F=="Orphan"){J+="&hasRoot=false&spaceKey="+K}else{J+="&hasRoot=true&pageId="+F}J+="&treeId="+L+"&startDepth="+H+"&mobile="+G;h.each(I,function(){J+="&ancestors="+this});J+="&treePageId="+E;if(G==false){J=(AJS.params.serverUrl||"")+J}return J};var q=function(G){var F=G;var E=null;h("div.plugin_pagetree").each(function(H){if(H==F){E=h(this)}});return E};var p=function(E){var F=E.children("fieldset");var G=new Object();if(F.length>0){F.children("input").each(function(){G[this.name]=this.value})}return G};var o=function(E){var G=E.children("fieldset");var H=new Array();if(G.length>0){var F=G.children("fieldset");if(F.length>0){F.children("input").each(function(){H.push(this.value)})}}return H};var e=function(G,F){var E=h("a.plugin_pagetree_childtoggle",G);E.each(function(){var H=h(this);H.attr("href","#").bind("click",function(K){var I=H.parent().parent().children("div.plugin_pagetree_children_container");var J=I.attr("id");var L=J.substring(8);n(L,null,null,null,F);K.preventDefault();K.stopPropagation()})})};var u=function(E){var F=h(document.createElement("div"));F.html(E);return F.find("ul[id^='child_ul']").length};var j=function(N,G,S,Q,J,F,H){var R=N;var K=J;var E=s(N);var I=E[0];var M=E[1];var L=h("#children"+N);var P=p(q(M));var T=false;function O(){L.find(".plugin_pagetree_children_loading_wrapper .spinner").spin("small")}L.append(Confluence.Templates.Pagetree.Macro.loadingIndicator());if(H){setTimeout(function(){if(!T){O()}},250)}else{O()}h.ajax({type:"GET",url:f(M,I,G,S,Q,P.treePageId,F),dataType:"text",success:function(U){if(u(U)){L.html(U);T=true;if(L.children().length&&L.hasClass("hidden")){L.removeClass("hidden")}e(L,F);h("#plusminus"+R).addClass("icon-section-opened").removeClass("icon-section-closed");h("#childrenspan"+d[parseInt(M)]+"-"+M).addClass("plugin_pagetree_current");if(K){r(R)}t(L);if(AJS.PageGadget&&AJS.PageGadget.contentsUpdated){AJS.PageGadget.contentsUpdated()}}else{window.location=P.loginUrl}AJS.trigger("pagetree-children-loaded")},error:function(U){if(U.status=="403"){L.text(P["i18n-pagetree.error.permission"])}else{L.text(P["i18n-pagetree.error.general"])}}})};var t=function(E){h("div.plugin_pagetree_children_container:empty",E).addClass("hidden")};var y=function(E,J){var H=p(E);var K=H.noRoot=="true";var G=K?"Orphan-"+J:H.rootPageId+"-"+J;var F=H.mobile=="true";w[J]=H.treeRequestId;if(F==false){d[J]=AJS.params.pageId}else{d[J]=h("div.content-container").parent().attr("data-content-id")}E.children("fieldset").each(function(){var L=h(this);L.children("input[treeId]").attr("value",J);L.children("input[rootPage]").attr("value",G)});if(K){E.find("div.plugin_pagetree_children").attr("id","childrenOrphan-"+J);E.find("a.plugin_pagetree_expandall").click(function(L){i("childrenOrphan-"+J,L,F);return false});E.find("a.plugin_pagetree_collapseall").click(function(L){x("childrenOrphan-"+J,L,F);return false})}else{E.find("div.plugin_pagetree_children").attr("id","children"+G);E.find("a.plugin_pagetree_expandall").click(function(L){i("children"+G,L,F);return false});E.find("a.plugin_pagetree_collapseall").click(function(L){x("children"+G,L,F);return false})}var I=o(E);j(G,I,H.startDepth,H.spaceKey,"",F,true)};this.initPageTrees=function(){h("div.plugin_pagetree").each(function(E){y(h(this),E)});D()};var D=function(){var E=self.placeFocus;if(E){self.placeFocus=function(){var F=h("form[name='pagetreesearchform']");F.attr("name","inlinecommentform");E();F.attr("name","pagetreesearchform")}}};h(".open-flyout-to-search").bind("click",function(E){if(h(".fly-out-open").length){setTimeout(function(){ConfluenceMobile.flyout.hide()},400)}else{setTimeout(function(){ConfluenceMobile.flyout.show()},400)}E.stopPropagation();E.preventDefault()})};Confluence=Confluence||{};Confluence.Plugins=Confluence.Plugins||{};Confluence.Plugins.PagetreeMacro={bind:function(b){var c=new a(b);c.initPageTrees()}}})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.pagetree:pagetree-js-resources', location = 'com/atlassian/confluence/plugins/pagetree/resource/javascript/pagetree-desktop.js' */
AJS.toInit(function(a){Confluence.Plugins.PagetreeMacro.bind(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:help-dialog-extension', location = '/jira/help-dialog.js' */
if(Confluence.KeyboardShortcuts){Confluence.KeyboardShortcuts.Editor.push({context:"editor.actions",descKey:"Ins\u00e9rer filtre/demande JIRA"+":",keys:[["Ctrl+Maj+J"]]})};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.refinedwiki.confluence.plugins.mobile:mobileinterface-redirect', location = 'mobileinterface/js/mobile-redirect.js' */
(function(a){AJS.toInit(function(){if(a.browser.mobile){a.ajax({type:"GET",url:contextPath+"/rest/mobileinterface/1.0/settings/global/device-redirect-link",data:{userAgent:navigator.userAgent},cache:false,success:function(d){if(d.value){var e=location.pathname+location.search;if(location.pathname.indexOf("/dashboard.action")>-1){e=""}var c=a('<a id="rwmi_mobile_redirect_link" class="rwmi_mobile_version" href="'+contextPath+"/mobileredirect"+e.replace(contextPath,"")+'" onclick="showRedirectLoader();" >View mobile version</a>');a("#com-atlassian-confluence").prepend(c);if(a("#rw_blog_bar").css("position")==="fixed"){a("#rw_blog_bar").css("margin-top",51);a("#rw_blog_mode").css("padding-top",100);c.css("position","fixed")}}},error:function(c){}})}});function b(){AJS.$("#rwmi_mobile_redirect_link").html('<img src="'+contextPath+'/download/resources/com.refinedwiki.confluence.plugins.mobile/images/ajax-loader.gif" /> ')}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.refinedwiki.confluence.plugins.mobile:mobileinterface-redirect', location = 'mobileinterface/libs/jquery/jquery.browser.mobile.min.js' */
/**
 * jQuery.browser.mobile (http://detectmobilebrowser.com/)
 *
 * Copyright (c) 2010 Chad Smith (http://twitter.com/chadsmith)
 * Dual licensed under the MIT and GPL licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/gpl-license.php
 *
 * jQuery.browser.mobile will be true if the browser is a mobile device
 *
 **/
(function(a){jQuery.browser.mobile=/android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-mentions-plugin:help-dialog-extension', location = 'js/help-dialog.js' */
AJS.toInit(function(a){Confluence.KeyboardShortcuts&&Confluence.KeyboardShortcuts.Autoformat.push({action:"@",context:"autoformat.autocomplete",description:"Mention"})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-dashboard:footer-analytics', location = '/js/confluence-dashboard/utils/footer-analytics.js' */
define("confluence-dashboard/utils/footer-analytics",["exports","jquery","ajs"],function(a,c,b){b.toInit(function(){var e="confluence.footer.item.click";var d=b.Meta.get("page-id");var f=(0,c)("body").hasClass("dashboard");(0,c)("#footer").on("click","a",function(){b.trigger("analytics",{name:e,data:{pageId:d,isDashboard:f}})})})});require(["confluence-dashboard/utils/footer-analytics"]);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-dialog2', location = 'node_modules/@atlassian/aui/src/js/aui/dialog2.js' */
("undefined"===typeof window?global:window).__66741aa250e6a2e683f9b0a60bdbbfd2=function(){function f(a){return a&&a.__esModule?a:{"default":a}}function e(a){var c=this.$el=a?(0,g.default)(a):(0,g.default)(aui.dialog.dialog2({}));g.default.each(i,function(a,b){var d="data-"+a;c[0].hasAttribute(d)||c.attr(d,b)})}var h={};"use strict";Object.defineProperty(h,"__esModule",{value:!0});var g=f(__2fd777cca7fe187ff4048afabed6a6b5),j=f(__7e0423727525720eec50a0fbce0cace2),k=f(__dd0dee18d8910035abf3563b0855343d),
b=f(__32c9c638c13fb3cc78ab29b878f9b179),l=f(__c0c7dd6b9ca4bd1d92ff026738d8a472),i={"aui-focus":"false","aui-blanketed":"true"};e.prototype.on=function(a,c){(0,b.default)(this.$el).on(a,c);return this};e.prototype.off=function(a,c){(0,b.default)(this.$el).off(a,c);return this};e.prototype.show=function(){(0,b.default)(this.$el).show();return this};e.prototype.hide=function(){(0,b.default)(this.$el).hide();return this};e.prototype.remove=function(){(0,b.default)(this.$el).remove();return this};e.prototype.isVisible=
function(){return(0,b.default)(this.$el).isVisible()};var d=(0,l.default)("dialog2",e);d.on=function(a,c){b.default.on(a,".aui-dialog2",c);return this};d.off=function(a,c){b.default.off(a,".aui-dialog2",c);return this};(0,g.default)(document).on("click",".aui-dialog2-header-close",function(a){a.preventDefault();d((0,g.default)(this).closest(".aui-dialog2")).hide()});d.on("show",function(a,c){var b;[".aui-dialog2-content",".aui-dialog2-footer",".aui-dialog2-header"].some(function(a){b=c.find(a+" :aui-tabbable");
return b.length});b&&b.first().focus()});d.on("hide",function(a,c){var d=(0,b.default)(c);c.data("aui-remove-on-hide")&&d.remove()});(0,j.default)("aui/dialog2",d);(0,k.default)("dialog2",d);h.default=d;return h=h["default"]}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:dialog2', location = 'src/soy/dialog2.soy' */
// This file was automatically generated from dialog2.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.dialog.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.dialog == 'undefined') { aui.dialog = {}; }


aui.dialog.dialog2 = function(opt_data, opt_ignored) {
  return '' + aui.dialog.dialog2Chrome({id: opt_data.id, titleId: opt_data.id ? opt_data.id + '-dialog-title' : null, modal: opt_data.modal, tagName: opt_data.tagName, removeOnHide: opt_data.removeOnHide, visible: opt_data.visible, size: opt_data.size, extraClasses: opt_data.extraClasses, extraAttributes: opt_data.extraAttributes, content: '' + aui.dialog.dialog2Content({id: null, titleText: opt_data.titleText, titleContent: opt_data.titleContent, headerActionContent: opt_data.headerActionContent, headerSecondaryContent: opt_data.headerSecondaryContent, modal: opt_data.modal, content: opt_data.content, footerHintText: opt_data.footerHintText, footerHintContent: opt_data.footerHintContent, footerActionContent: opt_data.footerActionContent})});
};
if (goog.DEBUG) {
  aui.dialog.dialog2.soyTemplateName = 'aui.dialog.dialog2';
}


aui.dialog.dialog2Chrome = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'section') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ((opt_data.titleId) ? ' aria-labelledby="' + soy.$$escapeHtml(opt_data.titleId) + '"' : '') + ' role="dialog" class=" aui-layer aui-dialog2 aui-dialog2-' + soy.$$escapeHtml(opt_data.size ? opt_data.size : 'medium') + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.modal) ? 'data-aui-modal="true"' : '') + ((opt_data.removeOnHide) ? 'data-aui-remove-on-hide="true"' : '') + ((opt_data.visible != true) ? 'aria-hidden="true"' : '') + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'section') + '>';
};
if (goog.DEBUG) {
  aui.dialog.dialog2Chrome.soyTemplateName = 'aui.dialog.dialog2Chrome';
}


aui.dialog.dialog2Content = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + aui.dialog.dialog2Header({titleId: opt_data.id ? opt_data.id + '-dialog-title' : null, titleText: opt_data.titleText, titleContent: opt_data.titleContent, actionContent: opt_data.headerActionContent, secondaryContent: opt_data.headerSecondaryContent, modal: opt_data.modal}) + aui.dialog.dialog2Panel(opt_data) + aui.dialog.dialog2Footer({hintText: opt_data.footerHintText, hintContent: opt_data.footerHintContent, actionContent: opt_data.footerActionContent});
};
if (goog.DEBUG) {
  aui.dialog.dialog2Content.soyTemplateName = 'aui.dialog.dialog2Content';
}


aui.dialog.dialog2Header = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<header' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dialog2-header' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '><h2 ' + ((opt_data.titleId) ? ' id="' + soy.$$escapeHtml(opt_data.titleId) + '"' : '') + ' class="aui-dialog2-header-main">' + ((opt_data.titleText) ? soy.$$escapeHtml(opt_data.titleText) : '') + ((opt_data.titleContent) ? soy.$$filterNoAutoescape(opt_data.titleContent) : '') + '</h2>' + ((opt_data.actionContent) ? '<div class="aui-dialog2-header-actions">' + soy.$$filterNoAutoescape(opt_data.actionContent) + '</div>' : '') + ((opt_data.secondaryContent) ? '<div class="aui-dialog2-header-secondary">' + soy.$$filterNoAutoescape(opt_data.secondaryContent) + '</div>' : '') + ((opt_data.modal != true) ? '<a class="aui-dialog2-header-close"><span class="aui-icon aui-icon-small aui-iconfont-close-dialog">' + soy.$$escapeHtml("Fermer") + '</span></a>' : '') + '</header>';
};
if (goog.DEBUG) {
  aui.dialog.dialog2Header.soyTemplateName = 'aui.dialog.dialog2Header';
}


aui.dialog.dialog2Footer = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<footer' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dialog2-footer' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.actionContent) ? '<div class="aui-dialog2-footer-actions">' + soy.$$filterNoAutoescape(opt_data.actionContent) + '</div>' : '') + ((opt_data.hintText || opt_data.hintContent) ? '<div class="aui-dialog2-footer-hint">' + ((opt_data.hintText) ? soy.$$escapeHtml(opt_data.hintText) : '') + ((opt_data.hintContent) ? soy.$$filterNoAutoescape(opt_data.hintContent) : '') + '</div>' : '') + '</footer>';
};
if (goog.DEBUG) {
  aui.dialog.dialog2Footer.soyTemplateName = 'aui.dialog.dialog2Footer';
}


aui.dialog.dialog2Panel = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="aui-dialog2-content' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</div>';
};
if (goog.DEBUG) {
  aui.dialog.dialog2Panel.soyTemplateName = 'aui.dialog.dialog2Panel';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-loading-indicator', location = '/includes/js/page-loading-indicator.js' */
define("confluence/page-loading-indicator",["jquery","underscore","ajs","confluence/templates"],function(c,g,a,h){return function(b){function d(){return c(".confluence-page-loading-blanket",b)}function e(){return c(".confluence-loading-indicator",b)}return{show:function(){0===d().length&&c(b).append(h.pageLoadingIndicator());d().show();e().spin({lines:12,length:8,width:4,radius:10,trail:60,speed:1.5,color:"#F0F0F0"})},hide:function(){e().stop();d().hide()},showUntilResolved:function(c,b){this.show();
c.always(g.bind(this.hide,this));b&&c.fail(function(){a.messages.error(".confluence-page-loading-errors",{body:b})})},showUntilDialogVisible:function(b,d){var f=this,e=d||"Une erreur est survenue pendant la connexion au serveur. Veuillez r\u00e9essayer.",g=c(".aui-dialog:visible"),h=c(".aui-dialog2:visible");!g.length&&!h.length&&f.show();b.always(f.hide).fail(function(){a.messages.error(".confluence-page-loading-errors",{body:e})});a.bind("show.dialog",function i(){a.unbind("show.dialog",i);f.hide()});if(null!=a.dialog2&&void 0!=a.dialog2)a.dialog2.on("show",
function j(){a.dialog2.off("show",j);f.hide()})},destroy:function(){b.remove(".confluence-page-loading-blanket")}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence/page-loading-indicator","Confluence.PageLoadingIndicator");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-loading-indicator', location = '/includes/soy/page-loading-indicator.soy' */
// This file was automatically generated from page-loading-indicator.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }


Confluence.Templates.pageLoadingIndicator = function(opt_data, opt_ignored) {
  return '<div class="confluence-page-loading-errors"></div><div class="confluence-page-loading-blanket aui-blanket" aria-hidden="false"><div class="confluence-loading-indicator"></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.pageLoadingIndicator.soyTemplateName = 'Confluence.Templates.pageLoadingIndicator';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:event', location = '/includes/js/api/event.js' */
define("confluence/api/event",["ajs"],function(a){return{bind:function(){a.bind.apply(this,arguments)},unbind:function(){a.unbind.apply(this,arguments)},trigger:function(){a.trigger.apply(this,arguments)},stopEvent:function(){a.stopEvent.apply(this,arguments)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:deferred-loaders', location = '/includes/js/deferred-dialog-loader.js' */
define("confluence/deferred-dialog-loader",["underscore","jquery","ajs","confluence/page-loading-indicator","confluence/api/event"],function(a,d,e,g,f){return function(){var h=g(d("body"));a.each({userStatus:{resource:"confluence.userstatus:userstatus-resources",selector:"#create-user-status-link",event:"deferred.userstatus.click"},movePageDialogTools:{resource:"confluence.web.resources:page-move-resources",selector:"#action-move-page-dialog-link",event:"deferred.page-move.tools-menu"},movePageDialogEditor:{resource:"confluence.web.resources:page-move-resources",
selector:"#rte-button-location",event:"deferred.page-move.editor"},moveBlogDialogTools:{resource:"confluence.web.resources:page-move-resources",selector:"#action-move-blogpost-dialog-link",event:"deferred.blog-move.tools-menu"},availableGadgetsHelp:{resource:"com.atlassian.confluence.plugins.gadgets:gadget-directory-resources",selector:"#gadget-directory-link",event:"deferred.available-gadgets.help-menu"},aboutConfluenceHelp:{resource:"confluence.web.resources:about",selector:"#confluence-about-link",
event:"deferred.about-confluence.help-menu"}},function(b){d("body").on("click",b.selector,function(a){var c=WRM.require("wr!"+b.resource,function(){f.trigger(b.event)});h.showUntilDialogVisible(c);c=b.resource+".requested";e.Analytics?e.Analytics.triggerPrivacyPolicySafeEvent(c):f.trigger("analyticsEvent",{name:c});a.preventDefault()})})}});require("confluence/module-exporter").safeRequire("confluence/deferred-dialog-loader",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:deferred-loaders', location = '/includes/js/page-permissions-deferred-loader.js' */
define("confluence/page-permissions-deferred-loader","confluence/dark-features confluence/legacy ajs confluence/page-loading-indicator jquery wrm".split(" "),function(a,b,c,d,e,f){var g=d(e("body"));return function(a){var b=f.require("wr!com.atlassian.confluence.plugins.confluence-page-restrictions-dialog:dialog-resources",function(){c.trigger("deferred.page.permissions")});g.showUntilDialogVisible(b,"Une erreur est survenue pendant le chargement des restrictions de page. Veuillez r\u00e9essayer plus tard.");a.preventDefault()}});
require("confluence/module-exporter").safeRequire("confluence/page-permissions-deferred-loader",function(a){var b=require("ajs");b.toInit(function(c){c("body").on("click","#rte-button-restrictions,#action-page-permissions-link",a);b.bind("system-content-metadata.open-restrictions-dialog",a)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:navigator-context', location = '/includes/js/api/navigator-context.js' */
define("confluence/api/navigator-context",["confluence/meta","document"],function(g,b){var h=function(a){a=d(a);return"undefined"!==typeof a&&0!==a},d=function(a){a=g.get(a);return isNaN(a)?void 0:Number(a)},i=function(){return!!b.querySelector(".page.view")||!!b.querySelector(".blogpost.view")},e=function(){return!!b.querySelector(".page.edit")||!!b.querySelector(".blogpost.edit")},f=function(){return g.get("content-type")},c=function(){return d("page-id")};return{getCurrent:function(){return e()&&
0===c()&&h("draft-id")?{target:"contentcreate",context:{contentId:d("draft-id"),contentType:f()}}:e()&&!i()&&0!==c()?{target:"contentedit",context:{contentId:c(),contentType:f()}}:!e()&&i()&&h("page-id")?{target:"contentview",context:{contentId:c(),contentType:f()}}:{target:"unknown",context:{}}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:global-css', location = 'assets/core/js/playsql-messages.js' */
(function($){
    window.PlaySQL = window.PlaySQL || {};
    window.PlaySQL.Messages = window.PlaySQL.Messages || {};
    var idLastMessage = 1000;

    /**
     * Displays a message in the side bar
     * @param type error, warn, info
     * @param message the message
     * @param id (optional) an id
     * @returns the id
     */
    window.PlaySQL.Messages.addMessage = function(type, message, id, jqXHRResponseText){
        if (!window.PlaySQL.Messages.debugMode) {
            AJS.log("Play SQL: " + type + " - " + message + " class:" + id + " - ResponseText:" + jqXHRResponseText);
            var firstLine = jqXHRResponseText != undefined && ("\n" + jqXHRResponseText.split(/[\n\r]/)[0]) || "";
            if (firstLine.length > 100) firstLine = "";
            alert(type.charAt(0).toUpperCase() + type.substr(1) + ": " + message + firstLine);
            return id || idLastMessage++;
        }

        // Clean up
        $("p.tip:not(.playsql-message-inner)").remove();

        // Set the id
        if (id == undefined) {
            id = idLastMessage++;
        } else {
            window.PlaySQL.Messages.removeMessage(id);
        }
        var $body = $("<p></p>", {
            "class": "tip playsql-message-inner",
            id: "playsql-message-" + id,
            text: " : " + message
        }).prepend($("<b></b>").text(type.toUpperCase()));

        // Insert
        var $location = $("hr.playsql-messages");
        if ($location.size() == 0) {
            $location = $(".acs-nav .advanced-links-section").first();
            if ($location.size() == 0)
            {
                $location = $(".acs-nav hr").first();
                if ($location.size() == 0) {
                    throw "Couldn't display error because there si no sidebar - " + type + message + id;
                }
            }
            $location.after($("<hr/>", {
                "class": "playsql-messages"
            }));
            $location = $("hr.playsql-messages");
        }
        $location.after($body);
        return id;
    };
    window.PlaySQL.Messages.removeMessage = function(id){
        var $p = $("#playsql-message-" + id);
        $p.remove();

    };

    /*
     * Converts an element into a spinner.
     */
    window.PlaySQL.Messages.spin = function ($element) {
        var response = {
            on: function(delay, title){
                // This data attribute also tells whether off() was already called.
                $element.attr("data-html-replacement", $element.html());
                function establish() {
                    if (typeof $element.attr("data-html-replacement") != "undefined") {
                        $("<span></span>", {
                            "class": "aui-icon aui-icon-wait",
                            "title": title,
                            text: "Wait"
                        }).appendTo($element.empty());
                    }
                }
                if (delay == undefined)
                    establish();
                else
                    window.setTimeout(establish, delay);
                return response;
            },
            off: function() {
                var html = $element.attr("data-html-replacement");
                $element.removeAttr("data-html-replacement");
                if (html) {
                    $element.empty().html(html);
                    $element.removeAttr("data-html-replacement");
                    // This doesn't rebind the handlers
                }
            }
        };
        return response;
    }



})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:web-item-about', location = 'assets/core/js/playsql-about.js' */
AJS.$(function($){
    $(".playsql-faq").on("click", ".faq", function() {
        var $this = $(this),
            $hidden = $this.closest("li").find(".answer");
        if ($hidden.length == 1 && $hidden.parents(".playsql-faq").length) {
            $hidden.toggleClass("hidden");
        }
    });
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:blueprint-first-time-tooltip-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/first-time-tooptip.js' */
AJS.bind("sidebar.finished-loading",function(){var a=AJS.Meta.get("blueprint-index-popup-key");AJS.debug("Index key for "+a);if(a){Confluence.Blueprint.showIndexPagePopup(a)}});Confluence.Blueprint=AJS.$.extend(Confluence.Blueprint,{showIndexPagePopup:function(b){var d=function(i){return function(l,j,k){l.html(Confluence.Templates.Blueprints.sidebarIndexPagePopup({indexPageTitle:i.toLowerCase()}));k()}};var a=AJS.$(AJS.$("li.blueprint."+b)[0]);var h=a.text();var g=AJS.$(".icon",a);var f="blueprintIndexSidebarPopup";var c=AJS.InlineDialog(g.is(":visible")?g:AJS.$(".acs-nav-sections .quick-links-section"),f,d(h),{addActiveClass:false,hideDelay:null,noBind:true});AJS.$(document).bind("showLayer",function(i){var j=f+".inline-dialog-check";AJS.$("body").unbind("click."+j)});c.show();var e=function(i){AJS.$(document).on("click","#dismiss-index-popup",function(){i.hide();return false})}(c);AJS.bind("quickedit.success",function(){c.hide()})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:blueprint-first-time-tooltip-resources', location = 'com/atlassian/confluence/plugins/createcontent/soy/sidebar-index-page-popup.soy' */
// This file was automatically generated from sidebar-index-page-popup.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Blueprints.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Blueprints == 'undefined') { Confluence.Templates.Blueprints = {}; }


Confluence.Templates.Blueprints.sidebarIndexPagePopup = function(opt_data, opt_ignored) {
  return '<h2>' + soy.$$escapeHtml(AJS.format("Trouver vos {0} ici",opt_data.indexPageTitle)) + '</h2><p>' + soy.$$escapeHtml(AJS.format("Vous avez cr\xe9\xe9 une page {0}. Un raccourci a \xe9t\xe9 ajout\xe9 dans le volet lat\xe9ral, vous pourrez y trouver les autres {0} de cet espace.",opt_data.indexPageTitle)) + '</p><br/><form>' + aui.buttons.button({text: "Ignorer", id: 'dismiss-index-popup'}) + '</form>';
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.sidebarIndexPagePopup.soyTemplateName = 'Confluence.Templates.Blueprints.sidebarIndexPagePopup';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:create-from-template-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/create-from-template-macro.js' */
AJS.toInit(function(b){var a=b(".create-from-template-button");a.each(function(){var d=b(this);if(d.attr("aria-disabled")=="true"){var c={live:true,gravity:"n",title:"data-tooltip",delayIn:250,delayOut:0};d.tooltip(c)}else{d.click(function(){d.addClass("launching-dialog");Confluence.Blueprint.loadDialogAndOpenTemplate(d.data());return false})}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:create-from-template-resources', location = 'com/atlassian/confluence/plugins/createcontent/soy/create-from-template-macro.soy' */
// This file was automatically generated from create-from-template-macro.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Blueprints.CreateFromTemplate.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Blueprints == 'undefined') { Confluence.Templates.Blueprints = {}; }
if (typeof Confluence.Templates.Blueprints.CreateFromTemplate == 'undefined') { Confluence.Templates.Blueprints.CreateFromTemplate = {}; }


Confluence.Templates.Blueprints.CreateFromTemplate.macroTemplate = function(opt_data, opt_ignored) {
  return '<a class=\'aui-button create-from-template-button\'' + ((! opt_data.hasCreatePermission) ? 'aria-disabled=\'true\' data-tooltip="' + soy.$$escapeHtml("D\xe9sol\xe9, vous n\x27\xeates pas autoris\xe9 \xe0 cr\xe9er du contenu. Adressez-vous \xe0 votre administrateur d\x27espace pour demander un acc\xe8s.") + '"' : '') + 'data-space-key=\'' + soy.$$escapeHtml(opt_data.spaceKey) + '\' href=\'' + soy.$$escapeHtml(opt_data.createContentUrl) + '\'' + ((opt_data.title) ? 'data-title=\'' + soy.$$escapeHtml(opt_data.title) + '\'' : '') + ((opt_data.templateId) ? 'data-template-id=\'' + soy.$$escapeHtml(opt_data.templateId) + '\'' : '') + ((opt_data.contentBlueprintId) ? 'data-content-blueprint-id=\'' + soy.$$escapeHtml(opt_data.contentBlueprintId) + '\'' : '') + '>' + soy.$$escapeHtml(opt_data.buttonLabel) + '</a>';
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.CreateFromTemplate.macroTemplate.soyTemplateName = 'Confluence.Templates.Blueprints.CreateFromTemplate.macroTemplate';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.contributors:contributors-web-resources', location = 'com/atlassian/confluence/contributors/scripts/contributors.js' */
require(["ajs","underscore"],function(a,b){a.toInit(function(c){c("div.contributors-macro-ajax-container").each(function(){var e=c(this);var d=c.parseJSON(b.unescape(e.find(".contributors-macro-parameters")[0].innerHTML));e.text("Informations relatives aux contributeurs en cours de g\u00e9n\u00e9ration...");c.ajax({dataType:"json",url:Confluence.getContextPath()+"/rest/com.atlassian.confluence.contributors/1.0/contributors",data:d,success:function(f){if(f.errorMessage){e.text(f.errorMessage)}else{e.html(Confluence.ContributorsMacro.renderContent(f));e.find(".show-hidden-contributors").click(function(){e.find(".hidden-contributor").removeClass("hidden");c(this).parent().remove();return false})}},error:function(h,f,g){e.text("La r\u00e9cup\u00e9ration des informations relatives aux contributeurs a \u00e9chou\u00e9"+": "+g)}})})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.contributors:contributors-web-resources', location = 'com/atlassian/confluence/contributors/templates/contributors-macro.soy' */
// This file was automatically generated from contributors-macro.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.ContributorsMacro.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.ContributorsMacro == 'undefined') { Confluence.ContributorsMacro = {}; }


Confluence.ContributorsMacro.ajaxContainer = function(opt_data, opt_ignored) {
  return '<div class="contributors-macro-ajax-container"><div style="display; none;" class="contributors-macro-parameters">' + soy.$$escapeHtml(opt_data.macroParameters) + '</div></div>';
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.ajaxContainer.soyTemplateName = 'Confluence.ContributorsMacro.ajaxContainer';
}


Confluence.ContributorsMacro.renderContent = function(opt_data, opt_ignored) {
  return '<div class="plugin-contributors">' + ((opt_data.layoutStyle == 'FLAT') ? Confluence.ContributorsMacro.flatLayout(opt_data) : (opt_data.layoutStyle == 'LIST') ? Confluence.ContributorsMacro.listLayout(opt_data) : '<span>Unknown layout style</span>') + '</div>';
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.renderContent.soyTemplateName = 'Confluence.ContributorsMacro.renderContent';
}


Confluence.ContributorsMacro.flatLayout = function(opt_data, opt_ignored) {
  return '<div class="plugin-contributors"><span><span>' + Confluence.ContributorsMacro.flatContributorsList({contributors: opt_data.visibleContributors, showCount: opt_data.showCount, showTime: opt_data.showTime}) + ((opt_data.hiddenContributors.length > 0) ? ',' : '') + '</span>' + ((opt_data.hiddenContributors.length > 0) ? '<span class="hidden hidden-contributor">' + Confluence.ContributorsMacro.flatContributorsList({contributors: opt_data.hiddenContributors, showCount: opt_data.showCount, showTime: opt_data.showTime}) + '</span><span><a href="#" class="show-hidden-contributors" title="' + soy.$$escapeHtml(AJS.format("{0} plus...",opt_data.hiddenContributors.length)) + '">...</a></span>' : '') + '</span></div>';
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.flatLayout.soyTemplateName = 'Confluence.ContributorsMacro.flatLayout';
}


Confluence.ContributorsMacro.listLayout = function(opt_data, opt_ignored) {
  var output = '<div class="plugin-contributors"><ul class="contributors-list">';
  var contributorList39 = opt_data.visibleContributors;
  var contributorListLen39 = contributorList39.length;
  for (var contributorIndex39 = 0; contributorIndex39 < contributorListLen39; contributorIndex39++) {
    var contributorData39 = contributorList39[contributorIndex39];
    output += '<li>' + Confluence.ContributorsMacro.contributor({contributor: contributorData39, showCount: opt_data.showCount, showTime: opt_data.showTime}) + '</li>';
  }
  if (opt_data.hiddenContributors.length > 0) {
    output += '<li><a href="#" class="show-hidden-contributors" title="' + soy.$$escapeHtml(AJS.format("{0} plus...",opt_data.hiddenContributors.length)) + '">...</a></li>';
    var contributorList52 = opt_data.hiddenContributors;
    var contributorListLen52 = contributorList52.length;
    for (var contributorIndex52 = 0; contributorIndex52 < contributorListLen52; contributorIndex52++) {
      var contributorData52 = contributorList52[contributorIndex52];
      output += '<li class="hidden hidden-contributor">' + Confluence.ContributorsMacro.contributor({contributor: contributorData52, showCount: opt_data.showCount, showTime: opt_data.showTime}) + '</li>';
    }
  }
  output += '</ul></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.listLayout.soyTemplateName = 'Confluence.ContributorsMacro.listLayout';
}


Confluence.ContributorsMacro.flatContributorsList = function(opt_data, opt_ignored) {
  var output = '';
  var contributorList62 = opt_data.contributors;
  var contributorListLen62 = contributorList62.length;
  for (var contributorIndex62 = 0; contributorIndex62 < contributorListLen62; contributorIndex62++) {
    var contributorData62 = contributorList62[contributorIndex62];
    output += ((! (contributorIndex62 == 0)) ? ',' : '') + Confluence.ContributorsMacro.contributor({contributor: contributorData62, showCount: opt_data.showCount, showTime: opt_data.showTime});
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.flatContributorsList.soyTemplateName = 'Confluence.ContributorsMacro.flatContributorsList';
}


Confluence.ContributorsMacro.contributor = function(opt_data, opt_ignored) {
  return Confluence.Templates.User.usernameLink({username: opt_data.contributor.idString, fullName: opt_data.contributor.fullNameString, canView: false}) + ' ' + ((opt_data.showCount) ? soy.$$escapeHtml(opt_data.contributor.totalCount) : '') + ' ' + ((opt_data.showTime) ? '(' + soy.$$escapeHtml(opt_data.contributor.relativeLastActiveTimeStr) + ')' : '');
};
if (goog.DEBUG) {
  Confluence.ContributorsMacro.contributor.soyTemplateName = 'Confluence.ContributorsMacro.contributor';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.issue-status-plugin:issue-status-resources', location = 'templates/status.soy' */
// This file was automatically generated from status.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace JIRA.Template.Util.Issue.Status.
 */

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Template == 'undefined') { JIRA.Template = {}; }
if (typeof JIRA.Template.Util == 'undefined') { JIRA.Template.Util = {}; }
if (typeof JIRA.Template.Util.Issue == 'undefined') { JIRA.Template.Util.Issue = {}; }
if (typeof JIRA.Template.Util.Issue.Status == 'undefined') { JIRA.Template.Util.Issue.Status = {}; }


JIRA.Template.Util.Issue.Status.issueStatusResolver = function(opt_data, opt_ignored) {
  return '' + ((! opt_data.issueStatus) ? '<span class="aui-icon aui-icon-small aui-iconfont-help jira-issue-status-render-error" title="' + soy.$$escapeHtml("Aucune information d\x27\xe9tat de demande n\x27a \xe9t\xe9 fournie") + '"></span>' : (opt_data.issueStatus.statusCategory) ? JIRA.Template.Util.Issue.Status.issueStatus(opt_data) : JIRA.Template.Util.Issue.Status.iconStatus({name: opt_data.issueStatus.name, iconUrl: opt_data.issueStatus.iconUrl, description: opt_data.issueStatus.description, isCompact: opt_data.isCompact}));
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.issueStatusResolver.soyTemplateName = 'JIRA.Template.Util.Issue.Status.issueStatusResolver';
}


JIRA.Template.Util.Issue.Status.iconStatus = function(opt_data, opt_ignored) {
  return '<img src="' + soy.$$escapeHtml(opt_data.iconUrl) + '" width="16" height="16" alt="' + soy.$$escapeHtml(opt_data.name) + '" title="' + soy.$$escapeHtml(opt_data.name) + ((opt_data.description) ? ' - ' + soy.$$escapeHtml(opt_data.description) : '') + '" class="jira-issue-status-icon">' + ((! opt_data.isCompact) ? ' ' + soy.$$escapeHtml(opt_data.name) : '');
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.iconStatus.soyTemplateName = 'JIRA.Template.Util.Issue.Status.iconStatus';
}


JIRA.Template.Util.Issue.Status.issueStatus = function(opt_data, opt_ignored) {
  return '' + JIRA.Template.Util.Issue.Status.statusLozenge({name: opt_data.issueStatus.name, categoryKey: opt_data.issueStatus.statusCategory.key, colorName: opt_data.issueStatus.statusCategory.colorName, description: opt_data.issueStatus.description, isSubtle: opt_data.isSubtle, isCompact: opt_data.isCompact, maxWidth: opt_data.maxWidth});
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.issueStatus.soyTemplateName = 'JIRA.Template.Util.Issue.Status.issueStatus';
}


JIRA.Template.Util.Issue.Status.statusLozenge = function(opt_data, opt_ignored) {
  var output = '';
  var maxWidth__soy46 = opt_data.maxWidth ? opt_data.maxWidth : 'medium';
  var tooltipContent__soy47 = '<span class="jira-issue-status-tooltip-title">' + soy.$$escapeHtml(opt_data.name) + '</span>' + ((opt_data.description) ? '<br><span class="jira-issue-status-tooltip-desc">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '');
  output += '<span class=" jira-issue-status-lozenge aui-lozenge ' + JIRA.Template.Util.Issue.Status.statusLozengeClasses(opt_data) + ((opt_data.isSubtle && ! opt_data.isCompact) ? ' aui-lozenge-subtle' : '') + ((opt_data.isCompact) ? ' jira-issue-status-lozenge-compact' : '') + ' jira-issue-status-lozenge-max-width-' + soy.$$escapeHtml(maxWidth__soy46) + '" data-tooltip="' + soy.$$escapeHtml(tooltipContent__soy47) + '">' + soy.$$escapeHtml(opt_data.name) + '</span>';
  return output;
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.statusLozenge.soyTemplateName = 'JIRA.Template.Util.Issue.Status.statusLozenge';
}


JIRA.Template.Util.Issue.Status.statusLozengeClasses = function(opt_data, opt_ignored) {
  return 'jira-issue-status-lozenge-' + soy.$$escapeHtml(opt_data.colorName ? opt_data.colorName : 'medium-gray') + ' ' + ((opt_data.categoryKey) ? 'jira-issue-status-lozenge-' + soy.$$escapeHtml(opt_data.categoryKey) : '');
};
if (goog.DEBUG) {
  JIRA.Template.Util.Issue.Status.statusLozengeClasses.soyTemplateName = 'JIRA.Template.Util.Issue.Status.statusLozengeClasses';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.issue-status-plugin:issue-status-resources', location = '/js/issue-status-plugin.js' */
AJS.$(function(){if(AJS.$.fn.tooltip){AJS.$(".jira-issue-status-lozenge[data-tooltip]").tooltip({aria:true,gravity:AJS.$.fn.tipsy.autoWE,delayIn:100,html:true,live:true,title:"data-tooltip",className:"jira-issue-status-tooltip"})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-metadata:confluence-jira-metadata-resources', location = 'soy/jira-metadata.soy' */
// This file was automatically generated from jira-metadata.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Metadata.JIRA.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Metadata == 'undefined') { Confluence.Templates.Metadata = {}; }
if (typeof Confluence.Templates.Metadata.JIRA == 'undefined') { Confluence.Templates.Metadata.JIRA = {}; }


Confluence.Templates.Metadata.JIRA.metadata = function(opt_data, opt_ignored) {
  var output = '<div id="jira-metadata-dialog" class="rendered-content"><h2 class="title">' + soy.$$escapeHtml("Liens JIRA") + '</h2><div class="items-section">';
  var groupList6 = opt_data.groups;
  var groupListLen6 = groupList6.length;
  for (var groupIndex6 = 0; groupIndex6 < groupListLen6; groupIndex6++) {
    var groupData6 = groupList6[groupIndex6];
    if (groupData6.items.length) {
      switch (groupData6.type) {
        case 'ISSUES':
          output += Confluence.Templates.Metadata.JIRA.renderGroup({items: groupData6.items, headingText: "Demandes", type: groupData6.type, links: groupData6.links});
          break;
        case 'SPRINTS':
          output += Confluence.Templates.Metadata.JIRA.renderGroup({items: groupData6.items, headingText: "Sprints", type: groupData6.type, links: groupData6.links});
          break;
        case 'VERSIONS':
          output += Confluence.Templates.Metadata.JIRA.renderGroup({items: groupData6.items, headingText: "Versions", type: groupData6.type, links: groupData6.links});
          break;
        case 'EPICS':
          output += Confluence.Templates.Metadata.JIRA.renderGroup({items: groupData6.items, headingText: "Epics", type: groupData6.type, links: groupData6.links});
          break;
      }
    }
  }
  output += '</div>' + Confluence.Templates.Metadata.JIRA.renderAuthPrompts({appLinks: opt_data.unauthorisedAppLinks}) + Confluence.Templates.Metadata.JIRA.renderJiraErrors(opt_data) + '</div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.JIRA.metadata.soyTemplateName = 'Confluence.Templates.Metadata.JIRA.metadata';
}


Confluence.Templates.Metadata.JIRA.featureDiscovery = function(opt_data, opt_ignored) {
  return '<div id="jira-metadata-feature-discovery"><h2>' + soy.$$escapeHtml("Afficher les \xe9l\xe9ments JIRA connexes ici") + '</h2><p>' + soy.$$escapeHtml("Vous pouvez \xe0 pr\xe9sent afficher les epics, les sprints, les versions et les demandes associ\xe9s \xe0 cette page.") + '</p><div class="aui-toolbar2" role="toolbar"><div class="aui-toolbar2-inner">' + aui.buttons.button({text: "Afficher", extraClasses: 'showme'}) + aui.buttons.button({text: "Ne plus afficher ce message", type: 'link', extraClasses: 'close'}) + '</div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.JIRA.featureDiscovery.soyTemplateName = 'Confluence.Templates.Metadata.JIRA.featureDiscovery';
}


Confluence.Templates.Metadata.JIRA.nometadata = function(opt_data, opt_ignored) {
  return '<div id="jira-metadata-dialog" class="rendered-content">' + aui.message.warning({content: '<p>' + soy.$$escapeHtml("Impossible d\x27afficher les liens JIRA. Soit vous ne disposez pas des autorisations JIRA appropri\xe9es, soit les liens ont \xe9t\xe9 supprim\xe9s.") + '</p>'}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.JIRA.nometadata.soyTemplateName = 'Confluence.Templates.Metadata.JIRA.nometadata';
}


Confluence.Templates.Metadata.JIRA.renderAuthPrompts = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.appLinks.length) {
    var param66 = '';
    if (opt_data.appLinks.length == 1) {
      var appLink__soy69 = opt_data.appLinks[0];
      param66 += '<p>' + soy.$$filterNoAutoescape(AJS.format("{0}Se connecter et approuver{1} pour r\xe9cup\xe9rer des donn\xe9es aupr\xe8s de {2}",'<a class="jira-metadata-auth-link" href="#" data-href="' + appLink__soy69.authorisationUrl + '">','</a>',appLink__soy69.htmlSafeName)) + '</p>';
    } else {
      param66 += '<p>' + soy.$$escapeHtml("S\x27authentifier pour r\xe9cup\xe9rer les donn\xe9es des instances suivantes\xa0:") + '</p>';
      var appLinkList78 = opt_data.appLinks;
      var appLinkListLen78 = appLinkList78.length;
      for (var appLinkIndex78 = 0; appLinkIndex78 < appLinkListLen78; appLinkIndex78++) {
        var appLinkData78 = appLinkList78[appLinkIndex78];
        param66 += '<div><a class="jira-metadata-auth-link" href="#" data-href="' + soy.$$escapeHtml(appLinkData78.authorisationUrl) + '">' + soy.$$escapeHtml(appLinkData78.name) + '</a></div>';
      }
    }
    output += aui.message.hint({content: param66});
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.JIRA.renderAuthPrompts.soyTemplateName = 'Confluence.Templates.Metadata.JIRA.renderAuthPrompts';
}


Confluence.Templates.Metadata.JIRA.renderGroup = function(opt_data, opt_ignored) {
  var output = '<div class="jira-metadata-section ' + soy.$$escapeHtml(opt_data.type) + '-section"><div class="section-label"><span class="icon"></span><span>' + soy.$$escapeHtml(opt_data.headingText) + '</span></div><ul class="jira-metadata-list jira-' + soy.$$escapeHtml(opt_data.type) + '-list">';
  var itemList94 = opt_data.items;
  var itemListLen94 = itemList94.length;
  for (var itemIndex94 = 0; itemIndex94 < itemListLen94; itemIndex94++) {
    var itemData94 = itemList94[itemIndex94];
    output += '<li class="jira-metadata-item"><span class="item-label"><a href="' + soy.$$escapeHtml("") + '/plugins/servlet/jira-metadata/redirect?u=' + soy.$$escapeUri(itemData94.url) + '&t=' + soy.$$escapeHtml(opt_data.type) + '" title="' + soy.$$escapeHtml(itemData94.name) + '">' + soy.$$escapeHtml(itemData94.name) + '</a>' + ((itemData94.status) ? '&nbsp;' + ((itemData94.status.statusCategory) ? JIRA.Template.Util.Issue.Status.issueStatusResolver({issueStatus: itemData94.status, isSubtle: true}) : '<span class="item-status">(' + soy.$$escapeHtml(itemData94.status.name) + ')</span>') : '') + '</span>' + ((itemData94.description != '') ? '<span class="item-subtext">' + soy.$$escapeHtml(itemData94.description) + '</span>' : '') + '</li>';
  }
  output += '</ul><ul class="jira-metadata-list ' + soy.$$escapeHtml(opt_data.type) + '-more-link">';
  var linkList130 = opt_data.links;
  var linkListLen130 = linkList130.length;
  for (var linkIndex130 = 0; linkIndex130 < linkListLen130; linkIndex130++) {
    var linkData130 = linkList130[linkIndex130];
    output += '<li class="jira-metadata-item"><a href="' + soy.$$escapeHtml("") + '/plugins/servlet/jira-metadata/redirect?u=' + soy.$$escapeUri(linkData130.url) + '&t=' + soy.$$escapeHtml(opt_data.type) + '&more">' + soy.$$escapeHtml(AJS.format("En afficher {0} de plus dans {1}",linkData130.numItems,linkData130.appName)) + '</a></li>';
  }
  output += '</ul></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.JIRA.renderGroup.soyTemplateName = 'Confluence.Templates.Metadata.JIRA.renderGroup';
}


Confluence.Templates.Metadata.JIRA.loadingMetadata = function(opt_data, opt_ignored) {
  return '<div id="jira-metadata-dialog"><h2 class="title">' + soy.$$escapeHtml("Liens JIRA") + '</h2><div class="spinner-container"><div class="spinner"></div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.JIRA.loadingMetadata.soyTemplateName = 'Confluence.Templates.Metadata.JIRA.loadingMetadata';
}


Confluence.Templates.Metadata.JIRA.renderJiraErrors = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.errors.length == 1) {
    var error__soy150 = opt_data.errors[0];
    output += aui.message.warning({content: '<p>' + soy.$$escapeHtml("Impossible de r\xe9cup\xe9rer les m\xe9tadonn\xe9es JIRA.") + ' ' + soy.$$escapeHtml(error__soy150.errorMessage) + '</p>'});
  } else if (opt_data.errors.length > 1) {
    var param159 = '<p>' + soy.$$escapeHtml("Impossible de r\xe9cup\xe9rer les m\xe9tadonn\xe9es JIRA. Les erreurs suivantes sont survenues\xa0:") + '</p><ul>';
    var errorList163 = opt_data.errors;
    var errorListLen163 = errorList163.length;
    for (var errorIndex163 = 0; errorIndex163 < errorListLen163; errorIndex163++) {
      var errorData163 = errorList163[errorIndex163];
      param159 += '<li>' + soy.$$escapeHtml(errorData163.errorMessage) + '</li>';
    }
    param159 += '</ul>';
    output += aui.message.warning({content: param159});
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.JIRA.renderJiraErrors.soyTemplateName = 'Confluence.Templates.Metadata.JIRA.renderJiraErrors';
}


Confluence.Templates.Metadata.JIRA.unknownError = function(opt_data, opt_ignored) {
  return '<div id="jira-metadata-dialog" class="rendered-content">' + aui.message.warning({content: '<p>' + soy.$$escapeHtml("Impossible de r\xe9cup\xe9rer les m\xe9tadonn\xe9es JIRA. Impossible de se connecter \xe0 Confluence") + '</p>'}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Metadata.JIRA.unknownError.soyTemplateName = 'Confluence.Templates.Metadata.JIRA.unknownError';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-metadata:confluence-jira-metadata-resources', location = '/js/jira-metadata.js' */
AJS.toInit(function(h){var i="com.atlassian.confluence.plugins.confluence-jira-metadata";var s=false;var o;var l;var q="jira-metadata-dialog";var g=h("#content-metadata-jira");var t;var e="jira-metadata-discovery";var r=AJS.Meta.get("jira-metadata-count");var k="linked-issues-dropdown";if(r>0){p(r,AJS.Meta.get("jira-metadata-count-incomplete"))}else{if(r==-1){h.ajax({url:AJS.contextPath()+"/rest/jira-metadata/1.0/metadata/aggregate?pageId="+AJS.Meta.get("page-id"),type:"GET",dataType:"json",contentType:"application/json",cache:false,success:function(u){if(u.count>0){p(u.count,u.incomplete)}}})}}function p(v,u){f(v,u);g.removeClass("hidden");if(b()){o=AJS.InlineDialog(g,q,function(x,w,y){AJS.trigger("analytics",{name:"confluence.jira.metadata.expanded"});if(!l||!s){l=x;y();a(x)}else{y()}return false},{hideDelay:null});g.click(function(){if(h("#"+q).is(":visible")){o.hide()}})}if(g&&j()){m();g.one("click",function(){Confluence.FeatureDiscovery.forPlugin(i).markDiscovered(k)})}}function f(v,u){if(!u){h("#content-metadata-jira > span").text(v==1?"1\u00a0lien JIRA":AJS.format("{0} liens JIRA",v))}}function b(){return !g.attr("href")}function m(){t=AJS.InlineDialog(g,e,function(v,u,w){v.html(Confluence.Templates.Metadata.JIRA.featureDiscovery());v.find(".showme").on("click",function(){Confluence.FeatureDiscovery.forPlugin(i).markDiscovered(k);t.hide();o.show()});v.find(".close").on("click",function(){Confluence.FeatureDiscovery.forPlugin(i).markDiscovered(k);t.hide()});w()},{noBind:true,closeOthers:false,hideDelay:null});t.show();Confluence.FeatureDiscovery.forPlugin(i).addDiscoveryView(k)}function j(){return !AJS.Meta.get("blueprint-index-popup-key")&&Confluence.FeatureDiscovery.forPlugin(i).shouldShow(k)}function a(){d();l.html(Confluence.Templates.Metadata.JIRA.loadingMetadata());l.find(".spinner").spin("medium");h.ajax({url:AJS.contextPath()+"/rest/jira-metadata/1.0/metadata?pageId="+AJS.Meta.get("page-id"),type:"GET",dataType:"json",contentType:"application/json",error:function(u){c();l.html(Confluence.Templates.Metadata.JIRA.unknownError())},success:function(u){c();s=true;f(u.count,false);var v;if(u.count===0&&!(u.unauthorisedAppLinks&&u.unauthorisedAppLinks.length>0)&&u.errors.length==0){AJS.trigger("analytics",{name:"confluence.jira.metadata.error.no-metadata"});v=Confluence.Templates.Metadata.JIRA.nometadata()}else{v=Confluence.Templates.Metadata.JIRA.metadata(u)}l.html(v);setTimeout(function(){l.find("#"+q).addClass("show")},0);n()},complete:function(){h("#"+q+" .icon-close").click(function(u){u.stopPropagation();h(this).closest(".closable").remove()})}})}function n(){h(".jira-metadata-auth-link").click(function(u){u.preventDefault();AppLinks.authenticateRemoteCredentials(h(this).data("href"),a,function(){})})}function d(){if(l&&l.height()>0){l.css("height",l.height())}}function c(){l&&l.css("height","")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-loader', location = 'com/atlassian/confluence/plugins/createjiracontent/js/page-helper.js' */
AJS.toInit(function(d){var c="com.atlassian.confluence.plugins.confluence-jira-content:create-JIRA-issue-summary";var g="wr!com.atlassian.confluence.plugins.confluence-jira-content:confluence-jira-content-resources";var b="Chargement en cours\u2026";var e=false;var j=d("div.jira-issues-created");if(j.length>0){if(window.history&&window.history.replaceState){var h=window.location.href;var i=h.substr(0,h.indexOf("JIRAIssuesCreated")-1);window.history.replaceState({},document.title,i)}var a=j.find("#jira-content-message-panel-error-warning");var f=j.find("#jira-content-message-panel-view-more-link");f.click(function(k){k.preventDefault();f.hide();a.show()});if(j.hasClass("success")){setTimeout(function(){j.hide()},10000)}}Confluence&&Confluence.HighlightAction&&Confluence.HighlightAction.registerButtonHandler(c,{onClick:function(l){var k;if(!e){var m=function(o,n,p){o.html('<span class="aui-icon aui-icon-wait"></span> '+b);p();return false};k=d("<div>");Confluence.CreateJiraContent.Dialogs.appendDialogTarget(l.area.average,k);dialog=Confluence.ScrollingInlineDialog(k,"create-issue-loading-dialog",m,{});dialog.show();e=true}WRM.require(g).done(function(){if(Confluence.CreateJiraContent.FeatureDiscovery.shouldShowFeatureDiscovery()){Confluence.CreateJiraContent.Dialogs.showFeatureDiscoveryDialog(l)}else{Confluence.CreateJiraContent.Dialogs.showCreateIssueDialog(l)}if(typeof k!=="undefined"){k.remove()}})},shouldDisplay:Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY});Confluence.CreateJiraContent={Dialogs:{}};Confluence.CreateJiraContent.Dialogs.appendDialogTarget=function(l,k){Confluence.DocThemeUtils.appendAbsolutePositionedElement(k);k.css({top:l.top,height:l.height,left:l.left,width:l.width,"z-index":-9999,position:"absolute"}).addClass("confluence-jira-content-dialog-target")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:soy-resources', location = 'soy/sidebar.soy' */
// This file was automatically generated from sidebar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Sidebar.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Sidebar == 'undefined') { Confluence.Templates.Sidebar = {}; }


Confluence.Templates.Sidebar.headerStyles = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.sidebarWidth) ? '<style>.ia-fixed-sidebar, .ia-splitter-left {width: ' + soy.$$escapeHtml(opt_data.sidebarWidth) + 'px;}.theme-default .ia-splitter #main {margin-left: ' + soy.$$escapeHtml(opt_data.sidebarWidth) + 'px;}.ia-fixed-sidebar {visibility: hidden;}</style>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.headerStyles.soyTemplateName = 'Confluence.Templates.Sidebar.headerStyles';
}


Confluence.Templates.Sidebar.sidebar = function(opt_data, opt_ignored) {
  return '<div class="acs-side-bar ia-scrollable-section"><div class="acs-side-bar-space-info tipsy-enabled" data-configure-tooltip="' + soy.$$escapeHtml("Modifier les informations relatives \xe0 l\u2019espace") + '"><div class="avatar"><div class="space-logo" data-key="' + soy.$$escapeHtml(opt_data.space.key) + '" data-name="' + soy.$$escapeHtml(opt_data.space.name) + '" data-entity-type="confluence.space"><div class="avatar-img-container"><div class="avatar-img-wrapper"><a href="' + soy.$$escapeHtml(opt_data.space.homeUrl) + '" title="' + soy.$$escapeHtml(opt_data.space.name) + '"><img class="avatar-img" src="' + soy.$$escapeHtml(opt_data.space.logoUrl) + '" alt="' + soy.$$escapeHtml(opt_data.space.name) + '"></a></div></div></div></div><div class="space-information-container"><div class="name"><a href="' + soy.$$escapeHtml(opt_data.space.homeUrl) + '" title="' + soy.$$escapeHtml(opt_data.space.name) + '">' + soy.$$escapeHtml(opt_data.space.name) + '</a></div><div class="flyout-handle icon"></div>' + ((opt_data.hasFavouriteSpacePermission) ? '<div class="favourite-space-icon">' + Confluence.Templates.Sidebar.renderFavouriteSpace(opt_data) + '</div>' : '') + '</div></div><div class="acs-side-bar-content"><div class="acs-nav-wrapper"><div class="acs-nav" data-has-create-permission="' + soy.$$escapeHtml(opt_data.hasCreatePermission) + '" data-quick-links-state="' + soy.$$escapeHtml(opt_data.quickLinksState) + '" data-page-tree-state="' + soy.$$escapeHtml(opt_data.pageTreeState) + '" data-nav-type="' + soy.$$escapeHtml(opt_data.navType) + '">' + Confluence.Templates.Sidebar.renderLinks(opt_data) + '</div></div>' + ((opt_data.contextualNav) ? Confluence.Templates.Sidebar.contextualNav(opt_data) : '') + '</div><div class="hidden"><a href="' + soy.$$escapeHtml(opt_data.space.browseSpaceUrl) + '" id="space-pages-link"></a><script type="text/x-template" title="logo-config-content"><h2>' + soy.$$escapeHtml("D\xe9tails de l\x27espace") + '</h2><div class="personal-space-logo-hint">' + soy.$$filterNoAutoescape(AJS.format("Votre photo de profil est utilis\xe9e comme logo pour votre espace personnel. \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3eChanger votre photo de profil\x3c/a\x3e.","" + '/users/profile/editmyprofilepicture.action')) + '</div><\/script></div></div>' + Confluence.Templates.Sidebar.renderSpaceToolsSection({advancedLinks: opt_data.advancedLinks, hasConfigurePermission: opt_data.hasConfigurePermission, currentlyViewed: opt_data.collectorToHighlight == 'spacebar-advanced'});
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.sidebar.soyTemplateName = 'Confluence.Templates.Sidebar.sidebar';
}


Confluence.Templates.Sidebar.renderFavouriteSpace = function(opt_data, opt_ignored) {
  return '<button title="' + soy.$$escapeHtml("Ajoutez \xe0 vos espaces") + '" id="space-favourite-add" class="space-favourite aui-icon aui-icon-small aui-iconfont-unstar"></button><button class="' + ((! opt_data.isFavouriteSpace) ? ' space-favourite-hidden ' : '') + ' space-favourite aui-icon aui-icon-small aui-iconfont-star" id="space-favourite-remove" title="' + soy.$$escapeHtml("Supprimez de vos espaces") + '"></button>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderFavouriteSpace.soyTemplateName = 'Confluence.Templates.Sidebar.renderFavouriteSpace';
}


Confluence.Templates.Sidebar.renderLinks = function(opt_data, opt_ignored) {
  return '<div class="acs-nav-sections">' + ((opt_data.mainLinks.length) ? Confluence.Templates.Sidebar.renderLinksSection({links: opt_data.mainLinks, sectionClass: 'main-links-section', collectorToHighlight: opt_data.collectorToHighlight}) : '') + ((opt_data.quickLinksState != 'hide') ? '<div class="quick-links-wrapper">' + ((opt_data.quickLinks.length) ? '<h5 class="ia-quick-links-header-title">' + soy.$$escapeHtml("Raccourcis espace") + '</h5>' + Confluence.Templates.Sidebar.renderLinksSection({links: opt_data.quickLinks, sectionClass: 'quick-links-section tipsy-enabled', collectorToHighlight: null}) : (opt_data.hasConfigurePermission) ? '<h5 class="ia-quick-links-header-title">' + soy.$$escapeHtml("Raccourcis espace") + '</h5><p class="tip">' + soy.$$filterNoAutoescape(AJS.format("Vous pouvez ajouter ici des liens pour les pages les plus importantes pour votre \xe9quipe ou votre projet. \x3ca href\x3d\x22{0}\x22 class\x3d\x22{1}\x22\x3e Configurer la barre lat\xe9rale \x3c/a\x3e.",'','configure-sidebar')) + '</p>' : '') + '</div>' : '') + ((opt_data.hasSidebarCustomisation) ? Confluence.Templates.Sidebar.renderCustomContent(opt_data) : '') + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderLinks.soyTemplateName = 'Confluence.Templates.Sidebar.renderLinks';
}


Confluence.Templates.Sidebar.renderCustomContent = function(opt_data, opt_ignored) {
  return '<div class="custom-sidebar"><div class="custom-sidebar-content"><div class="content">' + soy.$$filterNoAutoescape(opt_data.sidebarCustomisation) + '</div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderCustomContent.soyTemplateName = 'Confluence.Templates.Sidebar.renderCustomContent';
}


Confluence.Templates.Sidebar.renderLinksSection = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.links.length) {
    output += '<div class="' + soy.$$escapeHtml(opt_data.sectionClass) + ' ' + ((opt_data.highlightSection) ? ' current-section' : '') + '"><ul class="acs-nav-list">';
    var linkList129 = opt_data.links;
    var linkListLen129 = linkList129.length;
    for (var linkIndex129 = 0; linkIndex129 < linkListLen129; linkIndex129++) {
      var linkData129 = linkList129[linkIndex129];
      output += '<li class="acs-nav-item ' + soy.$$escapeHtml(linkData129.styleClass) + ((opt_data.collectorToHighlight && linkData129.collectorKey == opt_data.collectorToHighlight) ? ' current-item' : '') + '"' + ((linkData129.collectorKey) ? 'data-collector-key="' + soy.$$escapeHtml(linkData129.collectorKey) + '"' : '') + '><a class="acs-nav-item-link tipsy-enabled" href="' + soy.$$escapeHtml(linkData129.url) + '" data-collapsed-tooltip="' + soy.$$escapeHtml(linkData129.tooltip) + '"><span class="icon"></span><span class="acs-nav-item-label">' + soy.$$escapeHtml(linkData129.title) + '</span></a></li>';
    }
    output += '</ul></div>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderLinksSection.soyTemplateName = 'Confluence.Templates.Sidebar.renderLinksSection';
}


Confluence.Templates.Sidebar.contextualNav = function(opt_data, opt_ignored) {
  return '<div class="ia-secondary-container tipsy-enabled" data-tree-type="' + ((opt_data.forBlogs) ? 'blogs' : (opt_data.forSettings) ? 'settings' : soy.$$escapeHtml(opt_data.navType)) + '">' + ((opt_data.pageTreeState != 'hide') ? (opt_data.forBlogs) ? '<div class="ia-secondary-header"><h5 class="ia-secondary-header-title blog"><span class="icon"></span><span class="label">' + soy.$$escapeHtml("Blog") + '</span></h5></div><div class="ia-secondary-content">' + Confluence.Templates.Sidebar.pagetreeList({pagetree: opt_data.contextualNav}) + '</div>' : (opt_data.forSettings) ? '<div class="ia-secondary-header"><h5 class="ia-secondary-header-title settings"><span class="label">' + soy.$$escapeHtml("Avanc\xe9") + '</span></h5></div><div class="ia-secondary-content">' + Confluence.Templates.Sidebar.pagetreeList({pagetree: opt_data.contextualNav}) + '</div>' : (opt_data.navType == 'page-tree') ? '<div class="ia-secondary-header"><h5 class="ia-secondary-header-title page-tree"><span class="icon"></span><span class="label">' + soy.$$escapeHtml("Arborescence des pages") + '</span></h5></div>' + ((opt_data.pageTreeEmpty) ? '<p class="tip">' + soy.$$filterNoAutoescape(AJS.format("Commencez par ajouter des pages \xe0 cet espace. \x3ca href\x3d\x22{0}\x22 class\x3d\x22{1}\x22\x3eCr\xe9er la page\x3c/a\x3e.","" + '/pages/createpage.action?spaceKey=' + opt_data.space.key,'page-tree-create-child-page-link')) + '</p>' : '<div class="ia-secondary-content">' + soy.$$filterNoAutoescape(opt_data.contextualNav) + '</div>') : Confluence.Templates.Sidebar.Pages.renderPageContextualNav({pageContextualNav: opt_data.contextualNav, hasCreatePermission: opt_data.hasCreatePermission}) : '') + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.contextualNav.soyTemplateName = 'Confluence.Templates.Sidebar.contextualNav';
}


Confluence.Templates.Sidebar.pagetreeList = function(opt_data, opt_ignored) {
  var output = '<ul class="' + ((opt_data.isSubtree) ? 'ia-subpagetree' : 'ia-pagetree') + '">';
  var itemList205 = opt_data.pagetree;
  var itemListLen205 = itemList205.length;
  for (var itemIndex205 = 0; itemIndex205 < itemListLen205; itemIndex205++) {
    var itemData205 = itemList205[itemIndex205];
    output += Confluence.Templates.Sidebar.pagetreeItem(itemData205);
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.pagetreeList.soyTemplateName = 'Confluence.Templates.Sidebar.pagetreeList';
}


Confluence.Templates.Sidebar.throbber = function(opt_data, opt_ignored) {
  return '<div class="content-container"><div class="throbber-container"><div class="throbber"><div class="spinner"></div><span>' + soy.$$escapeHtml("Chargement en cours...") + '</span></div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.throbber.soyTemplateName = 'Confluence.Templates.Sidebar.throbber';
}


Confluence.Templates.Sidebar.treeThrobber = function(opt_data, opt_ignored) {
  return '<ul class="ia-subpagetree"><li class="acs-tree-item leaf"><span class="node-title">' + soy.$$escapeHtml("Chargement en cours...") + '</span></li></ul>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.treeThrobber.soyTemplateName = 'Confluence.Templates.Sidebar.treeThrobber';
}


Confluence.Templates.Sidebar.pagetreeItem = function(opt_data, opt_ignored) {
  return '<li class="acs-tree-item' + ((opt_data.hasChildren) ? (opt_data.children.length) ? ' opened' : ' closed' : ' leaf') + ((opt_data.groupType) ? ' grouping' : '') + ((opt_data.active) ? ' current-item' : '') + '"' + ((opt_data.pageId) ? ' data-page-id="' + soy.$$escapeHtml(opt_data.pageId) + '"' : '') + ((opt_data.groupType) ? ' data-group-type="' + soy.$$escapeHtml(opt_data.groupType) + '" data-group-value="' + soy.$$escapeHtml(opt_data.groupValue) + '"' : '') + '>' + ((! opt_data.groupType) ? '<a href="' + soy.$$escapeHtml(opt_data.url) + '">' : '') + '<span class="icon ' + ((opt_data.hasChildren) ? (opt_data.children.length) ? 'icon-section-opened' : 'icon-section-closed' : '') + '"></span><span class="node-title navigation-pseudo-link">' + soy.$$escapeHtml(opt_data.title) + '</span>' + ((! opt_data.groupType) ? '</a>' : '') + ((opt_data.children && opt_data.children.length > 0) ? Confluence.Templates.Sidebar.pagetreeList({pagetree: opt_data.children, isSubtree: true}) : '') + '</li>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.pagetreeItem.soyTemplateName = 'Confluence.Templates.Sidebar.pagetreeItem';
}


Confluence.Templates.Sidebar.renderSpaceToolsSection = function(opt_data, opt_ignored) {
  var output = '<div class="space-tools-section"><div id="space-tools-menu-additional-items" class="hidden">';
  var linkList275 = opt_data.advancedLinks;
  var linkListLen275 = linkList275.length;
  for (var linkIndex275 = 0; linkIndex275 < linkListLen275; linkIndex275++) {
    var linkData275 = linkList275[linkIndex275];
    output += '<div data-label="' + soy.$$escapeHtml(linkData275.title) + '" data-class="' + soy.$$escapeHtml(linkData275.styleClass) + '" data-href="' + soy.$$escapeHtml(linkData275.url) + '">' + soy.$$escapeHtml(linkData275.title) + '</div>';
  }
  output += ((opt_data.hasConfigurePermission) ? '<div data-label="' + soy.$$escapeHtml("Configurer le volet lat\xe9ral") + '" data-class="configure-sidebar" data-href="">' + soy.$$escapeHtml("Configurer le volet lat\xe9ral") + '</div>' : '') + '</div>' + aui.dropdown2.trigger({menu: {id: 'space-tools-menu'}, id: 'space-tools-menu-trigger', tagName: 'button', extraClasses: 'aui-button aui-button-subtle tipsy-enabled' + ((opt_data.currentlyViewed) ? ' current-item' : ''), content: aui.icons.icon({useIconFont: true, icon: 'configure', accessibilityText: "Configurer"}) + '<span class="aui-button-label">' + soy.$$escapeHtml("Outils de l\x27espace") + '</span>'}) + aui.dropdown2.contents({id: 'space-tools-menu', extraClasses: 'aui-style-default space-tools-dropdown', extraAttributes: {'data-aui-alignment': 'top left'}}) + '<a class="expand-collapse-trigger"></a></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.renderSpaceToolsSection.soyTemplateName = 'Confluence.Templates.Sidebar.renderSpaceToolsSection';
}


Confluence.Templates.Sidebar.spaceToolsMenu = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.isAuiFiveSeven) {
    output += '<div class="space-tools-menu"><div class="aui-dropdown2-section"><ul class="space-tools-navigation">';
    var linkList320 = opt_data.spaceToolLinks;
    var linkListLen320 = linkList320.length;
    for (var linkIndex320 = 0; linkIndex320 < linkListLen320; linkIndex320++) {
      var linkData320 = linkList320[linkIndex320];
      output += '<li><a href="' + soy.$$escapeHtml(linkData320.href) + '" title="' + soy.$$escapeHtml(linkData320.label) + '">' + soy.$$escapeHtml(linkData320.label) + '</a></li>';
    }
    output += '</ul></div>';
    if (opt_data.spaceLinks.length > 0) {
      output += '<div class="aui-dropdown2-section"><ul class="space-operations">';
      var linkList333 = opt_data.spaceLinks;
      var linkListLen333 = linkList333.length;
      for (var linkIndex333 = 0; linkIndex333 < linkListLen333; linkIndex333++) {
        var linkData333 = linkList333[linkIndex333];
        output += '<li><a class="' + soy.$$escapeHtml(linkData333.className) + '" href="' + soy.$$escapeHtml(linkData333.href) + '" title="' + soy.$$escapeHtml(linkData333.label) + '">' + soy.$$escapeHtml(linkData333.label) + '</a></li>';
      }
      output += '</ul></div>';
    }
    output += '</div>';
  } else {
    output += aui.dropdown2.itemGroup({isTruncated: true, items: opt_data.spaceToolLinks, extraClasses: 'space-tools-navigation'}) + ((opt_data.spaceLinks.length > 0) ? aui.dropdown2.itemGroup({isTruncated: true, items: opt_data.spaceLinks, extraClasses: 'space-operations'}) : '');
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.spaceToolsMenu.soyTemplateName = 'Confluence.Templates.Sidebar.spaceToolsMenu';
}


Confluence.Templates.Sidebar.configure = function(opt_data, opt_ignored) {
  return '<div class="acs-nav-sections"><table id="acs-nav-list-main" class="acs-nav-list"></table><div class="acs-nav-list-quick-section' + ((opt_data.quickLinksState == 'hide') ? ' hidden-section' : '') + '"><div class="quick-links-header"><h5>' + soy.$$escapeHtml("Raccourcis espace") + '</h5><a href="#" class="aui-icon aui-icon-small toggle-link" data-tooltip="' + soy.$$escapeHtml("Masquer / afficher les raccourcis espace") + '"/></div><table id="acs-nav-list-quick" class="acs-nav-list"></table><p class="tip">' + soy.$$escapeHtml("Cliquez sur \x22Ajouter lien\x22 pour ajouter des liens au volet lat\xe9ral.") + '</p><a class="acs-add-link" href="#"><span class="icon"></span><span class="label">' + soy.$$escapeHtml("Ajouter un lien") + '</span></a></div>' + ((opt_data.hasSidebarCustomisation) ? '<p class="tip">' + soy.$$filterNoAutoescape(AJS.format("Vous pouvez continuer de modifier votre volet lat\xe9ral personnalis\xe9 dans l\x27\x27administration de l\x27\x27espace. \x3ca href\x3d\x22{0}\x22 class\x3d\x22{1}\x22\x3eAller \xe0 l\x27\x27administration de l\x27\x27espace\x3c/a\x3e.",opt_data.customContentAdminLink,'custom-sidebar-tip')) + '</p>' + Confluence.Templates.Sidebar.renderCustomContent(opt_data) : '') + '<div class="acs-nav-list-page-tree-section' + ((opt_data.pageTreeState == 'hide') ? ' hidden-section' : '') + '"><div class="page-tree-header"><h5>' + soy.$$escapeHtml("Options d\x27affichage du navigateur") + '</h5><a href="#" class="aui-icon aui-icon-small toggle-link" data-tooltip="' + soy.$$escapeHtml("Masquer / Afficher les options d\x27affichage de navigation") + '"/></div><form class="aui page-tree-options"><div class="radio"><input ' + ((opt_data.pageTreeState == 'hide') ? 'disabled ' : '') + ' class="radio acs-nav-type" type="radio" name="nav-type" value="pages" id="nav-type-pages" ' + ((! opt_data.pageTree) ? 'checked' : '') + '><label for="nav-type-pages">' + soy.$$escapeHtml("Pages enfant") + '</label></div><div class="radio"><input ' + ((opt_data.pageTreeState == 'hide') ? 'disabled ' : '') + ' class="radio acs-nav-type" type="radio" name="nav-type" value="page-tree" id="nav-type-tree" ' + ((opt_data.pageTree) ? 'checked' : '') + '><label for="nav-type-tree">' + soy.$$escapeHtml("Arborescence des pages") + '</label></div></form></div><button class="aui-style aui-button acs-done-link">' + soy.$$escapeHtml("Termin\xe9") + '</button></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.configure.soyTemplateName = 'Confluence.Templates.Sidebar.configure';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:soy-resources', location = 'soy/sidebar-pages.soy' */
// This file was automatically generated from sidebar-pages.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Sidebar.Pages.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Sidebar == 'undefined') { Confluence.Templates.Sidebar = {}; }
if (typeof Confluence.Templates.Sidebar.Pages == 'undefined') { Confluence.Templates.Sidebar.Pages = {}; }


Confluence.Templates.Sidebar.Pages.renderPageContextualNav = function(opt_data, opt_ignored) {
  return '<div class="ia-secondary-header"><h5 class="ia-secondary-header-title pages"><span class="label">' + soy.$$escapeHtml("Pages enfant") + '</span></h5></div><div class="ia-secondary-parent-content">' + Confluence.Templates.Sidebar.Pages.parentPage({parentPage: opt_data.pageContextualNav.parentPage}) + '</div><div class="ia-secondary-current-content">' + Confluence.Templates.Sidebar.Pages.currentPage({currentPage: opt_data.pageContextualNav.currentPage}) + '</div><div class="ia-secondary-content">' + Confluence.Templates.Sidebar.Pages.childPages({children: opt_data.pageContextualNav, createPermission: opt_data.hasCreatePermission}) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.renderPageContextualNav.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.renderPageContextualNav';
}


Confluence.Templates.Sidebar.Pages.childPages = function(opt_data, opt_ignored) {
  return '<div class="contextual-nav-child-pages">' + ((opt_data.children.initialChildPages.length) ? '<ul class="children">' + Confluence.Templates.Sidebar.Pages.renderChildren({children: opt_data.children.initialChildPages}) + '</ul>' + ((opt_data.children.remainingChildPages.length) ? '<ul class="more-children">' + Confluence.Templates.Sidebar.Pages.renderChildren({children: opt_data.children.remainingChildPages}) + '</ul><a class="more-children-link" href=""><span class="icon"></span><span class="label">' + soy.$$escapeHtml(AJS.format("{0} pages enfant de plus",opt_data.children.remainingChildPages.length)) + '</span></a>' : '') : '') + ((opt_data.createPermission && opt_data.children.createLink) ? '<a class="create-child-page-link" href="' + soy.$$escapeHtml(opt_data.children.createLink) + '"><span class="icon"></span><span class="label">' + soy.$$escapeHtml("Cr\xe9er une page enfant") + '</span></a>' : '') + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.childPages.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.childPages';
}


Confluence.Templates.Sidebar.Pages.currentPage = function(opt_data, opt_ignored) {
  return '' + ((opt_data.currentPage) ? '<ul class="ia-secondary-currentPage-title wiki' + ((opt_data.currentPage.active) ? ' current-item' : '') + '"><li><span class="icon"></span><span class="label">' + soy.$$escapeHtml(opt_data.currentPage.title) + '</span></li></ul>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.currentPage.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.currentPage';
}


Confluence.Templates.Sidebar.Pages.parentPage = function(opt_data, opt_ignored) {
  return '' + ((opt_data.parentPage) ? '<ul class="parent ia-secondary-header-title wiki' + ((opt_data.parentPage.active) ? ' current-item' : '') + '"><li class="parent-item"><a class="parent-item-link" href="' + soy.$$escapeHtml(opt_data.parentPage.url) + '" title="' + soy.$$escapeHtml(opt_data.parentPage.title) + '"><span class="icon"></span><span class="label">' + soy.$$escapeHtml(opt_data.parentPage.title) + '</span></a></li></ul>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.parentPage.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.parentPage';
}


Confluence.Templates.Sidebar.Pages.renderChildren = function(opt_data, opt_ignored) {
  var output = '';
  var childList65 = opt_data.children;
  var childListLen65 = childList65.length;
  for (var childIndex65 = 0; childIndex65 < childListLen65; childIndex65++) {
    var childData65 = childList65[childIndex65];
    output += '<li class="child-item" data-page-id="' + soy.$$escapeHtml(childData65.pageId) + '"><span class="icon"></span><a href="' + soy.$$escapeHtml(childData65.url) + '" title="' + soy.$$escapeHtml(childData65.title) + '"><span class="label">' + soy.$$escapeHtml(childData65.title) + '</span></a></li>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Sidebar.Pages.renderChildren.soyTemplateName = 'Confluence.Templates.Sidebar.Pages.renderChildren';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.editor-loader:background-loading-editor', location = 'jscripts/editor-loader.js' */
define("confluence-editor-loader/editor-loader","jquery confluence/legacy confluence/meta confluence/aui-overrides ajs wrm window".split(" "),function(d,j,h,l,e,m,n){var b,c={_listening:false,_queuedHandlers:[],_watchHandler:function(){j.Editor.UI.toggleWatchPage(false)},_unwatchHandler:function(){j.Editor.UI.toggleWatchPage(true)},_createQueueAdder:function(a){return function(){c._listening&&c._queuedHandlers.push(a)}},bind:function(){e.bind("watchpage.pageoperation",this._createQueueAdder(this._watchHandler));
e.bind("unwatchpage.pageoperation",this._createQueueAdder(this._unwatchHandler))},setListening:function(a){this._listening=a},applyHandlers:function(){for(var a=this._queuedHandlers.pop();a;){a();a=this._queuedHandlers.pop()}}};c.setListening(true);c.bind();var k=function(){var a=d("#editor-preload-container");a.length||(a=d('<div id="editor-preload-container" style="display: none;"></div>'));return a},f;return{getPreloadContainer:k,getEditorPreloadMarkup:function(){if(f)return f;var a=e.contextPath()+
"/plugins/editor-loader/editor.action";return f=d.get(a,{parentPageId:h.get("parent-page-id"),pageId:h.get("page-id"),spaceKey:h.get("space-key"),atl_after_login_redirect:n.location.pathname,timeout:e.Confluence.EditorLoader.loadingTimeout})},resourcesLoaded:function(){return b&&b.isResolved()},loadingTimeout:12E3,isEditorActive:function(){var a=d("#editor-preload-container");return a.length&&a.is(":visible")},load:function(a,c){var g;if(b){b.fail(function(){c?c.call(this,arguments):e.log("EditorLoader: loadGuard - previous load failed.")});
b.done(function(){a?b.done(function(){setTimeout(a,0)}):e.log("EditorLoader: loadGuard - editor is already loaded.")});g=true}else g=void 0;if(!g){b=new d.Deferred;a&&b.done(a);c&&b.fail(c);var f=k();d("body").append(f);var i=new d.Deferred;h.get("page-id")?this.getEditorPreloadMarkup().always(function(a,b,c){if(b==="success"||b==="notmodified"){f.append(a);a=e.renderTemplate("dynamic-editor-metadata");d("head").append(a);l.metaToParams();e.debug("EditorLoader: Finished loading the editor template.");
i.resolve()}else i.reject("Error loading the Editor template: "+c.status+" - "+c.statusText)}):i.resolve();g=m.require(["wrc!editor","wrc!macro-browser","wrc!fullpage-editor"]).fail(function(a){e.logError("Failed to load editor resources",a)});d.when(i,g).done(function(){e.debug("EditorLoader: Finished loading the editor.");b.resolve()}).fail(function(){b.reject(arguments)})}},getEditorForm:function(){if(this.isEditorActive()){var a=require("tinymce");return d(a.activeEditor.getContainer()).closest("form")}return null}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor-loader/editor-loader","AJS.Confluence.EditorLoader");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.editor-loader:background-loading-editor', location = 'jscripts/block-and-buffer-keys.js' */
define("confluence-editor-loader/block-and-buffer-keys",[],function(){return{block:function(e){var d=[],f=function(a){a.preventDefault();a.stopPropagation();var c=a.which;c||(c=a.charCode?a.charCode:a.keyCode);13!==c&&48>c||d.push(c);a.preventDefault()};e.keypress(f);return function(){e.unbind("keypress",f);for(var a="",c=0;c<d.length;c++){var b;b=d[c];65535<b?(b-=65536,b=String.fromCharCode(55296+(b>>10),56320+(b&1023))):b=String.fromCharCode(b);a+=b}return a}}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor-loader/block-and-buffer-keys","AJS.Confluence.BlockAndBuffer");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/linkbrowser-editor-adapter.js' */
AJS.$(function(){if(!$("body").hasClass("with-space-sidebar")){return}Confluence=Confluence||{};Confluence.Editor=Confluence.Editor||{};AJS.Rte=AJS.Rte||{};AJS.Rte.BookmarkManager=AJS.Rte.BookmarkManager||{};AJS.Rte.BookmarkManager.storeBookmark=AJS.$.noop;AJS.Rte.BookmarkManager.restoreBookmark=AJS.$.noop});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-ia.js' */
(function(a){Confluence.Sidebar={};AJS.toInit(function(C){var I=C(window);var o=C(document);var v=Math.min(285,I.width()/3);var z=285;var c=150;var n=55;var q=640;var E=AJS.storageManager("confluence","sidebar");var p="width";var l=AJS.contextPath();var G=AJS.Meta.get("space-key");var i=AJS.Meta.get("use-keyboard-shortcuts")?" "+"(\u2009[\u2009)":"";Confluence.Sidebar.collapseTooltip="R\u00e9duire le volet lat\u00e9ral"+i;Confluence.Sidebar.expandTooltip="\u00c9tendre le volet lat\u00e9ral"+i;var H=C(".ia-splitter").children();var D=C(".ia-splitter-left");if(D.length<1){return}var h=C(".acs-side-bar");var d=D.find(".ia-fixed-sidebar");var b=C("<div>",{"class":"ia-splitter-handle tipsy-enabled","data-tooltip":Confluence.Sidebar.collapseTooltip}).appendTo(d);C("<div>",{"class":"ia-splitter-handle-highlight"}).appendTo(b);var u=C(".ia-secondary-container");var m=C("#footer, #studio-footer");Confluence.Sidebar.throbberDiv=e;u.length&&k(u.attr("data-tree-type"));I.scroll(y);I.resize(y);I.on("touchend",y);o.ready(y);AJS.bind("confluence.header-resized",y);C("#header-precursor img").load(y);Confluence.Sidebar.applyTooltip=r;t();AJS.bind("sidebar.exit-configure-mode",t);var g=E.getItem(p)||v;var A=g>c?g:n;x(A);K();d.css("visibility","visible");y();J();setTimeout(function(){Confluence.Sidebar.createFlyouts(h)},0);AJS.trigger("sidebar.finished-loading");I.one("pagetree-children-loaded",function(){var L=C(".plugin_pagetree_current");if(L.length){var M=L.offset();if(M.top>h.height()/2){h.scrollTop(M.top-h.height()/3)}if(M.left>h.width()/2){h.scrollLeft(M.left-h.width()/2)}}});AJS.bind("sidebar.enter-configure-mode",function(){s();w();d.addClass("configure-mode")});AJS.bind("sidebar.exit-configure-mode",function(){s();B();d.removeClass("configure-mode")});function s(){AJS.trigger("sidebar.hide-overlays")}function r(L,N){var M={live:true,gravity:"w",title:"data-tooltip",delayIn:500,delayOut:0,offset:5};C(L).tooltip(N?C.extend(M,N):M)}function t(){C(".acs-side-bar .quick-links-section").attr("data-collapsed-tooltip","Raccourcis espace");C("#space-tools-menu-trigger").attr("data-collapsed-tooltip","Outils de l\u0027espace");if(u.attr("data-tree-type")=="pages"){C(".acs-side-bar .ia-secondary-container").attr("data-collapsed-tooltip","Pages enfant");r(".collapsed .ia-secondary-container.tipsy-enabled",{title:"data-collapsed-tooltip"})}r(".expand-collapse-trigger");r(".ia-splitter-handle.tipsy-enabled");r(".collapsed .quick-links-section.tipsy-enabled, .collapsed .acs-nav-item > a.tipsy-enabled, .collapsed #space-tools-menu-trigger.tipsy-enabled",{title:"data-collapsed-tooltip"});r(".configure-mode .acs-side-bar-space-info.tipsy-enabled",{title:"data-configure-tooltip"});h.on("mousedown click scroll",s);C(window).on("scroll resize",s);AJS.bind("sidebar.hide-overlays",M);AJS.bind("sidebar.disable-tooltip",N);AJS.bind("sidebar.enable-all-tooltips",L);function N(R,Q){var O=C(Q).closest(".tipsy-enabled");if(O.size()!=1){return}O.removeClass("tipsy-enabled").addClass("tipsy-disabled").attr("title","");var P=O.data("tipsy");if(P){P.hoverState="out"}M()}function L(){C(".tipsy-disabled").removeClass("tipsy-disabled").addClass("tipsy-enabled")}function M(){C(".tipsy").remove()}}function K(){o.on("mousewheel",".ia-scrollable-section",function(O,P){var N=C(this).scrollTop();var M=C(this).get(0).scrollHeight-C(this).innerHeight()-1;if((P>0&&N<=0)||(P<0&&N>=M)){O.preventDefault()}else{if(C.browser.msie){O.preventDefault();var L=30;C(this).scrollTop(N+(-1*P*L))}}O.stopPropagation()})}function e(){var M=C(Confluence.Templates.Sidebar.throbber()),N=M.find(".spinner"),L=Raphael.spinner(N[0],10,"#666");M.find(".throbber").bind("remove",function(){L()});return M}function k(L){if(L==="blogs"){j(h,f)}else{if(L==="pages"){Confluence.Sidebar.Pages.installHandlers(h)}}}function f(O,P){var N=O.attr("data-group-type");var L=O.attr("data-group-value");var M=l+"/rest/ia/1.0/pagetree/blog/subtree";C.get(M,{spaceKey:G,groupType:N,groupValue:L}).done(P)}function j(L,M){L.delegate(".acs-tree-item > .icon, .acs-tree-item > .node-title","click",function(){var R=C(this);var Q=R.parent();var N=Q.find("> .icon");if(Q.hasClass("opened")){Q.children("ul").hide();Q.removeClass("opened").addClass("closed");N.removeClass("icon-section-opened").addClass("icon-section-closed")}else{if(Q.hasClass("closed")){var O=Q.children("ul");if(O.length){O.show()}else{var P=C(Confluence.Templates.Sidebar.treeThrobber());Q.append(P);M(Q,function(T){var S=C(Confluence.Templates.Sidebar.pagetreeList({pagetree:T,isSubtree:true}));P.remove();S.appendTo(Q)})}Q.removeClass("closed").addClass("opened");N.removeClass("icon-section-closed").addClass("icon-section-opened")}}})}function y(){var L=D.offset().top,M=I.scrollTop(),N=I.scrollLeft();if(M<0){return}if(M>(o.height()-I.height())){return}if(N<0){return}if(N>(o.width()-I.width())){return}if(C("#header").css("position")!=="fixed"){d.css({top:Math.max(L-M,0)+"px",left:Math.min(N*-1,0)+"px"})}else{d.css({left:Math.min(N*-1,0)+"px"})}}function F(){m.css("margin-left",d.outerWidth()+"px")}function J(){var O=C("body");var M=false;var N=false;var P=function(Q){N=true;Q.preventDefault();H.one("selectstart",function(S){S.preventDefault()});var R=function(){if(d.width()<=c){x(n)}else{v=d.width()}N=false;O.off("mousemove.ia-splitter")};M=false;O.on("mousemove.ia-splitter",function(S){if(Confluence.Sidebar.Configure.mode&&S.pageX<z){return}x(S.pageX);M=true});O.one("mouseup mouseleave",R)};b.on("mousedown.ia-splitter",function(Q){P(Q);s()}).click(function(){if(!M){L()}else{M=false}});Confluence.Sidebar.toggle=L;function L(){if(Confluence.Sidebar.Configure.mode){return}var Q=d.width();if(Q>n){if(Q<=c){v=z;x(v)}else{v=Q;x(n)}}else{x(v)}}}function x(L){L=Math.max(L,n);L=Math.min(L,q);E.setItemQuietly(p,L);if(L<=c){d.addClass("collapsed");b.attr("data-tooltip",Confluence.Sidebar.expandTooltip);AJS.trigger("sidebar.collapsed")}else{if(d.hasClass("collapsed")){d.removeClass("collapsed");b.attr("data-tooltip",Confluence.Sidebar.collapseTooltip);AJS.trigger("sidebar.expanded")}}d.width(L);H.eq(1).css("margin-left",L+"px");F()}function w(){if(d.width()<z){Confluence.Sidebar.widthBeforeConfiguring=d.width();x(z)}}function B(){if(Confluence.Sidebar.widthBeforeConfiguring){x(Confluence.Sidebar.widthBeforeConfiguring);Confluence.Sidebar.widthBeforeConfiguring=undefined}}})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/configurable-nav.js' */
(function(a){AJS.Confluence.ConfigurableNav=AJS.RestfulTable.extend({initialize:function(c){var b=this;b.options=a.extend(true,c,{model:AJS.RestfulTable.EntryModel,Collection:Backbone.Collection.extend({url:c.resources.self,model:AJS.RestfulTable.EntryModel}),columns:[{id:"title"}]});b._events=b._events||AJS.RestfulTable.Events;b._event=b._event||AJS.RestfulTable.Events;b.classNames=AJS.RestfulTable.ClassNames;b.dataKeys=AJS.RestfulTable.DataKeys;b.$table=c.$el.addClass(this.classNames.RESTFUL_TABLE).addClass(this.classNames.ALLOW_HOVER).addClass("aui").addClass(b.classNames.LOADING);b.$table.prepend('<colgroup><col span="1" class="aui-restfultable-order"><col span="1"><col span="1" class="aui-restfultable-operations"></colgroup>');b.$tbody=a("<tbody/>");b._models=this._createCollection();b._rowClass=AJS.Confluence.ConfigurableNav.Row;b.editRows=[];b.enableReordering();b._models.bind("remove",function(d){a.each(b.getRows(),function(e,f){if(f.model===d){if(f.hasFocus()&&b._createRow){b._createRow.trigger(b._event.FOCUS)}b.removeRow(f)}})});a.get(b.options.resources.all,function(d){b.populate(d)});Confluence.Sidebar.applyTooltip(".hide-link, .show-link, .delete-link, .toggle-link",{gravity:"ne"})},enableReordering:function(){var b=this;this.$tbody.sortable({handle:"."+this.classNames.DRAG_HANDLE,helper:function(f,c){var d=c.clone(true).addClass(b.classNames.MOVEABLE);d.children().each(function(e){a(this).width(c.children().eq(e).width())});return d},start:function(c,d){var e=d.placeholder.find("td");d.item.addClass(b.classNames.MOVEABLE).children().each(function(f){a(this).width(e.eq(f).width())});d.placeholder.html('<td colspan="'+b.getColumnCount()+'">&nbsp;</td>').css("visibility","visible");b.getRowFromElement(d.item[0]).trigger(b._event.MODAL)},stop:function(c,d){if(jQuery(d.item[0]).is(":visible")){d.item.removeClass(b.classNames.MOVEABLE).children().attr("style","");d.placeholder.removeClass(b.classNames.ROW);b.getRowFromElement(d.item[0]).trigger(b._event.MODELESS)}},update:function(e,g){var c,d,f={},h=b.getRowFromElement(g.item[0]);if(h){if(b.options.reverseOrder){d=g.item.next();if(!d.length){f.position="First"}else{c=b.getRowFromElement(d).model;f.after=c.url()}}else{d=g.item.prev();if(!d.length){f.position="First"}else{c=b.getRowFromElement(d).model;f.after=c.url()}}f.spaceKey=AJS.Meta.get("space-key");a.ajax({url:h.model.url()+"/move",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(f),complete:function(){h.hideLoading()},success:function(i){AJS.triggerEvtForInst(b._event.REORDER_SUCCESS,b,[i])},error:function(j){var i=a.parseJSON(j.responseText||j.data);AJS.triggerEvtForInst(b._event.SERVER_ERROR,b,[i,j])}});h.showLoading()}},axis:"y",delay:0,containment:"document",cursor:"move",scroll:true,zIndex:8000});this.$tbody.bind("selectstart mousedown",function(c){return !a(c.target).is("."+b.classNames.DRAG_HANDLE)})}});AJS.Confluence.ConfigurableNav.ReadView=AJS.RestfulTable.CustomReadView.extend({render:function(b){return _.template('<span class="acs-nav-item-link" title="<%=title%>"><span class="icon"></span><span class="acs-nav-item-label"><%=title%></span></span>',{title:AJS.escapeHtml(b.title)})}});AJS.Confluence.ConfigurableNav.Row=AJS.RestfulTable.Row.extend({render:function(){var b=this,d=this.model.toJSON(),e=a("<td class='aui-restfultable-operations' />").append(this.renderOperations(d.canHide,d.hidden)),c=a('<td class="'+this.classNames.ORDER+'"/>').append(this.renderDragHandle());b._event=b._event||b._events;b.$el.attr("data-id",this.model.id);b.$el.append(c);a.each(b.columns,function(f,g){var h,k=a("<td />"),j=d[g.id];if(j){b.$el.attr("data-"+g.id,j)}h=new AJS.Confluence.ConfigurableNav.ReadView().render(d);k.append(h);b.$el.append(k)});b.$el.append(e);d.canHide&&d.hidden&&b.$el.addClass("hidden-link");b.$el.addClass(this.classNames.ROW+" "+b.classNames.READ_ONLY+" acs-nav-item "+d.styleClass);b.trigger(this._event.RENDER,this.$el,d);b.$el.trigger(this._event.CONTENT_REFRESHED,[b.$el]);return b},renderOperations:function(f,e){var c=this,b=a('<a href="#" class="aui-icon aui-icon-small"/>');if(f){function d(g){if(g.hasClass("hide-link")){g.attr("data-tooltip","Masquer le lien")}else{g.attr("data-tooltip","Afficher le lien")}}b.addClass(e?"show-link":"hide-link").click(function(g){g.preventDefault();a.ajax({url:c.model.url()+(e?"/show":"/hide"),type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({spaceKey:AJS.Meta.get("space-key")})}).done(function(){b.closest(".acs-nav-item").toggleClass("hidden-link");b.toggleClass("hide-link").toggleClass("show-link");d(b)})});d(b)}else{b.addClass("delete-link tipsy-enabled").click(function(g){g.preventDefault();if(a(".acs-nav").data("quick-links-state")!="hide"){AJS.trigger("sidebar.disable-tooltip",this);c.destroy()}}).attr("data-tooltip","Supprimer le lien")}return b},destroy:function(){this.model.destroy({data:{spaceKey:AJS.Meta.get("space-key")}})}})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-pages.js' */
(function(b){var a=AJS.Meta.get("context-path");Confluence.Sidebar.Pages={installHandlers:function(d){d.find(".more-children-link").click(function(f){f.preventDefault();d.find("ul.more-children").show();b(this).hide()})},quickLinksContent:function(){return new b.Deferred().resolve(b(".acs-side-bar .quick-links-wrapper").html())},childPageCollapsedContent:function(){var e=b(".acs-side-bar .ia-secondary-header");var d=b(".acs-side-bar .ia-secondary-parent-content");var g=b(".acs-side-bar .ia-secondary-current-content");var f=b(".acs-side-bar .ia-secondary-content");return new b.Deferred().resolve(b("<div>").append(b("<div>").addClass("acs-side-bar-flyout-wiki-wrapper").append(e.clone()).append(d.clone()).append(g.clone()).append(f.clone())).html())},pageTreeCollapsedContent:function(){var d=b(".page-tree-flyout-content");if(d.length==0){return c().pipe(function(e){var f=b("<div>").addClass("acs-side-bar-flyout-wiki-wrapper").append(Confluence.Templates.Sidebar.Pages.renderPageContextualNav({pageContextualNav:e,hasCreatePermission:b(".acs-nav").data("has-create-permission")}));b("body").append(b("<div>").addClass("page-tree-flyout-content hidden").append(f.clone()));return f})}else{return new b.Deferred().resolve(d.html())}}};function c(){return b.ajax({url:a+"/rest/ia/1.0/space/childPagesContextualNav",data:{pageId:AJS.Meta.get("page-id")}})}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-links.js' */
AJS.$(function(){Confluence.Sidebar.Configure={mode:false};var d=AJS.$,n=AJS.Meta.get("context-path"),l=AJS.Meta.get("space-key"),j=d(".acs-side-bar"),r=j.find(".ia-secondary-container"),e,p,k,m,h=d(".acs-nav"),t=false;d.ajaxSetup({cache:false});d("body").on("click","#acs-configure-link, a.configure-sidebar",function(w){w.preventDefault();v()});d("#space-favourite-remove").on("click",function(){c("remove");d("#space-favourite-add").show();d("#space-favourite-remove").hide()});d("#space-favourite-add").on("click",function(){c("add");d("#space-favourite-remove").show();d("#space-favourite-add").hide()});function c(x){var y;var w;if(x==="add"){y="PUT";w="confluence.space-sidebar.favourite.click"}else{y="DELETE";w="confluence.space-sidebar.favourite-remove.click"}d.ajax({url:n+"/rest/experimental/relation/user/current/favourite/toSpace/"+l,type:y,dataType:"json",contentType:"application/json",data:JSON.stringify({spaceKey:l})}).done(function(){if(x==="add"){d("#space-favourite-add").prop("data-favourited","true")}else{d("#space-favourite-add").prop("data-favourited","false")}});AJS.trigger("analyticsEvent",{name:w})}function v(){AJS.trigger("sidebar-before-enter-configure-mode");var w=d(".custom-sidebar-content");var z=w.length;var C;var B;if(z){B=n+"/spaces/custompagecontent.action?key="+l;C=w.children().html()}m=h.data("nav-type");Confluence.Sidebar.Configure.mode=true;k=d(".acs-nav-sections .acs-nav-item.current-item").data("collector-key");e=Confluence.Sidebar.throbberDiv();e.height(d(".acs-nav-sections").height());r.hide();d(".acs-nav-sections").replaceWith(e);var y=Confluence.Templates.Sidebar.configure({pageTree:m==="page-tree",quickLinksState:h.data("quick-links-state"),pageTreeState:h.data("page-tree-state"),hasSidebarCustomisation:z,customContentAdminLink:B,sidebarCustomisation:C});p=d(y).hide();e.after(p);i();g();s();var A={};var x=function(){e.replaceWith(p);p.show()};d("#acs-nav-list-main").one(AJS.RestfulTable.Events.INITIALIZED,function(){A.main=true;A.quick&&x()});d("#acs-nav-list-quick").one(AJS.RestfulTable.Events.INITIALIZED,function(){A.quick=true;A.main&&x()});d(".acs-nav-type").change(function(D){u("nav-type",d(this).val(),function(E){r.data("tree-type",E);h.data("nav-type",E)})});d(".acs-done-link").click(function(D){D.preventDefault();d(".acs-done-link").attr("aria-disabled",true).prop("disabled",true);o()});d(".quick-links-header a").click(function(E){E.preventDefault();var D=h.data("quick-links-state")=="hide"?"show":"hide";u("quick-links-state",D,a)});d(".page-tree-header a").click(function(F){F.preventDefault();var E=h.data("page-tree-state")=="hide"?"show":"hide";var D=d(".acs-nav-type");if(E==="show"){D.attr("disabled",false)}else{D.attr("disabled",true)}u("page-tree-state",E,b)});AJS.$(".acs-side-bar-space-info").on("click.configurelogo",q);AJS.trigger("sidebar.enter-configure-mode")}function q(y){var x=AJS.$(".acs-side-bar-space-info > .flyout-handle");x.addClass("loading").spin();var w=WRM.require("wr!com.atlassian.confluence.plugins.confluence-space-ia:avatar-picker",function(){AJS.trigger("deferred.spaceia.open.configure.space")});w.always(function(){x.removeClass("loading").spinStop()});y.preventDefault()}function u(w,x,y){d.ajax({url:n+"/rest/ia/1.0/space/option",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({spaceKey:l,option:w,value:x}),success:function(z){y(x)}})}function o(){if(m!==h.data("nav-type")||t===true){location.reload();t=false;return}var w=d(".custom-sidebar-content");var y=w.length;var A;if(y){A=w.children().html()}e=Confluence.Sidebar.throbberDiv();e.height(p.height());p.replaceWith(e);f();r.show().css("display","");var x=function(){var B=d(Confluence.Templates.Sidebar.renderLinks({mainLinks:z.main,quickLinks:z.quick.reverse(),advancedLinks:z.advanced,hasConfigurePermission:true,collectorToHighlight:k,quickLinksState:h.data("quick-links-state"),hasSidebarCustomisation:y,sidebarCustomisation:A}));e.replaceWith(B);Confluence.Sidebar.Configure.mode=false;AJS.trigger("sidebar.exit-configure-mode")};var z={};d.get(n+"/rest/ia/1.0/link/main",{spaceKey:l,includeHidden:false}).done(function(B){z.main=B;z.quick&&z.advanced&&x()});d.get(n+"/rest/ia/1.0/link/quick",{spaceKey:l}).done(function(B){z.quick=B;z.main&&z.advanced&&x()});d.get(n+"/rest/ia/1.0/link/advanced",{spaceKey:l}).done(function(B){z.advanced=B;z.main&&z.quick&&x()});Confluence.Sidebar.Configure.Logo&&Confluence.Sidebar.Configure.Logo.unbind()}function i(){WRM.require("wr!com.atlassian.confluence.plugins.confluence-space-ia:link-dialog",function(){var w=new d.Deferred();d(".acs-add-link").click(function(x){w.done(function(){x.preventDefault();if(h.data("quick-links-state")!=="hide"){Confluence.Sidebar.LinkAdapter.hijackLinkBrowser();Confluence.Editor.LinkBrowser.open();d("#recentlyviewed-panel-id").click()}})}).addClass("acs-add-link-ready");if(AJS.Meta.get("space-key")){AJS.Confluence.EditorLoader.load(function(){w.resolve()},function(){AJS.log("Attempted to load editor for space ia side bar. Loading the editor failed.");w.reject()})}else{w.resolve()}})}function g(){var w=d("#acs-nav-list-quick");var y=d(".acs-nav-sections .tip").hide();var x=function(){if(Confluence.Sidebar.Configure.QuickLinks.isEmpty()){w.hide();y.show()}else{y.hide();w.show()}};AJS.bindEvt(AJS.RestfulTable.Events.INITIALIZED,x);AJS.bindEvt(AJS.RestfulTable.Events.ROW_ADDED,x);AJS.bindEvt(AJS.RestfulTable.Events.ROW_REMOVED,x)}function s(){Confluence.Sidebar.Configure.MainLinks=new AJS.Confluence.ConfigurableNav({$el:d("#acs-nav-list-main"),resources:{all:n+"/rest/ia/1.0/link/main?spaceKey="+l+"&includeHidden=true",self:n+"/rest/ia/1.0/link"}});Confluence.Sidebar.Configure.QuickLinks=new AJS.Confluence.ConfigurableNav({$el:d("#acs-nav-list-quick"),resources:{all:n+"/rest/ia/1.0/link/quick?spaceKey="+l,self:n+"/rest/ia/1.0/link"},reverseOrder:true})}function f(){Confluence.Sidebar.Configure.MainLinks.remove();Confluence.Sidebar.Configure.MainLinks.unbind();Confluence.Sidebar.Configure.QuickLinks.remove();Confluence.Sidebar.Configure.QuickLinks.unbind();d(AJS).unbind(AJS.RestfulTable.Events.INITIALIZED);d(AJS).unbind(AJS.RestfulTable.Events.ROW_ADDED);d(AJS).unbind(AJS.RestfulTable.Events.ROW_REMOVED)}function a(w){h.data("quick-links-state",w);if(w==="hide"){d(".acs-nav-list-quick-section").addClass("hidden-section")}else{d(".acs-nav-list-quick-section").removeClass("hidden-section")}}function b(w){h.data("page-tree-state",w);t=true;if(w==="hide"){d(".acs-nav-list-page-tree-section").addClass("hidden-section")}else{d(".acs-nav-list-page-tree-section").removeClass("hidden-section")}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-space-tools.js' */
define("confluence-space-ia/sidebar-space-tools",["ajs","jquery","confluence/legacy"],function(b,c,d){function a(){var e=[];var h=[];var k=b.version.indexOf("5.7")===0;var i;var l;var f,j;if(!k){f=c("#space-tools-menu-trigger");j=c("#space-tools-menu")}var g;if(k){c("#space-tools-web-items").children("div").each(function(){e.push({label:c(this).data("label"),href:c(this).data("href")})})}else{b.warn("Remove legacy sidebar code when upgrade to AUI 5.8+");j.on({"aui-dropdown2-show":function(){b.trigger("sidebar.disable-tooltip",f)},"aui-dropdown2-hide":function(){b.trigger("sidebar.enable-all-tooltips")}});c("#space-tools-web-items").children("div").each(function(){e.push({text:c(this).data("label"),href:c(this).data("href")})})}if(k){c("#space-tools-menu-additional-items").children("div").each(function(){h.push({className:c(this).data("class"),label:c(this).data("label"),href:c(this).data("href")})})}else{c("#space-tools-menu-additional-items").children("div").each(function(){h.push({extraClasses:c(this).data("class"),text:c(this).data("label"),href:c(this).data("href")})})}if(k){l={hideDelay:null,width:170,displayShadow:false,calculatePositions:function(m,n){var o=n.target.offset();return{popupCss:{top:o.top-m.height(),left:o.left},arrowCss:{display:"none"}}},hideCallback:function(){b.trigger("sidebar.enable-all-tooltips")}};i=b.InlineDialog(c("#space-tools-menu-trigger"),"space-tools",function(n,m,o){n.html(d.Templates.Sidebar.spaceToolsMenu({spaceToolLinks:e,spaceLinks:h,isAuiFiveSeven:k}));c(m).one("click",function(p){if(c("#inline-dialog-space-tools").is(":visible")){setTimeout(function(){i.hide()},0)}});b.trigger("sidebar.disable-tooltip",m);b.trigger("sidebar.spacetools-loaded");o();return false},l);i.addClass("aui-dropdown2 aui-style-default space-tools-dropdown");b.bind("sidebar.hide-overlays",i.hide)}else{j.html(d.Templates.Sidebar.spaceToolsMenu({spaceToolLinks:e,spaceLinks:h}));if(b&&b.Confluence&&b.Confluence.Analytics&&b.Confluence.Analytics.setAnalyticsSource){b.Confluence.Analytics.setAnalyticsSource(j.find("a:not(.configure-sidebar)"),"spacetools")}b.bind("sidebar.hide-overlays",function(){if(j.filter('[aria-hidden="false"]').length){c("#space-tools-menu-trigger").trigger("aui-button-invoke")}})}g=c(".expand-collapse-trigger");g.click(function(m){m.preventDefault();d.Sidebar.toggle()});g.attr("data-tooltip",c(".ia-fixed-sidebar").hasClass("collapsed")?d.Sidebar.expandTooltip:d.Sidebar.collapseTooltip);b.bind("sidebar.collapsed",function(){g.attr("data-tooltip",d.Sidebar.expandTooltip)});b.bind("sidebar.expanded",function(){g.attr("data-tooltip",d.Sidebar.collapseTooltip)})}return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-space-tools-require.js' */
require(["confluence-space-ia/sidebar-space-tools"],function(a){AJS.toInit(function(){a()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-flyouts.js' */
(function(d){var b,c,a;Confluence.Sidebar.createFlyouts=function(g){b=f(d(".collapsed .quick-links-section"),Confluence.Sidebar.Pages.quickLinksContent,"sidebar-quick-links-flyout",{flyout:"quick-links"});var h=g.find(".ia-secondary-container");if(h.length&&h.attr("data-tree-type")=="pages"){c=f(d(".collapsed .ia-secondary-header-title.wiki"),Confluence.Sidebar.Pages.childPageCollapsedContent,"sidebar-children-flyout",{flyout:"children"})}if(h.length&&h.attr("data-tree-type")=="page-tree"){a=f(d(".collapsed .ia-secondary-header-title.page-tree"),Confluence.Sidebar.Pages.pageTreeCollapsedContent,"sidebar-page-tree-flyout",{flyout:"pagetree"})}};function f(g,j,i,l){var k=function(n,m,o){d(n).addClass("acs-side-bar-flyout ia-scrollable-section");d(n).empty().append(Confluence.Sidebar.throbberDiv());j().done(function(p){d(n).html(p)});AJS.trigger("sidebar.flyout-triggered",l);o();d(m).one("click",function(p){if(d("#inline-dialog-"+i).is(":visible")){setTimeout(function(){h.hide()},0)}});AJS.trigger("sidebar.disable-tooltip",m)};var h=AJS.InlineDialog(g,i,k,{gravity:"w",calculatePositions:e,useLiveEvents:true,hideDelay:null,hideCallback:function(){AJS.trigger("sidebar.enable-all-tooltips")}});AJS.bind("sidebar.hide-overlays",h.hide);return h}function e(h,k,p,g){var q=k.target.offset();var o=k.target.width();var l=k.target.height();var n={top:q.top+l/2-15,left:q.left+o+5,right:"auto"};var i=d(window);var m=20;n.maxHeight=i.height()+i.scrollTop()-n.top-m;if(d.browser.msie&&parseInt(d.browser.version,10)<=8){n.maxHeight-=40}var j={top:9};return{popupCss:n,arrowCss:j,gravity:"w"}}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/external/jquery.mousewheel.min.js' */
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacesidebar', location = 'js/sidebar-logo.js' */
AJS.toInit(function(f){Confluence.Sidebar.Configure.Logo={};var b=f(".acs-side-bar-space-info div.name a");var h;var a;var e=function(i){f(".space-logo .avatar-img").attr("src",AJS.Meta.get("context-path")+i)};var d=function(i){b.attr("title",i).text(i)};var g=function(i){if(!h){h=new i({onCrop:function(k,j){f.ajax({type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({spaceKey:AJS.Meta.get("space-key"),spaceName:j,logoDataURI:k}),url:AJS.Meta.get("context-path")+"/rest/ia/1.0/space/setLogo",success:function(l){e(l.logoDownloadPath);d(l.name);h.hide()},error:function(l){h.setMessage("Une erreur est survenue lors de la mise \u00e0 jours des informations de l\u0027espace");h._removeSaveImageLoadingIcon()}})}})}h.show(f(".acs-side-bar-space-info div.name a").text());return false};var c=function(){var i=function(l,k,m){f(l).addClass("acs-side-bar-flyout");f(l).empty();l.html(AJS.template.load("logo-config-content"));l.unbind("mouseover mouseout");AJS.trigger("sidebar.disable-tooltip",k);m()};if(!a){a=AJS.InlineDialog(f(".acs-side-bar-space-info"),"space-logo-config",i,{gravity:"w",calculatePositions:j,useLiveEvents:true,hideCallback:function(){AJS.trigger("sidebar.enable-all-tooltips")},hideDelay:null,noBind:true,width:635})}function j(l,n,r,k){var s=n.target.offset();var q=n.target.width();var o=n.target.height();var p={top:s.top+o/2-15,left:s.left+q+5,right:"auto"};var m={top:9};return{popupCss:p,arrowCss:m,gravity:"w"}}a.show()};AJS.bind("sidebar-before-enter-configure-mode",function(){AJS.bind("deferred.spaceia.open.configure.space",function(i){if(AJS.Meta.get("space-key")=="~"+AJS.Meta.get("remote-user")){c()}else{require(["confluence-space-ia/avatar-picker/avatar-picker-dialog",],g)}i.preventDefault();return false})});Confluence.Sidebar.Configure.Logo.unbind=function(){f("#inline-dialog-space-logo-config .cancel").click();f(".acs-side-bar-space-info").off("click.configurelogo");AJS.unbind("deferred.spaceia.open.configure.space")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-fixed-headers:utils', location = '/js/utils/dom.js' */
define("confluence/fh/utils/dom",["jquery","ajs","exports"],function(j,p,i){var q,d,a,n;function k(r){if(k.done&&!r){return}var s="#main .aui-page-panel-outer-content";d=j(s).length!==0?j(s):j("#main");a=j("#header");n=j("#main-header");k.done=true}function f(){var r=p.Meta.get("content-type");if(r==="page"||r==="blogpost"){j(tinymce.activeEditor.getWin().document).find("body#tinymce").addClass("page-edit")}}function o(){k();n.css({width:d.outerWidth()-(parseInt(d.css("padding-left"))+parseInt(d.css("padding-right")))})}function c(){k();var r=parseInt(n.css("top"))+n.outerHeight();if(isNaN(r)||r===c.lastValue){return}c.lastValue=r;p.trigger("sticky-table-headers.change.options",{fixedOffset:r,cacheHeaderHeight:true})}function e(t,r,s){if(s){e[s]=e[s]||{};if(r===e[s].lastValue){return}e[s].lastValue=r}t.css({transform:"translateY("+r+"px)","-webkit-transform":"translateY("+r+"px)","-ms-transform":"translateY("+r+"px)"})}function m(u,r,s){var t={};s.forEach(function(v){t[v]=u.css(v)});r.css(t)}var l={mt:"margin-top",mr:"margin-right",ml:"margin-left",mb:"margin-bottom",pt:"padding-top",pr:"padding-right",pl:"padding-left",pb:"padding-bottom",ff:"font-family",fsi:"font-size",fst:"font-style",fw:"font-weight",td:"text-decoration",ls:"letter-spacing",ta:"text-align",c:"color"};l.margin=[l.mt,l.mr,l.ml,l.mb];l.padding=[l.pt,l.pr,l.pl,l.pb];l.font=[l.ff,l.fsi,l.fst,l.fw];function b(){k();if(q){return q}q=j('<div id="main-header-placeholder"></div>');var t=j("#title-text"),s=t.find("a"),r=t.clone().removeAttr("id"),u=r.find("a");m(n,q,l.margin.concat(l.padding));q.css({height:n.outerHeight()});m(t,r,l.font.concat(l.td,l.ls,l.ta,l.pr,l.pb,l.pl,l.mr,l.mb,l.ml));r.css({paddingTop:parseInt(t.css("padding-top"))+Math.round(t.offset().top-n.offset().top)});m(s,u,l.font.concat(l.margin,l.padding,l.font,l.c,l.td,l.ls,l.ta));q.append(r);return q}function g(){q&&q.remove()}function h(t){t=typeof(t)==="string"?t:j(this).attr("href");if(!t){return}k();var s=a.outerHeight();var r=j(t.replace(/(!|\"|\$|%|&|'|\(|\)|\*|\+|,|\.|\/|\:|;|<|=|>|\?|@|\[|\\|\]|\^|`|\{|\||\}|~)/g,"\\$1"));if(r.length){window.scrollTo(0,r.offset().top-s);if(history&&"pushState" in history){history.pushState({},document.title,window.location.pathname+window.location.search+t);return false}}}i.forceInitialize=function(){k(true)};i.addClassToPage=f;i.adjustMainHeaderSize=o;i.updateTableStickyHeaderOption=c;i.translateVertical=e;i.createMainHeaderPlaceHolder=b;i.removeMainHeaderPlaceHolder=g;i.scrollIfAnchor=h});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-fixed-headers:handlers', location = '/js/handlers/page-view-handler.js' */
define("confluence/fh/handlers/page-view-handler",["confluence/fh/utils/dom","jquery","ajs","exports"],function(z,i,m,G){var E,s,D,n,v,d,C,h,e,w,F,r=false,l=false,f=false,j=0,u=0,g=0,y=50,b=100,q="by-hover",t="by-scroll",B="by-other",a=B,o=false;function c(H){if(c.done&&!H){return}E=i("#header");s=i("#main .aui-page-panel-outer-content");s.length===0&&(s=i("#main"));D=i("#main-header");n=i("#action-menu-link");v=z.createMainHeaderPlaceHolder();d=i(".ia-splitter-left .ia-fixed-sidebar");C=D.prop("style");h=s.prop("style");e=Math.round(E.offset().top);w=E.height();F=Math.round(D.offset().top)-w-(parseInt(s.css("padding-top"))+parseInt(D.css("margin-top")));c.done=true}var x=function(){c();var I=i(window).scrollTop();var K=I>e;if(K&&parseInt(d.css("top"))<w){d.css({top:w+"px"})}if(!r&&K){r=true;E.addClass("fixed-header");s.css({marginTop:w+"px"})}else{if(!K){E.removeClass("fixed-header");h.removeProperty("margin-top");r=false}}var O=I>F;if(!l&&O){l=true;D.find("#title-text").hide();D.css({position:"fixed",width:s.outerWidth()-(parseInt(s.css("padding-left"))+parseInt(s.css("padding-right"))),right:0,top:w+"px",marginTop:0,paddingTop:parseInt(s.css("padding-top"))+parseInt(D.css("margin-top")),paddingBottom:parseInt(s.css("padding-top"))+parseInt(D.css("margin-top")),paddingLeft:s.css("padding-left"),paddingRight:s.css("padding-right"),zIndex:b});D.before(z.createMainHeaderPlaceHolder())}else{if(!O){["position","width","right","top","margin-top","padding-top","padding-bottom","padding-left","padding-right","z-index"].forEach(function(P){C.removeProperty(P)});D.removeClass("overlay-header");D.find("#title-text").show();l=false;f=false;z.removeMainHeaderPlaceHolder()}}var M,L,J=D.outerHeight(),H=j-I,N=parseInt(D.css("top"))+H;if(I<=0){g=0;u=0;M=w}else{if(l&&H>0){if(N>w){g=w;u=0;M=w;L=b}else{g+=Math.abs(H);if(g>=y||I<=J){u-=Math.abs(H);M=N;L=b}}if(I>J+y&&!f){D.addClass("overlay-header");f=true}a=t}else{if(l&&H<0){if(N<w-J){g=0;u=J;M=w-J;L=0}else{u+=Math.abs(H);M=N}}}}if(L!==undefined&&M!==undefined){D.css({top:M+"px",zIndex:L})}else{if(M!==undefined){D.css({top:M+"px"})}}if(o){z.translateVertical(n,u,n.attr("id"))}z.updateTableStickyHeaderOption();j=I};function A(){if(!l||u===0){return}u=0;D.addClass("overlay-header");D.css({top:w+"px",zIndex:b});if(o){z.translateVertical(n,u,n.attr("id"))}z.updateTableStickyHeaderOption()}function p(){c();A();a=q}function k(){c();A();m.bind("quick-edit.viewport.saved",function(){E.removeAttr("style");z.removeMainHeaderPlaceHolder()});i(window).off("scroll",x).off("resize.confluence-fixed-headers-responsive");m.trigger("analyticsEvent",{name:"view.edit.transition.edit.button.clicked",data:{method:a}})}G.forceInitialize=function(){c(true)};G.onScrollHandler=x;G.onHoverActionMenuLinkHandler=p;G.onClickEditPageLinkHandler=k;G.isKeepDotDotDotButton=o;G.__getShowMainHeaderBy=function(){return a};G.__getFixedHeader=function(){return r};G.__getFixedMainHeader=function(){return l};G.__setFixedHeader=function(H){r=H};G.__setFixedMainHeader=function(H){l=H};G.__setMainHeaderOverlay=function(H){f=H};G.__setScrollPosition=function(H){j=H};G.__setMovingDistance=function(H){u=H}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-fixed-headers:confluence-fixed-headers-view-content-resources', location = '/js/confluence-fixed-headers.js' */
require(["confluence/fh/utils/dom","confluence/fh/handlers/page-view-handler","ajs","jquery"],function(d,b,a,c){a.toInit(function(){if(!a.Meta.get("content-type")){return}if(c("#main-content").find("style").length>0){return}if(c("body").hasClass("theme-documentation")){return}var e=c("#header"),l=c("#main-header"),i=c("#main"),g=c("#content"),k=c("#editPageLink"),m=c("#action-menu-link");var n=["inline-dialog-notifications-miniview","inline-dialog-confluence-watch","inline-dialog-shareContentPopup","inline-dialog-ap-inline-dialog-content-confstats-connect-dev__confstats-live-watcher","inline-dialog-jira-metadata-dialog"];var j=function(){var p=c('.aui-dropdown2[aria-hidden="false"]');p.length&&c('.aui-dropdown2-trigger[aria-owns="'+p.attr("id")+'"]').trigger("aui-button-invoke");var o=c(".aui-inline-dialog:visible");if(o.length){o=o.filter(function(){var s=c(this);var r=s.attr("id");return s.hasClass("non-persistence-dialog")||n.indexOf(r)!==-1});o.css({display:"none"});var q=".aui-button.active, .aui-nav-imagelink.active";e.find(q).removeClass("active");l.find(q).removeClass("active");document.activeElement.blur()}};var h=new MutationObserver(function(o){d.adjustMainHeaderSize()});h.observe(i[0],{attributes:true,attributeFilter:["style"]});var f=new MutationObserver(function(o){g.css("padding-right")==="0px"&&g.css({paddingRight:"28px"})});f.observe(g[0],{attributes:true,attributeFilter:["style"]});c(window).on("resize.confluence-fixed-headers-responsive",a.debounce(d.adjustMainHeaderSize,100)).on("scroll",b.onScrollHandler).scroll(a.debounceImmediate(j,250));if(b.isKeepDotDotDotButton){i.addClass("floating-action-menu");m.on("hover",b.onHoverActionMenuLinkHandler)}k.click(function(){f&&f.disconnect();b.onClickEditPageLinkHandler()});setTimeout(function(){d.scrollIfAnchor(window.location.hash)});c("body").on("click",'a[href^="#"]',d.scrollIfAnchor)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/user.soy' */
// This file was automatically generated from user.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.User.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.User == 'undefined') { Confluence.Templates.User = {}; }


Confluence.Templates.User.userLinkUrl = function(opt_data, opt_ignored) {
  return soy.$$escapeHtml("") + '/display/~' + soy.$$escapeUri(opt_data.username);
};
if (goog.DEBUG) {
  Confluence.Templates.User.userLinkUrl.soyTemplateName = 'Confluence.Templates.User.userLinkUrl';
}


Confluence.Templates.User.logo = function(opt_data, opt_ignored) {
  return '' + ((opt_data.profilePictureInfo['default'] && opt_data.username == opt_data.currentUsername) ? '<a ' + ((opt_data.canView) ? ' ' + ((! opt_data.disableUserHover) ? 'class="userLogoLink"' : '') + ' data-username="' + soy.$$escapeHtml(opt_data.username) + '"' : '') + ' href="' + soy.$$escapeHtml("") + '/users/profile/editmyprofilepicture.action" title="' + soy.$$escapeHtml("Ajouter une image de vous-m\xeame") + '"><img class="userLogo logo defaultLogo" src="' + soy.$$escapeHtml("/s/fr_FR/6441/82994790ee2f720a5ec8daf4850ac5b7b34d2194/_") + '/images/icons/profilepics/add_profile_pic.png" alt="' + soy.$$escapeHtml("Ic\xf4ne utilisateur") + ': ' + soy.$$escapeHtml("Ajouter une image de vous-m\xeame") + '"></a>' : (opt_data.profilePictureInfo.anonymous) ? '<img class="userLogo logo anonymous" src="' + soy.$$escapeHtml("/s/fr_FR/6441/82994790ee2f720a5ec8daf4850ac5b7b34d2194/_") + '/images/icons/profilepics/anonymous.png" alt="' + soy.$$escapeHtml("Ic\xf4ne utilisateur") + ': ' + soy.$$escapeHtml("Anonyme") + '" title="' + soy.$$escapeHtml("Anonyme") + '">' : (opt_data.canView) ? '<a ' + ((! opt_data.disableUserHover) ? 'class="userLogoLink"' : '') + ' data-username="' + soy.$$escapeHtml(opt_data.username) + '" href="' + Confluence.Templates.User.userLinkUrl(opt_data) + '"><img class="userLogo logo" src="' + soy.$$escapeHtml(opt_data.profilePictureInfo.uriReference) + '" alt="' + soy.$$escapeHtml("Ic\xf4ne utilisateur") + ': ' + soy.$$escapeHtml(opt_data.username) + '" title="' + soy.$$escapeHtml(opt_data.username) + '"></a>' : '<img class="userLogo logo anonymous" src="' + soy.$$escapeHtml("/s/fr_FR/6441/82994790ee2f720a5ec8daf4850ac5b7b34d2194/_") + '/images/icons/profilepics/anonymous.png" alt="' + soy.$$escapeHtml("Ic\xf4ne utilisateur") + ': ' + soy.$$escapeHtml(opt_data.username) + '" title="' + soy.$$escapeHtml(opt_data.username) + '">');
};
if (goog.DEBUG) {
  Confluence.Templates.User.logo.soyTemplateName = 'Confluence.Templates.User.logo';
}


Confluence.Templates.User.usernameLink = function(opt_data, opt_ignored) {
  return '' + ((opt_data.username && opt_data.username != '') ? '<a href="' + Confluence.Templates.User.userLinkUrl(opt_data) + '"' + ((opt_data.canView) ? 'class="url fn confluence-userlink" data-username="' + soy.$$escapeHtml(opt_data.username) + '"' : 'class="url fn"') + '>' + ((opt_data.fullName && opt_data.fullName != '') ? soy.$$escapeHtml(opt_data.fullName) : soy.$$escapeHtml(opt_data.username)) + '</a>' : soy.$$escapeHtml("Anonyme"));
};
if (goog.DEBUG) {
  Confluence.Templates.User.usernameLink.soyTemplateName = 'Confluence.Templates.User.usernameLink';
}


Confluence.Templates.User.fullNameOrAnonymous = function(opt_data, opt_ignored) {
  return '' + ((opt_data.user && opt_data.user.fullName) ? soy.$$escapeHtml(opt_data.user.fullName) : soy.$$escapeHtml("Anonyme"));
};
if (goog.DEBUG) {
  Confluence.Templates.User.fullNameOrAnonymous.soyTemplateName = 'Confluence.Templates.User.fullNameOrAnonymous';
}


Confluence.Templates.User.usernameOrAnonymous = function(opt_data, opt_ignored) {
  return '' + ((opt_data.user && opt_data.user.name) ? soy.$$escapeHtml(opt_data.user.name) : soy.$$escapeHtml("Anonyme"));
};
if (goog.DEBUG) {
  Confluence.Templates.User.usernameOrAnonymous.soyTemplateName = 'Confluence.Templates.User.usernameOrAnonymous';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/icons.soy' */
// This file was automatically generated from icons.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Icons.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Icons == 'undefined') { Confluence.Templates.Icons = {}; }


Confluence.Templates.Icons.contentIcon = function(opt_data, opt_ignored) {
  return '' + ((opt_data.content.type == 'trackback') ? '<a' + ((opt_data.linkColour) ? ' ' + soy.$$escapeHtml(opt_data.linkColour) : '') + ' href="' + soy.$$escapeHtml(opt_data.linkHref) + '" class="icon icon-trackback" title="' + soy.$$escapeHtml("R\xe9trolien") + '">' + soy.$$escapeHtml("R\xe9trolien") + ':</a>' : '<a' + ((opt_data.linkColour) ? ' ' + soy.$$escapeHtml(opt_data.linkColour) : '') + ' href="' + soy.$$escapeHtml(opt_data.linkHref) + '" class="icon ' + soy.$$escapeHtml(opt_data.iconCss) + '" title="' + soy.$$escapeHtml(opt_data.iconTitle) + '">' + soy.$$escapeHtml(opt_data.iconTitle) + '</a>');
};
if (goog.DEBUG) {
  Confluence.Templates.Icons.contentIcon.soyTemplateName = 'Confluence.Templates.Icons.contentIcon';
}


Confluence.Templates.Icons.contentIconFont = function(opt_data, opt_ignored) {
  return '' + ((opt_data.content.type == 'trackback') ? '<a' + ((opt_data.linkColour) ? ' ' + soy.$$escapeHtml(opt_data.linkColour) : '') + ' href="' + soy.$$escapeHtml(opt_data.linkHref) + '" class="icon icon-trackback" title="' + soy.$$escapeHtml("R\xe9trolien") + '">' + soy.$$escapeHtml("R\xe9trolien") + ':</a>' : '<a' + ((opt_data.linkColour) ? ' ' + soy.$$escapeHtml(opt_data.linkColour) : '') + ' href="' + soy.$$escapeHtml(opt_data.linkHref) + '" title="' + soy.$$escapeHtml(opt_data.iconTitle) + '"><span class="icon ' + soy.$$escapeHtml(opt_data.iconCss) + '">' + soy.$$escapeHtml(opt_data.iconTitle) + '</span></a>');
};
if (goog.DEBUG) {
  Confluence.Templates.Icons.contentIconFont.soyTemplateName = 'Confluence.Templates.Icons.contentIconFont';
}


Confluence.Templates.Icons.iconSpan = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<span class="icon' + ((opt_data.type) ? ' aui-icon aui-icon-small aui-iconfont-' + soy.$$escapeHtml(opt_data.type) : '') + ' ' + ((opt_data.additionalClasses) ? soy.$$escapeHtml(opt_data.additionalClasses) : '') + '">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + '</span>';
};
if (goog.DEBUG) {
  Confluence.Templates.Icons.iconSpan.soyTemplateName = 'Confluence.Templates.Icons.iconSpan';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/captcha.soy' */
// This file was automatically generated from captcha.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Captcha.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Captcha == 'undefined') { Confluence.Templates.Captcha = {}; }


Confluence.Templates.Captcha.form = function(opt_data, opt_ignored) {
  var output = '<div class="captcha field-group"><label id="captcha-response-label" for="captcha-response"><span class="assistive">' + soy.$$escapeHtml("If you are unable to use this CAPTCHA please \x3ca href\x3d\x22administrators.action\x22 tabindex\x3d\x225\x22\x3econtact your administrator\x3c/a\x3e for assistance.") + '</span></label>' + Confluence.Templates.Captcha.image(opt_data) + '<input type="text" id="captcha-response" name="captchaResponse" value="" class="text" placeholder="' + soy.$$escapeHtml("Entrez le mot ci-dessus") + '">';
  if (opt_data.captchaErrors && opt_data.captchaErrors.length) {
    var errorList13 = opt_data.captchaErrors;
    var errorListLen13 = errorList13.length;
    for (var errorIndex13 = 0; errorIndex13 < errorListLen13; errorIndex13++) {
      var errorData13 = errorList13[errorIndex13];
      output += aui.message.warning({content: errorData13});
    }
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Captcha.form.soyTemplateName = 'Confluence.Templates.Captcha.form';
}


Confluence.Templates.Captcha.image = function(opt_data, opt_ignored) {
  return '<img src="' + soy.$$escapeHtml("") + '/jcaptcha?id=' + soy.$$escapeHtml(opt_data.captchaId) + '" class="captcha-image" alt="' + soy.$$escapeHtml("Image CAPTCHA") + '"><input type="hidden" name="captchaId" value="' + soy.$$escapeHtml(opt_data.captchaId) + '" placeholder="' + soy.$$escapeHtml("Entrez le mot ci-dessus") + '">';
};
if (goog.DEBUG) {
  Confluence.Templates.Captcha.image.soyTemplateName = 'Confluence.Templates.Captcha.image';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:shared-templates', location = '/includes/soy/notifications.soy' */
// This file was automatically generated from notifications.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Notifications.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Notifications == 'undefined') { Confluence.Templates.Notifications = {}; }


Confluence.Templates.Notifications.notLoggedIn = function(opt_data, opt_ignored) {
  return '' + ((! opt_data.isUserAuthenticated) ? '<div id="anonymous-warning" class="aui-message warning closeable">' + soy.$$filterNoAutoescape("Vous n\x27\xeates pas connect\xe9. Toutes vos modifications seront marqu\xe9es comme r\xe9alis\xe9es par \x3cspan class\x3d\x22smalltext\x22\x3eanonyme\x3c/span\x3e.") + ((! opt_data.isExternalUserManagementEnabled) ? ' ' + soy.$$filterNoAutoescape(AJS.format("Vous pouvez vous \x3ca href\x3d\x22{0}\x22\x3econnecter\x3c/a\x3e si vous disposez d\xe9j\xe0 d\x27\x27un compte.",opt_data.loginURL)) : '') + '</div>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.Notifications.notLoggedIn.soyTemplateName = 'Confluence.Templates.Notifications.notLoggedIn';
}


Confluence.Templates.Notifications.actionErrors = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.actionErrors.length > 0) {
    output += '<div class="aui-message aui-message-error ' + ((opt_data.closeable) ? 'closeable' : '') + '"><p class="title">' + soy.$$escapeHtml("L\x27erreur suivante s\x27est produite :") + '</p><span class="aui-icon icon-error"></span><ul>';
    var errorHtmlList24 = opt_data.actionErrors;
    var errorHtmlListLen24 = errorHtmlList24.length;
    for (var errorHtmlIndex24 = 0; errorHtmlIndex24 < errorHtmlListLen24; errorHtmlIndex24++) {
      var errorHtmlData24 = errorHtmlList24[errorHtmlIndex24];
      output += '<li>' + soy.$$filterNoAutoescape(errorHtmlData24) + '</li>';
    }
    output += '</ul></div>';
  }
  output += '<div id="action-messages"></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Notifications.actionErrors.soyTemplateName = 'Confluence.Templates.Notifications.actionErrors';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:es6-promise', location = '/includes/js/third-party/es6-promise.js' */
(function(){function y(a){return"function"===typeof a}function j(){for(var a=0;a<k;a+=2)(0,r[a])(r[a+1]),r[a]=void 0,r[a+1]=void 0;k=0}function s(){}function t(a,b){if(a===b)e(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof b||"object"===typeof b&&null!==b)if(b.constructor===a.constructor)b._state===u?l(a,b._result):b._state===m?e(a,b._result):w(b,void 0,function(b){t(a,b)},function(b){e(a,b)});else{var c;try{c=b.then}catch(d){x.error=d,c=x}if(c===x)e(a,x.error);
else if(void 0===c)l(a,b);else if(y(c)){var h=c;n(function(a){var c=!1,d;a:{d=function(d){c||(c=!0,b!==d?t(a,d):l(a,d))};var g=function(b){c||(c=!0,e(a,b))};try{h.call(b,d,g)}catch(i){d=i;break a}d=void 0}!c&&d&&(c=!0,e(a,d))},a)}else l(a,b)}else l(a,b)}function M(a){a._onerror&&a._onerror(a._result);z(a)}function l(a,b){a._state===o&&(a._result=b,a._state=u,0!==a._subscribers.length&&n(z,a))}function e(a,b){a._state===o&&(a._state=m,a._result=b,n(M,a))}function w(a,b,c,d){var h=a._subscribers,f=
h.length;a._onerror=null;h[f]=b;h[f+u]=c;h[f+m]=d;0===f&&a._state&&n(z,a)}function z(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,h,f=a._result,e=0;e<b.length;e+=3)d=b[e],h=b[e+c],d?D(c,d,h,f):h(f);a._subscribers.length=0}}function E(){this.error=null}function D(a,b,c,d){var h=y(c),f,g,i,j;if(h){try{f=c(d)}catch(k){A.error=k,f=A}f===A?(j=!0,g=f.error,f=null):i=!0;if(b===f){e(b,new TypeError("A promises callback cannot return that same promise."));return}}else f=d,i=!0;b._state===
o&&(h&&i?t(b,f):j?e(b,g):a===u?l(b,f):a===m&&e(b,f))}function i(a,b){this._instanceConstructor=a;this.promise=new a(s);this._validateInput(b)?(this._input=b,this._remaining=this.length=b.length,this._init(),0===this.length?l(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&l(this.promise,this._result))):e(this.promise,this._validationError())}function g(a){this._id=N++;this._result=this._state=void 0;this._subscribers=[];if(s!==a){if(!y(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");
if(!(this instanceof g))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var b=this;try{a(function(a){t(b,a)},function(a){e(b,a)})}catch(c){e(b,c)}}}var F=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},k=0,G,B,n=function(a,b){r[k]=a;r[k+1]=b;k+=2;2===k&&(B?B(j):p())},q="undefined"!==typeof window?window:void 0,v=q||{},v=v.MutationObserver||v.WebKitMutationObserver,
O="undefined"!==typeof process&&"[object process]"==={}.toString.call(process),P="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,r=Array(1E3),p;if(O)p=function(){process.nextTick(j)};else if(v){var H=0,q=new v(j),I=document.createTextNode("");q.observe(I,{characterData:!0});p=function(){I.data=H=++H%2}}else if(P){var J=new MessageChannel;J.port1.onmessage=j;p=function(){J.port2.postMessage(0)}}else if(void 0===q&&"function"===typeof require)try{var K=
require("vertx");G=K.runOnLoop||K.runOnContext;p=function(){G(j)}}catch(Q){p=function(){setTimeout(j,1)}}else p=function(){setTimeout(j,1)};var o=void 0,u=1,m=2,x=new E,A=new E;i.prototype._validateInput=function(a){return F(a)};i.prototype._validationError=function(){return Error("Array Methods must be provided an Array")};i.prototype._init=function(){this._result=Array(this.length)};i.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;b._state===o&&d<a;d++)this._eachEntry(c[d],
d)};i.prototype._eachEntry=function(a,b){var c=this._instanceConstructor;"object"===typeof a&&null!==a?a.constructor===c&&a._state!==o?(a._onerror=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(c.resolve(a),b):(this._remaining--,this._result[b]=a)};i.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===o&&(this._remaining--,a===m?e(d,c):this._result[b]=c);0===this._remaining&&l(d,this._result)};i.prototype._willSettleAt=function(a,b){var c=this;w(a,void 0,function(a){c._settledAt(u,
b,a)},function(a){c._settledAt(m,b,a)})};var N=0,L=g;g.all=function(a){return(new i(this,a)).promise};g.race=function(a){function b(a){t(d,a)}function c(a){e(d,a)}var d=new this(s);if(!F(a))return e(d,new TypeError("You must pass an array to race.")),d;for(var h=a.length,f=0;d._state===o&&f<h;f++)w(this.resolve(a[f]),void 0,b,c);return d};g.resolve=function(a){if(a&&"object"===typeof a&&a.constructor===this)return a;var b=new this(s);t(b,a);return b};g.reject=function(a){var b=new this(s);e(b,a);
return b};g._setScheduler=function(a){B=a};g._setAsap=function(a){n=a};g._asap=n;g.prototype={constructor:g,then:function(a,b){var c=this._state;if(c===u&&!a||c===m&&!b)return this;var d=new this.constructor(s),e=this._result;if(c){var f=arguments[c-1];n(function(){D(c,d,f,e)})}else w(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}};var q=function(){var a;if("undefined"!==typeof global)a=global;else if("undefined"!==typeof self)a=self;else try{a=Function("return this")()}catch(b){throw Error("polyfill failed because global object is unavailable in this environment");
}var c=a.Promise;if(!c||"[object Promise]"!==Object.prototype.toString.call(c.resolve())||c.cast)a.Promise=L},C={Promise:L,polyfill:q};"function"===typeof define&&define.amd?define(function(){return C}):"undefined"!==typeof module&&module.exports?module.exports=C:"undefined"!==typeof this&&(this.ES6Promise=C);q()}).call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api', location = 'probe.js' */
!function(){var n,t,e,r,o,i,u,c,s,f,a,h,d,l,p,v;n=function(){return window}(),t=function(n){return!(!n.performance||!n.performance.now)}(n),e=[],r=function(n){return function(t){n.unshift({addReporter:t})}}(e),o=function(n){return function(t){for(;n.length;)t(n.splice(0,1)[0]);n.unshift=t,n.push=t}}(e),i=function(n,t){return function(e){n.push({end:{key:e.key,timestamp:t.performance.now()}})}}(e,n),u=function(n){var t=n.HTMLElement.prototype;return t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector}(n),c=function(){function n(){this._={},this.length=0}return n.prototype.add=function(n,t){this._.hasOwnProperty(n)||(this.length++,this._[n]=[]),this._[n].push(t)},n.prototype.remove=function(n,t){var e,r=!1;return this._.hasOwnProperty(n)&&(1===arguments.length?(delete this._[n],r=!0):(e=this._[n].indexOf(t),e>-1&&(this._[n].splice(e,1),0===this._[n].length&&delete this._[n],r=!0))),r},n.prototype.get=function(n){return this._.hasOwnProperty(n)?this._[n]:[]},n.prototype.forEach=function(n){var t=this._;Object.keys(t).forEach(function(e){n(t[e],e)})},n}(),s=function(n){return n.document}(n),f=function(n,t,e,r){function o(n,t){a||(c.observe(r,{attributes:!0,childList:!0,subtree:!0}),a=!0),s.add(n,t)}function i(n,t){s.remove.apply(s,arguments),0===s.length&&(c.disconnect(),a=!1)}function u(n){var t;n.forEach||(n=[n]);var e=new h(function(e,u){function c(){f.forEach(function(n){n()})}var s=[],f=[];n.forEach(function(n){var t,e;r.querySelector(n)||(t=new h(function(t){o(n,t),e=function(){i(n,t)}}),s.push(t),f.push(e))}),h.all(s).then(c).then(e,u),t=function(){c(),u()}});return e.dismiss=t,e}var c,s,f=e.MutationObserver,a=!1,h=e.Promise;return f&&h?(s=new t,c=new f(function(t){t.forEach(function(t){var e="childList"===t.type&&t.addedNodes&&t.addedNodes.length>0,r="attributes"===t.type;(e||r)&&s.forEach(function(e,r){(t.target.querySelector(r)||n.call(t.target,r))&&(e.forEach(function(n){n()}),i(r))})})}),u):void 0}(u,c,n,s),a=function(n,t,e,r){function o(n,t){a||(c.observe(r,{childList:!0,subtree:!0}),a=!0),s.add(n,t)}function i(n,t){s.remove.apply(s,arguments),0===s.length&&(c.disconnect(),a=!1)}function u(n){var t;n.forEach||(n=[n]);var e=new h(function(e,u){function c(){f.forEach(function(n){n()})}var s=[],f=[];n.forEach(function(n){var t,e;r.querySelector(n)&&(t=new h(function(t){o(n,t),e=function(){i(n,t)}}),s.push(t),f.push(e))}),h.all(s).then(c).then(e,u),t=function(){c(),u()}});return e.dismiss=t,e}var c,s,f=e.MutationObserver,a=!1,h=e.Promise;return f&&h?(s=new t,c=new f(function(t){t.forEach(function(t){var e="childList"===t.type&&t.removedNodes&&t.removedNodes.length>0;e&&s.forEach(function(e,r){for(var o,u=0;u<t.removedNodes.length;u++)if(o=t.removedNodes[u],o.querySelector&&(o.querySelector(r)||n.call(o,r))){for(var c=0;c<e.length;c++)e[c]();i(r)}})})}),u):void 0}(u,c,n,s),h=function(n,t){return!(!n||!t)}(f,a),d=function(n,t){function e(){return r}var r=!1;return n.addEventListener("DOMContentLoaded",function(){t.setTimeout(function(){r=!0})}),e}(s,n),l=function(n,t,e,r,o,i,u){function c(n,t){return Array.isArray(n)||(n=[n]),n.map(function(n){return"string"==typeof n?{selector:n,requireUpdate:t}:n})}function s(n){var t;return t=n.map(function(n){var t;return n.requireUpdate?(t=new o(n.selector),a.push(function(){t.dismiss()})):t=f.resolve(),t.then(function(){var t=new r(n.selector);return a.push(function(){t.dismiss()}),t})}),f.all(t)}var f=u.Promise,a=[];return function(r){var o,f="isInitial"in r?r.isInitial:i()===!1,h="threshold"in r?r.threshold:1e3;e.push({start:{key:r.key,isInitial:f,threshold:h,timestamp:f?0:u.performance.now()}}),a.forEach(function(n){n()}),a.splice(0,a.length),r.ready&&t&&(o=c(r.ready,!f),s(o).then(function(){n({key:r.key})}))}}(i,h,e,f,a,d,n),p=function(n){return function(t){n.push({subscribe:t})}}(e),v=function(n,t,e,r,o,i){var u=function(){};return{start:n?o:u,end:n?r:u,addReporter:n?t:u,delegateTo:n?e:u,subscribe:n?i:u}}(t,r,o,i,l,p),window["browser-metrics"]=v,window.define&&window.define("internal/browser-metrics",function(){return v})}();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api', location = 'internal/browser-metrics-aa-beacon.js' */
define("internal/browser-metrics-aa-beacon",function(){var n={};return n=function(n){function e(n,e){Object.keys(e).forEach(function(r){n[r]=e[r]})}var r=[],t=[];return n.addUrlCleaner=function(n){t.push(n)},n.cleanUrl=function(n){return t.reduce(function(e,r){var t=r(n);return t.length>e.length?t:e},"")},n.addReportMarshaller=function(n){r.push(n)},n.beacon=function(n){var t={};r.forEach(function(r){var a=r(n);"object"==typeof a&&e(t,a)});var a={name:"browser.metrics.navigation",properties:t};AJS.EventQueue.push(a)},n}(n)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api', location = 'loader.js' */
!function(){var n={},r={},i={};n=function(n){var r=window;return r}(n),r=function(n,r){var i=r.WRM;return i}(r,n),i=function(n,r,i){function t(){u===c&&o&&(o(),o=null)}var u=0,c=0,o=null,e={install:function(n){u+=1,n(function(){c+=1,t()})}};return r["browser-metrics-plugin"]=e,i.require(["wrc!browser-metrics-plugin.contrib"],function(){r.require(["internal/browser-metrics-plugin/collector"],function(n){o=function(){n.install()},t()})}),n}(i,n,r)}();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-browser-metrics:viewcontent', location = '/js/viewcontent.js' */
require(["confluence/api/event","internal/browser-metrics","ajs","jquery"],function(f,e,c,g){function b(i){if(!g(i.target).hasClass("full-load")){var h=i.data.type;if(c.Meta.getBoolean("shared-drafts")&&c.Meta.getBoolean("synchrony-dark-enabled")){var j="confluence."+h+".edit.collaborative.quick-view";e.start({key:j});c.bind("synchrony.connected",function(){e.end({key:j})})}else{if(!c.Meta.getBoolean("shared-drafts")){e.start({key:"confluence."+h+".edit.quick-view",ready:".active-richtext"})}}}}function a(){e.start({key:"confluence.file.preview.firstpage"});f.bind("confluence-previews.fileviewer.completed",function(){e.end({key:"confluence.file.preview.firstpage"})})}function d(){var h=c.Meta.get("content-type");if(h){e.start({key:"confluence."+h+".view",ready:".wiki-content",isInitial:true});g("#editPageLink").on("click",{type:h},b);g(".confluence-embedded-file-wrapper").on("click",a)}}c.toInit(d)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.ext.newcode-macro-plugin:syntaxhighlighter-init', location = 'sh/asyncLoader.js' */
define("confluence/code-macro/async-loader",["jquery","wrm","underscore"],function(c,a,b){return function(){b.defer(function(){var h=c(".codeHeader .collapse-source");d(h);var i=c("#content").find("pre.syntaxhighlighter-pre");if(i.length>0){var g="wr!com.atlassian.confluence.ext.newcode-macro-plugin:sh-theme-";var f=["wrc!code-macro"];i.each(function(){f.push(g+c(this).data("theme").toLowerCase());var j=c(this).data("custom-language-resource");if(typeof j!=="undefined"&&f.indexOf(j)===-1){f.push("wr!"+j)}});a.require(f).done(function(){window.SyntaxHighlighter.highlight();e(h)})}});function d(f){f.hide();b.forEach(f,function(g){c(g).next(".collapse-spinner-wrapper").spin()})}function e(f){f.show();f.next(".collapse-spinner-wrapper").remove()}}});require("confluence/module-exporter").safeRequire("confluence/code-macro/async-loader",function(a){AJS.toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:page-banner-common-resources', location = 'js/page-banner.js' */
AJS.toInit(function(e){d();AJS.bind("system-content-metadata.toggled-restrictions",function(i,k){var j=e("#content-metadata-page-restrictions");var g="";j.removeClass();var h=k.hasRestrictions&&!(k.hasExplicitRestrictions||k.hasInheritedRestrictions);if(k.hasExplicitRestrictions||h){j.addClass("aui-icon aui-icon-small aui-iconfont-locked restricted");g="Des restrictions sont en vigueur"}else{if(k.hasInheritedRestrictions){j.addClass("aui-icon aui-icon-small aui-iconfont-unlocked restricted");g="Des restrictions sont en vigueur"}else{j.addClass("aui-icon aui-icon-small aui-iconfont-unlocked");g=k.hasAnyExplicitRestrictions?"Des restrictions sont en vigueur":"Sans restriction"}}j.attr("title",g);a(j);d()});AJS.bind("breadcrumbs.expanded",f);e("#page-metadata-banner").css("visibility","visible");b();e("#content-metadata-page-restrictions").click(function(g){g.preventDefault();AJS.trigger("system-content-metadata.open-restrictions-dialog")});function d(){if(e("#system-content-items").children(":not(.hidden)").length==0){e("#system-content-items").addClass("hidden")}else{e("#system-content-items").removeClass("hidden")}}function f(){e("#page-metadata-banner").hide()}function b(){var g=e("#system-content-items a:not(.tipsy-disabled), .page-metadata-item a:not(.tipsy-disabled), .page-metadata-modification-info a.last-modified:not(tipsy-disabled)");a(g);g.click(function(h){c(e(h.target).closest("a"))});e(window).on("click scroll resize",c)}function a(g){e(g).tooltip({live:true,gravity:e("#com-atlassian-confluence").hasClass("theme-documentation view-blog-post")?"nw":"n",title:"title",delayIn:500})}function c(g){e(".tipsy").remove();if(g){var h=e(g).data("tipsy");if(h){h.hoverState="out"}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:page-banner-common-resources', location = 'js/page-banner-analytics.js' */
AJS.toInit(function(c){function b(){if(!AJS.Confluence.Analytics||!AJS.Confluence.Analytics.setAnalyticsSource){AJS.log("WARNING: Could not initialise analytics for the page banner: AJS.Confluence.Analytics.setAnalyticsSource is not defined.");return}var e=AJS.Confluence.Analytics.setAnalyticsSource;var f=c("#breadcrumbs > li");e(f.filter(":not(#ellipsis)").find("a"),"breadcrumbs");e(f.filter(".hidden-crumb").find("a"),"breadcrumbs-expanded");e(f.filter(":last").find("a"),"breadcrumbs-parent");var d=c("#com-atlassian-confluence").hasClass("theme-documentation")?"breadcrumbs-homepage":"breadcrumbs-collector";e(f.filter(".first").find("a"),d)}function a(e,d,g){var f=null;e.mouseover(function(){f=setTimeout(g,d)});e.mouseout(function(){clearTimeout(f)})}AJS.bind("breadcrumbs.expanded",function(){AJS.trigger("analyticsEvent",{name:"breadcrumbs-expanded"})});b()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-banner:soy-resources', location = 'soy/page-banner.soy' */
// This file was automatically generated from page-banner.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PageBanner.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PageBanner == 'undefined') { Confluence.Templates.PageBanner = {}; }


Confluence.Templates.PageBanner.banner = function(opt_data, opt_ignored) {
  var output = '<div id="page-metadata-banner"><ul class="banner">' + Confluence.Templates.PageBanner.renderSystemContentItems(opt_data);
  var itemList6 = opt_data.pageBannerItems;
  var itemListLen6 = itemList6.length;
  for (var itemIndex6 = 0; itemIndex6 < itemListLen6; itemIndex6++) {
    var itemData6 = itemList6[itemIndex6];
    output += Confluence.Templates.PageBanner.renderPageBannerItem(itemData6);
  }
  output += '</ul></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.banner.soyTemplateName = 'Confluence.Templates.PageBanner.banner';
}


Confluence.Templates.PageBanner.renderSystemContentItems = function(opt_data, opt_ignored) {
  var output = '<li id="system-content-items" class="noprint">';
  var itemList12 = opt_data.systemContentItems;
  var itemListLen12 = itemList12.length;
  for (var itemIndex12 = 0; itemIndex12 < itemListLen12; itemIndex12++) {
    var itemData12 = itemList12[itemIndex12];
    output += Confluence.Templates.PageBanner.itemAnchor(soy.$$augmentMap(itemData12, {isSystemContentItem: true}));
  }
  output += '</li>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.renderSystemContentItems.soyTemplateName = 'Confluence.Templates.PageBanner.renderSystemContentItems';
}


Confluence.Templates.PageBanner.renderPageBannerItem = function(opt_data, opt_ignored) {
  return '<li class="page-metadata-item noprint ' + ((opt_data.isAuiButton) ? 'has-button' : '') + '" ' + ((opt_data.linkId) ? ' id="' + soy.$$escapeHtml(opt_data.linkId) + '-wrapper"' : '') + '>' + Confluence.Templates.PageBanner.itemAnchor(soy.$$augmentMap(opt_data, {isSystemContentItem: false})) + '</li>';
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.renderPageBannerItem.soyTemplateName = 'Confluence.Templates.PageBanner.renderPageBannerItem';
}


Confluence.Templates.PageBanner.itemAnchor = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml(opt_data.href) + '" title="' + soy.$$escapeHtml(opt_data.tooltip) + '" ' + ((opt_data.linkId) ? 'id="' + soy.$$escapeHtml(opt_data.linkId) + '"' : '') + ' ' + ((opt_data.styleClasses) ? 'class="' + soy.$$escapeHtml(opt_data.styleClasses) + '"' : '') + '>' + Confluence.Templates.PageBanner.itemIcon(opt_data) + ((! opt_data.isSystemContentItem) ? '<span>' + soy.$$escapeHtml(opt_data.label) + '</span>' : '') + '</a>';
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.itemAnchor.soyTemplateName = 'Confluence.Templates.PageBanner.itemAnchor';
}


Confluence.Templates.PageBanner.itemIcon = function(opt_data, opt_ignored) {
  return '' + ((opt_data.icon) ? '<img class="page-banner-item-icon" src="' + soy.$$escapeHtml(opt_data.icon.url) + '" style="height: ' + soy.$$escapeHtml(opt_data.icon.height) + 'px; width: ' + soy.$$escapeHtml(opt_data.icon.width) + 'px;"/>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.PageBanner.itemIcon.soyTemplateName = 'Confluence.Templates.PageBanner.itemIcon';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:view-comment', location = '/includes/js/comments.js' */
define("confluence/comments",["ajs","jquery","confluence/storage-manager"],function(b,g,h){function f(){return confirm("\u00cates-vous s\u00fbr de vouloir supprimer ce commentaire\u00a0?")?(this.href+="&confirm=yes",!0):!1}return{binder:{bindRemoveConfirmation:function(a){g("#comment-"+a+" .comment-action-remove a").click(f)}},initialiser:function(a){var d=h("confluence","comments");if(a("#comments-section").length){a("#comments-section .comment:odd").addClass("odd");a(".comment-action-remove a").click(f);var e=
a("#addcomment.comment-text"),c=a("#comments-text-editor textarea");c.focus(function(){e.addClass("active")}).blur(function(){a.trim(c.val()).length||e.removeClass("active")}).bind("reset.default-text",function(){e.removeClass("active")});a("form[name='textcommentform']").submit(function(){var d=c.val();return!a.trim(d)?(alert("Le texte du commentaire est vide. La cr\u00e9ation de commentaires vides est impossible."),!1):!0});a("#add-comment-rte").click(function(){c.hasClass("placeholded")||d.setItem("text-comment",a.trim(c.val()))});a("#addcomment #rte").length&&
b.bind("init.rte",function(a,b){var c=d.getItem("text-comment");c&&(b.editor.setContent(c),d.setItem("text-comment",""))})}}}});require("confluence/module-exporter").safeRequire("confluence/comments",function(b){require("confluence/legacy").Comments=b.binder;require("ajs").toInit(b.initialiser)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-vendor-jquery-jquery-ui-jquery-ui-datepicker', location = 'node_modules/@atlassian/aui/src/js-vendor/jquery/jquery-ui/jquery.ui.datepicker.js' */
("undefined"===typeof window?global:window).__716e1ce77ba41179f2e03684627da84b=function(){(function(d){function B(){this.debug=!1;this._curInst=null;this._keyEvent=!1;this._disabledInputs=[];this._inDialog=this._datepickerShowing=!1;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass=
"ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:"January February March April May June July August September October November December".split(" "),monthNamesShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),dayNames:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),
dayNamesMin:"Su Mo Tu We Th Fr Sa".split(" "),weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",
minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1};d.extend(this._defaults,this.regional[""]);this.dpDiv=C(d('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function C(a){return a.bind("mouseout",
function(a){a=d(a.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");a.length&&a.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(b){b=d(b.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");if(!d.datepicker._isDisabledDatepicker(D.inline?a.parent()[0]:D.input[0])&&b.length)b.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),
b.addClass("ui-state-hover"),b.hasClass("ui-datepicker-prev")&&b.addClass("ui-datepicker-prev-hover"),b.hasClass("ui-datepicker-next")&&b.addClass("ui-datepicker-next-hover")})}function z(a,b){d.extend(a,b);for(var c in b)if(null==b[c]||void 0==b[c])a[c]=b[c];return a}d.extend(d.ui,{datepicker:{version:"1.8.24"}});var x=(new Date).getTime(),D;d.extend(B.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},
setDefaults:function(a){z(this._defaults,a||{});return this},_attachDatepicker:function(a,b){var c=null,e;for(e in this._defaults){var f=a.getAttribute("date:"+e);if(f){c=c||{};try{c[e]=eval(f)}catch(h){c[e]=f}}}e=a.nodeName.toLowerCase();f="div"==e||"span"==e;a.id||(this.uuid+=1,a.id="dp"+this.uuid);var j=this._newInst(d(a),f);j.settings=d.extend({},b||{},c||{});"input"==e?this._connectDatepicker(a,j):f&&this._inlineDatepicker(a,j)},_newInst:function(a,b){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,
"\\\\$1"),input:a,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:b,dpDiv:!b?this.dpDiv:C(d('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(a,b){var c=d(a);b.append=d([]);b.trigger=d([]);c.hasClass(this.markerClassName)||(this._attachments(c,b),c.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",
function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),this._autoSize(b),d.data(a,"datepicker",b),b.settings.disabled&&this._disableDatepicker(a))},_attachments:function(a,b){var c=this._get(b,"appendText"),e=this._get(b,"isRTL");b.append&&b.append.remove();c&&(b.append=d('<span class="'+this._appendClass+'">'+c+"</span>"),a[e?"before":"after"](b.append));a.unbind("focus",this._showDatepicker);b.trigger&&b.trigger.remove();c=this._get(b,"showOn");("focus"==
c||"both"==c)&&a.focus(this._showDatepicker);if("button"==c||"both"==c){var c=this._get(b,"buttonText"),f=this._get(b,"buttonImage");b.trigger=d(this._get(b,"buttonImageOnly")?d("<img/>").addClass(this._triggerClass).attr({src:f,alt:c,title:c}):d('<button type="button"></button>').addClass(this._triggerClass).html(""==f?c:d("<img/>").attr({src:f,alt:c,title:c})));a[e?"before":"after"](b.trigger);b.trigger.click(function(){if(d.datepicker._datepickerShowing&&d.datepicker._lastInput==a[0])d.datepicker._hideDatepicker();
else{d.datepicker._datepickerShowing&&d.datepicker._lastInput!=a[0]&&d.datepicker._hideDatepicker();d.datepicker._showDatepicker(a[0])}return false})}},_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b=new Date(2009,11,20),c=this._get(a,"dateFormat");if(c.match(/[DM]/)){var d=function(a){for(var b=0,c=0,d=0;d<a.length;d++)a[d].length>b&&(b=a[d].length,c=d);return c};b.setMonth(d(this._get(a,c.match(/MM/)?"monthNames":"monthNamesShort")));b.setDate(d(this._get(a,c.match(/DD/)?"dayNames":
"dayNamesShort"))+20-b.getDay())}a.input.attr("size",this._formatDate(a,b).length)}},_inlineDatepicker:function(a,b){var c=d(a);c.hasClass(this.markerClassName)||(c.addClass(this.markerClassName).append(b.dpDiv).bind("setData.datepicker",function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),d.data(a,"datepicker",b),this._setDate(b,this._getDefaultDate(b),!0),this._updateDatepicker(b),this._updateAlternate(b),b.settings.disabled&&this._disableDatepicker(a),
b.dpDiv.css("display","block"))},_dialogDatepicker:function(a,b,c,e,f){a=this._dialogInst;a||(this.uuid+=1,this._dialogInput=d('<input type="text" id="dp'+this.uuid+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),d("body").append(this._dialogInput),a=this._dialogInst=this._newInst(this._dialogInput,!1),a.settings={},d.data(this._dialogInput[0],"datepicker",a));z(a.settings,e||{});b=b&&b.constructor==Date?this._formatDate(a,b):b;this._dialogInput.val(b);
this._pos=f?f.length?f:[f.pageX,f.pageY]:null;this._pos||(this._pos=[document.documentElement.clientWidth/2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)]);this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");a.settings.onSelect=c;this._inDialog=!0;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);d.blockUI&&d.blockUI(this.dpDiv);
d.data(this._dialogInput[0],"datepicker",a);return this},_destroyDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();d.removeData(a,"datepicker");"input"==e?(c.append.remove(),c.trigger.remove(),b.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==e||"span"==e)&&b.removeClass(this.markerClassName).empty()}},
_enableDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();if("input"==e)a.disabled=!1,c.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if("div"==e||"span"==e)b=b.children("."+this._inlineClass),b.children().removeClass("ui-state-disabled"),b.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled");this._disabledInputs=d.map(this._disabledInputs,
function(b){return b==a?null:b})}},_disableDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();if("input"==e)a.disabled=!0,c.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if("div"==e||"span"==e)b=b.children("."+this._inlineClass),b.children().addClass("ui-state-disabled"),b.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled",
"disabled");this._disabledInputs=d.map(this._disabledInputs,function(b){return b==a?null:b});this._disabledInputs[this._disabledInputs.length]=a}},_isDisabledDatepicker:function(a){if(!a)return!1;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]==a)return!0;return!1},_getInst:function(a){try{return d.data(a,"datepicker")}catch(b){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(a,b,c){var e=this._getInst(a);if(2==arguments.length&&"string"==typeof b)return"defaults"==
b?d.extend({},d.datepicker._defaults):e?"all"==b?d.extend({},e.settings):this._get(e,b):null;var f=b||{};"string"==typeof b&&(f={},f[b]=c);if(e){this._curInst==e&&this._hideDatepicker();var h=this._getDateDatepicker(a,!0),j=this._getMinMaxDate(e,"min"),g=this._getMinMaxDate(e,"max");z(e.settings,f);null!==j&&(void 0!==f.dateFormat&&void 0===f.minDate)&&(e.settings.minDate=this._formatDate(e,j));null!==g&&(void 0!==f.dateFormat&&void 0===f.maxDate)&&(e.settings.maxDate=this._formatDate(e,g));this._attachments(d(a),
e);this._autoSize(e);this._setDate(e,h);this._updateAlternate(e);this._updateDatepicker(e)}},_changeDatepicker:function(a,b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){(a=this._getInst(a))&&this._updateDatepicker(a)},_setDateDatepicker:function(a,b){var c=this._getInst(a);c&&(this._setDate(c,b),this._updateDatepicker(c),this._updateAlternate(c))},_getDateDatepicker:function(a,b){var c=this._getInst(a);c&&!c.inline&&this._setDateFromField(c,b);return c?this._getDate(c):null},_doKeyDown:function(a){var b=
d.datepicker._getInst(a.target),c=!0,e=b.dpDiv.is(".ui-datepicker-rtl");b._keyEvent=!0;if(d.datepicker._datepickerShowing)switch(a.keyCode){case 9:d.datepicker._hideDatepicker();c=!1;break;case 13:return c=d("td."+d.datepicker._dayOverClass+":not(."+d.datepicker._currentClass+")",b.dpDiv),c[0]&&d.datepicker._selectDay(a.target,b.selectedMonth,b.selectedYear,c[0]),(a=d.datepicker._get(b,"onSelect"))?(c=d.datepicker._formatDate(b),a.apply(b.input?b.input[0]:null,[c,b])):d.datepicker._hideDatepicker(),
!1;case 27:d.datepicker._hideDatepicker();break;case 33:d.datepicker._adjustDate(a.target,a.ctrlKey?-d.datepicker._get(b,"stepBigMonths"):-d.datepicker._get(b,"stepMonths"),"M");break;case 34:d.datepicker._adjustDate(a.target,a.ctrlKey?+d.datepicker._get(b,"stepBigMonths"):+d.datepicker._get(b,"stepMonths"),"M");break;case 35:(a.ctrlKey||a.metaKey)&&d.datepicker._clearDate(a.target);c=a.ctrlKey||a.metaKey;break;case 36:(a.ctrlKey||a.metaKey)&&d.datepicker._gotoToday(a.target);c=a.ctrlKey||a.metaKey;
break;case 37:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,e?1:-1,"D");c=a.ctrlKey||a.metaKey;a.originalEvent.altKey&&d.datepicker._adjustDate(a.target,a.ctrlKey?-d.datepicker._get(b,"stepBigMonths"):-d.datepicker._get(b,"stepMonths"),"M");break;case 38:(a.ctrlKey||a.metaKey)&&d.datepicker._adjustDate(a.target,-7,"D");c=a.ctrlKey||a.metaKey;break;case 39:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,e?-1:1,"D");c=a.ctrlKey||a.metaKey;a.originalEvent.altKey&&d.datepicker._adjustDate(a.target,
a.ctrlKey?+d.datepicker._get(b,"stepBigMonths"):+d.datepicker._get(b,"stepMonths"),"M");break;case 40:(a.ctrlKey||a.metaKey)&&d.datepicker._adjustDate(a.target,7,"D");c=a.ctrlKey||a.metaKey;break;default:c=!1}else 36==a.keyCode&&a.ctrlKey?d.datepicker._showDatepicker(this):c=!1;c&&(a.preventDefault(),a.stopPropagation())},_doKeyPress:function(a){var b=d.datepicker._getInst(a.target);if(d.datepicker._get(b,"constrainInput")){var b=d.datepicker._possibleChars(d.datepicker._get(b,"dateFormat")),c=String.fromCharCode(void 0==
a.charCode?a.keyCode:a.charCode);return a.ctrlKey||a.metaKey||" ">c||!b||-1<b.indexOf(c)}},_doKeyUp:function(a){a=d.datepicker._getInst(a.target);if(a.input.val()!=a.lastVal)try{if(d.datepicker.parseDate(d.datepicker._get(a,"dateFormat"),a.input?a.input.val():null,d.datepicker._getFormatConfig(a)))d.datepicker._setDateFromField(a),d.datepicker._updateAlternate(a),d.datepicker._updateDatepicker(a)}catch(b){d.datepicker.log(b)}return!0},_showDatepicker:function(a){a=a.target||a;"input"!=a.nodeName.toLowerCase()&&
(a=d("input",a.parentNode)[0]);if(!(d.datepicker._isDisabledDatepicker(a)||d.datepicker._lastInput==a)){var b=d.datepicker._getInst(a);d.datepicker._curInst&&d.datepicker._curInst!=b&&(d.datepicker._curInst.dpDiv.stop(!0,!0),b&&d.datepicker._datepickerShowing&&d.datepicker._hideDatepicker(d.datepicker._curInst.input[0]));var c=d.datepicker._get(b,"beforeShow"),c=c?c.apply(a,[a,b]):{};if(!1!==c){z(b.settings,c);b.lastVal=null;d.datepicker._lastInput=a;d.datepicker._setDateFromField(b);d.datepicker._inDialog&&
(a.value="");d.datepicker._pos||(d.datepicker._pos=d.datepicker._findPos(a),d.datepicker._pos[1]+=a.offsetHeight);var e=!1;d(a).parents().each(function(){e=e|d(this).css("position")=="fixed";return!e});e&&d.browser.opera&&(d.datepicker._pos[0]-=document.documentElement.scrollLeft,d.datepicker._pos[1]-=document.documentElement.scrollTop);c={left:d.datepicker._pos[0],top:d.datepicker._pos[1]};d.datepicker._pos=null;b.dpDiv.empty();b.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});d.datepicker._updateDatepicker(b);
c=d.datepicker._checkOffset(b,c,e);b.dpDiv.css({position:d.datepicker._inDialog&&d.blockUI?"static":e?"fixed":"absolute",display:"none",left:c.left+"px",top:c.top+"px"});if(!b.inline){var c=d.datepicker._get(b,"showAnim"),f=d.datepicker._get(b,"duration"),h=function(){var a=b.dpDiv.find("iframe.ui-datepicker-cover");if(a.length){var c=d.datepicker._getBorders(b.dpDiv);a.css({left:-c[0],top:-c[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()})}};b.dpDiv.zIndex(d(a).zIndex()+1);d.datepicker._datepickerShowing=
!0;if(d.effects&&d.effects[c])b.dpDiv.show(c,d.datepicker._get(b,"showOptions"),f,h);else b.dpDiv[c||"show"](c?f:null,h);(!c||!f)&&h();b.input.is(":visible")&&!b.input.is(":disabled")&&b.input.focus();d.datepicker._curInst=b}}}},_updateDatepicker:function(a){this.maxRows=4;var b=d.datepicker._getBorders(a.dpDiv);D=a;a.dpDiv.empty().append(this._generateHTML(a));this._attachHandlers(a);var c=a.dpDiv.find("iframe.ui-datepicker-cover");c.length&&c.css({left:-b[0],top:-b[1],width:a.dpDiv.outerWidth(),
height:a.dpDiv.outerHeight()});a.dpDiv.find("."+this._dayOverClass+" a").mouseover();b=this._getNumberOfMonths(a);c=b[1];a.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");1<c&&a.dpDiv.addClass("ui-datepicker-multi-"+c).css("width",17*c+"em");a.dpDiv[(1!=b[0]||1!=b[1]?"add":"remove")+"Class"]("ui-datepicker-multi");a.dpDiv[(this._get(a,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");a==d.datepicker._curInst&&(d.datepicker._datepickerShowing&&
a.input&&a.input.is(":visible")&&!a.input.is(":disabled")&&a.input[0]!=document.activeElement)&&a.input.focus();if(a.yearshtml){var e=a.yearshtml;setTimeout(function(){e===a.yearshtml&&a.yearshtml&&a.dpDiv.find("select.ui-datepicker-year:first").replaceWith(a.yearshtml);e=a.yearshtml=null},0)}},_getBorders:function(a){var b=function(a){return{thin:1,medium:2,thick:3}[a]||a};return[parseFloat(b(a.css("border-left-width"))),parseFloat(b(a.css("border-top-width")))]},_checkOffset:function(a,b,c){var e=
a.dpDiv.outerWidth(),f=a.dpDiv.outerHeight(),h=a.input?a.input.outerWidth():0,j=a.input?a.input.outerHeight():0,g=document.documentElement.clientWidth+(c?0:d(document).scrollLeft()),i=document.documentElement.clientHeight+(c?0:d(document).scrollTop());b.left-=this._get(a,"isRTL")?e-h:0;b.left-=c&&b.left==a.input.offset().left?d(document).scrollLeft():0;b.top-=c&&b.top==a.input.offset().top+j?d(document).scrollTop():0;b.left-=Math.min(b.left,b.left+e>g&&g>e?Math.abs(b.left+e-g):0);b.top-=Math.min(b.top,
b.top+f>i&&i>f?Math.abs(f+j):0);return b},_findPos:function(a){for(var b=this._getInst(a),b=this._get(b,"isRTL");a&&("hidden"==a.type||1!=a.nodeType||d.expr.filters.hidden(a));)a=a[b?"previousSibling":"nextSibling"];a=d(a).offset();return[a.left,a.top]},_hideDatepicker:function(a){var b=this._curInst;if(b&&!(a&&b!=d.data(a,"datepicker"))&&this._datepickerShowing){var a=this._get(b,"showAnim"),c=this._get(b,"duration"),e=function(){d.datepicker._tidyDialog(b)};if(d.effects&&d.effects[a])b.dpDiv.hide(a,
d.datepicker._get(b,"showOptions"),c,e);else b.dpDiv["slideDown"==a?"slideUp":"fadeIn"==a?"fadeOut":"hide"](a?c:null,e);a||e();this._datepickerShowing=!1;(a=this._get(b,"onClose"))&&a.apply(b.input?b.input[0]:null,[b.input?b.input.val():"",b]);this._lastInput=null;this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),d.blockUI&&(d.unblockUI(),d("body").append(this.dpDiv)));this._inDialog=!1}},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},
_checkExternalClick:function(a){if(d.datepicker._curInst){var a=d(a.target),b=d.datepicker._getInst(a[0]);(a[0].id!=d.datepicker._mainDivId&&0==a.parents("#"+d.datepicker._mainDivId).length&&!a.hasClass(d.datepicker.markerClassName)&&!a.closest("."+d.datepicker._triggerClass).length&&d.datepicker._datepickerShowing&&(!d.datepicker._inDialog||!d.blockUI)||a.hasClass(d.datepicker.markerClassName)&&d.datepicker._curInst!=b)&&d.datepicker._hideDatepicker()}},_adjustDate:function(a,b,c){var a=d(a),e=this._getInst(a[0]);
this._isDisabledDatepicker(a[0])||(this._adjustInstDate(e,b+("M"==c?this._get(e,"showCurrentAtPos"):0),c),this._updateDatepicker(e))},_gotoToday:function(a){var a=d(a),b=this._getInst(a[0]);if(this._get(b,"gotoCurrent")&&b.currentDay)b.selectedDay=b.currentDay,b.drawMonth=b.selectedMonth=b.currentMonth,b.drawYear=b.selectedYear=b.currentYear;else{var c=new Date;b.selectedDay=c.getDate();b.drawMonth=b.selectedMonth=c.getMonth();b.drawYear=b.selectedYear=c.getFullYear()}this._notifyChange(b);this._adjustDate(a)},
_selectMonthYear:function(a,b,c){var a=d(a),e=this._getInst(a[0]);e["selected"+("M"==c?"Month":"Year")]=e["draw"+("M"==c?"Month":"Year")]=parseInt(b.options[b.selectedIndex].value,10);this._notifyChange(e);this._adjustDate(a)},_selectDay:function(a,b,c,e){var f=d(a);!d(e).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(f[0])&&(f=this._getInst(f[0]),f.selectedDay=f.currentDay=d("a",e).html(),f.selectedMonth=f.currentMonth=b,f.selectedYear=f.currentYear=c,this._selectDate(a,this._formatDate(f,
f.currentDay,f.currentMonth,f.currentYear)))},_clearDate:function(a){a=d(a);this._getInst(a[0]);this._selectDate(a,"")},_selectDate:function(a,b){var c=d(a),c=this._getInst(c[0]),b=null!=b?b:this._formatDate(c);c.input&&c.input.val(b);this._updateAlternate(c);var e=this._get(c,"onSelect");e?e.apply(c.input?c.input[0]:null,[b,c]):c.input&&c.input.trigger("change");c.inline?this._updateDatepicker(c):(this._hideDatepicker(),this._lastInput=c.input[0],"object"!=typeof c.input[0]&&c.input.focus(),this._lastInput=
null)},_updateAlternate:function(a){var b=this._get(a,"altField");if(b){var c=this._get(a,"altFormat")||this._get(a,"dateFormat"),e=this._getDate(a),f=this.formatDate(c,e,this._getFormatConfig(a));d(b).each(function(){d(this).val(f)})}},noWeekends:function(a){a=a.getDay();return[0<a&&6>a,""]},iso8601Week:function(a){a=new Date(a.getTime());a.setDate(a.getDate()+4-(a.getDay()||7));var b=a.getTime();a.setMonth(0);a.setDate(1);return Math.floor(Math.round((b-a)/864E5)/7)+1},parseDate:function(a,b,c){if(null==
a||null==b)throw"Invalid arguments";b="object"==typeof b?b.toString():b+"";if(""==b)return null;for(var e=(c?c.shortYearCutoff:null)||this._defaults.shortYearCutoff,e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),f=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,h=(c?c.dayNames:null)||this._defaults.dayNames,j=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,g=(c?c.monthNames:null)||this._defaults.monthNames,i=c=-1,p=-1,r=-1,k=!1,m=function(b){(b=y+1<a.length&&
a.charAt(y+1)==b)&&y++;return b},l=function(a){var c=m(a),a=RegExp("^\\d{1,"+("@"==a?14:"!"==a?20:"y"==a&&c?4:"o"==a?3:2)+"}"),a=b.substring(u).match(a);if(!a)throw"Missing number at position "+u;u+=a[0].length;return parseInt(a[0],10)},n=function(a,c,e){var a=d.map(m(a)?e:c,function(a,b){return[[b,a]]}).sort(function(a,b){return-(a[1].length-b[1].length)}),f=-1;d.each(a,function(a,c){var d=c[1];if(b.substr(u,d.length).toLowerCase()==d.toLowerCase())return f=c[0],u+=d.length,!1});if(-1!=f)return f+
1;throw"Unknown name at position "+u;},s=function(){if(b.charAt(u)!=a.charAt(y))throw"Unexpected literal at position "+u;u++},u=0,y=0;y<a.length;y++)if(k)"'"==a.charAt(y)&&!m("'")?k=!1:s();else switch(a.charAt(y)){case "d":p=l("d");break;case "D":n("D",f,h);break;case "o":r=l("o");break;case "m":i=l("m");break;case "M":i=n("M",j,g);break;case "y":c=l("y");break;case "@":var v=new Date(l("@")),c=v.getFullYear(),i=v.getMonth()+1,p=v.getDate();break;case "!":v=new Date((l("!")-this._ticksTo1970)/1E4);
c=v.getFullYear();i=v.getMonth()+1;p=v.getDate();break;case "'":m("'")?s():k=!0;break;default:s()}if(u<b.length)throw"Extra/unparsed characters found in date: "+b.substring(u);-1==c?c=(new Date).getFullYear():100>c&&(c+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c<=e?0:-100));if(-1<r){i=1;p=r;do{e=this._getDaysInMonth(c,i-1);if(p<=e)break;i++;p-=e}while(1)}v=this._daylightSavingAdjust(new Date(c,i-1,p));if(v.getFullYear()!=c||v.getMonth()+1!=i||v.getDate()!=p)throw"Invalid date";return v},
ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864E9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(a,b,c){if(!b)return"";var d=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,h=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,
c=(c?c.monthNames:null)||this._defaults.monthNames,j=function(b){(b=r+1<a.length&&a.charAt(r+1)==b)&&r++;return b},g=function(a,b,c){b=""+b;if(j(a))for(;b.length<c;)b="0"+b;return b},i="",p=!1;if(b)for(var r=0;r<a.length;r++)if(p)"'"==a.charAt(r)&&!j("'")?p=!1:i+=a.charAt(r);else switch(a.charAt(r)){case "d":i+=g("d",b.getDate(),2);break;case "D":var k;k=b.getDay();var m=d,l=f;k=j("D")?l[k]:m[k];i+=k;break;case "o":i+=g("o",Math.round(((new Date(b.getFullYear(),b.getMonth(),b.getDate())).getTime()-
(new Date(b.getFullYear(),0,0)).getTime())/864E5),3);break;case "m":i+=g("m",b.getMonth()+1,2);break;case "M":k=b.getMonth();m=h;l=c;k=j("M")?l[k]:m[k];i+=k;break;case "y":i+=j("y")?b.getFullYear():(10>b.getYear()%100?"0":"")+b.getYear()%100;break;case "@":i+=b.getTime();break;case "!":i+=1E4*b.getTime()+this._ticksTo1970;break;case "'":j("'")?i+="'":p=!0;break;default:i+=a.charAt(r)}return i},_possibleChars:function(a){for(var b="",c=!1,d=function(b){(b=f+1<a.length&&a.charAt(f+1)==b)&&f++;return b},
f=0;f<a.length;f++)if(c)"'"==a.charAt(f)&&!d("'")?c=!1:b+=a.charAt(f);else switch(a.charAt(f)){case "d":case "m":case "y":case "@":b+="0123456789";break;case "D":case "M":return null;case "'":d("'")?b+="'":c=!0;break;default:b+=a.charAt(f)}return b},_get:function(a,b){return void 0!==a.settings[b]?a.settings[b]:this._defaults[b]},_setDateFromField:function(a,b){if(a.input.val()!=a.lastVal){var c=this._get(a,"dateFormat"),d=a.lastVal=a.input?a.input.val():null,f,h;f=h=this._getDefaultDate(a);var j=
this._getFormatConfig(a);try{f=this.parseDate(c,d,j)||h}catch(g){this.log(g),d=b?"":d}a.selectedDay=f.getDate();a.drawMonth=a.selectedMonth=f.getMonth();a.drawYear=a.selectedYear=f.getFullYear();a.currentDay=d?f.getDate():0;a.currentMonth=d?f.getMonth():0;a.currentYear=d?f.getFullYear():0;this._adjustInstDate(a)}},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(a,b,c){if(null==b||""===b)b=c;else{var e;if("string"==
typeof b)a:{try{e=d.datepicker.parseDate(d.datepicker._get(a,"dateFormat"),b,d.datepicker._getFormatConfig(a));break a}catch(f){}var h=(b.toLowerCase().match(/^c/)?d.datepicker._getDate(a):null)||new Date,a=h.getFullYear();e=h.getMonth();for(var h=h.getDate(),j=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,g=j.exec(b);g;){switch(g[2]||"d"){case "d":case "D":h+=parseInt(g[1],10);break;case "w":case "W":h+=7*parseInt(g[1],10);break;case "m":case "M":e+=parseInt(g[1],10);h=Math.min(h,d.datepicker._getDaysInMonth(a,
e));break;case "y":case "Y":a+=parseInt(g[1],10),h=Math.min(h,d.datepicker._getDaysInMonth(a,e))}g=j.exec(b)}e=new Date(a,e,h)}else"number"==typeof b?isNaN(b)?b=c:(a=new Date,a.setDate(a.getDate()+b),b=a):b=new Date(b.getTime()),e=b;b=e}if(b=b&&"Invalid Date"==b.toString()?c:b)b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0);return this._daylightSavingAdjust(b)},_daylightSavingAdjust:function(a){if(!a)return null;a.setHours(12<a.getHours()?a.getHours()+2:0);return a},_setDate:function(a,
b,c){var d=!b,f=a.selectedMonth,h=a.selectedYear,b=this._restrictMinMax(a,this._determineDate(a,b,new Date));a.selectedDay=a.currentDay=b.getDate();a.drawMonth=a.selectedMonth=a.currentMonth=b.getMonth();a.drawYear=a.selectedYear=a.currentYear=b.getFullYear();(f!=a.selectedMonth||h!=a.selectedYear)&&!c&&this._notifyChange(a);this._adjustInstDate(a);a.input&&a.input.val(d?"":this._formatDate(a))},_getDate:function(a){return!a.currentYear||a.input&&""==a.input.val()?null:this._daylightSavingAdjust(new Date(a.currentYear,
a.currentMonth,a.currentDay))},_attachHandlers:function(a){var b=this._get(a,"stepMonths"),c="#"+a.id.replace(/\\\\/g,"\\");a.dpDiv.find("[data-handler]").map(function(){d(this).bind(this.getAttribute("data-event"),{prev:function(){window["DP_jQuery_"+x].datepicker._adjustDate(c,-b,"M")},next:function(){window["DP_jQuery_"+x].datepicker._adjustDate(c,+b,"M")},hide:function(){window["DP_jQuery_"+x].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+x].datepicker._gotoToday(c)},selectDay:function(){window["DP_jQuery_"+
x].datepicker._selectDay(c,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return!1},selectMonth:function(){window["DP_jQuery_"+x].datepicker._selectMonthYear(c,this,"M");return!1},selectYear:function(){window["DP_jQuery_"+x].datepicker._selectMonthYear(c,this,"Y");return!1}}[this.getAttribute("data-handler")])})},_generateHTML:function(a){var b=new Date,b=this._daylightSavingAdjust(new Date(b.getFullYear(),b.getMonth(),b.getDate())),c=this._get(a,"isRTL"),e=this._get(a,"showButtonPanel"),
f=this._get(a,"hideIfNoPrevNext"),h=this._get(a,"navigationAsDateFormat"),j=this._getNumberOfMonths(a),g=this._get(a,"showCurrentAtPos"),i=this._get(a,"stepMonths"),p=1!=j[0]||1!=j[1],r=this._daylightSavingAdjust(!a.currentDay?new Date(9999,9,9):new Date(a.currentYear,a.currentMonth,a.currentDay)),k=this._getMinMaxDate(a,"min"),m=this._getMinMaxDate(a,"max"),g=a.drawMonth-g,l=a.drawYear;0>g&&(g+=12,l--);if(m)for(var n=this._daylightSavingAdjust(new Date(m.getFullYear(),m.getMonth()-j[0]*j[1]+1,m.getDate())),
n=k&&n<k?k:n;this._daylightSavingAdjust(new Date(l,g,1))>n;)g--,0>g&&(g=11,l--);a.drawMonth=g;a.drawYear=l;var n=this._get(a,"prevText"),n=!h?n:this.formatDate(n,this._daylightSavingAdjust(new Date(l,g-i,1)),this._getFormatConfig(a)),n=this._canAdjustMonth(a,-1,l,g)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+n+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+n+"</span></a>":f?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+
n+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+n+"</span></a>",s=this._get(a,"nextText"),s=!h?s:this.formatDate(s,this._daylightSavingAdjust(new Date(l,g+i,1)),this._getFormatConfig(a)),f=this._canAdjustMonth(a,1,l,g)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>":f?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+
(c?"w":"e")+'">'+s+"</span></a>",i=this._get(a,"currentText"),s=this._get(a,"gotoCurrent")&&a.currentDay?r:b,i=!h?i:this.formatDate(i,s,this._getFormatConfig(a)),h=!a.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(a,"closeText")+"</button>":"",e=e?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(c?h:"")+(this._isInRange(a,s)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+
i+"</button>":"")+(c?"":h)+"</div>":"",h=parseInt(this._get(a,"firstDay"),10),h=isNaN(h)?0:h,i=this._get(a,"showWeek"),s=this._get(a,"dayNames");this._get(a,"dayNamesShort");var u=this._get(a,"dayNamesMin"),y=this._get(a,"monthNames"),v=this._get(a,"monthNamesShort"),x=this._get(a,"beforeShowDay"),z=this._get(a,"showOtherMonths"),D=this._get(a,"selectOtherMonths");this._get(a,"calculateWeek");for(var B=this._getDefaultDate(a),E="",F=0;F<j[0];F++){var I="";this.maxRows=4;for(var G=0;G<j[1];G++){var C=
this._daylightSavingAdjust(new Date(l,g,a.selectedDay)),t=" ui-corner-all",q="";if(p){q+='<div class="ui-datepicker-group';if(1<j[1])switch(G){case 0:q+=" ui-datepicker-group-first";t=" ui-corner-"+(c?"right":"left");break;case j[1]-1:q+=" ui-datepicker-group-last";t=" ui-corner-"+(c?"left":"right");break;default:q+=" ui-datepicker-group-middle",t=""}q+='">'}for(var q=q+('<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+t+'">'+(/all|left/.test(t)&&0==F?c?f:n:"")+(/all|right/.test(t)&&
0==F?c?n:f:"")+this._generateMonthYearHeader(a,g,l,k,m,0<F||0<G,y,v)+'</div><table class="ui-datepicker-calendar"><thead><tr>'),w=i?'<th class="ui-datepicker-week-col">'+this._get(a,"weekHeader")+"</th>":"",t=0;7>t;t++)var o=(t+h)%7,w=w+("<th"+(5<=(t+h+6)%7?' class="ui-datepicker-week-end"':"")+'><span title="'+s[o]+'">'+u[o]+"</span></th>");q+=w+"</tr></thead><tbody>";w=this._getDaysInMonth(l,g);l==a.selectedYear&&g==a.selectedMonth&&(a.selectedDay=Math.min(a.selectedDay,w));t=(this._getFirstDayOfMonth(l,
g)-h+7)%7;w=Math.ceil((t+w)/7);this.maxRows=w=p?this.maxRows>w?this.maxRows:w:w;for(var o=this._daylightSavingAdjust(new Date(l,g,1-t)),L=0;L<w;L++){for(var q=q+"<tr>",J=!i?"":'<td class="ui-datepicker-week-col">'+this._get(a,"calculateWeek")(o)+"</td>",t=0;7>t;t++){var H=x?x.apply(a.input?a.input[0]:null,[o]):[!0,""],A=o.getMonth()!=g,K=A&&!D||!H[0]||k&&o<k||m&&o>m,J=J+('<td class="'+(5<=(t+h+6)%7?" ui-datepicker-week-end":"")+(A?" ui-datepicker-other-month":"")+(o.getTime()==C.getTime()&&g==a.selectedMonth&&
a._keyEvent||B.getTime()==o.getTime()&&B.getTime()==C.getTime()?" "+this._dayOverClass:"")+(K?" "+this._unselectableClass+" ui-state-disabled":"")+(A&&!z?"":" "+H[1]+(o.getTime()==r.getTime()?" "+this._currentClass:"")+(o.getTime()==b.getTime()?" ui-datepicker-today":""))+'"'+((!A||z)&&H[2]?' title="'+H[2]+'"':"")+(K?"":' data-handler="selectDay" data-event="click" data-month="'+o.getMonth()+'" data-year="'+o.getFullYear()+'"')+">"+(A&&!z?"&#xa0;":K?'<span class="ui-state-default">'+o.getDate()+"</span>":
'<a class="ui-state-default'+(o.getTime()==b.getTime()?" ui-state-highlight":"")+(o.getTime()==r.getTime()?" ui-state-active":"")+(A?" ui-priority-secondary":"")+'" href="#">'+o.getDate()+"</a>")+"</td>");o.setDate(o.getDate()+1);o=this._daylightSavingAdjust(o)}q+=J+"</tr>"}g++;11<g&&(g=0,l++);q+="</tbody></table>"+(p?"</div>"+(0<j[0]&&G==j[1]-1?'<div class="ui-datepicker-row-break"></div>':""):"");I+=q}E+=I}E+=e+(d.browser.msie&&7>parseInt(d.browser.version,10)&&!a.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':
"");a._keyEvent=!1;return E},_generateMonthYearHeader:function(a,b,c,d,f,h,j,g){var i=this._get(a,"changeMonth"),p=this._get(a,"changeYear"),r=this._get(a,"showMonthAfterYear"),k='<div class="ui-datepicker-title">',m="";if(h||!i)m+='<span class="ui-datepicker-month">'+j[b]+"</span>";else{for(var j=d&&d.getFullYear()==c,l=f&&f.getFullYear()==c,m=m+'<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">',n=0;12>n;n++)if((!j||n>=d.getMonth())&&(!l||n<=f.getMonth()))m+='<option value="'+
n+'"'+(n==b?' selected="selected"':"")+">"+g[n]+"</option>";m+="</select>"}r||(k+=m+(h||!i||!p?"&#xa0;":""));if(!a.yearshtml)if(a.yearshtml="",h||!p)k+='<span class="ui-datepicker-year">'+c+"</span>";else{var g=this._get(a,"yearRange").split(":"),s=(new Date).getFullYear(),j=function(a){a=a.match(/c[+-].*/)?c+parseInt(a.substring(1),10):a.match(/[+-].*/)?s+parseInt(a,10):parseInt(a,10);return isNaN(a)?s:a},b=j(g[0]),g=Math.max(b,j(g[1]||"")),b=d?Math.max(b,d.getFullYear()):b,g=f?Math.min(g,f.getFullYear()):
g;for(a.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';b<=g;b++)a.yearshtml+='<option value="'+b+'"'+(b==c?' selected="selected"':"")+">"+b+"</option>";a.yearshtml+="</select>";k+=a.yearshtml;a.yearshtml=null}k+=this._get(a,"yearSuffix");r&&(k+=(h||!i||!p?"&#xa0;":"")+m);return k+"</div>"},_adjustInstDate:function(a,b,c){var d=a.drawYear+("Y"==c?b:0),f=a.drawMonth+("M"==c?b:0),b=Math.min(a.selectedDay,this._getDaysInMonth(d,f))+("D"==c?b:0),d=this._restrictMinMax(a,
this._daylightSavingAdjust(new Date(d,f,b)));a.selectedDay=d.getDate();a.drawMonth=a.selectedMonth=d.getMonth();a.drawYear=a.selectedYear=d.getFullYear();("M"==c||"Y"==c)&&this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max"),c=c&&b<c?c:b;return d&&c>d?d:c},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");b&&b.apply(a.input?a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){a=this._get(a,
"numberOfMonths");return null==a?[1,1]:"number"==typeof a?[1,a]:a},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return(new Date(a,b,1)).getDay()},_canAdjustMonth:function(a,b,c,d){var f=this._getNumberOfMonths(a),c=this._daylightSavingAdjust(new Date(c,d+(0>b?b:f[0]*f[1]),1));0>b&&c.setDate(this._getDaysInMonth(c.getFullYear(),
c.getMonth()));return this._isInRange(a,c)},_isInRange:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max");return(!c||b.getTime()>=c.getTime())&&(!d||b.getTime()<=d.getTime())},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff"),b="string"!=typeof b?b:(new Date).getFullYear()%100+parseInt(b,10);return{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,
"monthNames")}},_formatDate:function(a,b,c,d){b||(a.currentDay=a.selectedDay,a.currentMonth=a.selectedMonth,a.currentYear=a.selectedYear);b=b?"object"==typeof b?b:this._daylightSavingAdjust(new Date(d,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),b,this._getFormatConfig(a))}});d.fn.datepicker=function(a){if(!this.length)return this;d.datepicker.initialized||(d(document).mousedown(d.datepicker._checkExternalClick).find("body").append(d.datepicker.dpDiv),
d.datepicker.initialized=!0);var b=Array.prototype.slice.call(arguments,1);return"string"==typeof a&&("isDisabled"==a||"getDate"==a||"widget"==a)||"option"==a&&2==arguments.length&&"string"==typeof arguments[1]?d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this[0]].concat(b)):this.each(function(){typeof a=="string"?d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this].concat(b)):d.datepicker._attachDatepicker(this,a)})};d.datepicker=new B;d.datepicker.initialized=!1;d.datepicker.uuid=
(new Date).getTime();d.datepicker.version="1.8.24";window["DP_jQuery_"+x]=d})(jQuery);return{}}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-date-picker', location = 'node_modules/@atlassian/aui/src/js/aui/date-picker.js' */
("undefined"===typeof window?global:window).__f60531af6fc7657922d6dda15e693588=function(){function g(a){return a&&a.__esModule?a:{"default":a}}function f(a,c){var d,g,b,i,m;d={};i=w++;b=(0,e.default)(a);b.attr("data-aui-dp-uuid",i);c=e.default.extend(void 0,f.prototype.defaultOptions,c);d.getField=function(){return b};d.getOptions=function(){return c};g=function(){var a,g,h,k,s,u,p,q,j,n;d.hide=function(){j.hide()};d.show=function(){j.show()};d.setDate=function(b){"undefined"!==typeof a&&a.datepicker("setDate",
b)};d.getDate=function(){if("undefined"!==typeof a)return a.datepicker("getDate")};u=function(f){n.off();if(c.hint){var l=(0,e.default)("<div/>").addClass("aui-datepicker-hint");l.append("<span/>").text(c.hint);n.append(l)}a=(0,e.default)("<div/>");a.attr("data-aui-dp-popup-uuid",i);n.append(a);l={dateFormat:c.dateFormat,defaultDate:b.val(),maxDate:b.attr("max"),minDate:b.attr("min"),nextText:">",onSelect:function(a){b.val(a);b.change();d.hide();p=!0;b.focus();c.onSelect&&c.onSelect.call(this,a)},
onChangeMonthYear:function(){setTimeout(j.refresh,0)},prevText:"<"};e.default.extend(l,f);-1<c.firstDay&&(l.firstDay=c.firstDay);"undefined"!==typeof b.attr("step")&&t.log("WARNING: The date picker polyfill currently does not support the step attribute!");a.datepicker(l);(0,e.default)("body").on("keydown",g);b.on("focusout keydown",h);b.on("propertychange keyup input paste",s)};g=function(a){var c=(0,e.default)(a.target),f=c.closest(n).length||c.is(b),g=c.closest(".ui-datepicker-header").length;!f&&
!g||a.keyCode===x.default.ESCAPE?d.hide():c[0]!==b[0]&&a.preventDefault()};h=function(){q||((0,e.default)("body").on("focus blur click mousedown","*",g),q=!0)};k=function(){p?p=!1:d.show()};s=function(){if((0,e.default)(this).val())a.datepicker("setDate",b.val()),a.datepicker("option",{maxDate:b.attr("max"),minDate:b.attr("min")})};d.destroyPolyfill=function(){d.hide();b.attr("placeholder",null);b.off("propertychange keyup input paste",s);b.off("focus click",k);b.off("focusout keydown",h);(0,e.default)("body").off("keydown",
h);f.prototype.browserSupportsDateField&&(b[0].type="date");"undefined"!==typeof a&&a.datepicker("destroy");delete d.destroyPolyfill;delete d.show;delete d.hide};q=p=!1;c.languageCode in f.prototype.localisations||(c.languageCode="");var v=f.prototype.localisations,r="",o=240;"large"===v.size&&(o=325,r="aui-datepicker-dialog-large");o={hideCallback:function(){(0,e.default)("body").off("focus blur click mousedown","*",g);q=false;m&&m._datePickerPopup&&delete m._datePickerPopup},hideDelay:null,noBind:!0,
persistent:!0,closeOthers:!1,width:o};c.position&&(o.calculatePositions=function(a,b){var d=(0,e.default)(a[0]);return c.position.call(this,d,b)});j=(0,y.default)(b,void 0,function(b,c,d){if(typeof a==="undefined"){n=b;u(v)}if(m=(0,e.default)(c).closest(".aui-inline-dialog").get(0))m._datePickerPopup=j;d()},o);j.addClass("aui-datepicker-dialog");j.addClass(r);b.on("focus click",k);b.attr("placeholder",c.dateFormat);if(c.overrideBrowserDefault&&f.prototype.browserSupportsDateField&&(b[0].type="text",
r=b[0].getAttribute("value")))b[0].value=r};d.reset=function(){"function"===typeof d.destroyPolyfill&&d.destroyPolyfill();(!f.prototype.browserSupportsDateField||c.overrideBrowserDefault)&&g()};d.reset();return d}var h={};"use strict";Object.defineProperty(h,"__esModule",{value:!0});var e=g(__2fd777cca7fe187ff4048afabed6a6b5);__716e1ce77ba41179f2e03684627da84b;var t;var a=__4f4d08f5cd21aa65e83ce6be211355f4;if(a&&a.__esModule)t=a;else{var k={};if(null!=a)for(var i in a)Object.prototype.hasOwnProperty.call(a,
i)&&(k[i]=a[i]);k.default=a;t=k}i=g(__dd0dee18d8910035abf3563b0855343d);var y=g(__afb690a989e69e0e0958267e81e20b37),x=g(__2df6ae9f601a70792914228c0cba1eb9),a=g(__c224cbc2582565ddc04950dfebb7528b),w=0;f.prototype.browserSupportsDateField="date"===(0,e.default)('<input type="date" />')[0].type;f.prototype.defaultOptions={overrideBrowserDefault:!1,firstDay:-1,languageCode:(0,e.default)("html").attr("lang")||"en-AU",dateFormat:e.default.datepicker.W3C};f.prototype.localisations={dayNames:[a.default.getText("ajs.datepicker.localisations.day-names.sunday"),
a.default.getText("ajs.datepicker.localisations.day-names.monday"),a.default.getText("ajs.datepicker.localisations.day-names.tuesday"),a.default.getText("ajs.datepicker.localisations.day-names.wednesday"),a.default.getText("ajs.datepicker.localisations.day-names.thursday"),a.default.getText("ajs.datepicker.localisations.day-names.friday"),a.default.getText("ajs.datepicker.localisations.day-names.saturday")],dayNamesMin:[a.default.getText("ajs.datepicker.localisations.day-names-min.sunday"),a.default.getText("ajs.datepicker.localisations.day-names-min.monday"),
a.default.getText("ajs.datepicker.localisations.day-names-min.tuesday"),a.default.getText("ajs.datepicker.localisations.day-names-min.wednesday"),a.default.getText("ajs.datepicker.localisations.day-names-min.thursday"),a.default.getText("ajs.datepicker.localisations.day-names-min.friday"),a.default.getText("ajs.datepicker.localisations.day-names-min.saturday")],firstDay:a.default.getText("ajs.datepicker.localisations.first-day"),isRTL:"true"===a.default.getText("ajs.datepicker.localisations.is-RTL")?
!0:!1,monthNames:[a.default.getText("ajs.datepicker.localisations.month-names.january"),a.default.getText("ajs.datepicker.localisations.month-names.february"),a.default.getText("ajs.datepicker.localisations.month-names.march"),a.default.getText("ajs.datepicker.localisations.month-names.april"),a.default.getText("ajs.datepicker.localisations.month-names.may"),a.default.getText("ajs.datepicker.localisations.month-names.june"),a.default.getText("ajs.datepicker.localisations.month-names.july"),a.default.getText("ajs.datepicker.localisations.month-names.august"),
a.default.getText("ajs.datepicker.localisations.month-names.september"),a.default.getText("ajs.datepicker.localisations.month-names.october"),a.default.getText("ajs.datepicker.localisations.month-names.november"),a.default.getText("ajs.datepicker.localisations.month-names.december")],showMonthAfterYear:"true"===a.default.getText("ajs.datepicker.localisations.show-month-after-year")?!0:!1,yearSuffix:a.default.getText("ajs.datepicker.localisations.year-suffix")};e.default.fn.datePicker=function(a){return new f(this,
a)};(0,i.default)("DatePicker",f);h.default=f;return h=h["default"]}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-jquery-ui-datepicker', location = 'node_modules/@atlassian/aui/src/js-vendor/jquery/jquery-ui/jquery.ui.datepicker.js' */
("undefined"===typeof window?global:window).__716e1ce77ba41179f2e03684627da84b=function(){(function(d){function B(){this.debug=!1;this._curInst=null;this._keyEvent=!1;this._disabledInputs=[];this._inDialog=this._datepickerShowing=!1;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass=
"ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:"January February March April May June July August September October November December".split(" "),monthNamesShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),dayNames:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),
dayNamesMin:"Su Mo Tu We Th Fr Sa".split(" "),weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",
minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1};d.extend(this._defaults,this.regional[""]);this.dpDiv=C(d('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function C(a){return a.bind("mouseout",
function(a){a=d(a.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");a.length&&a.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(b){b=d(b.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");if(!d.datepicker._isDisabledDatepicker(D.inline?a.parent()[0]:D.input[0])&&b.length)b.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),
b.addClass("ui-state-hover"),b.hasClass("ui-datepicker-prev")&&b.addClass("ui-datepicker-prev-hover"),b.hasClass("ui-datepicker-next")&&b.addClass("ui-datepicker-next-hover")})}function z(a,b){d.extend(a,b);for(var c in b)if(null==b[c]||void 0==b[c])a[c]=b[c];return a}d.extend(d.ui,{datepicker:{version:"1.8.24"}});var x=(new Date).getTime(),D;d.extend(B.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},
setDefaults:function(a){z(this._defaults,a||{});return this},_attachDatepicker:function(a,b){var c=null,e;for(e in this._defaults){var f=a.getAttribute("date:"+e);if(f){c=c||{};try{c[e]=eval(f)}catch(h){c[e]=f}}}e=a.nodeName.toLowerCase();f="div"==e||"span"==e;a.id||(this.uuid+=1,a.id="dp"+this.uuid);var j=this._newInst(d(a),f);j.settings=d.extend({},b||{},c||{});"input"==e?this._connectDatepicker(a,j):f&&this._inlineDatepicker(a,j)},_newInst:function(a,b){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,
"\\\\$1"),input:a,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:b,dpDiv:!b?this.dpDiv:C(d('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}},_connectDatepicker:function(a,b){var c=d(a);b.append=d([]);b.trigger=d([]);c.hasClass(this.markerClassName)||(this._attachments(c,b),c.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",
function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),this._autoSize(b),d.data(a,"datepicker",b),b.settings.disabled&&this._disableDatepicker(a))},_attachments:function(a,b){var c=this._get(b,"appendText"),e=this._get(b,"isRTL");b.append&&b.append.remove();c&&(b.append=d('<span class="'+this._appendClass+'">'+c+"</span>"),a[e?"before":"after"](b.append));a.unbind("focus",this._showDatepicker);b.trigger&&b.trigger.remove();c=this._get(b,"showOn");("focus"==
c||"both"==c)&&a.focus(this._showDatepicker);if("button"==c||"both"==c){var c=this._get(b,"buttonText"),f=this._get(b,"buttonImage");b.trigger=d(this._get(b,"buttonImageOnly")?d("<img/>").addClass(this._triggerClass).attr({src:f,alt:c,title:c}):d('<button type="button"></button>').addClass(this._triggerClass).html(""==f?c:d("<img/>").attr({src:f,alt:c,title:c})));a[e?"before":"after"](b.trigger);b.trigger.click(function(){if(d.datepicker._datepickerShowing&&d.datepicker._lastInput==a[0])d.datepicker._hideDatepicker();
else{d.datepicker._datepickerShowing&&d.datepicker._lastInput!=a[0]&&d.datepicker._hideDatepicker();d.datepicker._showDatepicker(a[0])}return false})}},_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b=new Date(2009,11,20),c=this._get(a,"dateFormat");if(c.match(/[DM]/)){var d=function(a){for(var b=0,c=0,d=0;d<a.length;d++)a[d].length>b&&(b=a[d].length,c=d);return c};b.setMonth(d(this._get(a,c.match(/MM/)?"monthNames":"monthNamesShort")));b.setDate(d(this._get(a,c.match(/DD/)?"dayNames":
"dayNamesShort"))+20-b.getDay())}a.input.attr("size",this._formatDate(a,b).length)}},_inlineDatepicker:function(a,b){var c=d(a);c.hasClass(this.markerClassName)||(c.addClass(this.markerClassName).append(b.dpDiv).bind("setData.datepicker",function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),d.data(a,"datepicker",b),this._setDate(b,this._getDefaultDate(b),!0),this._updateDatepicker(b),this._updateAlternate(b),b.settings.disabled&&this._disableDatepicker(a),
b.dpDiv.css("display","block"))},_dialogDatepicker:function(a,b,c,e,f){a=this._dialogInst;a||(this.uuid+=1,this._dialogInput=d('<input type="text" id="dp'+this.uuid+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),d("body").append(this._dialogInput),a=this._dialogInst=this._newInst(this._dialogInput,!1),a.settings={},d.data(this._dialogInput[0],"datepicker",a));z(a.settings,e||{});b=b&&b.constructor==Date?this._formatDate(a,b):b;this._dialogInput.val(b);
this._pos=f?f.length?f:[f.pageX,f.pageY]:null;this._pos||(this._pos=[document.documentElement.clientWidth/2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)]);this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");a.settings.onSelect=c;this._inDialog=!0;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);d.blockUI&&d.blockUI(this.dpDiv);
d.data(this._dialogInput[0],"datepicker",a);return this},_destroyDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();d.removeData(a,"datepicker");"input"==e?(c.append.remove(),c.trigger.remove(),b.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==e||"span"==e)&&b.removeClass(this.markerClassName).empty()}},
_enableDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();if("input"==e)a.disabled=!1,c.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if("div"==e||"span"==e)b=b.children("."+this._inlineClass),b.children().removeClass("ui-state-disabled"),b.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled");this._disabledInputs=d.map(this._disabledInputs,
function(b){return b==a?null:b})}},_disableDatepicker:function(a){var b=d(a),c=d.data(a,"datepicker");if(b.hasClass(this.markerClassName)){var e=a.nodeName.toLowerCase();if("input"==e)a.disabled=!0,c.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if("div"==e||"span"==e)b=b.children("."+this._inlineClass),b.children().addClass("ui-state-disabled"),b.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled",
"disabled");this._disabledInputs=d.map(this._disabledInputs,function(b){return b==a?null:b});this._disabledInputs[this._disabledInputs.length]=a}},_isDisabledDatepicker:function(a){if(!a)return!1;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]==a)return!0;return!1},_getInst:function(a){try{return d.data(a,"datepicker")}catch(b){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(a,b,c){var e=this._getInst(a);if(2==arguments.length&&"string"==typeof b)return"defaults"==
b?d.extend({},d.datepicker._defaults):e?"all"==b?d.extend({},e.settings):this._get(e,b):null;var f=b||{};"string"==typeof b&&(f={},f[b]=c);if(e){this._curInst==e&&this._hideDatepicker();var h=this._getDateDatepicker(a,!0),j=this._getMinMaxDate(e,"min"),g=this._getMinMaxDate(e,"max");z(e.settings,f);null!==j&&(void 0!==f.dateFormat&&void 0===f.minDate)&&(e.settings.minDate=this._formatDate(e,j));null!==g&&(void 0!==f.dateFormat&&void 0===f.maxDate)&&(e.settings.maxDate=this._formatDate(e,g));this._attachments(d(a),
e);this._autoSize(e);this._setDate(e,h);this._updateAlternate(e);this._updateDatepicker(e)}},_changeDatepicker:function(a,b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){(a=this._getInst(a))&&this._updateDatepicker(a)},_setDateDatepicker:function(a,b){var c=this._getInst(a);c&&(this._setDate(c,b),this._updateDatepicker(c),this._updateAlternate(c))},_getDateDatepicker:function(a,b){var c=this._getInst(a);c&&!c.inline&&this._setDateFromField(c,b);return c?this._getDate(c):null},_doKeyDown:function(a){var b=
d.datepicker._getInst(a.target),c=!0,e=b.dpDiv.is(".ui-datepicker-rtl");b._keyEvent=!0;if(d.datepicker._datepickerShowing)switch(a.keyCode){case 9:d.datepicker._hideDatepicker();c=!1;break;case 13:return c=d("td."+d.datepicker._dayOverClass+":not(."+d.datepicker._currentClass+")",b.dpDiv),c[0]&&d.datepicker._selectDay(a.target,b.selectedMonth,b.selectedYear,c[0]),(a=d.datepicker._get(b,"onSelect"))?(c=d.datepicker._formatDate(b),a.apply(b.input?b.input[0]:null,[c,b])):d.datepicker._hideDatepicker(),
!1;case 27:d.datepicker._hideDatepicker();break;case 33:d.datepicker._adjustDate(a.target,a.ctrlKey?-d.datepicker._get(b,"stepBigMonths"):-d.datepicker._get(b,"stepMonths"),"M");break;case 34:d.datepicker._adjustDate(a.target,a.ctrlKey?+d.datepicker._get(b,"stepBigMonths"):+d.datepicker._get(b,"stepMonths"),"M");break;case 35:(a.ctrlKey||a.metaKey)&&d.datepicker._clearDate(a.target);c=a.ctrlKey||a.metaKey;break;case 36:(a.ctrlKey||a.metaKey)&&d.datepicker._gotoToday(a.target);c=a.ctrlKey||a.metaKey;
break;case 37:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,e?1:-1,"D");c=a.ctrlKey||a.metaKey;a.originalEvent.altKey&&d.datepicker._adjustDate(a.target,a.ctrlKey?-d.datepicker._get(b,"stepBigMonths"):-d.datepicker._get(b,"stepMonths"),"M");break;case 38:(a.ctrlKey||a.metaKey)&&d.datepicker._adjustDate(a.target,-7,"D");c=a.ctrlKey||a.metaKey;break;case 39:if(a.ctrlKey||a.metaKey)d.datepicker._adjustDate(a.target,e?-1:1,"D");c=a.ctrlKey||a.metaKey;a.originalEvent.altKey&&d.datepicker._adjustDate(a.target,
a.ctrlKey?+d.datepicker._get(b,"stepBigMonths"):+d.datepicker._get(b,"stepMonths"),"M");break;case 40:(a.ctrlKey||a.metaKey)&&d.datepicker._adjustDate(a.target,7,"D");c=a.ctrlKey||a.metaKey;break;default:c=!1}else 36==a.keyCode&&a.ctrlKey?d.datepicker._showDatepicker(this):c=!1;c&&(a.preventDefault(),a.stopPropagation())},_doKeyPress:function(a){var b=d.datepicker._getInst(a.target);if(d.datepicker._get(b,"constrainInput")){var b=d.datepicker._possibleChars(d.datepicker._get(b,"dateFormat")),c=String.fromCharCode(void 0==
a.charCode?a.keyCode:a.charCode);return a.ctrlKey||a.metaKey||" ">c||!b||-1<b.indexOf(c)}},_doKeyUp:function(a){a=d.datepicker._getInst(a.target);if(a.input.val()!=a.lastVal)try{if(d.datepicker.parseDate(d.datepicker._get(a,"dateFormat"),a.input?a.input.val():null,d.datepicker._getFormatConfig(a)))d.datepicker._setDateFromField(a),d.datepicker._updateAlternate(a),d.datepicker._updateDatepicker(a)}catch(b){d.datepicker.log(b)}return!0},_showDatepicker:function(a){a=a.target||a;"input"!=a.nodeName.toLowerCase()&&
(a=d("input",a.parentNode)[0]);if(!(d.datepicker._isDisabledDatepicker(a)||d.datepicker._lastInput==a)){var b=d.datepicker._getInst(a);d.datepicker._curInst&&d.datepicker._curInst!=b&&(d.datepicker._curInst.dpDiv.stop(!0,!0),b&&d.datepicker._datepickerShowing&&d.datepicker._hideDatepicker(d.datepicker._curInst.input[0]));var c=d.datepicker._get(b,"beforeShow"),c=c?c.apply(a,[a,b]):{};if(!1!==c){z(b.settings,c);b.lastVal=null;d.datepicker._lastInput=a;d.datepicker._setDateFromField(b);d.datepicker._inDialog&&
(a.value="");d.datepicker._pos||(d.datepicker._pos=d.datepicker._findPos(a),d.datepicker._pos[1]+=a.offsetHeight);var e=!1;d(a).parents().each(function(){e=e|d(this).css("position")=="fixed";return!e});e&&d.browser.opera&&(d.datepicker._pos[0]-=document.documentElement.scrollLeft,d.datepicker._pos[1]-=document.documentElement.scrollTop);c={left:d.datepicker._pos[0],top:d.datepicker._pos[1]};d.datepicker._pos=null;b.dpDiv.empty();b.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});d.datepicker._updateDatepicker(b);
c=d.datepicker._checkOffset(b,c,e);b.dpDiv.css({position:d.datepicker._inDialog&&d.blockUI?"static":e?"fixed":"absolute",display:"none",left:c.left+"px",top:c.top+"px"});if(!b.inline){var c=d.datepicker._get(b,"showAnim"),f=d.datepicker._get(b,"duration"),h=function(){var a=b.dpDiv.find("iframe.ui-datepicker-cover");if(a.length){var c=d.datepicker._getBorders(b.dpDiv);a.css({left:-c[0],top:-c[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()})}};b.dpDiv.zIndex(d(a).zIndex()+1);d.datepicker._datepickerShowing=
!0;if(d.effects&&d.effects[c])b.dpDiv.show(c,d.datepicker._get(b,"showOptions"),f,h);else b.dpDiv[c||"show"](c?f:null,h);(!c||!f)&&h();b.input.is(":visible")&&!b.input.is(":disabled")&&b.input.focus();d.datepicker._curInst=b}}}},_updateDatepicker:function(a){this.maxRows=4;var b=d.datepicker._getBorders(a.dpDiv);D=a;a.dpDiv.empty().append(this._generateHTML(a));this._attachHandlers(a);var c=a.dpDiv.find("iframe.ui-datepicker-cover");c.length&&c.css({left:-b[0],top:-b[1],width:a.dpDiv.outerWidth(),
height:a.dpDiv.outerHeight()});a.dpDiv.find("."+this._dayOverClass+" a").mouseover();b=this._getNumberOfMonths(a);c=b[1];a.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");1<c&&a.dpDiv.addClass("ui-datepicker-multi-"+c).css("width",17*c+"em");a.dpDiv[(1!=b[0]||1!=b[1]?"add":"remove")+"Class"]("ui-datepicker-multi");a.dpDiv[(this._get(a,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");a==d.datepicker._curInst&&(d.datepicker._datepickerShowing&&
a.input&&a.input.is(":visible")&&!a.input.is(":disabled")&&a.input[0]!=document.activeElement)&&a.input.focus();if(a.yearshtml){var e=a.yearshtml;setTimeout(function(){e===a.yearshtml&&a.yearshtml&&a.dpDiv.find("select.ui-datepicker-year:first").replaceWith(a.yearshtml);e=a.yearshtml=null},0)}},_getBorders:function(a){var b=function(a){return{thin:1,medium:2,thick:3}[a]||a};return[parseFloat(b(a.css("border-left-width"))),parseFloat(b(a.css("border-top-width")))]},_checkOffset:function(a,b,c){var e=
a.dpDiv.outerWidth(),f=a.dpDiv.outerHeight(),h=a.input?a.input.outerWidth():0,j=a.input?a.input.outerHeight():0,g=document.documentElement.clientWidth+(c?0:d(document).scrollLeft()),i=document.documentElement.clientHeight+(c?0:d(document).scrollTop());b.left-=this._get(a,"isRTL")?e-h:0;b.left-=c&&b.left==a.input.offset().left?d(document).scrollLeft():0;b.top-=c&&b.top==a.input.offset().top+j?d(document).scrollTop():0;b.left-=Math.min(b.left,b.left+e>g&&g>e?Math.abs(b.left+e-g):0);b.top-=Math.min(b.top,
b.top+f>i&&i>f?Math.abs(f+j):0);return b},_findPos:function(a){for(var b=this._getInst(a),b=this._get(b,"isRTL");a&&("hidden"==a.type||1!=a.nodeType||d.expr.filters.hidden(a));)a=a[b?"previousSibling":"nextSibling"];a=d(a).offset();return[a.left,a.top]},_hideDatepicker:function(a){var b=this._curInst;if(b&&!(a&&b!=d.data(a,"datepicker"))&&this._datepickerShowing){var a=this._get(b,"showAnim"),c=this._get(b,"duration"),e=function(){d.datepicker._tidyDialog(b)};if(d.effects&&d.effects[a])b.dpDiv.hide(a,
d.datepicker._get(b,"showOptions"),c,e);else b.dpDiv["slideDown"==a?"slideUp":"fadeIn"==a?"fadeOut":"hide"](a?c:null,e);a||e();this._datepickerShowing=!1;(a=this._get(b,"onClose"))&&a.apply(b.input?b.input[0]:null,[b.input?b.input.val():"",b]);this._lastInput=null;this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),d.blockUI&&(d.unblockUI(),d("body").append(this.dpDiv)));this._inDialog=!1}},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},
_checkExternalClick:function(a){if(d.datepicker._curInst){var a=d(a.target),b=d.datepicker._getInst(a[0]);(a[0].id!=d.datepicker._mainDivId&&0==a.parents("#"+d.datepicker._mainDivId).length&&!a.hasClass(d.datepicker.markerClassName)&&!a.closest("."+d.datepicker._triggerClass).length&&d.datepicker._datepickerShowing&&(!d.datepicker._inDialog||!d.blockUI)||a.hasClass(d.datepicker.markerClassName)&&d.datepicker._curInst!=b)&&d.datepicker._hideDatepicker()}},_adjustDate:function(a,b,c){var a=d(a),e=this._getInst(a[0]);
this._isDisabledDatepicker(a[0])||(this._adjustInstDate(e,b+("M"==c?this._get(e,"showCurrentAtPos"):0),c),this._updateDatepicker(e))},_gotoToday:function(a){var a=d(a),b=this._getInst(a[0]);if(this._get(b,"gotoCurrent")&&b.currentDay)b.selectedDay=b.currentDay,b.drawMonth=b.selectedMonth=b.currentMonth,b.drawYear=b.selectedYear=b.currentYear;else{var c=new Date;b.selectedDay=c.getDate();b.drawMonth=b.selectedMonth=c.getMonth();b.drawYear=b.selectedYear=c.getFullYear()}this._notifyChange(b);this._adjustDate(a)},
_selectMonthYear:function(a,b,c){var a=d(a),e=this._getInst(a[0]);e["selected"+("M"==c?"Month":"Year")]=e["draw"+("M"==c?"Month":"Year")]=parseInt(b.options[b.selectedIndex].value,10);this._notifyChange(e);this._adjustDate(a)},_selectDay:function(a,b,c,e){var f=d(a);!d(e).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(f[0])&&(f=this._getInst(f[0]),f.selectedDay=f.currentDay=d("a",e).html(),f.selectedMonth=f.currentMonth=b,f.selectedYear=f.currentYear=c,this._selectDate(a,this._formatDate(f,
f.currentDay,f.currentMonth,f.currentYear)))},_clearDate:function(a){a=d(a);this._getInst(a[0]);this._selectDate(a,"")},_selectDate:function(a,b){var c=d(a),c=this._getInst(c[0]),b=null!=b?b:this._formatDate(c);c.input&&c.input.val(b);this._updateAlternate(c);var e=this._get(c,"onSelect");e?e.apply(c.input?c.input[0]:null,[b,c]):c.input&&c.input.trigger("change");c.inline?this._updateDatepicker(c):(this._hideDatepicker(),this._lastInput=c.input[0],"object"!=typeof c.input[0]&&c.input.focus(),this._lastInput=
null)},_updateAlternate:function(a){var b=this._get(a,"altField");if(b){var c=this._get(a,"altFormat")||this._get(a,"dateFormat"),e=this._getDate(a),f=this.formatDate(c,e,this._getFormatConfig(a));d(b).each(function(){d(this).val(f)})}},noWeekends:function(a){a=a.getDay();return[0<a&&6>a,""]},iso8601Week:function(a){a=new Date(a.getTime());a.setDate(a.getDate()+4-(a.getDay()||7));var b=a.getTime();a.setMonth(0);a.setDate(1);return Math.floor(Math.round((b-a)/864E5)/7)+1},parseDate:function(a,b,c){if(null==
a||null==b)throw"Invalid arguments";b="object"==typeof b?b.toString():b+"";if(""==b)return null;for(var e=(c?c.shortYearCutoff:null)||this._defaults.shortYearCutoff,e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),f=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,h=(c?c.dayNames:null)||this._defaults.dayNames,j=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,g=(c?c.monthNames:null)||this._defaults.monthNames,i=c=-1,p=-1,r=-1,k=!1,m=function(b){(b=y+1<a.length&&
a.charAt(y+1)==b)&&y++;return b},l=function(a){var c=m(a),a=RegExp("^\\d{1,"+("@"==a?14:"!"==a?20:"y"==a&&c?4:"o"==a?3:2)+"}"),a=b.substring(u).match(a);if(!a)throw"Missing number at position "+u;u+=a[0].length;return parseInt(a[0],10)},n=function(a,c,e){var a=d.map(m(a)?e:c,function(a,b){return[[b,a]]}).sort(function(a,b){return-(a[1].length-b[1].length)}),f=-1;d.each(a,function(a,c){var d=c[1];if(b.substr(u,d.length).toLowerCase()==d.toLowerCase())return f=c[0],u+=d.length,!1});if(-1!=f)return f+
1;throw"Unknown name at position "+u;},s=function(){if(b.charAt(u)!=a.charAt(y))throw"Unexpected literal at position "+u;u++},u=0,y=0;y<a.length;y++)if(k)"'"==a.charAt(y)&&!m("'")?k=!1:s();else switch(a.charAt(y)){case "d":p=l("d");break;case "D":n("D",f,h);break;case "o":r=l("o");break;case "m":i=l("m");break;case "M":i=n("M",j,g);break;case "y":c=l("y");break;case "@":var v=new Date(l("@")),c=v.getFullYear(),i=v.getMonth()+1,p=v.getDate();break;case "!":v=new Date((l("!")-this._ticksTo1970)/1E4);
c=v.getFullYear();i=v.getMonth()+1;p=v.getDate();break;case "'":m("'")?s():k=!0;break;default:s()}if(u<b.length)throw"Extra/unparsed characters found in date: "+b.substring(u);-1==c?c=(new Date).getFullYear():100>c&&(c+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c<=e?0:-100));if(-1<r){i=1;p=r;do{e=this._getDaysInMonth(c,i-1);if(p<=e)break;i++;p-=e}while(1)}v=this._daylightSavingAdjust(new Date(c,i-1,p));if(v.getFullYear()!=c||v.getMonth()+1!=i||v.getDate()!=p)throw"Invalid date";return v},
ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864E9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(a,b,c){if(!b)return"";var d=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,h=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,
c=(c?c.monthNames:null)||this._defaults.monthNames,j=function(b){(b=r+1<a.length&&a.charAt(r+1)==b)&&r++;return b},g=function(a,b,c){b=""+b;if(j(a))for(;b.length<c;)b="0"+b;return b},i="",p=!1;if(b)for(var r=0;r<a.length;r++)if(p)"'"==a.charAt(r)&&!j("'")?p=!1:i+=a.charAt(r);else switch(a.charAt(r)){case "d":i+=g("d",b.getDate(),2);break;case "D":var k;k=b.getDay();var m=d,l=f;k=j("D")?l[k]:m[k];i+=k;break;case "o":i+=g("o",Math.round(((new Date(b.getFullYear(),b.getMonth(),b.getDate())).getTime()-
(new Date(b.getFullYear(),0,0)).getTime())/864E5),3);break;case "m":i+=g("m",b.getMonth()+1,2);break;case "M":k=b.getMonth();m=h;l=c;k=j("M")?l[k]:m[k];i+=k;break;case "y":i+=j("y")?b.getFullYear():(10>b.getYear()%100?"0":"")+b.getYear()%100;break;case "@":i+=b.getTime();break;case "!":i+=1E4*b.getTime()+this._ticksTo1970;break;case "'":j("'")?i+="'":p=!0;break;default:i+=a.charAt(r)}return i},_possibleChars:function(a){for(var b="",c=!1,d=function(b){(b=f+1<a.length&&a.charAt(f+1)==b)&&f++;return b},
f=0;f<a.length;f++)if(c)"'"==a.charAt(f)&&!d("'")?c=!1:b+=a.charAt(f);else switch(a.charAt(f)){case "d":case "m":case "y":case "@":b+="0123456789";break;case "D":case "M":return null;case "'":d("'")?b+="'":c=!0;break;default:b+=a.charAt(f)}return b},_get:function(a,b){return void 0!==a.settings[b]?a.settings[b]:this._defaults[b]},_setDateFromField:function(a,b){if(a.input.val()!=a.lastVal){var c=this._get(a,"dateFormat"),d=a.lastVal=a.input?a.input.val():null,f,h;f=h=this._getDefaultDate(a);var j=
this._getFormatConfig(a);try{f=this.parseDate(c,d,j)||h}catch(g){this.log(g),d=b?"":d}a.selectedDay=f.getDate();a.drawMonth=a.selectedMonth=f.getMonth();a.drawYear=a.selectedYear=f.getFullYear();a.currentDay=d?f.getDate():0;a.currentMonth=d?f.getMonth():0;a.currentYear=d?f.getFullYear():0;this._adjustInstDate(a)}},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(a,b,c){if(null==b||""===b)b=c;else{var e;if("string"==
typeof b)a:{try{e=d.datepicker.parseDate(d.datepicker._get(a,"dateFormat"),b,d.datepicker._getFormatConfig(a));break a}catch(f){}var h=(b.toLowerCase().match(/^c/)?d.datepicker._getDate(a):null)||new Date,a=h.getFullYear();e=h.getMonth();for(var h=h.getDate(),j=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,g=j.exec(b);g;){switch(g[2]||"d"){case "d":case "D":h+=parseInt(g[1],10);break;case "w":case "W":h+=7*parseInt(g[1],10);break;case "m":case "M":e+=parseInt(g[1],10);h=Math.min(h,d.datepicker._getDaysInMonth(a,
e));break;case "y":case "Y":a+=parseInt(g[1],10),h=Math.min(h,d.datepicker._getDaysInMonth(a,e))}g=j.exec(b)}e=new Date(a,e,h)}else"number"==typeof b?isNaN(b)?b=c:(a=new Date,a.setDate(a.getDate()+b),b=a):b=new Date(b.getTime()),e=b;b=e}if(b=b&&"Invalid Date"==b.toString()?c:b)b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0);return this._daylightSavingAdjust(b)},_daylightSavingAdjust:function(a){if(!a)return null;a.setHours(12<a.getHours()?a.getHours()+2:0);return a},_setDate:function(a,
b,c){var d=!b,f=a.selectedMonth,h=a.selectedYear,b=this._restrictMinMax(a,this._determineDate(a,b,new Date));a.selectedDay=a.currentDay=b.getDate();a.drawMonth=a.selectedMonth=a.currentMonth=b.getMonth();a.drawYear=a.selectedYear=a.currentYear=b.getFullYear();(f!=a.selectedMonth||h!=a.selectedYear)&&!c&&this._notifyChange(a);this._adjustInstDate(a);a.input&&a.input.val(d?"":this._formatDate(a))},_getDate:function(a){return!a.currentYear||a.input&&""==a.input.val()?null:this._daylightSavingAdjust(new Date(a.currentYear,
a.currentMonth,a.currentDay))},_attachHandlers:function(a){var b=this._get(a,"stepMonths"),c="#"+a.id.replace(/\\\\/g,"\\");a.dpDiv.find("[data-handler]").map(function(){d(this).bind(this.getAttribute("data-event"),{prev:function(){window["DP_jQuery_"+x].datepicker._adjustDate(c,-b,"M")},next:function(){window["DP_jQuery_"+x].datepicker._adjustDate(c,+b,"M")},hide:function(){window["DP_jQuery_"+x].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+x].datepicker._gotoToday(c)},selectDay:function(){window["DP_jQuery_"+
x].datepicker._selectDay(c,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return!1},selectMonth:function(){window["DP_jQuery_"+x].datepicker._selectMonthYear(c,this,"M");return!1},selectYear:function(){window["DP_jQuery_"+x].datepicker._selectMonthYear(c,this,"Y");return!1}}[this.getAttribute("data-handler")])})},_generateHTML:function(a){var b=new Date,b=this._daylightSavingAdjust(new Date(b.getFullYear(),b.getMonth(),b.getDate())),c=this._get(a,"isRTL"),e=this._get(a,"showButtonPanel"),
f=this._get(a,"hideIfNoPrevNext"),h=this._get(a,"navigationAsDateFormat"),j=this._getNumberOfMonths(a),g=this._get(a,"showCurrentAtPos"),i=this._get(a,"stepMonths"),p=1!=j[0]||1!=j[1],r=this._daylightSavingAdjust(!a.currentDay?new Date(9999,9,9):new Date(a.currentYear,a.currentMonth,a.currentDay)),k=this._getMinMaxDate(a,"min"),m=this._getMinMaxDate(a,"max"),g=a.drawMonth-g,l=a.drawYear;0>g&&(g+=12,l--);if(m)for(var n=this._daylightSavingAdjust(new Date(m.getFullYear(),m.getMonth()-j[0]*j[1]+1,m.getDate())),
n=k&&n<k?k:n;this._daylightSavingAdjust(new Date(l,g,1))>n;)g--,0>g&&(g=11,l--);a.drawMonth=g;a.drawYear=l;var n=this._get(a,"prevText"),n=!h?n:this.formatDate(n,this._daylightSavingAdjust(new Date(l,g-i,1)),this._getFormatConfig(a)),n=this._canAdjustMonth(a,-1,l,g)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+n+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+n+"</span></a>":f?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+
n+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+n+"</span></a>",s=this._get(a,"nextText"),s=!h?s:this.formatDate(s,this._daylightSavingAdjust(new Date(l,g+i,1)),this._getFormatConfig(a)),f=this._canAdjustMonth(a,1,l,g)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>":f?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+
(c?"w":"e")+'">'+s+"</span></a>",i=this._get(a,"currentText"),s=this._get(a,"gotoCurrent")&&a.currentDay?r:b,i=!h?i:this.formatDate(i,s,this._getFormatConfig(a)),h=!a.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(a,"closeText")+"</button>":"",e=e?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(c?h:"")+(this._isInRange(a,s)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+
i+"</button>":"")+(c?"":h)+"</div>":"",h=parseInt(this._get(a,"firstDay"),10),h=isNaN(h)?0:h,i=this._get(a,"showWeek"),s=this._get(a,"dayNames");this._get(a,"dayNamesShort");var u=this._get(a,"dayNamesMin"),y=this._get(a,"monthNames"),v=this._get(a,"monthNamesShort"),x=this._get(a,"beforeShowDay"),z=this._get(a,"showOtherMonths"),D=this._get(a,"selectOtherMonths");this._get(a,"calculateWeek");for(var B=this._getDefaultDate(a),E="",F=0;F<j[0];F++){var I="";this.maxRows=4;for(var G=0;G<j[1];G++){var C=
this._daylightSavingAdjust(new Date(l,g,a.selectedDay)),t=" ui-corner-all",q="";if(p){q+='<div class="ui-datepicker-group';if(1<j[1])switch(G){case 0:q+=" ui-datepicker-group-first";t=" ui-corner-"+(c?"right":"left");break;case j[1]-1:q+=" ui-datepicker-group-last";t=" ui-corner-"+(c?"left":"right");break;default:q+=" ui-datepicker-group-middle",t=""}q+='">'}for(var q=q+('<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+t+'">'+(/all|left/.test(t)&&0==F?c?f:n:"")+(/all|right/.test(t)&&
0==F?c?n:f:"")+this._generateMonthYearHeader(a,g,l,k,m,0<F||0<G,y,v)+'</div><table class="ui-datepicker-calendar"><thead><tr>'),w=i?'<th class="ui-datepicker-week-col">'+this._get(a,"weekHeader")+"</th>":"",t=0;7>t;t++)var o=(t+h)%7,w=w+("<th"+(5<=(t+h+6)%7?' class="ui-datepicker-week-end"':"")+'><span title="'+s[o]+'">'+u[o]+"</span></th>");q+=w+"</tr></thead><tbody>";w=this._getDaysInMonth(l,g);l==a.selectedYear&&g==a.selectedMonth&&(a.selectedDay=Math.min(a.selectedDay,w));t=(this._getFirstDayOfMonth(l,
g)-h+7)%7;w=Math.ceil((t+w)/7);this.maxRows=w=p?this.maxRows>w?this.maxRows:w:w;for(var o=this._daylightSavingAdjust(new Date(l,g,1-t)),L=0;L<w;L++){for(var q=q+"<tr>",J=!i?"":'<td class="ui-datepicker-week-col">'+this._get(a,"calculateWeek")(o)+"</td>",t=0;7>t;t++){var H=x?x.apply(a.input?a.input[0]:null,[o]):[!0,""],A=o.getMonth()!=g,K=A&&!D||!H[0]||k&&o<k||m&&o>m,J=J+('<td class="'+(5<=(t+h+6)%7?" ui-datepicker-week-end":"")+(A?" ui-datepicker-other-month":"")+(o.getTime()==C.getTime()&&g==a.selectedMonth&&
a._keyEvent||B.getTime()==o.getTime()&&B.getTime()==C.getTime()?" "+this._dayOverClass:"")+(K?" "+this._unselectableClass+" ui-state-disabled":"")+(A&&!z?"":" "+H[1]+(o.getTime()==r.getTime()?" "+this._currentClass:"")+(o.getTime()==b.getTime()?" ui-datepicker-today":""))+'"'+((!A||z)&&H[2]?' title="'+H[2]+'"':"")+(K?"":' data-handler="selectDay" data-event="click" data-month="'+o.getMonth()+'" data-year="'+o.getFullYear()+'"')+">"+(A&&!z?"&#xa0;":K?'<span class="ui-state-default">'+o.getDate()+"</span>":
'<a class="ui-state-default'+(o.getTime()==b.getTime()?" ui-state-highlight":"")+(o.getTime()==r.getTime()?" ui-state-active":"")+(A?" ui-priority-secondary":"")+'" href="#">'+o.getDate()+"</a>")+"</td>");o.setDate(o.getDate()+1);o=this._daylightSavingAdjust(o)}q+=J+"</tr>"}g++;11<g&&(g=0,l++);q+="</tbody></table>"+(p?"</div>"+(0<j[0]&&G==j[1]-1?'<div class="ui-datepicker-row-break"></div>':""):"");I+=q}E+=I}E+=e+(d.browser.msie&&7>parseInt(d.browser.version,10)&&!a.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':
"");a._keyEvent=!1;return E},_generateMonthYearHeader:function(a,b,c,d,f,h,j,g){var i=this._get(a,"changeMonth"),p=this._get(a,"changeYear"),r=this._get(a,"showMonthAfterYear"),k='<div class="ui-datepicker-title">',m="";if(h||!i)m+='<span class="ui-datepicker-month">'+j[b]+"</span>";else{for(var j=d&&d.getFullYear()==c,l=f&&f.getFullYear()==c,m=m+'<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">',n=0;12>n;n++)if((!j||n>=d.getMonth())&&(!l||n<=f.getMonth()))m+='<option value="'+
n+'"'+(n==b?' selected="selected"':"")+">"+g[n]+"</option>";m+="</select>"}r||(k+=m+(h||!i||!p?"&#xa0;":""));if(!a.yearshtml)if(a.yearshtml="",h||!p)k+='<span class="ui-datepicker-year">'+c+"</span>";else{var g=this._get(a,"yearRange").split(":"),s=(new Date).getFullYear(),j=function(a){a=a.match(/c[+-].*/)?c+parseInt(a.substring(1),10):a.match(/[+-].*/)?s+parseInt(a,10):parseInt(a,10);return isNaN(a)?s:a},b=j(g[0]),g=Math.max(b,j(g[1]||"")),b=d?Math.max(b,d.getFullYear()):b,g=f?Math.min(g,f.getFullYear()):
g;for(a.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';b<=g;b++)a.yearshtml+='<option value="'+b+'"'+(b==c?' selected="selected"':"")+">"+b+"</option>";a.yearshtml+="</select>";k+=a.yearshtml;a.yearshtml=null}k+=this._get(a,"yearSuffix");r&&(k+=(h||!i||!p?"&#xa0;":"")+m);return k+"</div>"},_adjustInstDate:function(a,b,c){var d=a.drawYear+("Y"==c?b:0),f=a.drawMonth+("M"==c?b:0),b=Math.min(a.selectedDay,this._getDaysInMonth(d,f))+("D"==c?b:0),d=this._restrictMinMax(a,
this._daylightSavingAdjust(new Date(d,f,b)));a.selectedDay=d.getDate();a.drawMonth=a.selectedMonth=d.getMonth();a.drawYear=a.selectedYear=d.getFullYear();("M"==c||"Y"==c)&&this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max"),c=c&&b<c?c:b;return d&&c>d?d:c},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");b&&b.apply(a.input?a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){a=this._get(a,
"numberOfMonths");return null==a?[1,1]:"number"==typeof a?[1,a]:a},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return(new Date(a,b,1)).getDay()},_canAdjustMonth:function(a,b,c,d){var f=this._getNumberOfMonths(a),c=this._daylightSavingAdjust(new Date(c,d+(0>b?b:f[0]*f[1]),1));0>b&&c.setDate(this._getDaysInMonth(c.getFullYear(),
c.getMonth()));return this._isInRange(a,c)},_isInRange:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max");return(!c||b.getTime()>=c.getTime())&&(!d||b.getTime()<=d.getTime())},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff"),b="string"!=typeof b?b:(new Date).getFullYear()%100+parseInt(b,10);return{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,
"monthNames")}},_formatDate:function(a,b,c,d){b||(a.currentDay=a.selectedDay,a.currentMonth=a.selectedMonth,a.currentYear=a.selectedYear);b=b?"object"==typeof b?b:this._daylightSavingAdjust(new Date(d,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),b,this._getFormatConfig(a))}});d.fn.datepicker=function(a){if(!this.length)return this;d.datepicker.initialized||(d(document).mousedown(d.datepicker._checkExternalClick).find("body").append(d.datepicker.dpDiv),
d.datepicker.initialized=!0);var b=Array.prototype.slice.call(arguments,1);return"string"==typeof a&&("isDisabled"==a||"getDate"==a||"widget"==a)||"option"==a&&2==arguments.length&&"string"==typeof arguments[1]?d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this[0]].concat(b)):this.each(function(){typeof a=="string"?d.datepicker["_"+a+"Datepicker"].apply(d.datepicker,[this].concat(b)):d.datepicker._attachDatepicker(this,a)})};d.datepicker=new B;d.datepicker.initialized=!1;d.datepicker.uuid=
(new Date).getTime();d.datepicker.version="1.8.24";window["DP_jQuery_"+x]=d})(jQuery);return{}}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-vendor-jquery-plugins-jquery-select2', location = 'node_modules/@atlassian/aui/src/js-vendor/jquery/plugins/jquery.select2.js' */
("undefined"===typeof window?global:window).__1f8266a045326897dc01ded64d3814fa=function(){var y=jQuery;"undefined"==typeof y.fn.each2&&y.extend(y.fn,{each2:function(a){for(var b=y([0]),c=-1,d=this.length;++c<d&&(b.context=b[0]=this[c])&&!1!==a.call(b[0],c,b););return this}});var e=jQuery,w=function(a){var b,c,d,g;if(!a||1>a.length)return a;b="";c=0;for(d=a.length;c<d;c++)g=a.charAt(c),b+=O[g]||g;return b},k=function(a,b){for(var c=0,d=b.length;c<d;c+=1)if(m(a,b[c]))return c;return-1},m=function(a,
b){return a===b?!0:void 0===a||void 0===b||null===a||null===b?!1:a.constructor===String?a+""===b+"":b.constructor===String?b+""===a+"":!1},B=function(a,b){var c,d,g;if(null===a||1>a.length)return[];c=a.split(b);d=0;for(g=c.length;d<g;d+=1)c[d]=e.trim(c[d]);return c},G=function(a){a.on("keydown",function(){void 0===e.data(a,"keyup-change-value")&&e.data(a,"keyup-change-value",a.val())});a.on("keyup",function(){var b=e.data(a,"keyup-change-value");void 0!==b&&a.val()!==b&&(e.removeData(a,"keyup-change-value"),
a.trigger("keyup-change"))})},H=function(a,b,c){var c=c||void 0,d;return function(){var g=arguments;window.clearTimeout(d);d=window.setTimeout(function(){b.apply(c,g)},a)}},j=function(a){a.preventDefault();a.stopPropagation()},z=function(a,b,c){var d,g=[],h;(d=a.attr("class"))&&e((""+d).split(" ")).each2(function(){0===this.indexOf("select2-")&&g.push(this)});(d=b.attr("class"))&&e((""+d).split(" ")).each2(function(){0!==this.indexOf("select2-")&&(h=c(this))&&g.push(h)});a.attr("class",g.join(" "))},
I=function(a,b,c,d){var g=w(a.toUpperCase()).indexOf(w(b.toUpperCase())),b=b.length;0>g?c.push(d(a)):(c.push(d(a.substring(0,g))),c.push("<span class='select2-match'>"),c.push(d(a.substring(g,g+b))),c.push("</span>"),c.push(d(a.substring(g+b,a.length))))},J=function(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})},K=function(a){var b,c=null,d=a.quietMillis||100,g=a.url,h=this;return function(l){window.clearTimeout(b);
b=window.setTimeout(function(){var b=a.data,d=g,t=a.transport||e.fn.select2.ajaxDefaults.transport,f=e.extend({},e.fn.select2.ajaxDefaults.params,{type:a.type||"GET",cache:a.cache||!1,jsonpCallback:a.jsonpCallback||void 0,dataType:a.dataType||"json"}),b=b?b.call(h,l.term,l.page,l.context):null,d="function"===typeof d?d.call(h,l.term,l.page,l.context):d;c&&c.abort();a.params&&(e.isFunction(a.params)?e.extend(f,a.params.call(h)):e.extend(f,a.params));e.extend(f,{url:d,dataType:a.dataType,data:b,success:function(b){b=
a.results(b,l.page);l.callback(b)}});c=t.call(h,f)},d)}},L=function(a){var b=a,c,d,g=function(a){return""+a.text};e.isArray(b)&&(d=b,b={results:d});!1===e.isFunction(b)&&(d=b,b=function(){return d});a=b();a.text&&(g=a.text,e.isFunction(g)||(c=a.text,g=function(a){return a[c]}));return function(a){var c=a.term,d={results:[]},n;if(c==="")a.callback(b());else{n=function(b,d){var i,f,b=b[0];if(b.children){i={};for(f in b)b.hasOwnProperty(f)&&(i[f]=b[f]);i.children=[];e(b.children).each2(function(a,b){n(b,
i.children)});(i.children.length||a.matcher(c,g(i),b))&&d.push(i)}else a.matcher(c,g(b),b)&&d.push(b)};e(b().results).each2(function(a,b){n(b,d.results)});a.callback(d)}}},M=function(a){var b=e.isFunction(a);return function(c){var d=c.term,g={results:[]};e(b?a():a).each(function(){var a=void 0!==this.text,b=a?this.text:this;if(""===d||c.matcher(d,b))g.results.push(a?this:{id:this,text:this})});c.callback(g)}},r=function(a,b){if(e.isFunction(a))return!0;if(!a)return!1;throw Error(b+" must be a function or a falsy value");
},o=function(a){return e.isFunction(a)?a():a},N=function(a){var b=0;e.each(a,function(a,d){d.children?b+=N(d.children):b++});return b},P=function(a,b,c,d){var g=a,h=!1,e,i,f,t;if(d.createSearchChoice&&d.tokenSeparators&&!(1>d.tokenSeparators.length)){for(;;){h=-1;i=0;for(f=d.tokenSeparators.length;i<f&&!(t=d.tokenSeparators[i],h=a.indexOf(t),0<=h);i++);if(0>h)break;e=a.substring(0,h);a=a.substring(h+t.length);if(0<e.length&&(e=d.createSearchChoice.call(this,e,b),void 0!==e&&null!==e&&void 0!==d.id(e)&&
null!==d.id(e))){h=!1;i=0;for(f=b.length;i<f;i++)if(m(d.id(e),d.id(b[i]))){h=!0;break}h||c(e)}}if(g!==a)return a}},C=function(a,b){var c=function(){};c.prototype=new a;c.prototype.constructor=c;c.prototype.parent=a.prototype;c.prototype=e.extend(c.prototype,b);return c};if(void 0===window.Select2){var f,s,D,E,A,v,x={x:0,y:0},F;f={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(a){a=
a.which?a.which:a;switch(a){case f.LEFT:case f.RIGHT:case f.UP:case f.DOWN:return!0}return!1},isControl:function(a){switch(a.which){case f.SHIFT:case f.CTRL:case f.ALT:return!0}return a.metaKey?!0:!1},isFunctionKey:function(a){a=a.which?a.which:a;return 112<=a&&123>=a}};var O={"\u24b6":"A","\uff21":"A","\u00c0":"A","\u00c1":"A","\u00c2":"A","\u1ea6":"A","\u1ea4":"A","\u1eaa":"A","\u1ea8":"A","\u00c3":"A","\u0100":"A","\u0102":"A","\u1eb0":"A","\u1eae":"A","\u1eb4":"A","\u1eb2":"A","\u0226":"A","\u01e0":"A",
"\u00c4":"A","\u01de":"A","\u1ea2":"A","\u00c5":"A","\u01fa":"A","\u01cd":"A","\u0200":"A","\u0202":"A","\u1ea0":"A","\u1eac":"A","\u1eb6":"A","\u1e00":"A","\u0104":"A","\u023a":"A","\u2c6f":"A","\ua732":"AA","\u00c6":"AE","\u01fc":"AE","\u01e2":"AE","\ua734":"AO","\ua736":"AU","\ua738":"AV","\ua73a":"AV","\ua73c":"AY","\u24b7":"B","\uff22":"B","\u1e02":"B","\u1e04":"B","\u1e06":"B","\u0243":"B","\u0182":"B","\u0181":"B","\u24b8":"C","\uff23":"C","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C",
"\u00c7":"C","\u1e08":"C","\u0187":"C","\u023b":"C","\ua73e":"C","\u24b9":"D","\uff24":"D","\u1e0a":"D","\u010e":"D","\u1e0c":"D","\u1e10":"D","\u1e12":"D","\u1e0e":"D","\u0110":"D","\u018b":"D","\u018a":"D","\u0189":"D","\ua779":"D","\u01f1":"DZ","\u01c4":"DZ","\u01f2":"Dz","\u01c5":"Dz","\u24ba":"E","\uff25":"E","\u00c8":"E","\u00c9":"E","\u00ca":"E","\u1ec0":"E","\u1ebe":"E","\u1ec4":"E","\u1ec2":"E","\u1ebc":"E","\u0112":"E","\u1e14":"E","\u1e16":"E","\u0114":"E","\u0116":"E","\u00cb":"E","\u1eba":"E",
"\u011a":"E","\u0204":"E","\u0206":"E","\u1eb8":"E","\u1ec6":"E","\u0228":"E","\u1e1c":"E","\u0118":"E","\u1e18":"E","\u1e1a":"E","\u0190":"E","\u018e":"E","\u24bb":"F","\uff26":"F","\u1e1e":"F","\u0191":"F","\ua77b":"F","\u24bc":"G","\uff27":"G","\u01f4":"G","\u011c":"G","\u1e20":"G","\u011e":"G","\u0120":"G","\u01e6":"G","\u0122":"G","\u01e4":"G","\u0193":"G","\ua7a0":"G","\ua77d":"G","\ua77e":"G","\u24bd":"H","\uff28":"H","\u0124":"H","\u1e22":"H","\u1e26":"H","\u021e":"H","\u1e24":"H","\u1e28":"H",
"\u1e2a":"H","\u0126":"H","\u2c67":"H","\u2c75":"H","\ua78d":"H","\u24be":"I","\uff29":"I","\u00cc":"I","\u00cd":"I","\u00ce":"I","\u0128":"I","\u012a":"I","\u012c":"I","\u0130":"I","\u00cf":"I","\u1e2e":"I","\u1ec8":"I","\u01cf":"I","\u0208":"I","\u020a":"I","\u1eca":"I","\u012e":"I","\u1e2c":"I","\u0197":"I","\u24bf":"J","\uff2a":"J","\u0134":"J","\u0248":"J","\u24c0":"K","\uff2b":"K","\u1e30":"K","\u01e8":"K","\u1e32":"K","\u0136":"K","\u1e34":"K","\u0198":"K","\u2c69":"K","\ua740":"K","\ua742":"K",
"\ua744":"K","\ua7a2":"K","\u24c1":"L","\uff2c":"L","\u013f":"L","\u0139":"L","\u013d":"L","\u1e36":"L","\u1e38":"L","\u013b":"L","\u1e3c":"L","\u1e3a":"L","\u0141":"L","\u023d":"L","\u2c62":"L","\u2c60":"L","\ua748":"L","\ua746":"L","\ua780":"L","\u01c7":"LJ","\u01c8":"Lj","\u24c2":"M","\uff2d":"M","\u1e3e":"M","\u1e40":"M","\u1e42":"M","\u2c6e":"M","\u019c":"M","\u24c3":"N","\uff2e":"N","\u01f8":"N","\u0143":"N","\u00d1":"N","\u1e44":"N","\u0147":"N","\u1e46":"N","\u0145":"N","\u1e4a":"N","\u1e48":"N",
"\u0220":"N","\u019d":"N","\ua790":"N","\ua7a4":"N","\u01ca":"NJ","\u01cb":"Nj","\u24c4":"O","\uff2f":"O","\u00d2":"O","\u00d3":"O","\u00d4":"O","\u1ed2":"O","\u1ed0":"O","\u1ed6":"O","\u1ed4":"O","\u00d5":"O","\u1e4c":"O","\u022c":"O","\u1e4e":"O","\u014c":"O","\u1e50":"O","\u1e52":"O","\u014e":"O","\u022e":"O","\u0230":"O","\u00d6":"O","\u022a":"O","\u1ece":"O","\u0150":"O","\u01d1":"O","\u020c":"O","\u020e":"O","\u01a0":"O","\u1edc":"O","\u1eda":"O","\u1ee0":"O","\u1ede":"O","\u1ee2":"O","\u1ecc":"O",
"\u1ed8":"O","\u01ea":"O","\u01ec":"O","\u00d8":"O","\u01fe":"O","\u0186":"O","\u019f":"O","\ua74a":"O","\ua74c":"O","\u01a2":"OI","\ua74e":"OO","\u0222":"OU","\u24c5":"P","\uff30":"P","\u1e54":"P","\u1e56":"P","\u01a4":"P","\u2c63":"P","\ua750":"P","\ua752":"P","\ua754":"P","\u24c6":"Q","\uff31":"Q","\ua756":"Q","\ua758":"Q","\u024a":"Q","\u24c7":"R","\uff32":"R","\u0154":"R","\u1e58":"R","\u0158":"R","\u0210":"R","\u0212":"R","\u1e5a":"R","\u1e5c":"R","\u0156":"R","\u1e5e":"R","\u024c":"R","\u2c64":"R",
"\ua75a":"R","\ua7a6":"R","\ua782":"R","\u24c8":"S","\uff33":"S","\u1e9e":"S","\u015a":"S","\u1e64":"S","\u015c":"S","\u1e60":"S","\u0160":"S","\u1e66":"S","\u1e62":"S","\u1e68":"S","\u0218":"S","\u015e":"S","\u2c7e":"S","\ua7a8":"S","\ua784":"S","\u24c9":"T","\uff34":"T","\u1e6a":"T","\u0164":"T","\u1e6c":"T","\u021a":"T","\u0162":"T","\u1e70":"T","\u1e6e":"T","\u0166":"T","\u01ac":"T","\u01ae":"T","\u023e":"T","\ua786":"T","\ua728":"TZ","\u24ca":"U","\uff35":"U","\u00d9":"U","\u00da":"U","\u00db":"U",
"\u0168":"U","\u1e78":"U","\u016a":"U","\u1e7a":"U","\u016c":"U","\u00dc":"U","\u01db":"U","\u01d7":"U","\u01d5":"U","\u01d9":"U","\u1ee6":"U","\u016e":"U","\u0170":"U","\u01d3":"U","\u0214":"U","\u0216":"U","\u01af":"U","\u1eea":"U","\u1ee8":"U","\u1eee":"U","\u1eec":"U","\u1ef0":"U","\u1ee4":"U","\u1e72":"U","\u0172":"U","\u1e76":"U","\u1e74":"U","\u0244":"U","\u24cb":"V","\uff36":"V","\u1e7c":"V","\u1e7e":"V","\u01b2":"V","\ua75e":"V","\u0245":"V","\ua760":"VY","\u24cc":"W","\uff37":"W","\u1e80":"W",
"\u1e82":"W","\u0174":"W","\u1e86":"W","\u1e84":"W","\u1e88":"W","\u2c72":"W","\u24cd":"X","\uff38":"X","\u1e8a":"X","\u1e8c":"X","\u24ce":"Y","\uff39":"Y","\u1ef2":"Y","\u00dd":"Y","\u0176":"Y","\u1ef8":"Y","\u0232":"Y","\u1e8e":"Y","\u0178":"Y","\u1ef6":"Y","\u1ef4":"Y","\u01b3":"Y","\u024e":"Y","\u1efe":"Y","\u24cf":"Z","\uff3a":"Z","\u0179":"Z","\u1e90":"Z","\u017b":"Z","\u017d":"Z","\u1e92":"Z","\u1e94":"Z","\u01b5":"Z","\u0224":"Z","\u2c7f":"Z","\u2c6b":"Z","\ua762":"Z","\u24d0":"a","\uff41":"a",
"\u1e9a":"a","\u00e0":"a","\u00e1":"a","\u00e2":"a","\u1ea7":"a","\u1ea5":"a","\u1eab":"a","\u1ea9":"a","\u00e3":"a","\u0101":"a","\u0103":"a","\u1eb1":"a","\u1eaf":"a","\u1eb5":"a","\u1eb3":"a","\u0227":"a","\u01e1":"a","\u00e4":"a","\u01df":"a","\u1ea3":"a","\u00e5":"a","\u01fb":"a","\u01ce":"a","\u0201":"a","\u0203":"a","\u1ea1":"a","\u1ead":"a","\u1eb7":"a","\u1e01":"a","\u0105":"a","\u2c65":"a","\u0250":"a","\ua733":"aa","\u00e6":"ae","\u01fd":"ae","\u01e3":"ae","\ua735":"ao","\ua737":"au","\ua739":"av",
"\ua73b":"av","\ua73d":"ay","\u24d1":"b","\uff42":"b","\u1e03":"b","\u1e05":"b","\u1e07":"b","\u0180":"b","\u0183":"b","\u0253":"b","\u24d2":"c","\uff43":"c","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u00e7":"c","\u1e09":"c","\u0188":"c","\u023c":"c","\ua73f":"c","\u2184":"c","\u24d3":"d","\uff44":"d","\u1e0b":"d","\u010f":"d","\u1e0d":"d","\u1e11":"d","\u1e13":"d","\u1e0f":"d","\u0111":"d","\u018c":"d","\u0256":"d","\u0257":"d","\ua77a":"d","\u01f3":"dz","\u01c6":"dz","\u24d4":"e","\uff45":"e",
"\u00e8":"e","\u00e9":"e","\u00ea":"e","\u1ec1":"e","\u1ebf":"e","\u1ec5":"e","\u1ec3":"e","\u1ebd":"e","\u0113":"e","\u1e15":"e","\u1e17":"e","\u0115":"e","\u0117":"e","\u00eb":"e","\u1ebb":"e","\u011b":"e","\u0205":"e","\u0207":"e","\u1eb9":"e","\u1ec7":"e","\u0229":"e","\u1e1d":"e","\u0119":"e","\u1e19":"e","\u1e1b":"e","\u0247":"e","\u025b":"e","\u01dd":"e","\u24d5":"f","\uff46":"f","\u1e1f":"f","\u0192":"f","\ua77c":"f","\u24d6":"g","\uff47":"g","\u01f5":"g","\u011d":"g","\u1e21":"g","\u011f":"g",
"\u0121":"g","\u01e7":"g","\u0123":"g","\u01e5":"g","\u0260":"g","\ua7a1":"g","\u1d79":"g","\ua77f":"g","\u24d7":"h","\uff48":"h","\u0125":"h","\u1e23":"h","\u1e27":"h","\u021f":"h","\u1e25":"h","\u1e29":"h","\u1e2b":"h","\u1e96":"h","\u0127":"h","\u2c68":"h","\u2c76":"h","\u0265":"h","\u0195":"hv","\u24d8":"i","\uff49":"i","\u00ec":"i","\u00ed":"i","\u00ee":"i","\u0129":"i","\u012b":"i","\u012d":"i","\u00ef":"i","\u1e2f":"i","\u1ec9":"i","\u01d0":"i","\u0209":"i","\u020b":"i","\u1ecb":"i","\u012f":"i",
"\u1e2d":"i","\u0268":"i","\u0131":"i","\u24d9":"j","\uff4a":"j","\u0135":"j","\u01f0":"j","\u0249":"j","\u24da":"k","\uff4b":"k","\u1e31":"k","\u01e9":"k","\u1e33":"k","\u0137":"k","\u1e35":"k","\u0199":"k","\u2c6a":"k","\ua741":"k","\ua743":"k","\ua745":"k","\ua7a3":"k","\u24db":"l","\uff4c":"l","\u0140":"l","\u013a":"l","\u013e":"l","\u1e37":"l","\u1e39":"l","\u013c":"l","\u1e3d":"l","\u1e3b":"l","\u017f":"l","\u0142":"l","\u019a":"l","\u026b":"l","\u2c61":"l","\ua749":"l","\ua781":"l","\ua747":"l",
"\u01c9":"lj","\u24dc":"m","\uff4d":"m","\u1e3f":"m","\u1e41":"m","\u1e43":"m","\u0271":"m","\u026f":"m","\u24dd":"n","\uff4e":"n","\u01f9":"n","\u0144":"n","\u00f1":"n","\u1e45":"n","\u0148":"n","\u1e47":"n","\u0146":"n","\u1e4b":"n","\u1e49":"n","\u019e":"n","\u0272":"n","\u0149":"n","\ua791":"n","\ua7a5":"n","\u01cc":"nj","\u24de":"o","\uff4f":"o","\u00f2":"o","\u00f3":"o","\u00f4":"o","\u1ed3":"o","\u1ed1":"o","\u1ed7":"o","\u1ed5":"o","\u00f5":"o","\u1e4d":"o","\u022d":"o","\u1e4f":"o","\u014d":"o",
"\u1e51":"o","\u1e53":"o","\u014f":"o","\u022f":"o","\u0231":"o","\u00f6":"o","\u022b":"o","\u1ecf":"o","\u0151":"o","\u01d2":"o","\u020d":"o","\u020f":"o","\u01a1":"o","\u1edd":"o","\u1edb":"o","\u1ee1":"o","\u1edf":"o","\u1ee3":"o","\u1ecd":"o","\u1ed9":"o","\u01eb":"o","\u01ed":"o","\u00f8":"o","\u01ff":"o","\u0254":"o","\ua74b":"o","\ua74d":"o","\u0275":"o","\u01a3":"oi","\u0223":"ou","\ua74f":"oo","\u24df":"p","\uff50":"p","\u1e55":"p","\u1e57":"p","\u01a5":"p","\u1d7d":"p","\ua751":"p","\ua753":"p",
"\ua755":"p","\u24e0":"q","\uff51":"q","\u024b":"q","\ua757":"q","\ua759":"q","\u24e1":"r","\uff52":"r","\u0155":"r","\u1e59":"r","\u0159":"r","\u0211":"r","\u0213":"r","\u1e5b":"r","\u1e5d":"r","\u0157":"r","\u1e5f":"r","\u024d":"r","\u027d":"r","\ua75b":"r","\ua7a7":"r","\ua783":"r","\u24e2":"s","\uff53":"s","\u00df":"s","\u015b":"s","\u1e65":"s","\u015d":"s","\u1e61":"s","\u0161":"s","\u1e67":"s","\u1e63":"s","\u1e69":"s","\u0219":"s","\u015f":"s","\u023f":"s","\ua7a9":"s","\ua785":"s","\u1e9b":"s",
"\u24e3":"t","\uff54":"t","\u1e6b":"t","\u1e97":"t","\u0165":"t","\u1e6d":"t","\u021b":"t","\u0163":"t","\u1e71":"t","\u1e6f":"t","\u0167":"t","\u01ad":"t","\u0288":"t","\u2c66":"t","\ua787":"t","\ua729":"tz","\u24e4":"u","\uff55":"u","\u00f9":"u","\u00fa":"u","\u00fb":"u","\u0169":"u","\u1e79":"u","\u016b":"u","\u1e7b":"u","\u016d":"u","\u00fc":"u","\u01dc":"u","\u01d8":"u","\u01d6":"u","\u01da":"u","\u1ee7":"u","\u016f":"u","\u0171":"u","\u01d4":"u","\u0215":"u","\u0217":"u","\u01b0":"u","\u1eeb":"u",
"\u1ee9":"u","\u1eef":"u","\u1eed":"u","\u1ef1":"u","\u1ee5":"u","\u1e73":"u","\u0173":"u","\u1e77":"u","\u1e75":"u","\u0289":"u","\u24e5":"v","\uff56":"v","\u1e7d":"v","\u1e7f":"v","\u028b":"v","\ua75f":"v","\u028c":"v","\ua761":"vy","\u24e6":"w","\uff57":"w","\u1e81":"w","\u1e83":"w","\u0175":"w","\u1e87":"w","\u1e85":"w","\u1e98":"w","\u1e89":"w","\u2c73":"w","\u24e7":"x","\uff58":"x","\u1e8b":"x","\u1e8d":"x","\u24e8":"y","\uff59":"y","\u1ef3":"y","\u00fd":"y","\u0177":"y","\u1ef9":"y","\u0233":"y",
"\u1e8f":"y","\u00ff":"y","\u1ef7":"y","\u1e99":"y","\u1ef5":"y","\u01b4":"y","\u024f":"y","\u1eff":"y","\u24e9":"z","\uff5a":"z","\u017a":"z","\u1e91":"z","\u017c":"z","\u017e":"z","\u1e93":"z","\u1e95":"z","\u01b6":"z","\u0225":"z","\u0240":"z","\u2c6c":"z","\ua763":"z"};s=e(document);var Q=1;A=function(){return Q++};s.on("mousemove",function(a){x.x=a.pageX;x.y=a.pageY});s=C(Object,{bind:function(a){var b=this;return function(){a.apply(b,arguments)}},init:function(a){var b,c;this.opts=a=this.prepareOpts(a);
this.id=a.id;void 0!==a.element.data("select2")&&null!==a.element.data("select2")&&a.element.data("select2").destroy();this.container=this.createContainer();this.containerId="s2id_"+(a.element.attr("id")||"autogen"+A());this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");this.container.attr("id",this.containerId);var d=!1,g;this.body=function(){!1===d&&(g=a.element.closest("body"),d=!0);return g};z(this.container,this.opts.element,this.opts.adaptContainerCssClass);
this.container.attr("style",a.element.attr("style"));this.container.css(o(a.containerCss));this.container.addClass(o(a.containerCssClass));this.elementTabIndex=this.opts.element.attr("tabindex");this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",j);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");z(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(o(a.dropdownCssClass));
this.dropdown.data("select2",this);this.dropdown.on("click",j);this.results=b=this.container.find(".select2-results");this.search=c=this.container.find("input.select2-input");this.resultsPage=this.queryCount=0;this.context=null;this.initContainer();this.container.on("click",j);this.results.on("mousemove",function(a){(void 0===x||x.x!==a.pageX||x.y!==a.pageY)&&e(a.target).trigger("mousemove-filtered",a)});this.dropdown.on("mousemove-filtered touchstart touchmove touchend",".select2-results",this.bind(this.highlightUnderEvent));
var h=this.results,l=H(80,function(a){h.trigger("scroll-debounced",a)});h.on("scroll",function(a){0<=k(a.target,h.get())&&l(a)});this.dropdown.on("scroll-debounced",".select2-results",this.bind(this.loadMoreIfNeeded));e(this.container).on("change",".select2-input",function(a){a.stopPropagation()});e(this.dropdown).on("change",".select2-input",function(a){a.stopPropagation()});e.fn.mousewheel&&b.mousewheel(function(a,c,d,g){c=b.scrollTop();0<g&&0>=c-g?(b.scrollTop(0),j(a)):0>g&&b.get(0).scrollHeight-
b.scrollTop()+g<=b.height()&&(b.scrollTop(b.get(0).scrollHeight-b.height()),j(a))});G(c);c.on("keyup-change input paste",this.bind(this.updateResults));c.on("focus",function(){c.addClass("select2-focused")});c.on("blur",function(){c.removeClass("select2-focused")});this.dropdown.on("mouseup",".select2-results",this.bind(function(a){0<e(a.target).closest(".select2-result-selectable").length&&(this.highlightUnderEvent(a),this.selectHighlighted(a))}));this.dropdown.on("click mouseup mousedown",function(a){a.stopPropagation()});
e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource());null!==a.maximumInputLength&&this.search.attr("maxlength",a.maximumInputLength);var i=a.element.prop("disabled");void 0===i&&(i=!1);this.enable(!i);i=a.element.prop("readonly");void 0===i&&(i=!1);this.readonly(i);if(!(i=F)){i=e("<div class='select2-measure-scrollbar'></div>");i.appendTo("body");var f={width:i.width()-i[0].clientWidth,height:i.height()-i[0].clientHeight};i.remove();i=f}F=i;this.autofocus=a.element.prop("autofocus");
a.element.prop("autofocus",!1);this.autofocus&&this.focus();this.nextSearchTerm=void 0},destroy:function(){var a=this.opts.element,b=a.data("select2");this.close();this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null);void 0!==b&&(b.container.remove(),b.dropdown.remove(),a.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?a.attr({tabindex:this.elementTabIndex}):a.removeAttr("tabindex"),a.show())},
optionToData:function(a){if(a.is("option"))return{id:a.prop("value"),text:a.text(),element:a.get(),css:a.attr("class"),disabled:a.prop("disabled"),locked:m(a.attr("locked"),"locked")||m(a.data("locked"),!0)};if(a.is("optgroup"))return{text:a.attr("label"),children:[],element:a.get(),css:a.attr("class")}},prepareOpts:function(a){var b,c,d,g=this;b=a.element;"select"===b.get(0).tagName.toLowerCase()&&(this.select=c=a.element);c&&e.each("id multiple ajax query createSearchChoice initSelection data tags".split(" "),
function(){if(this in a)throw Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.");});a=e.extend({},{populateResults:function(b,c,d){var f,t=this.opts.id;f=function(b,c,h){var l,j,m,k,o,u,q,b=a.sortResults(b,c,d);l=0;for(j=b.length;l<j;l=l+1){m=b[l];o=m.disabled===true;k=!o&&t(m)!==void 0;u=m.children&&m.children.length>0;q=e("<li></li>");q.addClass("select2-results-dept-"+h);q.addClass("select2-result");q.addClass(k?"select2-result-selectable":"select2-result-unselectable");
o&&q.addClass("select2-disabled");u&&q.addClass("select2-result-with-children");q.addClass(g.opts.formatResultCssClass(m));k=e(document.createElement("div"));k.addClass("select2-result-label");o=a.formatResult(m,k,d,g.opts.escapeMarkup);o!==void 0&&k.html(o);q.append(k);if(u){u=e("<ul></ul>");u.addClass("select2-result-sub");f(m.children,u,h+1);q.append(u)}q.data("select2-data",m);c.append(q)}};f(c,b,0)}},e.fn.select2.defaults,a);"function"!==typeof a.id&&(d=a.id,a.id=function(a){return a[d]});if(e.isArray(a.element.data("select2Tags"))){if("tags"in
a)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+a.element.attr("id");a.tags=a.element.data("select2Tags")}if(c)a.query=this.bind(function(a){var c={results:[],more:false},d=a.term,e,f,p;p=function(b,c){var e;if(b.is("option"))a.matcher(d,b.text(),b)&&c.push(g.optionToData(b));else if(b.is("optgroup")){e=g.optionToData(b);b.children().each2(function(a,b){p(b,e.children)});e.children.length>0&&c.push(e)}};e=b.children();if(this.getPlaceholder()!==void 0&&
e.length>0)(f=this.getPlaceholderOption())&&(e=e.not(f));e.each2(function(a,b){p(b,c.results)});a.callback(c)}),a.id=function(a){return a.id},a.formatResultCssClass=function(a){return a.css};else if(!("query"in a))if("ajax"in a){if((c=a.element.data("ajax-url"))&&0<c.length)a.ajax.url=c;a.query=K.call(a.element,a.ajax)}else if("data"in a)a.query=L(a.data);else if("tags"in a&&(a.query=M(a.tags),void 0===a.createSearchChoice&&(a.createSearchChoice=function(a){return{id:e.trim(a),text:e.trim(a)}}),void 0===
a.initSelection))a.initSelection=function(b,c){var d=[];e(B(b.val(),a.separator)).each(function(){var b={id:this,text:this},c=a.tags;e.isFunction(c)&&(c=c());e(c).each(function(){if(m(this.id,b.id)){b=this;return false}});d.push(b)});c(d)};if("function"!==typeof a.query)throw"query function not defined for Select2 "+a.element.attr("id");return a},monitorSource:function(){var a=this.opts.element,b,c;a.on("change.select2",this.bind(function(){!0!==this.opts.element.data("select2-change-triggered")&&
this.initSelection()}));b=this.bind(function(){var b=a.prop("disabled");void 0===b&&(b=!1);this.enable(!b);b=a.prop("readonly");void 0===b&&(b=!1);this.readonly(b);z(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.addClass(o(this.opts.containerCssClass));z(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(o(this.opts.dropdownCssClass))});a.on("propertychange.select2",b);void 0===this.mutationCallback&&(this.mutationCallback=function(a){a.forEach(b)});
c=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;void 0!==c&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new c(this.mutationCallback),this.propertyObserver.observe(a.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(a){a=e.Event("select2-selecting",{val:this.id(a),object:a});this.opts.element.trigger(a);return!a.isDefaultPrevented()},triggerChange:function(a){a=a||{};a=e.extend({},a,{type:"change",
val:this.val()});this.opts.element.data("select2-change-triggered",!0);this.opts.element.trigger(a);this.opts.element.data("select2-change-triggered",!1);this.opts.element.click();this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return!0===this.enabledInterface},enableInterface:function(){var a=this._enabled&&!this._readonly;if(a===this.enabledInterface)return!1;this.container.toggleClass("select2-container-disabled",!a);this.close();this.enabledInterface=a;return!0},
enable:function(a){void 0===a&&(a=!0);this._enabled!==a&&(this._enabled=a,this.opts.element.prop("disabled",!a),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(a){void 0===a&&(a=!1);if(this._readonly===a)return!1;this._readonly=a;this.opts.element.prop("readonly",a);this.enableInterface();return!0},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var a=this.dropdown,b=this.container.offset(),c=this.container.outerHeight(!1),
d=this.container.outerWidth(!1),g=a.outerHeight(!1),h=e(window),f=h.width(),i=h.height(),n=h.scrollLeft()+f,j=h.scrollTop()+i,c=b.top+c,p=b.left,j=c+g<=j,m=b.top-g>=this.body().scrollTop(),k=a.outerWidth(!1),r=p+k<=n,s;a.hasClass("select2-drop-above")?(g=!0,!m&&j&&(s=!0,g=!1)):(g=!1,!j&&m&&(g=s=!0));s&&(a.hide(),b=this.container.offset(),c=this.container.outerHeight(!1),d=this.container.outerWidth(!1),a.outerHeight(!1),n=h.scrollLeft()+f,h.scrollTop(),c=b.top+c,p=b.left,k=a.outerWidth(!1),r=p+k<=
n,a.show());this.opts.dropdownAutoWidth?(h=e(".select2-results",a)[0],a.addClass("select2-drop-auto-width"),a.css("width",""),k=a.outerWidth(!1)+(h.scrollHeight===h.clientHeight?0:F.width),k>d?d=k:k=d,r=p+k<=n):this.container.removeClass("select2-drop-auto-width");"static"!==this.body().css("position")&&(n=this.body().offset(),c-=n.top,p-=n.left);r||(p=b.left+d-k);d={left:p,width:d};g?(d.bottom=i-b.top,d.top="auto",this.container.addClass("select2-drop-above"),a.addClass("select2-drop-above")):(d.top=
c,d.bottom="auto",this.container.removeClass("select2-drop-above"),a.removeClass("select2-drop-above"));d=e.extend(d,o(this.opts.dropdownCss));a.css(d)},shouldOpen:function(){var a;if(this.opened()||!1===this._enabled||!0===this._readonly)return!1;a=e.Event("select2-opening");this.opts.element.trigger(a);return!a.isDefaultPrevented()},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")},open:function(){if(!this.shouldOpen())return!1;
this.opening();return!0},opening:function(){var a=this.containerId,b="scroll."+a,c="resize."+a,d="orientationchange."+a;this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.clearDropdownAlignmentPreference();this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body());a=e("#select2-drop-mask");0==a.length&&(a=e(document.createElement("div")),a.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),a.hide(),a.appendTo(this.body()),
a.on("mousedown touchstart click",function(a){var b=e("#select2-drop");0<b.length&&(b=b.data("select2"),b.opts.selectOnBlur&&b.selectHighlighted({noFocus:!0}),b.close({focus:!0}),a.preventDefault(),a.stopPropagation())}));this.dropdown.prev()[0]!==a[0]&&this.dropdown.before(a);e("#select2-drop").removeAttr("id");this.dropdown.attr("id","select2-drop");a.show();this.positionDropdown();this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");var g=this;this.container.parents().add(window).each(function(){e(this).on(c+
" "+b+" "+d,function(){g.positionDropdown()})})},close:function(){if(this.opened()){var a=this.containerId,b="scroll."+a,c="resize."+a,d="orientationchange."+a;this.container.parents().add(window).each(function(){e(this).off(b).off(c).off(d)});this.clearDropdownAlignmentPreference();e("#select2-drop-mask").hide();this.dropdown.removeAttr("id");this.dropdown.hide();this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");this.results.empty();this.clearSearch();this.search.removeClass("select2-active");
this.opts.element.trigger(e.Event("select2-close"))}},externalSearch:function(a){this.open();this.search.val(a);this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return o(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var a=this.results,b,c,d,g;c=this.highlight();0>c||(0==c?a.scrollTop(0):(b=this.findHighlightableChoices().find(".select2-result-label"),d=e(b[c]),g=d.offset().top+d.outerHeight(!0),c===b.length-1&&(b=a.find("li.select2-more-results"),
0<b.length&&(g=b.offset().top+b.outerHeight(!0))),b=a.offset().top+a.outerHeight(!0),g>b&&a.scrollTop(a.scrollTop()+(g-b)),g=d.offset().top-a.offset().top,0>g&&"none"!=d.css("display")&&a.scrollTop(a.scrollTop()+g)))},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled, .select2-selected)")},moveHighlight:function(a){for(var b=this.findHighlightableChoices(),c=this.highlight();-1<c&&c<b.length;){var c=c+a,d=e(b[c]);if(d.hasClass("select2-result-selectable")&&
!d.hasClass("select2-disabled")&&!d.hasClass("select2-selected")){this.highlight(c);break}}},highlight:function(a){var b=this.findHighlightableChoices();if(0===arguments.length)return k(b.filter(".select2-highlighted")[0],b.get());a>=b.length&&(a=b.length-1);0>a&&(a=0);this.removeHighlight();b=e(b[a]);b.addClass("select2-highlighted");this.ensureHighlightVisible();(b=b.data("select2-data"))&&this.opts.element.trigger({type:"select2-highlight",val:this.id(b),choice:b})},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},
countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(a){a=e(a.target).closest(".select2-result-selectable");if(0<a.length&&!a.is(".select2-highlighted")){var b=this.findHighlightableChoices();this.highlight(b.index(a))}else 0==a.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var a=this.results,b=a.find("li.select2-more-results"),c,d=this.resultsPage+1,e=this,h=this.search.val(),f=this.context;0!==b.length&&(c=b.offset().top-a.offset().top-
a.height(),c<=this.opts.loadMorePadding&&(b.addClass("select2-active"),this.opts.query({element:this.opts.element,term:h,page:d,context:f,matcher:this.opts.matcher,callback:this.bind(function(c){e.opened()&&(e.opts.populateResults.call(this,a,c.results,{term:h,page:d,context:f}),e.postprocessResults(c,!1,!1),!0===c.more?(b.detach().appendTo(a).text(e.opts.formatLoadMore(d+1)),window.setTimeout(function(){e.loadMoreIfNeeded()},10)):b.remove(),e.positionDropdown(),e.resultsPage=d,e.context=c.context,
this.opts.element.trigger({type:"select2-loaded",items:c}))})})))},tokenize:function(){},updateResults:function(a){function b(){d.removeClass("select2-active");i.positionDropdown()}function c(a){g.html(a);b()}var d=this.search,g=this.results,h=this.opts,f,i=this;f=d.val();var n=e.data(this.container,"select2-last-term"),j;if(!(!0!==a&&n&&m(f,n))&&(e.data(this.container,"select2-last-term",f),!(!0!==a&&(!1===this.showSearchInput||!this.opened())))){j=++this.queryCount;n=this.getMaximumSelectionSize();
if(1<=n&&(f=this.data(),e.isArray(f)&&f.length>=n&&r(h.formatSelectionTooBig,"formatSelectionTooBig"))){c("<li class='select2-selection-limit'>"+h.formatSelectionTooBig(n)+"</li>");return}d.val().length<h.minimumInputLength?(r(h.formatInputTooShort,"formatInputTooShort")?c("<li class='select2-no-results'>"+h.formatInputTooShort(d.val(),h.minimumInputLength)+"</li>"):c(""),a&&this.showSearch&&this.showSearch(!0)):h.maximumInputLength&&d.val().length>h.maximumInputLength?r(h.formatInputTooLong,"formatInputTooLong")?
c("<li class='select2-no-results'>"+h.formatInputTooLong(d.val(),h.maximumInputLength)+"</li>"):c(""):(h.formatSearching&&0===this.findHighlightableChoices().length&&c("<li class='select2-searching'>"+h.formatSearching()+"</li>"),d.addClass("select2-active"),this.removeHighlight(),f=this.tokenize(),void 0!=f&&null!=f&&d.val(f),this.resultsPage=1,h.query({element:h.element,term:d.val(),page:this.resultsPage,context:null,matcher:h.matcher,callback:this.bind(function(f){var l;j==this.queryCount&&(this.opened()?
(this.context=void 0===f.context?null:f.context,this.opts.createSearchChoice&&""!==d.val()&&(l=this.opts.createSearchChoice.call(i,d.val(),f.results),void 0!==l&&null!==l&&void 0!==i.id(l)&&null!==i.id(l)&&0===e(f.results).filter(function(){return m(i.id(this),i.id(l))}).length&&f.results.unshift(l)),0===f.results.length&&r(h.formatNoMatches,"formatNoMatches"))?c("<li class='select2-no-results'>"+h.formatNoMatches(d.val())+"</li>"):(g.empty(),i.opts.populateResults.call(this,g,f.results,{term:d.val(),
page:this.resultsPage,context:null}),!0===f.more&&r(h.formatLoadMore,"formatLoadMore")&&(g.append("<li class='select2-more-results'>"+i.opts.escapeMarkup(h.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){i.loadMoreIfNeeded()},10)),this.postprocessResults(f,a),b(),this.opts.element.trigger({type:"select2-loaded",items:f})):this.search.removeClass("select2-active"))})}))}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0});
this.close();this.container.removeClass("select2-container-active");this.search[0]===document.activeElement&&this.search.blur();this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){var a=this.search;a[0]!==document.activeElement&&window.setTimeout(function(){var b=a[0],c=a.val().length;a.focus();a.is(":visible")&&b===document.activeElement&&(b.setSelectionRange?b.setSelectionRange(c,c):b.createTextRange&&(b=b.createTextRange(),
b.collapse(!1),b.select()))},0)},selectHighlighted:function(a){var b=this.highlight(),c=this.results.find(".select2-highlighted").closest(".select2-result").data("select2-data");c?(this.highlight(b),this.onSelect(c,a)):a&&a.noFocus&&this.close()},getPlaceholder:function(){var a;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||(void 0!==(a=this.getPlaceholderOption())?a.text():void 0)},getPlaceholderOption:function(){if(this.select){var a=
this.select.children("option").first();if(void 0!==this.opts.placeholderOption)return"first"===this.opts.placeholderOption&&a||"function"===typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===a.text()&&""===a.val())return a}},initContainerWidth:function(){var a=function(){var a,c,d,g;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||
"resolve"===this.opts.width){a=this.opts.element.attr("style");if(void 0!==a){a=a.split(";");d=0;for(g=a.length;d<g;d+=1)if(c=a[d].replace(/\s/g,""),c=c.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==c&&1<=c.length)return c[1]}return"resolve"===this.opts.width?(a=this.opts.element.css("width"),0<a.indexOf("%")?a:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}.call(this);
null!==a&&this.container.css("width",a)}});D=C(s,{createContainer:function(){return e(document.createElement("div")).attr({"class":"select2-container"}).html("<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>   <span class='select2-arrow'><b></b></span></a><input class='select2-focusser select2-offscreen' type='text'/><div class='select2-drop select2-display-none'>   <div class='select2-search'>       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>   </div>   <ul class='select2-results'>   </ul></div>")},
enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var a,b;0<=this.opts.minimumResultsForSearch&&this.showSearch(!0);this.parent.opening.apply(this,arguments);!1!==this.showSearchInput&&this.search.val(this.focusser.val());this.search.focus();a=this.search.get(0);a.createTextRange?(a=a.createTextRange(),a.collapse(!1),a.select()):a.setSelectionRange&&(b=this.search.val().length,a.setSelectionRange(b,
b));""===this.search.val()&&void 0!=this.nextSearchTerm&&(this.search.val(this.nextSearchTerm),this.search.select());this.focusser.prop("disabled",!0).val("");this.updateResults(!0);this.opts.element.trigger(e.Event("select2-open"))},close:function(a){this.opened()&&(this.parent.close.apply(this,arguments),a=a||{focus:!0},this.focusser.removeAttr("disabled"),a.focus&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},
cancel:function(){this.parent.cancel.apply(this,arguments);this.focusser.removeAttr("disabled");this.focusser.focus()},destroy:function(){e("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id"));this.parent.destroy.apply(this,arguments)},initContainer:function(){var a,b=this.container,c=this.dropdown;0>this.opts.minimumResultsForSearch?this.showSearch(!1):this.showSearch(!0);this.selection=a=b.find(".select2-choice");this.focusser=b.find(".select2-focusser");this.focusser.attr("id",
"s2id_autogen"+A());e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id"));this.focusser.attr("tabindex",this.elementTabIndex);this.search.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled())if(a.which===f.PAGE_UP||a.which===f.PAGE_DOWN)j(a);else switch(a.which){case f.UP:case f.DOWN:this.moveHighlight(a.which===f.UP?-1:1);j(a);break;case f.ENTER:this.selectHighlighted();j(a);break;case f.TAB:this.selectHighlighted({noFocus:!0});break;case f.ESC:this.cancel(a),
j(a)}}));this.search.on("blur",this.bind(function(){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.search.focus()}),0)}));this.focusser.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()&&!(a.which===f.TAB||f.isControl(a)||f.isFunctionKey(a)||a.which===f.ESC))if(!1===this.opts.openOnEnter&&a.which===f.ENTER)j(a);else if(a.which==f.DOWN||a.which==f.UP||a.which==f.ENTER&&this.opts.openOnEnter)!a.altKey&&(!a.ctrlKey&&!a.shiftKey&&!a.metaKey)&&(this.open(),
j(a));else if(a.which==f.DELETE||a.which==f.BACKSPACE)this.opts.allowClear&&this.clear(),j(a)}));G(this.focusser);this.focusser.on("keyup-change input",this.bind(function(a){0<=this.opts.minimumResultsForSearch&&(a.stopPropagation(),this.opened()||this.open())}));a.on("mousedown","abbr",this.bind(function(a){this.isInterfaceEnabled()&&(this.clear(),a.preventDefault(),a.stopImmediatePropagation(),this.close(),this.selection.focus())}));a.on("mousedown",this.bind(function(a){this.container.hasClass("select2-container-active")||
this.opts.element.trigger(e.Event("select2-focus"));this.opened()?this.close():this.isInterfaceEnabled()&&this.open();j(a)}));c.on("mousedown",this.bind(function(){this.search.focus()}));a.on("focus",this.bind(function(a){j(a)}));this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus"));this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),
this.opts.element.trigger(e.Event("select2-blur")))}));this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus"));this.container.addClass("select2-container-active")}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.setPlaceholder()},clear:function(a){var b=this.selection.data("select2-data");if(b){var c=e.Event("select2-clearing");this.opts.element.trigger(c);c.isDefaultPrevented()||
(c=this.getPlaceholderOption(),this.opts.element.val(c?c.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),!1!==a&&(this.opts.element.trigger({type:"select2-removed",val:this.id(b),choice:b}),this.triggerChange({removed:b})))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var a=this;this.opts.initSelection.call(null,this.opts.element,function(b){void 0!==
b&&null!==b&&(a.updateSelection(b),a.close(),a.setPlaceholder())})}},isPlaceholderOptionSelected:function(){var a;return!this.getPlaceholder()?!1:void 0!==(a=this.getPlaceholderOption())&&a.prop("selected")||""===this.opts.element.val()||void 0===this.opts.element.val()||null===this.opts.element.val()},prepareOpts:function(){var a=this.parent.prepareOpts.apply(this,arguments),b=this;"select"===a.element.get(0).tagName.toLowerCase()?a.initSelection=function(a,d){var e=a.find("option").filter(function(){return this.selected});
d(b.optionToData(e))}:"data"in a&&(a.initSelection=a.initSelection||function(b,d){var g=b.val(),f=null;a.query({matcher:function(b,c,d){(b=m(g,a.id(d)))&&(f=d);return b},callback:!e.isFunction(d)?e.noop:function(){d(f)}})});return a},getPlaceholder:function(){return this.select&&void 0===this.getPlaceholderOption()?void 0:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var a=this.getPlaceholder();this.isPlaceholderOptionSelected()&&void 0!==a&&!(this.select&&void 0===this.getPlaceholderOption())&&
(this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(a)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear"))},postprocessResults:function(a,b,c){var d=0,e=this;this.findHighlightableChoices().each2(function(a,b){if(m(e.id(b.data("select2-data")),e.opts.element.val()))return d=a,!1});!1!==c&&(!0===b&&0<=d?this.highlight(d):this.highlight(0));!0===b&&(b=this.opts.minimumResultsForSearch,0<=b&&this.showSearch(N(a.results)>=b))},showSearch:function(a){this.showSearchInput!==
a&&(this.showSearchInput=a,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!a),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!a),e(this.dropdown,this.container).toggleClass("select2-with-searchbox",a))},onSelect:function(a,b){if(this.triggerSelect(a)){var c=this.opts.element.val(),d=this.data();this.opts.element.val(this.id(a));this.updateSelection(a);this.opts.element.trigger({type:"select2-selected",val:this.id(a),choice:a});this.nextSearchTerm=
this.opts.nextSearchTerm(a,this.search.val());this.close();(!b||!b.noFocus)&&this.focusser.focus();m(c,this.id(a))||this.triggerChange({added:a,removed:d})}},updateSelection:function(a){var b=this.selection.find(".select2-chosen"),c;this.selection.data("select2-data",a);b.empty();null!==a&&(c=this.opts.formatSelection(a,b,this.opts.escapeMarkup));void 0!==c&&b.append(c);a=this.opts.formatSelectionCssClass(a,b);void 0!==a&&b.addClass(a);this.selection.removeClass("select2-default");this.opts.allowClear&&
void 0!==this.getPlaceholder()&&this.container.addClass("select2-allowclear")},val:function(){var a,b=!1,c=null,d=this,e=this.data();if(0===arguments.length)return this.opts.element.val();a=arguments[0];1<arguments.length&&(b=arguments[1]);if(this.select)this.select.val(a).find("option").filter(function(){return this.selected}).each2(function(a,b){c=d.optionToData(b);return!1}),this.updateSelection(c),this.setPlaceholder(),b&&this.triggerChange({added:c,removed:e});else if(!a&&0!==a)this.clear(b);
else{if(void 0===this.opts.initSelection)throw Error("cannot call val() if initSelection() is not defined");this.opts.element.val(a);this.opts.initSelection(this.opts.element,function(a){d.opts.element.val(!a?"":d.id(a));d.updateSelection(a);d.setPlaceholder();b&&d.triggerChange({added:a,removed:e})})}},clearSearch:function(){this.search.val("");this.focusser.val("")},data:function(a){var b,c=!1;if(0===arguments.length)return b=this.selection.data("select2-data"),void 0==b&&(b=null),b;1<arguments.length&&
(c=arguments[1]);a?(b=this.data(),this.opts.element.val(!a?"":this.id(a)),this.updateSelection(a),c&&this.triggerChange({added:a,removed:b})):this.clear(c)}});E=C(s,{createContainer:function(){return e(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html("<ul class='select2-choices'>  <li class='select2-search-field'>    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>  </li></ul><div class='select2-drop select2-drop-multi select2-display-none'>   <ul class='select2-results'>   </ul></div>")},
prepareOpts:function(){var a=this.parent.prepareOpts.apply(this,arguments),b=this;"select"===a.element.get(0).tagName.toLowerCase()?a.initSelection=function(a,d){var e=[];a.find("option").filter(function(){return this.selected}).each2(function(a,c){e.push(b.optionToData(c))});d(e)}:"data"in a&&(a.initSelection=a.initSelection||function(b,d){var g=B(b.val(),a.separator),f=[];a.query({matcher:function(b,c,d){(b=e.grep(g,function(b){return m(b,a.id(d))}).length)&&f.push(d);return b},callback:!e.isFunction(d)?
e.noop:function(){for(var b=[],c=0;c<g.length;c++)for(var e=g[c],j=0;j<f.length;j++){var k=f[j];if(m(e,a.id(k))){b.push(k);f.splice(j,1);break}}d(b)}})});return a},selectChoice:function(a){var b=this.container.find(".select2-search-choice-focus");if(!b.length||!(a&&a[0]==b[0]))b.length&&this.opts.element.trigger("choice-deselected",b),b.removeClass("select2-search-choice-focus"),a&&a.length&&(this.close(),a.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",a))},destroy:function(){e("label[for='"+
this.search.attr("id")+"']").attr("for",this.opts.element.attr("id"));this.parent.destroy.apply(this,arguments)},initContainer:function(){var a;this.searchContainer=this.container.find(".select2-search-field");this.selection=a=this.container.find(".select2-choices");var b=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",function(){b.search[0].focus();b.selectChoice(e(this))});this.search.attr("id","s2id_autogen"+A());e("label[for='"+this.opts.element.attr("id")+"']").attr("for",
this.search.attr("id"));this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())}));this.search.attr("tabindex",this.elementTabIndex);this.keydowns=0;this.search.on("keydown",this.bind(function(b){var d,g;if(this.isInterfaceEnabled()){++this.keydowns;var h=a.find(".select2-search-choice-focus"),l=h.prev(".select2-search-choice:not(.select2-locked)"),i=h.next(".select2-search-choice:not(.select2-locked)");d=this.search;d=e(d)[0];var k=0;g=0;"selectionStart"in
d?(k=d.selectionStart,g=d.selectionEnd-k):"selection"in document&&(d.focus(),k=document.selection.createRange(),g=document.selection.createRange().text.length,k.moveStart("character",-d.value.length),k=k.text.length-g);d=k;if(h.length&&(b.which==f.LEFT||b.which==f.RIGHT||b.which==f.BACKSPACE||b.which==f.DELETE||b.which==f.ENTER))g=h,b.which==f.LEFT&&l.length?g=l:b.which==f.RIGHT?g=i.length?i:null:b.which===f.BACKSPACE?(this.unselect(h.first()),this.search.width(10),g=l.length?l:i):b.which==f.DELETE?
(this.unselect(h.first()),this.search.width(10),g=i.length?i:null):b.which==f.ENTER&&(g=null),this.selectChoice(g),j(b),(!g||!g.length)&&this.open();else if((b.which===f.BACKSPACE&&1==this.keydowns||b.which==f.LEFT)&&0==d&&!g)this.selectChoice(a.find(".select2-search-choice:not(.select2-locked)").last()),j(b);else{this.selectChoice(null);if(this.opened())switch(b.which){case f.UP:case f.DOWN:this.moveHighlight(b.which===f.UP?-1:1);j(b);return;case f.ENTER:this.selectHighlighted();j(b);return;case f.TAB:this.selectHighlighted({noFocus:!0});
this.close();return;case f.ESC:this.cancel(b);j(b);return}b.which===f.TAB||f.isControl(b)||f.isFunctionKey(b)||b.which===f.BACKSPACE||b.which===f.ESC||b.which===f.ENTER&&(!1===this.opts.openOnEnter||b.altKey||b.ctrlKey||b.shiftKey||b.metaKey)||(this.open(),(b.which===f.PAGE_UP||b.which===f.PAGE_DOWN)&&j(b),b.which===f.ENTER&&j(b))}}}));this.search.on("keyup",this.bind(function(){this.keydowns=0;this.resizeSearch()}));this.search.on("blur",this.bind(function(a){this.container.removeClass("select2-container-active");
this.search.removeClass("select2-focused");this.selectChoice(null);this.opened()||this.clearSearch();a.stopImmediatePropagation();this.opts.element.trigger(e.Event("select2-blur"))}));this.container.on("click",".select2-choices",this.bind(function(a){this.isInterfaceEnabled()&&!(0<e(a.target).closest(".select2-search-choice").length)&&(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.open(),
this.focusSearch(),a.preventDefault())}));this.container.on("focus",".select2-choices",this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,
arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch());if(this.select||""!==this.opts.element.val()){var a=this;this.opts.initSelection.call(null,this.opts.element,function(b){if(b!==void 0&&b!==null){a.updateSelection(b);a.close();a.clearSearch()}})}},clearSearch:function(){var a=this.getPlaceholder(),b=this.getMaxSearchWidth();void 0!==a&&
0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(a).addClass("select2-default"),this.search.width(0<b?b:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder();this.resizeSearch();this.parent.opening.apply(this,arguments);this.focusSearch();this.updateResults(!0);this.search.focus();this.opts.element.trigger(e.Event("select2-open"))},
close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close();this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(a){var b=[],c=[],d=this;e(a).each(function(){0>k(d.id(this),b)&&(b.push(d.id(this)),c.push(this))});a=c;this.selection.find(".select2-search-choice").remove();e(a).each(function(){d.addSelectedChoice(this)});d.postprocessResults()},tokenize:function(){var a=this.search.val(),a=this.opts.tokenizer.call(this,
a,this.data(),this.bind(this.onSelect),this.opts);null!=a&&void 0!=a&&(this.search.val(a),0<a.length&&this.open())},onSelect:function(a,b){this.triggerSelect(a)&&(this.addSelectedChoice(a),this.opts.element.trigger({type:"selected",val:this.id(a),choice:a}),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(a,!1,!0===this.opts.closeOnSelect),this.opts.closeOnSelect?(this.close(),this.search.width(10)):0<this.countSelectableResults()?(this.search.width(10),this.resizeSearch(),0<this.getMaximumSelectionSize()&&
this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:a}),(!b||!b.noFocus)&&this.focusSearch())},cancel:function(){this.close();this.focusSearch()},addSelectedChoice:function(a){var b=!a.locked,c=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),d=e("<li class='select2-search-choice select2-locked'><div></div></li>"),
c=b?c:d,d=this.id(a),f=this.getVal(),h;h=this.opts.formatSelection(a,c.find("div"),this.opts.escapeMarkup);void 0!=h&&c.find("div").replaceWith("<div>"+h+"</div>");h=this.opts.formatSelectionCssClass(a,c.find("div"));void 0!=h&&c.addClass(h);if(b)c.find(".select2-search-choice-close").on("mousedown",j).on("click dblclick",this.bind(function(a){this.isInterfaceEnabled()&&(e(a.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(a.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");
this.close();this.focusSearch()})).dequeue(),j(a))})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))}));c.data("select2-data",a);c.insertBefore(this.searchContainer);f.push(d);this.setVal(f)},unselect:function(a){var b=this.getVal(),c,d,a=a.closest(".select2-search-choice");if(0===a.length)throw"Invalid argument: "+a+". Must be .select2-search-choice";if(c=a.data("select2-data")){for(;0<=
(d=k(this.id(c),b));)b.splice(d,1),this.setVal(b),this.select&&this.postprocessResults();b=e.Event("select2-removing");b.val=this.id(c);b.choice=c;this.opts.element.trigger(b);b.isDefaultPrevented()||(a.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(c),choice:c}),this.triggerChange({removed:c}))}},postprocessResults:function(a,b,c){var d=this.getVal(),b=this.results.find(".select2-result"),e=this.results.find(".select2-result-with-children"),f=this;b.each2(function(a,b){var c=
f.id(b.data("select2-data"));0<=k(c,d)&&(b.addClass("select2-selected"),b.find(".select2-result-selectable").addClass("select2-selected"))});e.each2(function(a,b){!b.is(".select2-result-selectable")&&0===b.find(".select2-result-selectable:not(.select2-selected)").length&&b.addClass("select2-selected")});-1==this.highlight()&&!1!==c&&f.highlight(0);!this.opts.createSearchChoice&&0<!b.filter(".select2-result:not(.select2-selected)").length&&(!a||a&&!a.more&&0===this.results.find(".select2-no-results").length)&&
r(f.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+f.opts.formatNoMatches(f.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-(this.search.outerWidth(!1)-this.search.width())},resizeSearch:function(){var a,b,c,d,f=this.search.outerWidth(!1)-this.search.width();a=this.search;v||(c=a[0].currentStyle||window.getComputedStyle(a[0],null),v=e(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",
display:"none",fontSize:c.fontSize,fontFamily:c.fontFamily,fontStyle:c.fontStyle,fontWeight:c.fontWeight,letterSpacing:c.letterSpacing,textTransform:c.textTransform,whiteSpace:"nowrap"}),v.attr("class","select2-sizer"),e("body").append(v));v.text(a.val());a=v.width()+10;b=this.search.offset().left;c=this.selection.width();d=this.selection.offset().left;b=c-(b-d)-f;b<a&&(b=c-f);40>b&&(b=c-f);0>=b&&(b=a);this.search.width(Math.floor(b))},getVal:function(){var a;if(this.select)return a=this.select.val(),
null===a?[]:a;a=this.opts.element.val();return B(a,this.opts.separator)},setVal:function(a){var b;this.select?this.select.val(a):(b=[],e(a).each(function(){0>k(this,b)&&b.push(this)}),this.opts.element.val(0===b.length?"":b.join(this.opts.separator)))},buildChangeDetails:function(a,b){for(var b=b.slice(0),a=a.slice(0),c=0;c<b.length;c++)for(var d=0;d<a.length;d++)m(this.opts.id(b[c]),this.opts.id(a[d]))&&(b.splice(c,1),0<c&&c--,a.splice(d,1),d--);return{added:b,removed:a}},val:function(a,b){var c,
d=this;if(0===arguments.length)return this.getVal();c=this.data();c.length||(c=[]);if(!a&&0!==a)this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),b&&this.triggerChange({added:this.data(),removed:c});else{this.setVal(a);if(this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),b&&this.triggerChange(this.buildChangeDetails(c,this.data()));else{if(void 0===this.opts.initSelection)throw Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,
function(a){var f=e.map(a,d.id);d.setVal(f);d.updateSelection(a);d.clearSearch();b&&d.triggerChange(d.buildChangeDetails(c,d.data()))})}this.clearSearch()}},onSortStart:function(){if(this.select)throw Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0);this.searchContainer.hide()},onSortEnd:function(){var a=[],b=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();
this.selection.find(".select2-search-choice").each(function(){a.push(b.opts.id(e(this).data("select2-data")))});this.setVal(a);this.triggerChange()},data:function(a,b){var c=this,d,f;if(0===arguments.length)return this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get();f=this.data();a||(a=[]);d=e.map(a,function(a){return c.opts.id(a)});this.setVal(d);this.updateSelection(a);this.clearSearch();b&&this.triggerChange(this.buildChangeDetails(f,this.data()))}});
e.fn.select2=function(){var a=Array.prototype.slice.call(arguments,0),b,c,d,f,h,j="val destroy opened open close focus isFocused container dropdown onSortStart onSortEnd enable disable readonly positionDropdown data search".split(" "),i=["opened","isFocused","container","dropdown"],m=["val","data"],o={search:"externalSearch"};this.each(function(){if(0===a.length||"object"===typeof a[0])b=0===a.length?{}:e.extend({},a[0]),b.element=e(this),"select"===b.element.get(0).tagName.toLowerCase()?h=b.element.prop("multiple"):
(h=b.multiple||!1,"tags"in b&&(b.multiple=h=!0)),c=h?new E:new D,c.init(b);else if("string"===typeof a[0]){if(0>k(a[0],j))throw"Unknown method: "+a[0];f=void 0;c=e(this).data("select2");if(void 0!==c&&(d=a[0],"container"===d?f=c.container:"dropdown"===d?f=c.dropdown:(o[d]&&(d=o[d]),f=c[d].apply(c,a.slice(1))),0<=k(a[0],i)||k(a[0],m)&&1==a.length))return!1}else throw"Invalid arguments to select2 plugin: "+a;});return void 0===f?this:f};e.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,
openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(a,b,c,d){b=[];I(a.text,c.term,b,d);return b.join("")},formatSelection:function(a,b,c){return a?c(a.text):void 0},sortResults:function(a){return a},formatResultCssClass:function(){},formatSelectionCssClass:function(){},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(a,b){var c=b-a.length;return"Please enter "+c+" more character"+(1==c?"":"s")},formatInputTooLong:function(a,
b){var c=a.length-b;return"Please delete "+c+" character"+(1==c?"":"s")},formatSelectionTooBig:function(a){return"You can only select "+a+" item"+(1==a?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(a){return a.id},matcher:function(a,b){return 0<=w(""+b).toUpperCase().indexOf(w(""+a).toUpperCase())},separator:",",tokenSeparators:[],
tokenizer:P,escapeMarkup:J,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(a){return a},adaptDropdownCssClass:function(){return null},nextSearchTerm:function(){}};e.fn.select2.ajaxDefaults={transport:e.ajax,params:{type:"GET",cache:!1,dataType:"json"}};window.Select2={query:{ajax:K,local:L,tags:M},util:{debounce:H,markMatch:I,escapeMarkup:J,stripDiacritics:w},"class":{"abstract":s,single:D,multi:E}}}return{}}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-select2', location = 'node_modules/@atlassian/aui/src/js/aui/select2.js' */
("undefined"===typeof window?global:window).__bbb27ea36c055f1d1f9619a67388f866=function(){"use strict";var b=__2fd777cca7fe187ff4048afabed6a6b5,d=b&&b.__esModule?b:{"default":b};__1f8266a045326897dc01ded64d3814fa;var e=d.default.fn.select2;d.default.fn.auiSelect2=function(b){var c;if(d.default.isPlainObject(b)){var a=d.default.extend({},b);c=a.hasAvatar?" aui-has-avatar":"";a.containerCssClass="aui-select2-container"+c+(a.containerCssClass?" "+a.containerCssClass:"");a.dropdownCssClass="aui-select2-drop aui-dropdown2 aui-style-default"+
c+(a.dropdownCssClass?" "+a.dropdownCssClass:"");c=Array.prototype.slice.call(arguments,1);c.unshift(a)}else c=arguments.length?arguments:[{containerCssClass:"aui-select2-container",dropdownCssClass:"aui-select2-drop aui-dropdown2 aui-style-default"}];return e.apply(this,c)};return{}}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:blueprint-resources', location = 'assets/core/js/playsql-common.js' */
(function($){
    window.PlaySQL = window.PlaySQL || {};

    window.PlaySQL.Helpers = window.PlaySQL.Helpers || {};
    window.PlaySQL.Helpers.generateKey = function (name, defaultCase) {
        var diacritics = {
            "A": /[\300-\306]/g,
            "a": /[\340-\346]/g,
            "E": /[\310-\313]/g,
            "e": /[\350-\353]/g,
            "I": /[\314-\317]/g,
            "i": /[\354-\357]/g,
            "O": /[\322-\330]/g,
            "o": /[\362-\370]/g,
            "U": /[\331-\334]/g,
            "u": /[\371-\374]/g,
            "N": /[\321]/g,
            "n": /[\361]/g,
            "C": /[\307]/g,
            "c": /[\347]/g
        };
        var result = name;
        for (var d in diacritics) {
            result = result.replace(diacritics[d], d);
        }
        if (defaultCase == "UPPER") {
            result = result.toUpperCase();
        } else if (defaultCase == "LOWER") {
            result = result.toLowerCase();
        } else {
            throw "Unknown case: " + defaultCase;
        }
        result = result
            .replace(/[- =+\/\\]/g, '')
            .replace(/[^a-zA-Z0-9_]/g, '')
            .replace(/^[_0-9]+|_$/g, '');

        return result;
    };

    AJS.$(function(){
        AJS.$(".playsql-query-placeholder table[data-query-editor-url] thead tr.playsql-col-headers th a").first().each(function(){
            var $this = $(this),
                href = $this.closest("table").attr("data-query-editor-url");
            if (href) $this.attr("href", href);
        });
    });

    window.PlaySQL.Helpers.parseOrderByClause = function(clause) {
        var parsed = [],
            lengthParsed = 0,
            part, oPart;
        while (part = getNextExpression(clause.substr(lengthParsed), ',')) {
            lengthParsed += part.length;
            if (part.length == 0) break;
            oPart = {
                expression: part
            };
            chop(oPart, ',');
            chop(oPart, 'FIRST');
            chop(oPart, 'LAST');
            chop(oPart, 'NULLS');
            chop(oPart, 'ASC');
            chop(oPart, 'DESC');
            parsed.push({
                field: $.trim(oPart.expression),
                way: oPart.ASC ? "ASC" : oPart.DESC ? "DESC" : undefined,
                nulls: oPart.FIRST ? "FIRST" : oPart.LAST ? "LAST" : undefined
            });
        }
        return parsed;
    }

    window.PlaySQL.Helpers.parseSelectClause = function(clause) {
        var result = ["SELECT"],
            expression,
            eaten = "SELECT".length;
        while ((expression = getNextExpression(clause.substr(eaten+1), ",")).length > 0) {
            eaten += expression.length;
            result.push({
                def: chop($.trim(expression), ",")
            });
        }
        return result;
    }

    var FROM_OPERATORS = ["LEFT JOIN", "RIGHT JOIN", "FULL JOIN",
        "LEFT OUTER JOIN", "RIGHT OUTER JOIN", "FULL OUTER JOIN",
        "INNER JOIN", "JOIN", "CROSS JOIN"];
    function getOperator(text) {
        for (var i = 0; i < FROM_OPERATORS.length; i++)
            if (text.indexOf(FROM_OPERATORS[i]) == 0)
                return FROM_OPERATORS[i];
        return undefined;
    }

    window.PlaySQL.Helpers.parseFromClause = function(clause) {
        var parts = splitKeywords.apply(this, [clause.substr("FROM".length)].concat(FROM_OPERATORS)),
            expression;
        // Split FROM clauses when there are commas
        for (var i = 0; i < parts.length; i++) {
            var fromPart = parts[i],
                eaten = 0,
                result = [];
            if (fromPart.indexOf(",") != -1) {
                while ((expression = getNextExpression(fromPart.substr(eaten), ",")).length > 0) {
                    eaten += expression.length;
                    result.push($.trim(expression));
                }
                if (result.length > 1) {
                    parts.splice(i, 1);
                    for (var k = result.length - 1; k >= 0; k--) {
                        parts.splice(i, 0, result[k]);
                    }
                }
            }
        }
        for (var i = 0; i < parts.length; i++) {
            var part = $.trim(parts[i]),
                operator = getOperator(part),
                afterOperator = $.trim(part.substr(operator == undefined ? 0 : operator.length)),
                tableDef = getNextExpression(afterOperator, " "),
                aliasAndCriteria = tableDef.length < afterOperator.length ? $.trim(afterOperator.substr(tableDef.length)) : undefined,
                criteria = aliasAndCriteria != undefined ? splitKeywords(aliasAndCriteria, "ON") : undefined;
            parts[i] = {
                operator : operator,
                def: $.trim(tableDef),
                alias: criteria && $.trim(criteria[0]),
                criteria: criteria && criteria.length > 1 ? criteria.slice(1).join(" ") : undefined
            };
        }
        parts.unshift("FROM");
        return parts;
    }

    window.PlaySQL.Helpers.buildOrderByClause = function(parsed) {
        var elements = parsed.map(function(p){
            var expression = p.field;
            if (p.way) expression+= ' ' + p.way;
            if (p.nulls) expression+= ' NULLS ' + p.nulls;
            return expression;
        });
        return elements.join(", ");
    }

    function chop(oPart, lastWord) {
        if (typeof oPart != "object") {
            oPart = {expression: oPart};
        }

        var trimmed = $.trim(oPart.expression);
        if (trimmed.substr(trimmed.length - lastWord.length).toLowerCase() == lastWord.toLowerCase()) {
            oPart.expression = $.trim(trimmed.substr(0, trimmed.length - lastWord.length));
            oPart[lastWord] = true;
        } else {
            oPart[lastWord] = false;
        }
        return oPart.expression;
    }

    /** Gets the next full expression, without entering into parenthesis or quotes */
    function getNextExpression(clause, delimiter) {
        var expression = '',
            next,
            delimiterNN = delimiter != null ? delimiter.charAt(0) : undefined;
        for (var i = 0 ; i < clause.length ; i++) {
            expression += clause.charAt(i);
            next = clause.charAt(i);
            switch (next) {
                // HERE we should check for comments "--.*\n"
                case "(":
                    expression += getNextExpression(clause.substr(i+1), ')');
                    i = expression.length - 1;
                    break;
                case "'":
                    expression += getString(clause.substr(i+1), "'");
                    i = expression.length - 1;
                    break;
                case "\"":
                    expression += getString(clause.substr(i+1), "\"");
                    i = expression.length - 1;
                    break;
                case delimiterNN:
                    if (clause.substr(i, delimiter.length) == delimiter) {
                        return expression;
                    }
                    break;
            }
        }
        return expression;
    }

    function getString(clause, end) {
        var escaped = false,
            expression = '',
            next;
        for (var i = 0; i < clause.length; i++) {
            next = clause.charAt(i);
            if (escaped) {
                escaped = false;
            } else if (clause.substr(i, end.length) == end) {
                expression += end;
                return expression;
            } else if (next == '\\') {
                escaped = true;
            }
            expression += next;
        }
        return expression;
    }

    function splitKeywords(text, keyword1, keywordn) {
        var keywords = Array.prototype.slice.call(arguments, 1),
            NON_ALPHANUM = /[^a-zA-Z0-9_]/;
        for (var i in keywords) {
            var keyword = keywords[i];
            // Find all keywords in the string. If any is valid, split the work in 2.
            var position = 0;
            while ((position = text.toLowerCase().indexOf(keyword.toLowerCase(), position+1)) > 0) {
                // If we're matching the first letters of the text, we might be matching a keyword that's already complete
                var isSubKeyword = false;
                for (var j = 0; j < i; j++) {
                    var positionOfSubKeyword = keywords[j].indexOf(keyword);
                    if (positionOfSubKeyword == position) {
                        // Bingo, our keyword is part of keyword j, and keyword j starts at the beginning of text
                        isSubKeyword = true;
                        break;
                    }
                }
                if (isSubKeyword) continue;

                // If it's a full word
                if (NON_ALPHANUM.test(text.charAt(position-1))
                    && (text.length <= (position + keyword.length)
                    || NON_ALPHANUM.test(text.charAt(position + keyword.length)))) {
                    var firstHalf = text.substr(0, position),
                        secondHalf = text.substr(position),
                        firstChops = splitKeywords.apply(this, [firstHalf].concat(keywords)),
                        secondChops = splitKeywords.apply(this, [secondHalf].concat(keywords));
                    // We've split the array recursively. Just return.
                    return firstChops.concat(secondChops);
                }
            }
        }
        // Keywords not found
        return [text];
    }

    function isBalanced(expression) {
        var test = expression + "))";
        return getNextExpression(test, ")").length != test.length;
    }

    function mergeIncompleteExpressions(parts) {
        var result = [];
        for (var i = 0 ; i < parts.length ; i++) {
            var expression = parts[i];
            while (!isBalanced(expression)) {
                // Merge one more element
                i++;
                if (i >= parts.length) {
                    break;
                }
                expression += parts[i];
            }
            result.push(expression);
        }
        return result;
    }

    window.PlaySQL.Helpers.rebuildSQL = function(parsedSQL) {
        var result = "";
        for (var i = 0 ; i < parsedSQL.length ; i++) {
            var part = parsedSQL[i];
            if (part == undefined || part.length == 0) continue;
            if (part[0] == "SELECT") {
                result += "\n" + part[0];
                for (var j = 1; j < part.length; j++) {
                    var field = part[j];
                    if (j>1) result += ", ";
                    if (field.def != undefined) result += " " + field.def;
                    if (field.alias != undefined) result += " " + field.alias;
                }
            } else if (part[0] == "FROM") {
                result += "\n" + part[0];
                for (var j = 1; j < part.length; j++) {
                    var field = part[j];
                    if (j>1) result += "\n    ";
                    if (field.operator != undefined) result += " " + field.operator;
                    if (field.def != undefined) result += " " + field.def;
                    if (field.alias != undefined) result += " " + field.alias;
                    if (field.criteria != undefined) result += " " + field.criteria;
                }
            } else if (part.length > 1 && part[0] == "--" && part[1] == "Bilinear:") {
                // Do not insert that
            } else {
                result += "\n" + part[0];
                if (part.length > 0) {
                    result += " " + part.slice(1).join(" ");
                }
            }
        }
        return $.trim(result);
    }

    window.PlaySQL.Helpers.isSQLEqual = function(sql1, sql2) {
        if (typeof sql1 == "object") {
            sql1 = window.PlaySQL.Helpers.rebuildSQL(sql1);
        }
        if (typeof sql2 == "object") {
            sql2 = window.PlaySQL.Helpers.rebuildSQL(sql2);
        }
        sql1 = $.trim(sql1.replace(/\s+/g, ' '));
        sql2 = $.trim(sql2.replace(/\s+/g, ' '));
        return sql1 == sql2;
    }

    var SQL_ROOT_KEYWORDS = ["SELECT", "FROM", "WHERE", "ORDER BY", "GROUP BY", "HAVING", "LIMIT", "OFFSET", "--"];
    var SQL_ROOT_KEYWORDS_AND_ROWSTARTERS = SQL_ROOT_KEYWORDS.concat(["--"]);

    window.PlaySQL.Helpers.parseSQL = function(sql) {
        var parts = splitKeywords.apply(this, [sql].concat(SQL_ROOT_KEYWORDS_AND_ROWSTARTERS)),
            result = [];
        parts = mergeIncompleteExpressions(parts);
        for (var i in parts) {
            var part = parts[i],
                partUpper = part.toUpperCase();
            if (partUpper.indexOf("SELECT") == 0) {
                result.push(window.PlaySQL.Helpers.parseSelectClause(part));
            } else if (partUpper.indexOf("FROM") == 0) {
                result.push(window.PlaySQL.Helpers.parseFromClause(part));
            } else if (partUpper.indexOf("WHERE") == 0) {
                result.push([part.substr(0, "WHERE".length), part.substr("WHERE".length)]);
            } else if (partUpper.indexOf("ORDER BY") == 0) {
                result.push([part.substr(0, "ORDER BY".length), part.substr("ORDER BY".length)]);
            } else if (partUpper.indexOf("GROUP BY") == 0) {
                result.push([part.substr(0, "GROUP BY".length), part.substr("GROUP BY".length)]);
            } else {
                result.push([part]);
            }
        }

        try {
            var isBilinear = window.PlaySQL.Helpers.isSQLEqual(sql, result) ? "true" : "false";
            isBilinear = isBilinear
            && result.length > 1
            && result[0][0] == "SELECT"
            && result[1][0] == "FROM";
            result.push(["--", "Bilinear:", isBilinear]);
            result.bilinear = isBilinear;
        } catch (err) {
            // Do nothing
        }

        /** Get or set the clause */
        result.clause = function(clauseName, value) {
            for (var i = 0; i < this.length; i++) {
                if (this[i].length > 1 && this[i][0] == clauseName) {
                    // If the value is set... and if it's not already the value.
                    if (value != undefined && value !== this[i]) {
                        this[i].splice(0, this[i].length, value);
                    }
                    return this[i];
                }
            }
            if (value != undefined) {
                // Find a spot for it
                var keywordId = SQL_ROOT_KEYWORDS.indexOf(clauseName);
                if (keywordId == -1) {
                    this.push(value);
                    return this[this.length-1];
                } else {
                    // Try putting it before any next keyword
                    while (++keywordId < SQL_ROOT_KEYWORDS.length) {
                        for (var i = 0; i < this.length; i++) {
                            if (this[i].length > 1 && this[i][0] == clauseName) {
                                this.splice(i, 0, value);
                                return this[i];
                            }
                        }
                    }
                    // Not found. Append at the end.
                    this.push(value);
                    return this[this.length-1];
                }
            }
            return undefined;
        }

        return result;
    }

    window.PlaySQL.base64_decode = function (data) {
        // http://kevin.vanzonneveld.net
        // +   original by: Tyler Akins (http://rumkin.com)
        // +   improved by: Thunder.m
        // +      input by: Aman Gupta
        // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // +   bugfixed by: Onno Marsman
        // +   bugfixed by: Pellentesque Malesuada
        // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // +      input by: Brett Zamir (http://brett-zamir.me)
        // +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
        // *     example 1: base64_decode('S2V2aW4gdmFuIFpvbm5ldmVsZA==');
        // *     returns 1: 'Kevin van Zonneveld'
        // mozilla has this native
        // - but breaks in 2.0.0.12!
        //if (typeof this.window['atob'] === 'function') {
        //    return atob(data);
        //}
        var b64 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
        var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,
            ac = 0,
            dec = "",
            tmp_arr = [];

        if (!data) {
            return data;
        }

        data += '';

        do { // unpack four hexets into three octets using index points in b64
            h1 = b64.indexOf(data.charAt(i++));
            h2 = b64.indexOf(data.charAt(i++));
            h3 = b64.indexOf(data.charAt(i++));
            h4 = b64.indexOf(data.charAt(i++));

            bits = h1 << 18 | h2 << 12 | h3 << 6 | h4;

            o1 = bits >> 16 & 0xff;
            o2 = bits >> 8 & 0xff;
            o3 = bits & 0xff;

            if (h3 == 64) {
                tmp_arr[ac++] = String.fromCharCode(o1);
            } else if (h4 == 64) {
                tmp_arr[ac++] = String.fromCharCode(o1, o2);
            } else {
                tmp_arr[ac++] = String.fromCharCode(o1, o2, o3);
            }
        } while (i < data.length);

        dec = tmp_arr.join('');

        return dec;
    };


    /*
     Copyright Vassilis Petroulias [DRDigit]

     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
     */
    var B64 = {
        alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',
        lookup: null,
        ie: /MSIE /.test(navigator.userAgent),
        ieo: /MSIE [67]/.test(navigator.userAgent),
        decode: function (s) {
            var buffer = B64.fromUtf8(s),
                position = 0,
                len = buffer.length;
            if (B64.ieo) {
                result = [];
                while (position < len) {
                    if (buffer[position] < 128) result.push(String.fromCharCode(buffer[position++]));
                    else if (buffer[position] > 191 && buffer[position] < 224) result.push(String.fromCharCode(((buffer[position++] & 31) << 6) | (buffer[position++] & 63)));
                    else result.push(String.fromCharCode(((buffer[position++] & 15) << 12) | ((buffer[position++] & 63) << 6) | (buffer[position++] & 63)));
                }
                return result.join('').replace(/\0/g,"");
            } else {
                result = '';
                while (position < len) {
                    if (buffer[position] < 128) result += String.fromCharCode(buffer[position++]);
                    else if (buffer[position] > 191 && buffer[position] < 224) result += String.fromCharCode(((buffer[position++] & 31) << 6) | (buffer[position++] & 63));
                    else result += String.fromCharCode(((buffer[position++] & 15) << 12) | ((buffer[position++] & 63) << 6) | (buffer[position++] & 63));
                }
                return result.replace(/\0/g,"");
            }
        },
        fromUtf8: function (s) {
            var position = -1,
                len, buffer = [],
                enc = [undefined, undefined, undefined, undefined];
            if (!B64.lookup) {
                len = B64.alphabet.length;
                B64.lookup = {};
                while (++position < len)
                    B64.lookup[B64.alphabet[position]] = position;
                position = -1;
            }
            len = s.length;
            while (position < len) {
                enc[0] = B64.lookup[s.charAt(++position)];
                enc[1] = B64.lookup[s.charAt(++position)];
                buffer.push((enc[0] << 2) | (enc[1] >> 4));
                enc[2] = B64.lookup[s.charAt(++position)];
                if (enc[2] == 64) break;
                buffer.push(((enc[1] & 15) << 4) | (enc[2] >> 2));
                enc[3] = B64.lookup[s.charAt(++position)];
                if (enc[3] == 64) break;
                buffer.push(((enc[2] & 3) << 6) | enc[3]);
            }
            return buffer;
        }
    };
    window.PlaySQL.B64 = B64;

    window.PlaySQL.Totals = window.PlaySQL.Totals || {};


    function getTotal(totalsData, index, value) {
        if (typeof index == "object") {
            value = index;
            index = undefined;
        }
        if (value != undefined) {
            if (index == undefined) {
                totalsData = value;
            } else {
                while (totalsData.length < index) {
                    totalsData.push({});
                }
                if (totalsData.length == index) {
                    totalsData.push(value);
                } else {
                    totalsData[index] = value;
                }
            }
        }
        if (index == undefined) {
            return totalsData;
        } else {
            return totalsData.length > index ? totalsData[index] : undefined;
        }
    }

    window.PlaySQL.Totals.editTotal = function (totalsData, $cell) {
        $cell.attr('data-rendered', $cell.html());
        var index = $cell.index() - 1,
            value = getTotal(totalsData, index),
            label = value && value.label || "",
            calculation = value && value.calculation || "";
        $cell.addClass("editing selected focused")
            .html(Confluence.Templates.PlaySQL.editTotalsCell({
                label: label,
                calculation: calculation}));
        $cell.find("input:first").focus();
        return false;
    };
    window.PlaySQL.Totals.addTotal = function(totals, $cell, position) {
        if (totals == undefined || totals.length == 0) return;
        var index = $cell.index() - 1,
            colspan = parseInt($cell.attr('colspan')),
            thisTotal = totals[index];
        if (colspan == undefined || colspan > 1) {
            if (colspan == undefined ) colspan = 2;
            colspan--;
            $cell.attr('colspan', colspan)
                .removeClass("selected focused");
            thisTotal.colspan = colspan;
            // This is inserting a copy of the total
            totals.splice(position < 0 ? index : index + 1, 0, thisTotal);
            // Insert cell on the side
            var $newCell = $("<td></td>");
            if (position < 0) $newCell.insertBefore($cell);
            else $newCell.insertAfter($cell);
            // Edit the cell
            window.PlaySQL.Totals.editTotal(totals, $newCell);
        } else {
            // How come the menu was proposed for a non-spanned cell?
        }
    };
    window.PlaySQL.Totals.removeTotal = function(totals, $cell, callbackSaveTotals) {
        var index = $cell.index() - 1,
            colspan = parseInt($cell.attr('colspan')),
            adjacentIndex = index > 0 ? index-1 : totals.length > 1 ? 1 : undefined,
            adjacentTotal = adjacentIndex != undefined ? totals[adjacentIndex] : undefined,
            $adjacentCell = adjacentIndex == undefined ? undefined : adjacentIndex > index ? $cell.next() : $cell.prev();
        if (adjacentIndex != undefined) {
            adjacentTotal.colspan = (parseInt($adjacentCell.attr('colspan')) || 1) + colspan;
            $adjacentCell.attr('colspan', adjacentTotal.colspan);
            $cell.remove();
        } else {
            // Just blank it out
            $cell.empty();
        }
        totals.splice(index, 1);
        if (callbackSaveTotals) callbackSaveTotals();
    };
    window.PlaySQL.Totals.saveTotal = function(totals, $cell) {
        window.PlaySQL.Selection.inlineDialog && window.PlaySQL.Selection.inlineDialog.hide();
        var index = $cell.index() - 1,
            value = {
                label : $cell.find("input.totals-label").val(),
                calculation : $cell.find("input.totals-calculation").val(),
                colspan : $cell.attr('colspan'),
                name : "totals_" + index
            };
        $cell.empty().attr("data-label", value.label)
            .attr("data-calculation", value.calculation)
            .attr("colspan", value.colspan)
            .attr("data-name", value.name)
            .text(value.label)
            .removeClass("editing")
            .append($("<em></em>").text(" =" + value.calculation));
        totals[index] = value;
    };
    /** Update the span records of the totals and pagination */
    window.PlaySQL.Totals.updateColspans = function(totals, $placeholder) {
        if (totals == null) return;
        // 1. The Totals
        var $cells = $placeholder.find("tfoot .totals-row td:not(.right-padding)");
        if (totals.length == 0) return;
        if (totals.length < $cells.length) {
            throw "Totals: A model is missing... $1 models and $2 cells."
                .replace("$1", totals.length)
                .replace("$2", $cells.length);
        } else if (totals.length > $cells.length) {
            totals.splice(0, totals.length - $cells.length);
        }
        var totalSpan = 0,
            totalHeaderSpan = $placeholder.find("thead tr.playsql-col-headers th:not(:first-child):not(.add-column)").size(),
            span;
        for (var i = 0 ; i < totals.length ; i++) {
            span = parseInt($cells.eq(i).attr("colspan")) || 1;
            totals[i].colspan = span;
            totalSpan += span;
        }
        var diff = totalSpan - totalHeaderSpan;
        if (totals.length > 0 && diff < 0) {
            totals[0].colspan += Math.abs(diff);
        } else if (diff > 0) {
            $cells.each(function(i) {
                var $cell = $(this),
                    span = parseInt($cell.attr("colspan")) || 1,
                    exchange;
                if (span >= 1 + diff) {
                    exchange = span - Math.max(1, span - diff);
                    span = span - exchange;
                    diff = diff - exchange;
                    // Update the real life
                    $cell.attr("colspan", span);
                    totals[i].colspan = span;
                }
            });
        }
        // 2. The pagination
        // Beware, there are two pagination rows
        var $paginations = $placeholder.find(".pagination-row td:not(.right-padding)");
        $paginations.attr("colspan", totalHeaderSpan);
    };

    var replaceBuiltInVariablesCache = undefined;
    window.PlaySQL.Helpers.replaceBuiltInVariables = function(value) {
        if (value == null || value.indexOf("$") == -1) return value;
        if (!replaceBuiltInVariablesCache) {
            replaceBuiltInVariablesCache = {
                "$pageId": AJS.Meta.get("page-id"),
                "$spaceKey": AJS.Meta.get("space-key"),
                "$pageTitle": AJS.Meta.get("page-title"),
                "$userFullName": AJS.Meta.get("user-display-name"),
                "$user": AJS.Meta.get("remote-user")
            };
        }
        for (var key in replaceBuiltInVariablesCache) {
            value = value.replace(key, replaceBuiltInVariablesCache[key]);
        }
        return value;
    };

    window.PlaySQL.Helpers.hasMinVersion = function(minVersion) {
        var version = AJS.Meta.get("version-number"),
            verT = version.split(/\./),
            minT = minVersion.split(/\./);

        if (verT.length < 3) return true;
        if (minT.length != 3) throw "Can't recognize version number: " + minVersion;

        for (var i = 0 ; i < 3 ; i++) {
            if (parseInt(verT[i]) < parseInt(minT[i])) return false;
            if (parseInt(verT[i]) > parseInt(minT[i])) return true;
        }
        return true;
    }

    window.PlaySQL.Helpers.parsePerms = function(perms) {
        var result = [];
        if (!perms) return result;
        if (typeof perms === "string") {
            perms = perms.split(/[ ,]+/);
        }
        for (var i = 0 ; i < perms.length ; i++) {
            if (perms[i] == 'EDIT')
                perms.push('VIEW', 'ADD_ROWS', 'EDIT_CELLS', 'REMOVE_ROWS', 'EDIT_ROWS_METADATA', 'Q_VIEW_EDIT');
            if (perms[i] == 'ADMIN_COLS')
                perms.push('EDIT', 'EDIT_TOTALS', 'ADD_COLS', 'EDIT_COLS_FE', 'EDIT_COLS_BE', 'REMOVE_COLS');
            if (perms[i] == 'CONTEXT_ADMIN')
                perms.push('ADMIN_COLS', 'REMOVE_TABLE');
            if (perms[i] == 'Q_VIEW')
                perms.push('VIEW');
            if (perms[i] == 'Q_VIEW_EDIT')
                perms.push('Q_VIEW');
            if (perms[i] == 'Q_EDIT')
                perms.push('Q_VIEW_EDIT', 'EDIT_TOTALS', 'EDIT_COLS_FE');
            if (perms[i] == 'Q_SAVE')
                perms.push('Q_EDIT');
        }
        for (var i = 0 ; i < perms.length ; i++)
            if (result.indexOf(perms[i]) == -1)
                result.push(perms[i]);
        /**
         * Tells whether the user has a permission.
         * @param perm
         * @param column the column. Optional. Only provide the column if the permission is Q_VIEW_EDIT.
         * @returns {boolean}
         */
        result.hasPerm = function(perm, column) {
            var result = this.indexOf(perm) != -1;
            if (result && column
                && !column.formats["joint-id"]
                && !column.formats["joint-table"]) {
                // result = true, but this is not an editable column.
                return false;
            }
            return result;
        }
        return result;
    }

    window.PlaySQL.Helpers.intersect = function(perms1, perms2) {
        var result = [];
        for (var i in perms1) {
            if (perms2.indexOf(perms1[i]) != -1) {
                result.push(perms1[i]);
            }
        }
        if (!perms1.hasPerm) throw "window.PlaySQL.Helpers.intersect() requires authentic permissions as a first arg";
        result.hasPerm = perms1.hasPerm;
        return result;
    }

    window.PlaySQL.Helpers.parsePagination = function(pagination) {
        var offset = pagination && pagination.offset || 0,
            limit = pagination && pagination.limit || 20,// Can't be zero, so can't div/0
            count = pagination && pagination.count || 0,
            pageEnd = Math.min(offset + limit - 1, count - 1),
            lastPage = Math.floor((count - 1) / limit) * limit;
        // If it fits in 1 page, or if the user clicked "see all" (in which case limit = 1,000,000)
        if (count < limit && offset == 0 && limit < 100000) return null;
        // Everything is 0-based in this object, but please make it 1-based for text you display
        return {
            offset: offset,
            limit: limit,
            count: count, // 1-based.
            pageEnd: pageEnd, // 1-based
            firstPage: offset == 0 ? undefined : 0,
            previousPage: offset == 0 ? undefined : Math.max(0, (Math.floor(offset/limit)-1) * limit),
            nextPage: offset >= lastPage ? undefined : Math.min(lastPage, (Math.floor(offset/limit)+1) * limit),
            lastPage: offset >= lastPage ? undefined : lastPage
        };
    }

    window.PlaySQL.Helpers.escapeSqlString = function(string, dialect) {
        string = string.replace(/[\0\n\r\b\t\\'"\x1a]/g, function (s) {
            switch (s) {
                case "\0":
                    return "\\0";
                case "\n":
                    return "\\n";
                case "\r":
                    return "\\r";
                case "\b":
                    return "\\b";
                case "\t":
                    return "\\t";
                case "\x1a":
                    return "\\Z";
                case "'":
                    return "''";
                case '"':
                    return '""';
                default:
                    return "\\" + s;
            }
        });
        return string;
    }



    window.PlaySQL.Helpers.checkNotNull = function(value, message) {
        if (value == undefined) {
            throw "Unexpectedly undefined value: " + value + "(" + message + ")";
        }
        if (value instanceof $) {
            if (value.size() == 0)
                throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
        }
        return value;
    }

    /** Returns an explanation about the selection in the inputBox.
     * @param inputBox the box, not jquery
     * @param range the range. Optional. Default is window.getSelection().getRangeAt(0).
     * */
    window.PlaySQL.Helpers.caretSelection = function (inputBox, range) {
        // Here's why we check ![type="date"]: If it's an actual date field, we can't get the cursor's position.
        // However: If it's a date field and the AUI datePicker kicked in, it transformed the type to [text] and
        // we can get the position.
        if ($(inputBox).attr("type") == "date") {
            return {};
        }
        if (inputBox.nodeName == 'INPUT' || inputBox.nodeName == 'TEXTAREA') {
            if ('selectionStart' in inputBox) {
                // Standard-compliant browsers
                return {
                    position: inputBox.selectionStart,
                    length: inputBox.selectionEnd - inputBox.selectionStart
                }
            } else if (document.selection) {
                // IE
                var sel = document.selection.createRange();
                var selLen = document.selection.createRange().text.length;
                sel.moveStart('character', -inputBox.value.length);
                return {
                    position: sel.text.length - selLen,
                    length: selLength,
                    el: inputBox
                }
            }
        } else if (inputBox.contentEditable == "true" && window.getSelection) {
            if (!range) {
                range = window.getSelection && (window.getSelection().rangeCount > 0) && window.getSelection().getRangeAt(0);
            }
            if (!range) return {};
            var preSelectionRange = range.cloneRange();
            // Modify this copy of a range so we can count the number of selected characters and deduce the start position
            preSelectionRange.selectNodeContents(inputBox);
            preSelectionRange.setEnd(range.startContainer, range.startOffset);
            return {
                position: preSelectionRange.toString().length,
                length: range.toString().length,
                range: range,
                el: range.startContainer
            };
        }
    }

    /**
     * Sets the beginning or end of the range to the desired position,
     * even if the node is comprised of child nodes.
     *
     * It is generally used for a window.getSelection(), but strictly speaking only
     * ranges are involved here.
     *
     * @param methodName the method to set the range. Default is 'setEnd'.
     **/
    window.PlaySQL.Helpers.setSelection = function (range, node, index, methodName) {
        methodName = methodName || 'setEnd';
        if (node.nodeType == node.TEXT_NODE) {
            if (index >= 0) {
                range[methodName](node, index);
                return true;
            } else {
                range[methodName](node, 0);
                return false;
            }
        } else {
            var childNodes = node.childNodes;
            for (var i = 0 ; i < childNodes.length ; i++) {
                if (index == 0) {
                    range[methodName](childNodes[i], 0);
                    return true;
                } else if (childNodes[i].textContent.length > index) {
                    return window.PlaySQL.Helpers.setSelection(range, childNodes[i], index, methodName);
                } else {
                    index -= childNodes[i].textContent.length;
                }
            }
            // We didn't find the element. Selecting the max.
            var lastChild = childNodes[childNodes.length - 1];
            while (lastChild.childNodes.length > 0)
                lastChild = lastChild.childNodes[lastChild.childNodes.length - 1];
            range[methodName](lastChild, lastChild.textContent.length);
            return false;
        }
    }

    window.PlaySQL.Helpers.isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;

    /** Analyzes an event and returns a canonical human-understandable key */
    window.PlaySQL.Helpers.getKeyCombinationDetail = function(e) {
        var code = e.keyCode,
            key = String.fromCharCode(code).toLowerCase(),
            onKeyDown = true;
        switch (code) {
            case 8: key = "backspace"; break;
            case 9: key = "tab"; break;
            case 13: key = "enter"; /*onKeyDown = false;*/ break;
            case 27: key = "esc"; break;
            case 37: key = "left"; break;
            case 38: key = "up"; break;
            case 39: key = "right"; break;
            case 40: key = "down"; break;
            case 46: key = "delete"; break;
            case 112: key = "f1"; break;
            case 113: key = "f2"; break;
        }
        var modifiers = [];
        if (e.altKey) modifiers.push("alt");
        if (e.shiftKey) modifiers.push("shift");
        if (window.PlaySQL.Helpers.isMac) {
            if (e.metaKey) modifiers.push("control");
        } else {
            if (e.ctrlKey) modifiers.push("control");
        }

        return {
            code: code,
            key: key,
            modifiers: modifiers,
            onKeyDown: onKeyDown,
            canonical: (modifiers.length ? modifiers.join("+") + "+" : "") + key
        };
    }

    function strip(text, opening, closing, escape) {
        for (var i = 0 ; i < text.length ; i++) {
            if (text.charAt(i) == opening) {
                var j = i + 1;
                while (j < text.length) {
                    if (text.charAt(j) == closing) {
                        break;
                    } else if (closing != undefined && text.charAt(j) == escape && text.charAt(j+1) == closing) {
                        j += 2;
                    } else {
                        j++;
                    }
                }
                text = text.substr(0, i + 1) + text.substr(j);
                i++;
            }
        }
        return text;
    }
    /** Parse a formula and hopes to return the text being entered at the current
     * position, and the enclosing formula
     */
    window.PlaySQL.Helpers.parseFunctionAtCaret = function(text) {
        text = strip(text, "'", "'", "\\");
        var currentExpression = text.match(/[a-zA-Z][\.a-zA-Z0-9]*$/),
            parentFunctions = text.match(/[a-zA-Z][a-zA-Z0-9]*\(/g),
            parentFunction, argList, argCount, currentTable;
        if (parentFunctions) {
            parentFunction = parentFunctions[parentFunctions.length-1];
            argList = text.substr(text.lastIndexOf(parentFunction));
            argCount = (argList + ",").match(/,/g).length - 1;
        }
        currentExpression = currentExpression && currentExpression[0];
        currentTable = currentExpression && currentExpression.indexOf(".") != -1 && currentExpression.substr(0, currentExpression.indexOf("."));
        parentFunction = parentFunction && parentFunction.substr(0, parentFunction.length - 1);
        return {
            currentTable:currentTable,
            current:currentExpression,
            parentFn:parentFunction,
            argCount:argCount
        };
    }

    var functionList = {};
    window.PlaySQL.Helpers.getFunctionList = function(context, spreadsheetId, callback) {
        if (functionList[spreadsheetId]) return callback(functionList[spreadsheetId]);
        var url = PlaySQL.SPI.baseUrlOld("autocomplete", context, spreadsheetId, "functionList");
        $.ajax({
            url: url,
            type: 'GET',
            contentType: "application/json; charset=utf-8"
        }).done(function(data){
            data.constants = [
                { name: "TRUE", type: "Constant" },
                { name: "FALSE", type: "Constant" }
            ];
            functionList[spreadsheetId] = data;
            callback(data);
        }).fail(function(jqXHR, error, reason){
            AJS.log("Can't get autocomplete for function names");
        });
    }
    window.PlaySQL.Helpers.getAutocomplete = function(context, callback) {
        var url = PlaySQL.SPI.baseUrlOld("autocomplete/" + context);
        $.ajax({
            url: url,
            type: 'GET',
            contentType: "application/json; charset=utf-8"
        }).done(function(data){
            callback(data);
        }).fail(function(jqXHR, error, reason){
            AJS.log("Can't get autocomplete for function names");
        });
    }

    // Fetch the source, for the default case-sensibility of the dialect
    window.PlaySQL.fetchContextProperties = function(fetchTableList, context, callback) {
        context = context || PlaySQL.SPI.contextForPage;
        if (!context) return;
        var url = PlaySQL.SPI.baseUrl(context);
        $.ajax({
            url: url,
            type: fetchTableList ? 'GET' : 'HEAD',
            contentType: "application/json; charset=utf-8"
        }).done(function (data, status, jqXHR) {
            var defaultCase = jqXHR.getResponseHeader("X-DIALECT_DEFAULT_CASE"),
                mode = jqXHR.getResponseHeader("X-MODE");
            callback && callback(jqXHR, defaultCase, mode);
        });
    }

    window.PlaySQL.createSpreadsheet = function(context, spreadsheet, copyId, defaultCase, successCallback, failureCallback) {
        if (!spreadsheet) throw "Spreadsheet expected";
        if (!spreadsheet.name) throw "Spreadsheet key expected";
        if (!spreadsheet.label) throw "Spreadsheet label expected";
        if (!spreadsheet.columns) {
            spreadsheet.columns = [{
                    name: (defaultCase == "UPPER" ? "FIRSTCOLUMN" : "firstcolumn"),
                    label: "First column",
                    type: "TEXT"
                }, {
                    name: (defaultCase == "UPPER" ? "SECONDCOLUMN" : "secondcolumn"),
                    label: "Second column",
                    type: "TEXT"
                }];
        }
        context = context || PlaySQL.SPI.contextForPage;
        if (context == undefined) {
            alert("The space where the spreadsheet must be created wasn't specified" );
            return;
        }
        var url = PlaySQL.SPI.baseUrl(context, spreadsheet.name);
        if (typeof copyId != "undefined") {
            url += "?copyOf=" + copyId;
        }
        AJS.$.ajax({
            url: url,
            type: 'PUT',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(spreadsheet)
        }).done(function(data){
            var hasOpener = false;
            try {
                hasOpener = window.opener &&
                    !window.opener.closed &&
                    window.opener.AJS &&
                    window.opener.AJS.MacroBrowser &&
                    window.opener.AJS.MacroBrowser.fields &&
                    window.opener.AJS.MacroBrowser.fields.spreadsheetId &&
                    window.opener.AJS.MacroBrowser.fields.spreadsheetId.updateSpreadsheet;
            } catch (err) {
                // Surely a CORS exception with window.opener coming from localhost / baseUrl
                hasOpener = false;
            }
            if (hasOpener) {
                window.opener.AJS.MacroBrowser.fields.spreadsheetId.loadedSpreadsheetId = "please refresh anyway";
                window.opener.AJS.MacroBrowser.fields.spreadsheetId.setValue(spreadsheet.name);
                window.opener.AJS.MacroBrowser.fields.spreadsheetId.updateSpreadsheet();
                // That's when people use Hsql: We shouldn't make the Macro Browser access the db at the same time as changing page...
                successCallback && window.setTimeout(function(){successCallback(data);}, 700);
            } else {
                successCallback && successCallback(data);
            }
        }).fail(failureCallback);
    }

    /** This is the 'Confluence' implementation for the baseUrl */
    if (!window.PlaySQL.SPI) {
        var spaceKey = AJS.Meta.get("space-key");
        window.PlaySQL.SPI = {
            contextPath: AJS.contextPath(),
            getMetadata: AJS.Meta.get,
            baseUrl: function (endpoint, paths, queryParams) {
                // If you think you could reuse baseUrlForContext, don't forget that V8 engines can't perform
                // optimizations on sliced arguments, thus requiring you to write just as much code.
                var suffix = "";
                for (var i = 0; i < arguments.length; i++) {
                    var arg = arguments[i];
                    if (i == arguments.length - 1 && (typeof arg == "object")) {
                        suffix += "?" + $.param(arg);
                    } else if (typeof arg == "undefined") {
                        AJS.log("Undefined argument in baseUrl: ", arguments);
                        suffix += "/[undefined]";
                    } else {
                        suffix += "/" + ("" + arg).replace(/^\/|\/$/g, "");
                    }
                }

                return AJS.contextPath() + "/rest/playsql2/1.0/spreadsheets" + suffix;
            },
            /** This returns an URL for all the 'old' resources, which aren't designed like spreadsheets */
            baseUrlOld: function (endpoint, paths, queryParams) {
                // If you think you could reuse baseUrlForContext, don't forget that V8 engines can't perform
                // optimizations on sliced arguments, thus requiring you to write just as much code.
                var suffix = "";
                for (var i = 0; i < arguments.length; i++) {
                    var arg = arguments[i];
                    if (i == arguments.length - 1 && (typeof arg == "object")) {
                        suffix += "?" + $.param(arg);
                    } else if (typeof arg == "undefined") {
                        AJS.log("Undefined argument in baseUrl: ", arguments);
                        suffix += "/[undefined]";
                    } else {
                        suffix += "/" + ("" + arg).replace(/^\/|\/$/g, "");
                    }
                }

                return AJS.contextPath() + "/rest/playsql/1.0" + suffix;
            },
            contextForPage: spaceKey ? "space:" + spaceKey : "name:unknown"
        };
    }
    window.spreadsheet = {};
    PlaySQL.Helpers.CssObject = function($placeholder) {
        function getRule(criteria) {
            // 'this' is the array
            var rule;
            for (var i in this) {
                rule = this[i];
                if (!rule.appliesTo) continue;
                if (criteria.column && rule.appliesTo.column == criteria.column
                || criteria.selector == rule.appliesTo.selector == criteria.selector) {
                    return rule;
                }
            }
            rule = {
                appliesTo: criteria,
                body: {}
            };
            this.push(rule);
            return rule;
        }
        return {
            $placeholder : $placeholder,
            /** A module is a set of CSS rules with a name, so we can sweep all of them and replace them */
            module : function(module) {
                if (!this[module]) {
                    this[module] = [];
                    this[module].getRule = getRule;
                }
                return this[module];
            }
        };
    }

    /** Applies the 'css' tag of the spreadsheet. The object should be in the form of PlaySQL.Helpers.CssObject:
     * spreadsheet.css = {
     *     "module": [{
     *         appliesTo: { column: "ID", selector: undefined },
     *         body: { "css-prop" : "value" }
     *     }]
     * };
     * Only one module can be rendered at once.
     */
    PlaySQL.Helpers.applyCss = function(css, module) {
        if (!css) return;
        // Concat
        var stylesheet = "/* Dynamically generated by Play SQL */";
        var uniquePlaceholderIdentifier = css.$placeholder.attr("id");
        if (uniquePlaceholderIdentifier == null) {
            uniquePlaceholderIdentifier = "pssid-" + Math.floor(Math.random() * 1000);
            css.$placeholder.attr("id", uniquePlaceholderIdentifier);
        }
        var rulePrefix = "#" + uniquePlaceholderIdentifier + " ";
        for (var i in css) {
            if (i != module) continue;
            for (var j in css[i]) {
                var rule = css[i][j];
                if (typeof rule == "function") continue;
                if (!!rule.appliesTo.column) {
                    // We need to build it from the column name
                    rule.appliesTo.selector = undefined;
                    var $th = css.$placeholder.find("thead th[data-name='" + rule.appliesTo.column + "']");
                    if ($th.size() == 1) {
                        var oneBasedIndex = $th.index() + 1;
                        rule.appliesTo.selector =
                            rulePrefix + "tbody td:nth-child(" + oneBasedIndex + "), \n" +
                            rulePrefix + "thead tr.playsql-col-headers th:nth-child(" + oneBasedIndex + ")"
                    }
                }
                if (rule.appliesTo.selector && rule.body) {
                    for (var propName in rule.body)
                        if (rule.body[propName] == null)
                            delete rule.body[propName];

                    if (Object.keys(rule.body).length > 0) {
                        stylesheet += "\n\n" + rule.appliesTo.selector + " {";
                        for (var propName in rule.body) {
                            var propValue = rule.body[propName];
                            if (!!propValue) {
                                if (!(/^[-a-zA-Z0-9 .,()\n]*$/.test(propName))) {
                                    AJS.logError("Illegal css key: " + propName);
                                } else if ((/(\/\*|;)/.test(propValue))) {
                                    AJS.logError("Illegal css value: " + propValue);
                                } else {
                                    stylesheet += "\n " + propName + ":" + propValue + ";";
                                }
                            }
                        }
                        stylesheet += "\n}";
                    }
                }
            }
        }
        // Replace the <style> tag, pay attention it's the tag of the correct spreadsheet
        var id = "style-" + uniquePlaceholderIdentifier + "-" + module;
        var styleTag = document.getElementById(id);
        if (styleTag == null) {
            styleTag = document.createElement('style');
            styleTag.type = 'text/css';
            styleTag.id = id;
            document.getElementsByTagName('head')[0].appendChild(styleTag);
        }
        if (window.PlaySQL.debug) {
            AJS.log("Generated dynamic css for " + id, stylesheet);
        }
        styleTag.innerHTML = stylesheet;
    }

    PlaySQL.Helpers.parseMacroParams = function($macroNode) {
        var parameters = $macroNode.attr("data-macro-parameters");
        if (typeof parameters != "string") return {};
        var result = {};
        parameters = parameters.split("|");
        for (var i in parameters) {
            var keyValue = parameters[i];
            var separator = keyValue.indexOf("=");
            if (separator == -1) continue;
            var key = keyValue.substr(0, separator);
            var value = keyValue.substr(separator + 1);
            result[key] = value;
        }
        return result;
    }

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:blueprint-resources', location = '/assets/core/blueprint/playsql-blueprint.js' */
Confluence.Blueprint.setWizard('com.playsql.playsql-base-plugin:playsql-blueprint-webitem', function(wizard) {

	var defaultCase = null,
		mode = null,
		darkFeatures = [],
		listOfSpreadsheets = null;

	function updateVisibleTypes(mode) {
		if (mode == "READ_ONLY") {
			$(".bp-types .require-read-write").addClass("disabled");
			selectType($(".bp-types .selected"));
			var $addenum = $(".dialog-wizard-page-description p.addenum");
			if ($addenum.size() == 0) {
				$("<p>", {
					text: "Some types are disabled because the datasource is read-only.",
					"class": "addenum"
				}).appendTo(".dialog-wizard-page-description");
			} else {
				$addenum.removeClass("hidden");
			}
		} else {
			$(".bp-types .require-read-write").removeClass("disabled");
			$(".dialog-wizard-page-description p.addenum").removeClass("hidden");
		}
	}

	function selectType($template) {
		// If disabled, select the next possible
		var i = 0;
		while ($template.is(".disabled")) {
			if (i++ > 4) {
				$template.parent().children().removeClass("selected");
				break;
			}
			$template = $template.next(":visible:not(.disabled)").length != 0
				? $template.next(":visible:not(.disabled)")
				: $template.parent().children(":visible:not(.disabled)").first();
		}

		// Go ahead with the selection
		$template.addClass("selected").siblings().removeClass("selected");
		if ($template.hasClass("with-next")) {
        	$('.create-dialog-create-button:visible').text("Next");
		} else {
			$('.create-dialog-create-button:visible').text("Create");
		}
	}

	wizard.on('post-render.choose', function(e, state) {
		window.PlaySQL.fetchContextProperties(false, "space:" + state.wizardData.spaceKey, function(jqXHR, defaultCase1, mode1) {
			defaultCase = defaultCase1;
			mode = mode1;
			darkFeatures = jqXHR.getResponseHeader("X-DARK-FEATURES");
			darkFeatures = darkFeatures && darkFeatures.split(",") || [];
			var $types = $(".bp-types");
			if ($types.size() > 0) {
				$types.fadeIn(200);
				$types.attr('tabindex', 0).focus();
				updateVisibleTypes(mode);
				selectType($("#bp-create-spreadsheet"));
			}
			// Also fetch the list of tables, if the user creates a query
			window.PlaySQL.Helpers.getAutocomplete("space:" + state.wizardData.spaceKey, function(data) {
				try {
					var tableDDLs = data.tables && data.tables["current schema"],
						tableNames = data.tableNames;
					if (!tableDDLs && tableNames) return;
					listOfSpreadsheets = [{
						name: "",
						label: "- None -"
					}];
					for (var i in tableDDLs) {
						var tableName = tableDDLs[i].name,
							tableLabel = tableDDLs[i].label,
							positionInTableNames = tableNames.indexOf(tableName);
						if (positionInTableNames >= 0) tableNames.splice(positionInTableNames, 1);
						listOfSpreadsheets.push({name: tableName, label: tableLabel});
					}
					for (var i in tableNames) {
						listOfSpreadsheets.push({name: tableNames, label: tableNames});
					}
				} catch (err) {
					AJS.error(err);
				}
			});
		});

		$(".bp-types").on("click", ".template", function(){
			selectType($(this));
		}).on("dblclick", ".template", function(){
			$('.create-dialog-create-button:visible').click();
		}).keydown(function(e) {
			if (e.keyCode == 38 || e.keyCode == 40) {
				e.preventDefault();

				var $selected = $('.bp-types .template.selected'),
					$templates = $('.bp-types .template'),
					$newSelected;
				if (e.keyCode == 38) // up
					$newSelected = $selected.prev(":visible:not(.disabled)").length != 0
						? $selected.prev(":visible:not(.disabled)")
						: $selected.parent().children(":visible:not(.disabled)").last();
				else if (e.keyCode == 40) // down
					$newSelected = $selected.next(":visible:not(.disabled)").length != 0
						? $selected.next(":visible:not(.disabled)")
						: $selected.parent().children(":visible:not(.disabled)").first();
				selectType($newSelected);
			}
		}).hide().removeClass("hidden");
		//updateVisibleTypes(mode);
		//selectType($("#bp-create-spreadsheet"));
	});

	wizard.on('submit.choose', function(e, state) {
		var $selected = $(".bp-types .template.selected"),
			type = $selected.attr("id");
		if (type == "bp-create-spreadsheet") {
			state.nextPageId = "create-spreadsheet";
		} else if (type == "bp-create-query") {
			if (listOfSpreadsheets && listOfSpreadsheets.length > 1) {
				state.nextPageId = "create-query";
			} else {
				state.nextPageId = "create-redirect";
				state.wizardData.redirectUrl = PlaySQL.SPI.contextPath + "/playsql-base-plugin/query-editor.action?"
				+ $.param({
					key: state.wizardData.spaceKey,
					create: "true"
				});
			}
		} else if (type == "bp-create-joint-table") {
			state.nextPageId = "create-redirect";
			state.wizardData.redirectUrl = PlaySQL.SPI.contextPath + "/playsql-base-plugin/joint-table-editor.action?"
				+ $.param({
					key: state.wizardData.spaceKey,
					create: "true"
				});
		}
	});

	wizard.on('post-render.create-redirect', function(e, state) {
		// Submit immediately
		window.setTimeout(function(){
			$('.create-dialog-create-button:visible').click();
		}, 0);
	});

	wizard.on('submit.create-redirect', function(e, state) {
		if (!state.wizardData.redirectUrl) throw "A redirection url is expected when using the create-redirect wizard step";
		state.finalUrl = state.wizardData.redirectUrl;
	});

	wizard.on('post-render.create-spreadsheet', function(e, state) {
		window.PlaySQL.Blueprint.autocorrectKey(
			state.$container.find("#spreadsheet-name"),
			state.$container.find("#spreadsheet-key"),
			defaultCase
		);
	});

	wizard.on('submit.create-spreadsheet', function(e, state) {
		var $nameField = state.$container.find("#spreadsheet-name"),
			$keyField = state.$container.find("#spreadsheet-key"),
			$errorField = $keyField.parent().find(".error");
		var name = $nameField.val(),
			key = $keyField.val(),
			spaceKey = state.wizardData.spaceKey || AJS.Meta.get("space-key"),
			spreadsheet = {
				name: key,
				label: name
			};
		$errorField.empty();
		if (!name || !key || !spaceKey) {
			$errorField.text("All fields are required");
			return false;
		}
		// Submit the spreadsheet
		window.PlaySQL.createSpreadsheet("space:" + spaceKey, spreadsheet, undefined, window.PlaySQL.defaultCase, function(){
			state.validationDeferred.resolve();
		}, function(data){
			var message = data.responseText;
			if (data && data.status == 409) {
				// Conflict, table already exists
			}
			if (message) {
				try {
					var data2 = $.parseJSON(data.responseText);
					if (data2.message) message = data2.message;
				} catch (err) {}
			}
			$errorField.text(message);
			state.validationDeferred.reject();
		});
		state.finalUrl = PlaySQL.SPI.contextPath + "/playsql-base-plugin/spreadsheet-editor.action?" +
						$.param({key: spaceKey, spreadsheetId: key});
		state.async = true;
	});

	wizard.on('pre-render.create-query', function(e, state) {
		state.soyRenderContext['spreadsheets'] = listOfSpreadsheets;
	});

	wizard.on('submit.create-query', function(e, state) {
		state.finalUrl = PlaySQL.SPI.contextPath + "/playsql-base-plugin/query-editor.action?"
				+ $.param({
					key: state.wizardData.spaceKey,
					create: "true",
					from: state.$container.find("#table-name").val() || "your_table"
				});
	});
});

(function($){
	window.PlaySQL = window.PlaySQL || {};
	window.PlaySQL.Blueprint = window.PlaySQL.Blueprint || {};
	window.PlaySQL.Blueprint.autocorrectKey = function($ssName, $ssKey, defaultCase) {
		var keyup = function() {
			var val = $ssName.val(),
                keyVal = $ssKey.val();
            if (keyVal === $ssKey.data('generated-val') || keyVal == "") {
                // Generate the key from the name
                var generatedKey = window.PlaySQL.Helpers.generateKey(val, defaultCase);
                keyVal != generatedKey && $ssKey.val(generatedKey).data('generated-val', generatedKey);
            } else {
                // Autocorrect the key
                var correctKey = window.PlaySQL.Helpers.generateKey($ssKey.val(), defaultCase);
                if (correctKey != $ssKey.val())
                    $ssKey.val(correctKey);
            }
		};
		$ssName.keyup(keyup);
		$ssKey.keyup(keyup);
	};

	/**
	 * Displays a popup which looks like the Create dialog.
	 */
	window.PlaySQL.Blueprint.displayCreateSpreadsheetDialog = function(defaultCase, copyId, context, key, name) {
		var $nameField, $keyField, $errorField;
		var $template = $(Confluence.Templates.PlaySQL.CreateExperience.createSpreadsheetForm({
				key: key,
				name: name,
				copyId: copyId
			}));

		var submitCallback = function () {
				$("#create-spreadsheet-dialog .button-panel-submit-button").disable().text("Submitting...");
				var name = $nameField.val(),
					key = $keyField.val(),
					spreadsheet = {
						name: key,
						label: name
					};
			    context = context || PlaySQL.SPI.contextForPage;
				$errorField.empty();
				if (!name || !key || !context) {
					$errorField.text("All fields are required");
					$("#create-spreadsheet-dialog .button-panel-submit-button").enable().text("Submit");
					return false;
				}
				// Submit the spreadsheet
				window.PlaySQL.createSpreadsheet(context, spreadsheet, copyId, window.PlaySQL.defaultCase, function () {
                    var spaceKey = context.indexOf("space:") == 0 ? context.substr("space:".length) : context;
					window.location.href = PlaySQL.SPI.contextPath + "/playsql-base-plugin/spreadsheet-editor.action?key=" + spaceKey + "&spreadsheetId=" + key;
				}, function (data) {
					$("#create-spreadsheet-dialog .button-panel-submit-button").enable().text("Submit");
                    var message = data.responseText;
                    if (message) {
                        try {
                            var data2 = $.parseJSON(data.responseText);
                            if (data2.message) message = data2.message;
                        } catch (err) {}
                    }
					if (data && data.status == 409) {
						// Conflict, table already exists
						$errorField.text(message);
					} else {
						$errorField.text(message);
					}
				});
			};

		var cancelCallback = function () {
				dialog.hide();

				$nameField.val('');
				$keyField.val('');
				keyErrors.text('').addClass('hidden');
				nameErrors.text('').addClass('hidden');
				enableSubmit(false);
			};

		var dialog = new AJS.ConfluenceDialog({
				width: 840,
				height: 449,
				id: 'create-spreadsheet-dialog',
				closeOnOutsideClick: true,
				onCancel: cancelCallback,
				onSubmit: submitCallback
			});

        dialog.addHeader("Create spreadsheet");
        dialog.addPanel("Panel 1", $template);

        dialog.addSubmit("Submit", submitCallback);
        dialog.addCancel("Cancel", cancelCallback);

        $submitButton = dialog.popup.element.find('.button-panel-submit-button');

        dialog.gotoPage(0);
        dialog.gotoPanel(0);

        dialog.show();
		$nameField = $("#spreadsheet-name");
		$keyField = $("#spreadsheet-key");
		$errorField = $keyField.parent().find(".error");

		if (defaultCase != "LOWER" && defaultCase != "UPPER") {
			$("#create-spreadsheet-dialog .button-panel-submit-button").remove();
			$errorField.text(
				"There was an error while getting information from the database. Please send the steps to reproduce to support@play-sql.com and we\u0027ll gladly help you."
			);
		} else {
			window.PlaySQL.Blueprint.autocorrectKey(
				$nameField,
				$keyField,
				defaultCase
			);
		}
	};

})(AJS.$);

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:blueprint-resources', location = '/blueprint/playsql-blueprint.soy' */
// This file was automatically generated from playsql-blueprint.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PlaySQL.CreateExperience.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PlaySQL == 'undefined') { Confluence.Templates.PlaySQL = {}; }
if (typeof Confluence.Templates.PlaySQL.CreateExperience == 'undefined') { Confluence.Templates.PlaySQL.CreateExperience = {}; }


Confluence.Templates.PlaySQL.CreateExperience.getStarted = function(opt_data, opt_ignored) {
  return '<h2>' + soy.$$escapeHtml("Product lists. Timetables. Bookings. Your data.") + '</h2><div id="playsql-blueprint-explanation"><ul><li>' + soy.$$escapeHtml("Create a spreadsheet") + '</li><li>' + soy.$$escapeHtml("Copy-paste excerpts into pages of the space") + '</li><li>' + soy.$$escapeHtml("Use queries for more advanced reports") + '</li></ul></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.getStarted.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.getStarted';
}


Confluence.Templates.PlaySQL.CreateExperience.choose = function(opt_data, opt_ignored) {
  return '<ol class="bp-types hidden" id="playsql-blueprint-types"><li class="template selected with-next require-read-write" id="bp-create-spreadsheet"><span class="template-preview"></span><div class="template-meta"><div class="template-name">' + soy.$$escapeHtml("Spreadsheet") + '</div><div class="template-description">' + soy.$$escapeHtml("Spreadsheets store new data. It can be displayed on the pages of the space.") + '</div></div></li><li class="template with-next" id="bp-create-query"><span class="template-preview"></span><div class="template-meta"><div class="template-name">' + soy.$$escapeHtml("Query") + '</div><div class="template-description">' + soy.$$escapeHtml("Display data from several tables. Write in the SQL language.") + '</div></div></li><li class="template require-read-write" id="bp-create-joint-table"><span class="template-preview"></span><div class="template-meta"><div class="template-name">' + soy.$$escapeHtml("Joint Table") + '</div><div class="template-description">' + soy.$$escapeHtml("Keep the original data unmodified. Add comments of your own, or dates or figures.") + '</div></div></li></ol>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.choose.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.choose';
}


Confluence.Templates.PlaySQL.CreateExperience.createSpreadsheetForm = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = ((opt_data.copyId != null) ? '<p>' + soy.$$escapeHtml(AJS.format("La feuille de calcul sera dupliqu\xe9e en:",opt_data.copyId)) + '</p>' : '') + '<form class="aui" id="create-spreadsheet-form"><fieldset><div class="field-group"><label for="name">' + soy.$$escapeHtml("Nom de la feuille de calcul") + '</label><input class="text" id="spreadsheet-name" name="name" autocomplete="off" ' + ((opt_data.name) ? 'value="' + soy.$$escapeHtml(opt_data.name) + '"' : '') + '/>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['name']) {
    var errorList43 = opt_data.fieldErrors['name'];
    var errorListLen43 = errorList43.length;
    for (var errorIndex43 = 0; errorIndex43 < errorListLen43; errorIndex43++) {
      var errorData43 = errorList43[errorIndex43];
      output += '<div class="error">' + soy.$$escapeHtml(errorData43) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</div><div class="field-group"><label for="key">' + soy.$$escapeHtml("Cl\xe9") + '</label><input class="text" id="spreadsheet-key" name="key" ' + ((opt_data.key) ? 'value="' + soy.$$escapeHtml(opt_data.key) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml("Utilis\xe9 comme nom pour la table dans la base de donn\xe9es") + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['key']) {
    var errorList63 = opt_data.fieldErrors['key'];
    var errorListLen63 = errorList63.length;
    for (var errorIndex63 = 0; errorIndex63 < errorListLen63; errorIndex63++) {
      var errorData63 = errorList63[errorIndex63];
      output += '<div class="error">' + soy.$$escapeHtml(errorData63) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</div></fieldset></form>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.createSpreadsheetForm.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.createSpreadsheetForm';
}


Confluence.Templates.PlaySQL.CreateExperience.wizardChooseSpreadsheet = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<form class="aui"><fieldset><div class="field-group"><label for="name">' + soy.$$escapeHtml("From") + '</label><select class="select" id="table-name" name="table-name">';
  var spreadsheetList75 = opt_data.spreadsheets;
  var spreadsheetListLen75 = spreadsheetList75.length;
  for (var spreadsheetIndex75 = 0; spreadsheetIndex75 < spreadsheetListLen75; spreadsheetIndex75++) {
    var spreadsheetData75 = spreadsheetList75[spreadsheetIndex75];
    output += '<option value="' + soy.$$escapeHtml(spreadsheetData75.name) + '"' + ((opt_data.selectedSpreadsheet == spreadsheetData75.name) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(spreadsheetData75.label) + '</option>';
  }
  output += '</select><div class="description">' + soy.$$escapeHtml("Optional. Select a spreadsheet to start from.") + '</div><div class="error"></div></div></fieldset></form>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.wizardChooseSpreadsheet.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.wizardChooseSpreadsheet';
}


Confluence.Templates.PlaySQL.CreateExperience.empty = function(opt_data, opt_ignored) {
  return '';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.CreateExperience.empty.soyTemplateName = 'Confluence.Templates.PlaySQL.CreateExperience.empty';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-base-web', location = 'assets/core/js/playsql-selection.js' */
(function($){
    window.PlaySQL = window.PlaySQL || {};

    window.PlaySQL.Selection = {
        forTable: function ($placeholder) {
            var that = $placeholder.data('PlaySQLSelection');
            if (that == undefined) {
                that = {};
                $placeholder.data('PlaySQLSelection', that);
                that.options = {
                    cellSecondClick: function ($cell) {
                        this.options.editCell.call(this, $cell);
                    },
                    rowSecondClick: undefined,
                    columnSecondClick: undefined,
                    baseSelector: ".playsql-spreadsheet-placeholder table",
                    // Could be optimized by not withholding the $placeholder inside the data() of thedit $placeholder
                    $placeholder: $placeholder,
                    css : new window.PlaySQL.Helpers.CssObject($placeholder),
                    colOf : function($cell) {
                        return {index: $cell.index()};
                    },
                    popupTrigger: undefined,
                    popupContentFn: undefined,
                    pasteHandler: undefined,
                    addRow: undefined,
                    /** The cssClassMap allows to operate on other CSS classes than "selection" and "focused".
                     - Undefined = It uses "selected" and "focused",
                     - Any other name = It uses the name, and no focus.
                     It is useful when the user is editing a formula and we're highlighting cells.
                     If this mode is activated, only selection/keymove is active and not secondClicks.
                     */
                    cssClassMap: undefined
                };
                that.setOptions = function (options) {
                    $.extend(that.options, options);
                    return that;
                };
                that.init = function (options) {
                    that.setOptions(options);
                    if (that.alreadyInitialized) {
                        // Do nothing
                    } else {
                        that.alreadyInitialized = true;
                        window.PlaySQL.Selection.attach($placeholder, that, {
                            "click thead tr.playsql-col-headers th:not(:first-child)": columnClick,
                            "mousedown tbody > tr > th:first-child, tfoot > tr > th:first-child": rowClick,
                            "mousedown tbody > tr > td, tfoot > tr > td": cellClick,
                            "mouseenter thead > tr.playsql-col-headers > th:not(:first):not(:last)": headerMouseEnter,
                            "mouseleave thead > tr.playsql-col-headers  > th:not(:first):not(:last)": headerMouseLeave,
                            "mousedown .playsql-resize-handle": resizeHandleMousedown,
                            "click .playsql-resize-handle": dodgeClick,
                            "key enter": pressEnter,
                            "key esc": pressEsc,
                            "key down": moveDown,
                            "key up": moveUp,
                            "key left": moveLeft,
                            "key right": moveRight,
                            "key tab": nextTabOrder,
                            "key shift+tab": previousTabOrder,
                            "key control+a": selectAll
                        });
                        window.PlaySQL.Selection.attach($("#main"), that, {
                            "click" : function($element, e){
                                // If the clicked element is still attached to the DOM (e.g. if a click handler
                                // came in between)
                                if (e.target.parent != null) {
                                    if (this.options.$placeholder.has(e.target).length == 0) {
                                        // The click was outside the spreadsheet
                                        unselectAll.call(this);
                                    }
                                }
                            }
                        });
                        if (that.options.popupTrigger) {
                            window.PlaySQL.Selection.inlineDialog = AJS.InlineDialog(that.options.popupTrigger, "playsql-table-popup",
                                function($content, trigger, showPopup) {
                                    that.options.popupContentFn.call(that, $content, trigger, showPopup);
                                    return false;
                                },
                                {
                                    useLiveEvents:true,
                                    offsetY: 20
                                }
                            );
                        }
                        options.onInit && options.onInit();
                    }
                    return that;
                };
                that.unselectAll = function() {
                    unselectAll.call(that);
                };
                that.mapCss = mapCss;
            }

            return that;
        },

        /**
         * Quickly delegate events using jquery
         * @param $base the element to bind the handlers to
         * @param that the 'selection' object to apply the callback handlers to. Mandatory.
         * @param handlers an array in the form:{
         *  "event table > td": function,
         *  "key control+ctrl+meta+shift+alt+key": function // control = ctrl on windows, meta on mac
         * }
         */
        attach: function ($base, that, handlers) {
            var event, selector, cutPosition,
                keyboardBindings = [],
                hasKeyBindings = false;
            // Bind all handlers on the $placeholder
            for (var key in handlers) {
                cutPosition = key.indexOf(" ");
                event = cutPosition == -1 ? key : key.substring(0, cutPosition);
                selector = cutPosition == -1 ? undefined : key.substring(cutPosition + 1);
                if (event.indexOf("key") == 0) {
                    keyboardBindings.push({key:selector.split("+"), handler: handlers[key]});
                    hasKeyBindings = true;
                } else {
                    (function (event, selector, handler, that) {
                        $base.on(event, selector, function(e) {
                            return handler.call(that, $(this), e);
                        });
                    })(event, selector, handlers[key], that);
                }
            }

            if (hasKeyBindings) {
                $(window.document).on("keydown.playsql-key-bindings keypress.playsql-key-bindings", function(e) {
                    // Dismiss the event if no cell is selected on the spreadsheet
                    if ($base.find(that.mapCss(".focused")).size() == 0) return;
                    // Dismiss the event if a dialog is shown
                    var $popups = $(".aui-inline-dialog:visible, .aui-popup:visible, .aui-blanket:visible");
                    var isDialogShown = false;
                    $popups.each(function(){
                        var $this = $(this),
                            id = $this.attr("id") || ("." + $this.attr("class"));
                        // Don't dismiss the handler
                        if ($this.is("#inline-dialog-playsql-table-popup, .aui-datepicker-dialog")) return;
                        if ($this.is("#inline-dialog-formula-editor")) return;
                        if ($this.is("#inline-dialog-cell-properties")) return;
                        if ($this.is("#inline-dialog-selection-action-panel")) return;
                        if ($this.find(".ui-datepicker").size() > 0) return;
                        if ($this.attr("aria-hidden") == "true") return;
                        // Alright, dismiss the handler
                        AJS.log("Dismissing the key/click handler - A dialog is shown - " + id);
                        isDialogShown = true;
                        return false;
                    });
                    if (isDialogShown) return;
                    var $focus = $("*:focus"),
                        isFocusOutsidePlaceholder = $focus.size() == 1 && $base.has($focus).size() == 0;
                    if (isFocusOutsidePlaceholder) return;

                    var keyCombinationDetail = window.PlaySQL.Helpers.getKeyCombinationDetail(e),
                        key = keyCombinationDetail.key,
                        onKeyDown = keyCombinationDetail.onKeyDown,
                        modifiers = keyCombinationDetail.modifiers;

                    //console.trace("Captured ", key, modifiers.join(","), e.type, $base.attr("data-macro-spreadsheet-id"));

                    // Only execute left, up, right, down and ctrl+a on keydown. The others on keypress.
                    if (onKeyDown && e.type != 'keydown') return;
                    if (!onKeyDown && e.type == 'keydown') return;

                    function trigger(key, handler) {
                        if (handler) {
                            handler.call(that, e);
                        }
                    }

                    function isCorrectCombination(key, modifiers, keyCombination) {
                        // Check the character matches
                        if (key != keyCombination[keyCombination.length - 1]) return false;
                        // Check the modifiers match
                        if (modifiers.length + 1 != keyCombination.length) return false;
                        for (var j = 0 ; j < keyCombination.length - 1 ; j++) {
                            if (modifiers.indexOf(keyCombination[j]) == -1) return false;
                        }
                        return true;
                    }

                    for (var i in keyboardBindings) {
                        if (isCorrectCombination(key, modifiers, keyboardBindings[i].key)) {
                            //console.trace("Trigger", keyboardBindings[i]);
                            trigger(keyboardBindings[i].key, keyboardBindings[i].handler);
                        }
                    }
                });
            }
        },
        bindMenu : function($element, items) {
            var $ul = $("<ul></ul>").appendTo($("#custom-menu").empty());
            function addElement(label, fn, args) {
                var $li = $("<li></li>").appendTo($ul),
                    $a = $("<a></a>", {
                        //href: '#',
                        text: label
                    }).appendTo($li);
                $a.click(function(e){
                    $element.removeClass("aui-dropdown2-trigger")
                        .removeAttr('aria-controls aria-haspopup aria-owns');
                    fn.apply(this, args.concat([$(this), e]));
                    //return false;
                });
            }
            for (var item in items) {
                addElement(items[item][0], items[item][1], items[item].slice(2));
            }
            $element
                .attr('aria-owns', 'custom-menu')
                .attr('aria-haspopup', 'true')
                .addClass('aui-dropdown2-trigger');
        },
        /**
         * Setup the copy-paste. Once for a page only. It uses byPlaceholder($0) to dispatch the event
         * @param options { pasteHandler: spreadsheet.function(contenteditableDiv) }
         */
        setupCopyHandler: function(options) {
            options = options || {};
            var that = this;
            $(document).on("copy", function() {
                // 1. Check whether we're in the spreadsheet
                var selection = window.getSelection(),
                    isConnexe = selection.rangeCount <= 1,
                    uniqueRange = selection.rangeCount == 1 ? selection.getRangeAt(0) : undefined,
                    hasPopups = $(".aui-inline-dialog:visible, .aui-dialog:visible").size() > 0,
                    hasEditingFocusedCell = $("table.playsql td.editing *:focus").size() > 0;
                if (hasPopups || hasEditingFocusedCell) return;
                if (!isConnexe) return;
                if (uniqueRange) {
                    if (!uniqueRange.collapsed) {
                        var didUserSelectSomething = !uniqueRange.collapsed;
                        if (didUserSelectSomething) {
                            var isPlaySqlZeroWidthSpan = uniqueRange.toString() == String.fromCharCode(8203);
                            if (!isPlaySqlZeroWidthSpan) {
                                isPlaySqlZeroWidthSpan =
                                    uniqueRange.startContainer == uniqueRange.endContainer
                                    && uniqueRange.startOffset == 0
                                    && uniqueRange.endOffset == 1;
                                isPlaySqlZeroWidthSpan = isPlaySqlZeroWidthSpan && (
                                (uniqueRange.startContainer.nodeName == "DIV" && uniqueRange.startContainer.className == "zws-playsql") ||
                                (uniqueRange.startContainer.textContent == String.fromCharCode(8203)));
                            }
                            if (isPlaySqlZeroWidthSpan) {
                                didUserSelectSomething = false;
                            }
                        }
                        if (didUserSelectSomething) {
                            return;
                        }
                    }
                }

                // 2. Since nothing is selected, select the cells/rows/col
                // Note: We use .selected directly without mapping (mapCss()) because the copyHandler is page-level
                // and we can't make specifics for each ss. Therefore it is always the .selected with is copied and
                // not the .cell-ref-active classes.
                var $selected = $(".playsql-spreadsheet-placeholder .selected, .playsql-query-placeholder .selected"),
                    $copyDiv = $(".tmp-clipboard-contents").empty();
                if ($copyDiv.size() == 0) {
                    $copyDiv = $("<div></div>", { "class" : "tmp-clipboard-contents" }).appendTo($("body").first());
                }
                if ($selected.size() == 0) return;
                var $placeholder = $selected.closest(".playsql-spreadsheet-placeholder, .playsql-query-placeholder").first();
                $placeholder.find("tr[data-row-metadata]").each(function(){
                    var $this = $(this),
                        rowMetadata = $this.data("row-metadata");
                    if (rowMetadata) {
                        $this.attr("data-row-metadata", JSON.stringify(rowMetadata));
                    } else {
                        $this.removeAttr("data-row-metadata");
                    }
                });
                $placeholder = $placeholder.clone();
                $placeholder.appendTo($copyDiv);

                // Remove header and footer
                $placeholder.find(".pagination-row, .playsql-resize-handle, .right-padding > *, .zws-playsql").remove();
                $placeholder.find("tfoot").remove();
                // Remove all rows which don't have any cell selected
                $placeholder.find("tbody > tr").each(function(){
                    if ($(this).find("td.selected").size() == 0) {
                        $(this).remove();
                    }
                });
                // Remove all columns which don't have any cell selected
                $($placeholder.find("thead tr.playsql-col-headers th").get().reverse()).each(function(){
                    var $this = $(this),
                        index = $this.index(),
                        $cells = $placeholder.find("tbody tr > *:nth-child(" + (index+1) + ")");
                    if ($(this).data("status-pk") == 'true' || $(this).data("status-position") == 'true') return;
                    if ($this.hasClass(".right-padding") || !$cells.hasClass("selected")) {
                        // Well, remove...
                        $this.remove();
                        $cells.remove();
                    }
                });
                // Update the anchor on the top left
                $placeholder.find("thead > tr.playsql-col-headers > th:first a").text("...");
                $placeholder.find("td, th").removeClass("selected focused invalid cell-ref-active cell-ref-inactive").removeAttr("data-rendered");
                $placeholder.find("tr").each(deserializeCellMetadataToTD);
                var table = $copyDiv.find("table.playsql")[0];

                // Move all attributes from the div placeholder to the TABLE html element,
                // because divs are stripped (in Chrome)
                var attrs = $placeholder[0].attributes;
                for (var i in attrs) {
                    var attr = attrs[i];
                    if (attr.name && attr.name.indexOf("data-") == 0)
                        table.setAttribute(attr.name, attr.value);
                }
                // Avoid coying the styles, so styles don't get inlined in other destinations
                $(table).removeClass("playsql");

                var range = document.createRange(),
                    selection = window.getSelection();
                range.setStart(table, 0);
                range.setEnd(table, table.childNodes.length);

                selection.removeAllRanges();
                selection.addRange(range);
                window.setTimeout(function() {
                    selection = window.getSelection();
                    table = $(".tmp-clipboard-contents table")[0];
                    range.setStart(table, 0);
                    range.setEnd(table, table.childNodes.length);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }, 100);
            }).on("input keyup", ".zws-playsql", function(event){
                var $contenteditable = $(this);
                if ($.trim($contenteditable.html()).length == 0 || $contenteditable.html() == "&#x200B;" || $contenteditable.html() == "\u200B") return;
                window.setTimeout(function(){
                    // Yuughuu!
                    if (!options.pasteHandler) return;
                    // Find spreadsheet, if any
                    var $focused = $(".playsql-spreadsheet-placeholder .focused"),
                        $placeholder = $focused.closest(".playsql-spreadsheet-placeholder");
                    if ($placeholder.length == 0) return;
                    var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($placeholder);
                    if (!spreadsheet) return;
                    options.pasteHandler.call(spreadsheet, $contenteditable);
                }, 0);
            });

            function deserializeCellMetadataToTD() {
                var $tr = $(this),
                    $tds = $tr.children(),
                    $ths = $tr.closest("table").find("thead tr").first().children();
                var rowMetadataText = $tr.data("row-metadata");
                var $td, colName, cellMetadata;
                if (!rowMetadataText) return;
                try {
                    var rowMetadata = typeof rowMetadataText == "string" ? $.parseJSON(rowMetadataText) : rowMetadataText;
                    if (!rowMetadata) return;
                } catch (err) {
                    return;
                }
                for (var i = 0 ; i < $tds.size() ; i++ ) {
                    colName = $ths.eq(i).attr("data-name");
                    // We may not find the colName for the padding column
                    if (!colName) continue;
                    cellMetadata = rowMetadata["c_" + colName];
                    $td = $tds.eq(i);
                    if (cellMetadata) {
                        for (var key in cellMetadata) {
                            $td.attr("data-cell-metadata-" + key, cellMetadata[key]);
                        }
                    }
                }
            }
        },
        /** This method should be called after every click/selection. It selects
         * a zws in a contenteditable div, so the user can copy, paste and type and
         * we'll catch these events.
         * @param that the playsql-selection object
         **/
        setNonCollapsedSelection : function (that, handlePaste) {
            // Check whether the user has consciously selected something
            var $placeholder = that.options.$placeholder,
                selection = window.getSelection(),
                uniqueRange = selection.rangeCount == 1 ? selection.getRangeAt(0) : undefined;
            // Abort if there's an alternate selection mode (formula editing)
            if (that.options.cssClassMap) return;
            // Abort if there's a textual selection
            if (uniqueRange && !uniqueRange.collapsed) return;
            // Abort if the user has selected any cell
            if ($(".playsql").find(that.mapCss(".selected")).length == 0) return;

            // Abort if the user is editing anything...
            // Go figure: When the caret is in the zws-playsql, IE9 declares it in the thead
            var $caret = $placeholder.find("*:focus:not(table.playsql > thead), " + that.mapCss(".editing.focused"));
            if ($caret.length > 0 && $caret.html().length > 0 && !$caret.html() == "\u200B" && !$caret.is(".zws-playsql *")) return;

            // Alright, make them select a zws
            var $th = $placeholder.find("th").first(),
                $zwsDiv = $th.find(".zws-playsql"),
                initialScroll = $(window).scrollLeft();
            if ($zwsDiv.size() == 0) {
                $zwsDiv = $("<div></div>", {
                    "class" : "zws-playsql",
                    "contenteditable": handlePaste ? "true" : "false",
                    html: "&#x200B;" // That's a zero-width space
                }).appendTo($th);

                // We want to bypass the keyboard shortcuts if the user is typing into zws-playsql
                $(document).on("keypress", function(e){
                    if (e && e.target && e.target.contentEditable == "true" && e.target.className) {
                        if ((e.target.className || "").indexOf("zws-playsql") != -1) {
                            e.stopImmediatePropagation();
                        }
                    }
                });

                // There are more than 70 'keypress' handlers on a Confluence page, and we want to be first to skip
                // them all. Note: We hope we don't bypass some useful key binding, apart from the keyboard shortcuts.
                var allEvents = $._data(document, "events").keypress;
                // Move our handler to the first position
                allEvents.unshift(allEvents.pop());

            } else {
                $zwsDiv.html("&#x200B;");
            }
            $zwsDiv.focus();
            var range = document.createRange(),
                el = $zwsDiv[0],
                selection = window.getSelection();
            range.setStart(el, 0);
            range.setEnd(el, el.childNodes.length);

            try {
                selection.removeAllRanges();
            } catch (err) {
                // Err is 800a025e and happens on removeAllRanges in IE (9 at least)
                document.selection && document.selection.clear && document.selection.clear();
            }
            selection.addRange(range);

            // Restore the left scroll
            $(window).scrollLeft(initialScroll);
        }
    };

    function checkNotNull(value, message) {
        if (value == undefined) {
            throw "Unexpectedly undefined value: " + value + "(" + message + ")";
        }
        if (value instanceof $) {
            if (value.size() == 0)
                throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
        }
        return value;
    }

    var pressEnter = function(e) {
        // We must prevent default, otherwise the form is submitted.
        e.preventDefault();
        var options = this.options,
            $placeholder = options.$placeholder,
            $editingCells = $placeholder.find(".editing"),
            hasEditingCells = $editingCells.size() != 0;
        if (hasEditingCells) {
            options.saveCells($editingCells);
            window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
        } else {
            // Abort if there's an alternate selection mode (formula editing)
            if (this.options.cssClassMap) return false;
            $placeholder.find(this.mapCss(".focused")).each(function(){
                options.editCell($(this));
            });
        }
        return false;
    };

    var pressEsc = function(e) {
        var options = this.options,
            $placeholder = options.$placeholder,
            $beingEdited = $placeholder.find(".editing, .saving"),
            hasEdits = $beingEdited.size() != 0;
        if (hasEdits) {
            $beingEdited.each(function(){
                options.cancelEdit($(this));
            });
            window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
        } else {
            // If there are open inline-dialogs, close them
            var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($placeholder);
            if (spreadsheet.inlinedialog != null && spreadsheet.inlinedialog) {
                spreadsheet.inlinedialog.close();
            } else {
                // Otherwise, deselect all
                unselectAll.call(this);
            }
            // Formulas in edition: Close them
            window.PlaySQL.Spreadsheet.FormulaEditor.closeDialog(spreadsheet, true);
        }
        return false;
    };

    function shouldCaptureKey(selection, $placeholder, e, handlerName) {
        var $cell = checkNotNull($placeholder.find(selection.mapCss(".focused"))),
            $widget = $cell.find("input:focus, select:focus, textarea:focus, div[contenteditable]:focus");
        if ($widget.size() == 1) {
            /* Think about:
             * Input (numbers)
             * Textarea (multiline text)
             * Datepicker
             * Page picker
             */
            // Generally, don't capture, except if pressing up, down, or if caret is at the beginning or end.
            if ($widget.is("input, textarea, div")) {
                if ((handlerName == 'moveDown' || handlerName == 'moveUp') && $widget.is("input")) {
                    if ($widget.parent().find(".autocomplete li:visible").size() != 0) {
                        // We're in a page picker with the drop-down open
                        return false;
                    }
                    // We're in an input box
                    return true;
                }
                // We're an input box (left, right) or a textarea (all directions)
                var caret = window.PlaySQL.Helpers.caretSelection($widget[0]),
                    length = ($widget.val() || $widget.text()).length;
                if (caret == undefined) return false;
                if ((handlerName == 'moveLeft' || handlerName == 'moveUp') && caret.position == 0 && caret.length == 0) return true;
                if ((handlerName == 'moveRight' || handlerName == 'moveDown') && caret.position == length) return true;
            } else if ($widget.is("select")) {
                if (handlerName == 'moveLeft') return true;
                if (handlerName == 'moveRight') return true;
            }
            return false;
        }
        return true;
    }

    var moveDown = function(e) {
        var $placeholder = checkNotNull(this.options.$placeholder),
            $cell = checkNotNull($placeholder.find(this.mapCss(".focused"))),
            wasEditing = $cell.hasClass("editing"),
            $row = $cell.parent(),
            $newRow = $row.next(),
            index = $cell.index(),
            $newCell;

        // Dismiss if the user is editing a cell
        if (!shouldCaptureKey(this, $placeholder, e, "moveDown")) return;

        if ($row.parent().is("thead")) {
            $newRow = $placeholder.find("tbody > tr:first-child");
        } else if ($row.is("tbody > tr:last-child") && this.options.canSelectFooter) {
            $newRow = $placeholder.find("tfoot > tr.totals-row");
            // Don't select the <th> or the right padding
            index = Math.max(index, 1);
            index = Math.min(index, $newRow.children(":not(.right-padding)").size() - 1);
        }

        $newCell = $newRow.children().eq(index);
        if ($newRow.size() != 0) {
            if (index == 0) {
                // Select row
                rowClick.call(this, $newCell);
                unbindDrag.call(this);
                e.preventDefault();
            } else {
                if ($newCell.size() == 1 && !$newCell.hasClass("right-padding")) {
                    e.preventDefault();
                    // Select cell
                    unselectAll.call(this);
                    $newCell.addClass(this.mapCss("selected focused"));
                    if (wasEditing) {
                        this.options.saveCells($cell);
                        this.options.editCell && this.options.editCell($newCell);
                    } else {
                        window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
                    }
                }
            }
        }
    }

    var moveUp = function(e) {
        var $placeholder = checkNotNull(this.options.$placeholder),
            $cell = checkNotNull($placeholder.find(this.mapCss(".focused"))),
            wasEditing = $cell.hasClass("editing"),
            $row = $cell.parent(),
            $newRow = $row.prev(),
            index = $cell.index(),
            $newCell;

        // Dismiss if the user is editing a cell
        if (!shouldCaptureKey(this, $placeholder, e, "moveUp")) return;

        if ($row.is("tbody > tr:first-child")) {
            var $header = $placeholder.find("thead > tr.playsql-col-headers").children().eq(Math.max(index, 1));
            columnClick.call(this, checkNotNull($header, index), e);
            e.preventDefault();
            return;
        } else if ($row.is("tfoot > tr")) {
            $newRow = $placeholder.find("tbody > tr:last-child");
        }
        $newCell = $newRow.children().eq(index);

        if ($newRow.size() != 0) {
            if (index == 0) {
                // Select row
                rowClick.call(this, $newCell);
                unbindDrag.call(this);
                e.preventDefault();
                return;
            } else {
                e.preventDefault();
                // Just select a cell
                unselectAll.call(this);
                $newCell.addClass(this.mapCss("selected focused"));
                if (wasEditing) {
                    this.options.saveCells($cell);
                    this.options.editCell && this.options.editCell($newCell);
                } else {
                    window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
                }
                return;
            }
        }
    }

    var moveLeft = function(e) {
        var $placeholder = checkNotNull(this.options.$placeholder),
            $cell = checkNotNull($placeholder.find(this.mapCss(".focused"))),
            wasEditing = $cell.hasClass("editing"),
            $newCell = $cell.prev();

        // Dismiss if the user is editing a cell
        if (!shouldCaptureKey(this, $placeholder, e, "moveLeft")) return;

        if ($newCell.is("thead > tr.playsql-col-headers > th")) {
            if ($newCell.index() == 0) {
                rowClick.call(this, checkNotNull($placeholder.find("tbody > tr > th").first()));
                unbindDrag.call(this);
                e.preventDefault();
            } else {
                columnClick.call(this, $newCell, e);
                e.preventDefault();
            }
        } else if ($newCell.is("tbody th")) {
            rowClick.call(this, $newCell);
            unbindDrag.call(this);
            e.preventDefault();
        } else if ($newCell.is("td")) {
            e.preventDefault();
            unselectAll.call(this);
            $newCell.addClass(this.mapCss("selected focused"));
            if (wasEditing) {
                this.options.saveCells($cell);
                this.options.editCell && this.options.editCell($newCell);
            } else {
                window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
            }
        }
    }

    var moveRight = function(e) {
        var $placeholder = checkNotNull(this.options.$placeholder),
            $cell = checkNotNull($placeholder.find(this.mapCss(".focused"))),
            wasEditing = $cell.hasClass("editing"),
            $newCell = $cell.next(":not(.right-padding,.hidden,.nohighlight)");

        // Dismiss if the user is editing a cell
        if (!shouldCaptureKey(this, $placeholder, e, "moveRight")) return;

        if ($cell.is("thead > tr > th")) {
            if ($newCell.size() != 0)
                columnClick.call(this, $newCell, e);
        } else if ($newCell.size() != 0) {
            unselectAll.call(this);
            $newCell.addClass(this.mapCss("selected focused"));
            e.preventDefault();
            if (wasEditing) {
                this.options.saveCells($cell);
                this.options.editCell && this.options.editCell($newCell);
            } else {
                window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
            }
        }
    }

    var nextTabOrder = function(e) {
        moveTabOrder.call(this, e, +1);
    }
    var previousTabOrder = function(e) {
        moveTabOrder.call(this, e, -1);
    }

    var moveTabOrder = function(e, increment) {
        function moveFocus($oldCell, $newCell) {
            $oldCell.removeClass(this.mapCss("focused"));
            $newCell.addClass(this.mapCss("focused"));

            if (!$newCell.hasClass(this.mapCss("selected"))) {
                // Moving inside a selection
                $oldCell.removeClass(this.mapCss("selected"));
                $newCell.addClass(this.mapCss("selected"));
            }

            if ($oldCell.hasClass("editing")) {
                // Save the previous cell
                this.options.saveCells($oldCell);
                // Make the cell editable
                this.options.editCell && this.options.editCell($newCell);
            }
        }
        var $placeholder = checkNotNull(this.options.$placeholder),
            $focused = $placeholder.find(this.mapCss(".focused")),
            $selected = $placeholder.find(this.mapCss(".selected")),
            $inputsInCell = $focused.find("input, div[contenteditable], textarea"),
            $focusedInput = $focused.find(":focus"),
            index = $selected.index($focused),
            newIndex = (index + increment) % $selected.size();

        if ($inputsInCell.size() > 1 && $focusedInput.size() == 1) {
            if (increment == 1 && $inputsInCell.last()[0] != $focusedInput[0]
                || increment == -1 && $inputsInCell.first()[0] != $focusedInput[0]) {
                // Let the natural tab operate
                AJS.log("Natural tab");
                return true;
            } else {
                // We're in the last/first input field of a cell. Normally we'd change cell,
                // except if we're editing a total
                if ($focusedInput.closest(".totals-row").size() > 0) {
                    AJS.log("Natural tab: Prevented");
                    e.preventDefault();
                    return false;
                }
            }
        }
        if ($focused.is("thead > tr.playsql-col-headers > th")) {
            // Just submit the column
            $focusedInput.blur();
            return false;
        }

        if (index != -1 && $selected.size() > 1) {
            moveFocus.call(this, $focused, $selected.eq(newIndex));
        } else if ($focused.size() != 0) {
            // Next cell in the row?
            var $newCell = increment > 0 ? $focused.next(":not(.right-padding)") : $focused.prev(":not(:first-child)");
            if ($newCell.size() != 1) {
                // Next row?
                $newCell = increment > 0
                    ? checkNotNull($focused.parent("tr")).next("tr").children("td").first()
                    : checkNotNull($focused.parent("tr")).prev("tr").children("td:not(.right-padding)").last();
            }
            if ($newCell.size() != 1) {
                // Top-left cell? Move around the spreadsheet
                if (increment < 0) {
                    $newCell = checkNotNull($placeholder.find("tbody td:not(.right-padding)").last());
                } else {
                    // Bottom-right cell? If edit -> add row, Otherwise go to top-left cell.
                    if ($focused.hasClass(this.mapCss("editing"))) {
                        this.options.addRow && this.options.addRow();
                    } else {
                        $newCell = checkNotNull($placeholder.find("tbody td").first());
                    }
                }
            }
            if ($newCell.size() == 1) {
                moveFocus.call(this, $focused, $newCell);
            }
        }

        e.preventDefault();
    }

    var selectAll = function() {
        var $cell = checkNotNull(this.options.$placeholder.find(this.mapCss(".focused") + ", .focused")),
            $widget = $cell.find("input:focus, select:focus, textarea:focus, div[contenteditable]:focus");

        // Abort if there's an alternate selection mode (formula editing)
        if (this.options.cssClassMap) return;
        // Abort if there is any cell in edition
        if ($widget.size() == 1) return;

        var $allCells = this.options.$placeholder.find("tbody tr > th, tbody tr > td:not(.right-padding)");
        $allCells.addClass(this.mapCss("selected")).removeClass(this.mapCss("focused"));
        $allCells.first().addClass(this.mapCss("focused"));
        window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
    }

    /**
     * Unselect all cells and remove menus
     * @param keepSelectedCells true if we should just remove the focus and the menus, and keep the selected cells
     */
    var unselectAll = function(keepSelectedCells) {
        // It wasn't possible to have 2 spreadsheets on the same page, so I've changed from
        // unselecting within the $placeholder and unselecting on the whole page.
        $(".playsql-spreadsheet-placeholder,.playsql-query-container").find(this.mapCss(".selected,.focused"))
            .removeClass((keepSelectedCells ? "" : this.mapCss("selected")) + " " + this.mapCss("focused") + " aui-dropdown2-trigger")
            .removeAttr('aria-controls aria-haspopup aria-owns');

        // Ensure no text is selected. Otherwize setNonCollapsedSelection() will quit, assuming something was selected.
        var selection = window.getSelection();
        var range = selection && (selection.rangeCount > 0) && selection.getRangeAt(0);
        if (range) range.collapse(true);
    }

    var columnClick = function($header, e) {
        var $placeholder = this.options.$placeholder,
            column = this.options.colOf($header);
        if (!column) return false;
        var index = column.index + 1;
        $cells = $placeholder.find("table.playsql > thead > tr.playsql-col-headers > *:nth-child(" + index + ")," +
        "table.playsql > tbody > tr:not(.playsql-message) > *:nth-child(" + index + ")");
        if ($cells.first().hasClass(this.mapCss("selected"))) {
            if (!$header.hasClass("editing")) {
                this.options.columnSecondClick && this.options.columnSecondClick($header);
            }
        } else if (!$cells.first().hasClass(this.mapCss("focused"))) {
            unselectAll.call(this);
            $cells.addClass(this.mapCss("selected"));
            $cells.first().addClass(this.mapCss("focused"));
            window.PlaySQL.Selection.setNonCollapsedSelection(this, !!this.options.pasteHandler);
        }
        return false;
    };

    /** Select row */
    var rowClick = function($header, event) {
        if (event && event.type != "keydown" && (event.which || event.button) != 1) return;
        if ($header.hasClass(this.mapCss("selected"))) {
            // Abort if there's an alternate selection mode (formula editing)
            if (this.options.cssClassMap) return;
            this.options.rowSecondClick && this.options.rowSecondClick($header);
        } else {
            if ($header.is("tfoot th")) return true;

            unselectAll.call(this);
            var $cells = $header.parent().children("th,td"),
                $placeholder = this.options.$placeholder;
            $cells.addClass(this.mapCss("selected"));
            $cells.first().addClass(this.mapCss("focused"));
            var selectDragRow = function($tr) {
                if (!$placeholder.has($tr))
                    return;
                var $allTrs = $header.closest("table").find("tbody > tr"),
                    rowId1 = $tr.attr("data-row-id"),
                    rowId2 = checkNotNull($header.parent().attr("data-row-id")),
                    highlighted = false;
                if (rowId1 == undefined)
                // We're hovering over a tr which isn't in the body
                    return;
                $allTrs.each(function(){
                    var $tr = $(this),
                        rowId = $tr.attr("data-row-id");
                    if (rowId == rowId1 || rowId == rowId2) {
                        highlighted = !highlighted;
                        $tr.find("td,th").addClass(that.mapCss("selected"));
                    } else if (highlighted) {
                        $tr.find("td,th").addClass(that.mapCss("selected"));
                    } else {
                        $tr.find("td,th").removeClass(that.mapCss("selected"));
                    }
                });
                $placeholder.addClass("no-select");
            };
            window.PlaySQL.Selection.attach($(window.document), this, {
                "mouseover.select-drag tr" : selectDragRow,
                "mouseup.select-drag" : unbindDrag
            });

            // This timeout comes for a fix where a click on the <tr> didn't allow the copy.
            // When happened was, there was no text selected, as opposed to clicks on cells.
            // setNonCollapsedSelection() was doing its job, but the mouseup/click happened after
            // the current code (which is bound to mousedown), so whatever was selected was unselected
            // by the browser at the end of the click
            var that = this;
            window.setTimeout(function() {
                window.PlaySQL.Selection.setNonCollapsedSelection(that, !!that.options.pasteHandler);
            }, 0);
        }
    };

    // I've introduced mouseupTriggered because "unbindDrag" must be attached as soon as mousedown is here in order
    // not to miss the mouseup, but it can't be treated until after the setTimeout(0) of cellClick is done.
    var mouseupTriggered = false;
    var unbindDrag = function() {
        mouseupTriggered = true;
        $(window.document)
            .unbind("mouseover.select-drag")
            .unbind("mouseup.select-drag");
        if (this.options.$placeholder.hasClass("no-select")) {
            // This timeout was introduced to fix the copy of an area. The bug was: The user drag'n'selected a
            // few rows, the setNonCollapsedSelection() would select a &zws;, the mouseup would trigger a brower-level
            // caret positioning, effectively resetting to a collapsed range. We want setNonCollapsedSelection to
            // happen after this browser event.
            var that = this;
            that.options.$placeholder.removeClass("no-select");
            window.setTimeout(function() {
                window.PlaySQL.Selection.setNonCollapsedSelection(that, !!that.options.pasteHandler);
            }, 0);
        }
    }

    var cellClick = function($cell, event) {
        if (event.type != "keydown" && (event.which || event.button) != 1) return;
        // We had to bind 'cellClick' (and all attachments) to 'mousedown' instead of 'click', because we wanted
        // to capture the drag event (mousedown/mouseup lapse).
        //
        // It caused cellClick to behave differently, because the 'click' would happen after mousedown, disturbing
        // the focus. Therefore we introduced window.setTimeout().
        //
        // Then we noticed events happened in this order in IE9: mousedown, mouseup, mousedown.timeout(0). So it would
        // appear like the cursor was dragging a sticky selection.
        // We solved that by checking the current state of the mouse button.
        var that = this;
        mouseupTriggered = false;
        window.PlaySQL.Selection.attach($(window.document), that, {
            "mouseup.select-drag" : unbindDrag
        });
        window.setTimeout(function(){
            // Abort if the click is in the footer and it's not allowed to select it
            if ($cell.is("tfoot > tr > *") && !that.options.canSelectFooter) {
                return;
            }
            if ($cell.parent().hasClass("pagination-row")) {
                return;
            }
            if ($cell.hasClass("right-padding")) {
                return;
            }
            if ($cell.hasClass(that.mapCss("focused"))) {
                // Abort if there's an alternate selection mode (formula editing)
                if (that.options.cssClassMap) return;
                that.options.cellSecondClick && that.options.cellSecondClick.call(that, $cell);
                return;
            }
            // Special case to edit totals
            if ($cell.hasClass("edit-on-first-click")) {
                // Abort if there's an alternate selection mode (formula editing)
                if (that.options.cssClassMap) return;
                that.options.cellSecondClick && that.options.cellSecondClick.call(that, $cell);
                return;
            }
            if (!event || !(!window.PlaySQL.Helpers.isMac && event.ctrlKey || window.PlaySQL.Helpers.isMac && event.metaKey))
                unselectAll.call(that);
            else
                unselectAll.call(that, true);
            $cell.addClass(that.mapCss("selected focused"));

            if ($cell.hasClass(that.mapCss("editing"))) {
                return;
            }
            var $placeholder = that.options.$placeholder;
            var selectDragCell = function($cell) {
                if (!$placeholder.has($cell)) return;
                var $focused = $placeholder.find(that.mapCss(".focused")),
                    origCol = $focused.index(),
                    origRow = $focused.closest("tr").index(),
                    destCol = $cell.index(),
                    destRow = $cell.closest("tr").index(),
                    minCol = Math.min(origCol, destCol),
                    maxCol = Math.max(origCol, destCol),
                    minRow = Math.min(origRow, destRow),
                    maxRow = Math.max(origRow, destRow);
                if (!$cell.is($focused)) {
                    // We let the user select the text in one cell. If he moves over another
                    // cell, we disable selection.
                    $placeholder.addClass("no-select");
                }
                // Select all cells between that focused cell and $cell
                $placeholder.find("tbody tr > td").each(function(){
                    var $this = $(this),
                        col = $this.index(),
                        row = $this.closest("tr").index();
                    if (   col >= minCol && col <= maxCol
                        && row >= minRow && row <= maxRow) {
                        $this.addClass(that.mapCss("selected"));
                    } else {
                        $this.removeClass(that.mapCss("selected"));
                    }
                });
            };

            if (mouseupTriggered) {
                // Since the mouseup was already triggered, no need to attach the handler
            } else {
                window.PlaySQL.Selection.attach($(window.document), that, {
                    "mouseover.select-drag td" : selectDragCell
                });
            }

            // Yeg, select something so the 'copy' event can be raised
            window.PlaySQL.Selection.setNonCollapsedSelection(that, !!that.options.pasteHandler);
        }, 0);
    }

    var resizing = false,
        isHovering,
        minPageY, maxPageY;
    var headerMouseEnter = function($cell, e) {
        isHovering = true;
        if (resizing) return;
        var offset = $cell.offset(),
            width = $cell.outerWidth(),
            height = $cell.outerHeight(),
            left = offset.left + width - 10,
            top = offset.top,
            $placeholder = $cell.closest(".playsql-spreadsheet-placeholder"),
            $handle = $placeholder.find(".playsql-resize-handle");

        // Find the closest positioned element, that's the one which "position:relative" is relative to
        var $container = $cell;
        while ($container.css("position")=="static" && $container.parent().size() > 0) {
            $container = $container.parent();
        }
        var containerTop = $container.offset().top,
            containerLeft = $container.offset().left;

        // Determine the upper and lower allowed bounds of the cursor
        minPageY = top - 20;
        maxPageY = top + height + 20;

        $handle.remove();
        $handle = $("<div>", { "class": "playsql-resize-handle" });
        $cell.append($handle);
        $handle.css({
            top: (top - containerTop) + "px",
            left: (left - containerLeft) + "px",
            height: height + "px"
        }).removeClass("hidden");
    }
    var headerMouseLeave = function($cell, e) {
        if (!resizing) {
            $(".playsql-resize-handle").addClass("hidden");
        }
    }
    var resizeHandleMousedown = function($handle, e) {
        resizing = true;
        var pageX = e.pageX,
            $cell = $handle.closest("th"),
            originalWidth = $cell.width(),
            originalLeft = parseInt($handle.css("left")),
            playsqlSelection = this;
        $handle.addClass("dragging");

        $(document).on('selectstart.playsql-resize', function (e) {
            e.preventDefault();
        });

        $(document).on("mousemove.playsql-resize", function(e) {
            var newPageY = e.pageY;
            isHovering = newPageY > minPageY && newPageY < maxPageY;
            if (!isHovering) {
                $handle.addClass("hidden");
                playsqlSelection.options.updateColumnWidth && playsqlSelection.options
                    .updateColumnWidth.call(playsqlSelection, $cell, null, false);
            } else {
                var newPageX = e.pageX,
                    newWidth = originalWidth - pageX + newPageX,
                    newLeft = originalLeft - pageX + newPageX;
                if (newWidth < 20) {
                    newWidth = 0;
                }
                playsqlSelection.options.updateColumnWidth && playsqlSelection.options
                    .updateColumnWidth.call(playsqlSelection, $cell, newWidth, false);
                $handle.css("left", newLeft + "px").removeClass("hidden");
            }
        });

        $(document).on("mouseup.playsql-resize", function(e) {
            e.preventDefault();
            $(document).off(".playsql-resize");
            $handle.removeClass("dragging");
            resizing = false;
            var width = isHovering ? $cell.width() : null;
            if (width != null && Math.abs(originalWidth - width) < 3) {
                // It's a header click. We let the fw decide whether it's a first or second click.
                $cell.click();
            } else {
                playsqlSelection.options.updateColumnWidth && playsqlSelection.options
                    .updateColumnWidth.call(playsqlSelection, $cell, width, true);
            }
        });
    };
    var dodgeClick = function($handle, e) {
        // Prevent the resize handle from feeling selected
        e.preventDefault();
        return false;
    }

    /** Depending on selection.options.cssClassMap, returns the equivalent CSS classes.
     * E.g.: mapClass("selected") returns "selected" by default.
     * When selection.options.cssClassMap == {"selected": "cell-ref-active"}, it returns "cell-ref-active"
     * @param cssClassName the name of the class. Several classes can be passed with a comma.
     * @return the mapped class names separated by a space
     */
    function mapCss(cssClassName) {
        if (!this.options.cssClassMap) return cssClassName;
        function isSpecialChar(a) {
            switch (a) {
                case '':
                case ' ':
                case ',':
                case '.':
                case '[':
                case ']':
                    return true;
                default:
                    return false;
            }
        }
        var parts = [""],
            state = false;
        // It loops on length+1 characters, because the last (virtual) one is considered
        // as a separator and it ensures the last class is transformed too.
        for (var i = 0 ; i <= cssClassName.length ; i++) {
            if (isSpecialChar(cssClassName.charAt(i))) {
                if (state) {
                    // The last string on "parts" is a CSS classname
                    var val = this.options.cssClassMap[parts[parts.length - 1]];
                    if (val) {
                        parts[parts.length - 1] = val;
                    }
                }
                state = false;
            } else {
                if (!state) parts.push("");
                state = true;
            }
            parts[parts.length - 1] += cssClassName.charAt(i);
        }
        var result = parts.join("");
        return result;
    }

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-base-web', location = 'templates/playsql-common.soy' */
// This file was automatically generated from playsql-common.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PlaySQL.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PlaySQL == 'undefined') { Confluence.Templates.PlaySQL = {}; }


Confluence.Templates.PlaySQL.editTotalsCell = function(opt_data, opt_ignored) {
  return '<input class="totals-label" placeholder="' + soy.$$escapeHtml("(Placez le libell\xe9 ici)") + '" value="' + soy.$$escapeHtml(opt_data.label) + '">&nbsp;=<input class="totals-calculation" value="' + soy.$$escapeHtml(opt_data.calculation) + '">';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.editTotalsCell.soyTemplateName = 'Confluence.Templates.PlaySQL.editTotalsCell';
}


Confluence.Templates.PlaySQL.formulaHelp = function(opt_data, opt_ignored) {
  var output = '<div class="formula-help-popup"><p>' + soy.$$filterNoAutoescape(AJS.format("Ecrire une expression SQL ici. \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3eAide sur les formules\x3c/a\x3e.",'http://documentation.play-sql.com/display/PUBLIC/Formulas')) + '</p>';
  var keyList15 = soy.$$getMapKeys(opt_data.fields);
  var keyListLen15 = keyList15.length;
  for (var keyIndex15 = 0; keyIndex15 < keyListLen15; keyIndex15++) {
    var keyData15 = keyList15[keyIndex15];
    output += ((keyData15) ? '<p>' + soy.$$escapeHtml(AJS.format("{0} champs:",keyData15)) + '</p>' : '<p>' + soy.$$escapeHtml("Champs disponibles:") + '</p>') + '<ul>';
    var fieldList26 = opt_data.fields[keyData15];
    var fieldListLen26 = fieldList26.length;
    for (var fieldIndex26 = 0; fieldIndex26 < fieldListLen26; fieldIndex26++) {
      var fieldData26 = fieldList26[fieldIndex26];
      output += '<li>' + soy.$$escapeHtml(fieldData26) + '</li>';
    }
    output += '</ul>';
  }
  if (opt_data.examples != null && opt_data.examples.length > 0) {
    output += '<p>' + soy.$$escapeHtml("Exemples :") + '</p><ul class="examples">';
    var exampleList38 = opt_data.examples;
    var exampleListLen38 = exampleList38.length;
    for (var exampleIndex38 = 0; exampleIndex38 < exampleListLen38; exampleIndex38++) {
      var exampleData38 = exampleList38[exampleIndex38];
      output += '<li><a href="#">' + soy.$$escapeHtml(exampleData38) + '</a></li>';
    }
    output += '</ul>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.formulaHelp.soyTemplateName = 'Confluence.Templates.PlaySQL.formulaHelp';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/js/playsql-macro-view.js' */
/** This is the legacy macro */
var PlaySQLMacro = (function() {
    var $ = AJS.$;

    function initialize($playsql) {
        if ($playsql.data("initialized")) {
            AJS.log("PlaySQL is already initialized.");
            return;
        }
        $playsql.data("initialized", true);

        var $placeholder = $playsql.closest('.playsql-placeholder');
        $placeholder.find('.playsql-user-parameters .submit-user-parameters').click(function(){
            PlaySQLMacro.load($placeholder);
        });
        $placeholder.find('.playsql-user-parameters input').keypress(function(e){
            if (e.keyCode == 13) {
                PlaySQLMacro.load($placeholder);
            }
        });
    }


    return {
        Renderer : {
            key : "abstract-renderer"
        },
        /** $playsql must be a "table.playsql" element. */
        initialize : initialize,
        /** $placeholder must be a jQuery object of <div class="playsql-placeholder" data-sql="SELECT * FROM PERSON"> */
        load : function ($placeholder) {
            var htmlRest = PlaySQL.SPI.baseUrlOld("/playsql/html"),
                data = $placeholder.data(),
                macroParameters = {},
                jsonParameters = [],//['user-parameters', 'groupby', 'orderby'], jquery already applies isJSON.
                $userParameters = $('.playsql-user-parameters input', $placeholder),
                ceoId = AJS.Meta.get("content-id") || AJS.Meta.get("page-id");
            for (var key in data) {
                var key2 = key.replace(/([a-z\d])([A-Z])/g, '$1-$2').toLowerCase();
                if (key2.indexOf('macro-') == 0) {
                    var name = key2.substring(6);
                    if ($.inArray(name, jsonParameters)) {
                        macroParameters[name] = data[key];
                    } else {
                        macroParameters[name] = $.parseJSON(data[key]);
                    }
                }
            }
            if ($userParameters.size() > 0 && macroParameters['user-parameters']) {
                var parameters = macroParameters['user-parameters'];
                $userParameters.each(function(i){
                    var $this = $(this),
                        name = $this.attr('name'),
                        val = $this.val(),
                        parameter = parameters[i];
                    if (parameter && name == parameter.name) {
                        parameter.value = val;
                    }
                });
            }
            if (!macroParameters.context || macroParameters.context == 'space:' || macroParameters.context == 'name:') {
                var spaceKey = AJS.Meta.get('space-key');
                if (spaceKey)
                    macroParameters.context = 'space:' + spaceKey;
            }
            for (var key in macroParameters) {
                var value = macroParameters[key];
                if (value == undefined || value === "" || (key != "sql" && typeof value == "string" && value.indexOf("$") == 0))
                    delete macroParameters[key];
            }
            if (ceoId) macroParameters["ceoId"] = ceoId;
            $.ajax({
                url:htmlRest,
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(macroParameters),
                timeout: 180000
            }).done(function(data) {
                $placeholder.html(data.html);
                if (!macroParameters.readonly) {
                    $placeholder.find("table.playsql").each(function() {
                        initialize($(this));
                    });
                }
            }).fail(function(jqXHR, errorMessage, errorObject){
                AJS.logError("PlaySQL: Error while retrieving data.", jqXHR, errorMessage, errorObject);
                $placeholder.html("Could not display PlaySQL: " + errorMessage);
            });
            $placeholder.find('table:first').addClass('loading');
        }
    };
})();

AJS.$(document).ready(function($) {
    // Initialise the playsql
    $("div.playsql-placeholder").each(function() {
        var $placeholder = $(this);
        PlaySQLMacro.load($placeholder);
    });
});


}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/query/query-view.js' */
(function($) {
    window.PlaySQL = window.PlaySQL || {};
    window.PlaySQL.Query = window.PlaySQL.Query || {};
    window.PlaySQL.Query.piertotumLocomotor = function ($placeholder, options) {
        // Enable PlaySQL Selection on the query
        // With what-it-needs for the Totals
        window.PlaySQL.Selection.forTable($placeholder).init($.extend({
            baseSelector: ".playsql-query-placeholder table",
            canSelectFooter: true,

            popupTrigger: ".totals-row .totals-calculation",
            popupContentFn: function($content, trigger, showPopup) {
                var fields = [],
                    exampleTemplates = ['SUM(%s)', 'ROUND(AVG(%s))', 'MAX(%s)'],
                    examples = [],
                    originalFieldName, fieldName, type, template;
                $placeholder.find("thead th:visible").each(function(){
                    var $this = $(this),
                        originalFieldName = $.trim($this.text()),
                        defaultCase = $placeholder.attr('data-ds-case') || 'LOWER',
                        fieldName = defaultCase == 'LOWER' ? originalFieldName.toLowerCase() : originalFieldName.toUpperCase();
                    if (originalFieldName != "") {
                        if (fieldName != originalFieldName) {
                            fieldName = '"' + originalFieldName + '"';
                        }
                        fields.push(fieldName);
                    }
                });

                $content.html(Confluence.Templates.PlaySQL.formulaHelp({fields:{'':fields}}));
                $content.children().first().on("click", ".examples a", function() {
                    $(trigger).val($(this).text()).focus();
                    window.PlaySQL.Selection.inlineDialog && window.PlaySQL.Selection.inlineDialog.hide();
                    return false;
                });
                showPopup();
            }
        }, options));
    }
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/js/built-in-renderers.js' */
/**
 * Those are all Renderer1 renderers.
 * I even wonder whether playsql-init is ever triggered.
 * @deprecated Use Renderer2 instead.
 **/
AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "default-renderer"
  }));
});


AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "string-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "integer-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "boolean-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "hidden-column-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "id-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "read-only-default-renderer"
  }));
});

AJS.$(document).bind("playsql-init", function(event, api) {
  api.register(PlaySQLMacro.Renderer.extend({
    key : "unknown-type-renderer"
  }));
});

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/js/browser-loader.js' */
/**
 * This file binds the click on the red top-left cell to the SQL textarea. 
 */
AJS.$(function($){
  
  function openBrowser(clickedElement) {
    var componentClickedPlaceholder = $(clickedElement).closest("div.playsql-placeholder");
    if (componentClickedPlaceholder.prev("form#query-form").is(":visible"))
    {
      return;
    }
    componentClickedPlaceholder.before(Confluence.Templates.PlaySQL.browserForm());
    $form = componentClickedPlaceholder.prev("form#query-form")
    if ($form.size() != 1) {
      throw "Browser was not inserted";
    }
    PlaySQLBrowser.initialize($form);
  }
  
  $(document).delegate("div:not(.playsql-query-placeholder, .playsql-spreadsheet-placeholder) > table.playsql thead tr th:first-child a", "click", function(e) {
    e.preventDefault();
    openBrowser(e.target);
  });

  $(".playsql-placeholder").each(function() {
    if ($(this).data("open-browser"))
    {
      openBrowser(this);
    }
  });
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/js/browser.js' */
/**
 * This file loads the SQL browser, for any existing macro.
 * "SQL Browser" = textarea just before the div.playsql-placeholder
 * in which the user may enter SQL to update the placeholder and re-query the
 * results.
 */

var PlaySQLBrowser = PlaySQLBrowser || {}; 

(function($){

  var fieldAccessor = function(fieldNameInMacro, selector, overrides, isJSON, isSaved) {
    function getWiget(selector) {
      return PlaySQLBrowser.initialized.$queryForm.find(selector);
    };
    return $.extend({
      /** @param value string format of a value */
      setField : function(value) {
        if (getWiget(selector).size() == 0) {
          PlaySQLBrowser.initialized.showField2(fieldNameInMacro, value);
        }
        if (getWiget(selector).size() > 0) {
          getWiget(selector).val(value);
        }
      },
      /** @return value string format of a value */
      getField : function() {
        if (getWiget(selector))
          return getWiget(selector).val();
      },
      /** 
       * Sets the data() in string format
       * @param value string format of the value */
      set : function(value) {
        if (isJSON && typeof value == 'string') {
          value = $.parseJSON(value);
        } 
        PlaySQLBrowser.initialized.$placeholder.data(fieldNameInMacro, value);
      },
      /** 
       * Gets the value from the data parameter (data is in string format).
       * @return value the object format of the value */
      getObject : function() {
        var value = PlaySQLBrowser.initialized.$placeholder.data(fieldNameInMacro);
        if (isJSON && typeof value == "string") {
          value = $.parseJSON(value);
        }
        return value;
      },
      /** 
       * @return value the string format of the value */
      getString : function() {
        var value = PlaySQLBrowser.initialized.$placeholder.data(fieldNameInMacro);
        if (isJSON && typeof value == "object") {
          value = JSON.stringify(value);
        }
        return value;
      },
      isJSON : function() {
        return isJSON;
      },
      isSaved : function() {
        return isSaved;
      }
    }, overrides);
  };

  PlaySQLBrowser.fields = {
    'sql' : fieldAccessor('macro-sql', '.sql', undefined, undefined, true),
    'timeout': fieldAccessor('macro-timeout', '#timeout', undefined, undefined, true),
    'context': fieldAccessor('macro-context', "#context-selector", undefined, undefined, true),
    'readonly' : fieldAccessor('readonly', undefined, undefined, undefined, false),
    'open-browser': fieldAccessor('macro-open-browser', undefined, undefined, undefined, false),
    'groupby': fieldAccessor('macro-groupby', undefined, {}, true, true),
    'built-in-parameters': fieldAccessor('macro-built-in-parameters', "#built-in-parameters", {
        getField : function() {
            if ($("#built-in-parameters:visible").size() == 1) {
                return true;
            } else {
                return false;
            }
        },
        setField : function(value) {
            if (value === 'true' || value === true) {
                PlaySQLBrowser.initialized.showField2('macro-built-in-parameters', value);
            }
        }

    }, false, true),
    'user-parameters': fieldAccessor('macro-user-parameters', undefined, {
      setField : function(values) {
        var values = $.parseJSON(values);
        $('*[name="user-parameter"]').closest('.field-group').remove();
        for (var i in values) {
          PlaySQLBrowser.initialized.showField('user-parameter', values[i]);
        }
      },
      getField : function() {
        var values = [];
        $('*[name="user-parameter"]').each(function(){
          var $this = $(this),
              $fieldGroup = $this.closest('.field-group'),
              name = $this.val(),
              label = $fieldGroup.find('*[name="user-parameter-label"]').val(),
              defaultValue = $fieldGroup.find('*[name="user-parameter-default"]').val();
          if (name) {
            values.push({
              name: name,
              label: label,
              defaultValue: defaultValue
            });
          }
        });
        return values.length == 0 ? null : JSON.stringify(values);
      }
    }, true, true)
  };
  
  
/**
 * Initializes the browser features.
 * @param $queryForm the form#query-form in which all elements of the browser can be found. 
 */ 
PlaySQLBrowser.initialize = function($queryForm){
  if (PlaySQLBrowser.initialized) {
    throw 'The browser for Play SQL has already been initialized';
  }
  var $ = AJS.$,
      $sqlInput = $queryForm.find("textarea.sql"),
      $submitBtn = $queryForm.find("input.submit-sql"),
      $placeholder = $queryForm.next(".playsql-placeholder"),
      $autocomplete = $('#autocomplete-sql'),
      autocompleteEntries = $('<ul/>'),
      autocompleteActivated = false;
  PlaySQLBrowser.initialized = {
      $sqlInput : $sqlInput,
      $placeholder : $placeholder,
      $queryForm : $queryForm
  }

  $submitBtn.click(function(e) {
    e.preventDefault();
    PlaySQLBrowser.synchronizeValues();
    PlaySQLBrowser.query();
  });
  
  // According to the datasource in the combo box, update the macro placeholder
  var datasources,
      datasourceAvailableCallback,
      whenDatasourcesAvailable = function(callBack) {
        if (datasources) {
          callBack(datasources);
        } else {
          datasourceAvailableCallback = callBack;
        }
      };
      
  $.ajax(PlaySQL.SPI.baseUrlOld('playsql/contexts')).done(function(data){
    if (data) {
      datasources = data;
      if (datasourceAvailableCallback) {
        datasourceAvailableCallback(data);
      }
    }
  });

  $sqlInput.keydown(function(e) {
    if (e.ctrlKey && (e.keyCode == 13 || e.keyCode == 10)) {
      $submitBtn.click();
    } else if (e.ctrlKey && (e.keyCode == 32)) {
      autocompleteActivated = true;
      window.setTimeout(autocomplete, 0);
    } else {
      window.setTimeout(function(){
        updateAutocomplete(getUserLastWord());
      }, 0);
    }
  }).blur(function(e) {
    $autocomplete.hide();
    autocompleteActivated = false;
  });

//  $queryForm.find(".hide-browser").click(function(e){
//    e.preventDefault();
//    $queryForm.remove();
//  });

  function autocomplete() {
      return;
  }

  function getUserLastWord() {
    var selStart = $sqlInput[0].selectionStart,
        snippet, lastWord;
    
    if (!selStart || !$sqlInput.val()) {return;}
    snippet = $sqlInput.val().substring(0, selStart);
    if (!snippet) { return; }
    lastWord = snippet.substring(snippet.lastIndexOf(' ') + 1);
    return lastWord;
  }

  /* After an autocomplete, As the user types, reduces the matched items */ 
  function updateAutocomplete(startingWith) {
    if (autocompleteEntries.length==0 || !autocompleteActivated) return;
    startingWith = startingWith.toUpperCase();
    startingWith = startingWith.substring(startingWith.lastIndexOf('.')+1);
    
    var // Copy the values
        $newList = $('<ul/>'),
        $startingWith = $('<b/>').text(startingWith);
    
    for (var idx in autocompleteEntries) {
      var entry = autocompleteEntries[idx];
      if (entry.text) {
        if (idx == 15 && autocompleteEntries.length > 16) {
          $('<li/>').text('...').appendTo($newList);
          break;
        }
        if (entry.text.toLowerCase().indexOf(startingWith.toLowerCase()) == 0) {
          $('<li/>').text(entry.text.substring(startingWith.length)).prepend($startingWith.clone()).appendTo($newList);
        }
      }
    }
    $autocomplete.html($newList.children());
  }

  var dialog2 = AJS.InlineDialog(AJS.$('.display-more'), 188, function($defaultContents, trigger, showPopup) {
    $defaultContents.html("Some info: <ul><li>Press Ctrl + Space for autocompletion.</li>" +
    		                       "<li>Press Ctrl + Enter to submit the query.</li></ul>");
    showPopup();
  });
  
  
  var $addCombo = $("#addOption").click(function(){
    var $dropDown = $(this);
    $("option.unique", $dropDown).each(function(){
      var $option = $(this),
          name = $option.attr('value'),
          $fieldGroup = $("#" + name).parent();
      if ($fieldGroup.size() > 0 && $fieldGroup.is(":visible")) {
        $option.hide();
      } else {
        $option.show();
      }
    });
    
  }).change(function(){
    var name = $addCombo.val();
    if (name == 'initial') {
      return;
    }
    $(this).val("initial");
    if (!PlaySQLBrowser.initialized.showField(name)) {
      $("#addOptionError").removeClass('hidden');
      return;
    }
  });
  

  PlaySQLBrowser.initialized.showField2 = function(fieldNameInMacro, value) {
    // The first argument should be the name of the <option> tag
    // Translations between parameter name, name of the <option> and name of the #element
    var translations = {
        'macro-timeout' : 'timeout',
        'macro-context' : 'context-selector',
        'macro-built-in-parameters' : 'built-in-parameters',
        'macro-user-parameters' : 'user-parameter'
    },
        name = translations[fieldNameInMacro] || fieldNameInMacro;
    PlaySQLBrowser.initialized.showField(name, value);
  }
  
  /**
   * Shows a parameter of the form
   * @param name
   * @param value
   * @returns {Boolean} true if successful
   */
  PlaySQLBrowser.initialized.showField = function(name, value) {
    if (name == 'macro-context') name ='context-selector';
    var $option = $("option[value='" + name + "']", $addCombo),
        $fieldGroup = $("#" + name).parent();
    if ($option.size() == 0) {
      return false;
    }
    
    if (name == 'user-parameter' && !value) {
      value = {
          name : "$param1",
          label : "Enter the value",
          defaultValue : "My default value"
      }
    } else if (name == 'built-in-user-parameter' && value === undefined) {
        value = true;
    }
    
    // Add a new group
    var $newGroup = $(Confluence.Templates.PlaySQL.addParameter({name : name, value: value})).removeClass('hidden');
    $addCombo.parent().before($newGroup);

    if (name == 'context-selector') {
      whenDatasourcesAvailable(function(datasources){
        var context = $placeholder.data('macro-context'),
            contextHalves = context ? context.split(':') : [],
            spaceKey = contextHalves.length == 2 && contextHalves[0] == 'space' ? contextHalves[1] : undefined,
            currentSpaceKey = AJS.Meta.get('space-key'),
            contextName = contextHalves.length == 2 && contextHalves[0] == 'name' ? contextHalves[1] : undefined, 
            html = Confluence.Templates.PlaySQL.datasourceOptions({
              datasources: datasources, 
              spaceKey: spaceKey, 
              currentSpaceKey : currentSpaceKey,
              contextName: contextName
            }),
            $contextSelector = $("#context-selector");
        $contextSelector.html(html);
        if (value) {
          $contextSelector.val(value);
        }
        $contextSelector.change(function() {
          var value = $(this).val(),
              contextName = '',
              contextSpaceKey = '';
          if (!value) {
            // Leave empty strings
          } else if (value.indexOf('name:') == 0) {
            contextName = value.substring(5);
          } else if (value.indexOf('space:') == 0) {
            contextSpaceKey = value.substring(6);
          }
          $(".playsql-placeholder")
            .data('space-key', contextSpaceKey)
            .data('context-name', contextName);
        });
      });
    }
    return true;
  }
  
  $queryForm.delegate('.playsql-parameter-remove', 'click', function(e){
    e.preventDefault();
    var $button = $(this),
        $fieldGroup=$button.parent();
    if ($button.hasClass('remove-mode-delete')) {
      $fieldGroup.remove();
    } else if ($button.hasClass('remove-mode-hide')) {
      $fieldGroup.addClass('hidden');
    }
  });
  
  // Load the values from the placeholder into the fields
  PlaySQLBrowser.synchronizeValuesFromPlaceholder(PlaySQLBrowser.initialized.$placeholder);
}

PlaySQLBrowser.query = function() {
  PlaySQLMacro.load(PlaySQLBrowser.initialized.$placeholder);
}


// Sets the values passed as argument into the fields.
// Put all the values of the fields into the data of $placeholder,
// and returns them.
/**
 * Sets the values passed as argument into the fields.
 * Put all the values of the fields in to the data of $placeholder.
 * @param values the string format of the values
 * @return the data to save in the macro
 */
PlaySQLBrowser.synchronizeValues = function(values) {
  if (!PlaySQLBrowser.initialized) throw "The PlaySQL browser isn't open yet";
  var toReturn = {};
  values = values || {};
  /*values['groupby'] = JSON.stringify({
      fields : ['TABLE_SCHEMA'],
      aggregations : [{
        title: 'Total 1',
        expression: 'MAX(TABLE_NAME)'
      }],
      having : "TABLE_SCHEMA IS NOT NULL"
  };
  values['orderby'] = JSON.stringify({
      fields : [{
        field : 'TABLE_SCHEMA',
        ordering : 'ASC',
        nulls : 'LAST'
      }]
  };*/
  for (var fieldName in PlaySQLBrowser.fields) {
    var field = PlaySQLBrowser.fields[fieldName],
        value = values[fieldName];
    if (typeof value != 'undefined') {
      field.setField(value);
    } else {
      value = field.getField();
    }
    // Update all 'data' parameters of the placeholder
    if (typeof value != 'undefined') {
      field.set(value);
      if (field.isSaved()) toReturn[fieldName] = value;
    } else {
      if (field.isSaved()) toReturn[fieldName] = field.getString();
    }
  }
  return toReturn;
}

// Loads all the values from the placeholder into the fields
PlaySQLBrowser.synchronizeValuesFromPlaceholder = function($placeholder) {
  for (var fieldName in PlaySQLBrowser.fields) {
    var field = PlaySQLBrowser.fields[fieldName],
        value = field.getString();
    if (value)
      field.setField(value);
  }
}

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'templates/browser-form.soy' */
// This file was automatically generated from browser-form.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PlaySQL.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PlaySQL == 'undefined') { Confluence.Templates.PlaySQL = {}; }


Confluence.Templates.PlaySQL.browserForm = function(opt_data, opt_ignored) {
  return '<form action="#" id="query-form" class="aui unsectioned aui-dd-parent playsql-browser"><fieldset><div class="field-group"><label for="sql">SQL</label><textarea name="sql" class="sql"></textarea></div><div class="field-group"><label for="addOption">More options</label><select class="select medium-field" id="addOption" name="addOption"><option value="initial">- Select an option -</option><option value="context-selector" class="unique">Context</option><option value="timeout" class="unique">Timeout</option><option value="built-in-parameters">Built-in Parameters</option><option value="user-parameter">User Parameter</option></select><div class="error hidden" id="addOptionError">An error happened while creating the field</div></div></fieldset><div class="buttons-container"><div class="buttons"><input class="submit-sql button" type="submit" />&nbsp;<a class="display-more" href="#">More...</a>&nbsp;</div></div><div class="aui-dd-trigger" /><ul class="aui-dropdown hidden" id="autocomplete-sql"><li class="dropdown-item">-</li></ul></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.browserForm.soyTemplateName = 'Confluence.Templates.PlaySQL.browserForm';
}


Confluence.Templates.PlaySQL.addParameter = function(opt_data, opt_ignored) {
  return '' + ((opt_data.name == 'context-selector') ? Confluence.Templates.PlaySQL.parameterLine({name: opt_data.name, label: 'Context', html: '<select class="select medium-field" id="context-selector" name="context-selector" title="context-selector"></select>', removeMode: 'hide'}) : (opt_data.name == 'timeout') ? Confluence.Templates.PlaySQL.parameterLine({name: opt_data.name, label: 'Timeout', html: '<input class="text short-field" type="text" id="' + soy.$$escapeHtml(opt_data.name) + '" name="' + soy.$$escapeHtml(opt_data.name) + '" title="Timeout in milliseconds, e.g. 30000" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value) + '"' : '') + '>&nbsp;ms', removeMode: 'delete'}) : (opt_data.name == 'built-in-parameters') ? Confluence.Templates.PlaySQL.parameterLine({name: opt_data.name, label: 'Built-in Parameters', html: '<div class="free-text-in-form" type="text" id="' + soy.$$escapeHtml(opt_data.name) + '" name="' + soy.$$escapeHtml(opt_data.name) + '" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value) + '"' : '') + '>$userName, $userFullName, $email, $creator, $lastModifier $ceoType, $ceoId, $pageId, $pageTitle, $parentPageId, $parentPageTitle, $spaceKey, $spaceName</div>', removeMode: 'delete'}) : (opt_data.name == 'user-parameter') ? Confluence.Templates.PlaySQL.parameterLine({name: opt_data.name, label: 'Replacement Parameter', html: '<input class="text medium-field" type="text" name="' + soy.$$escapeHtml(opt_data.name) + '" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value.name) + '"' : 'value="$param1"') + 'title="The string to replace in the query. One of: &quot;$param1&quot;, &quot;$!param1&quot; and &quot;?&quot;">&nbsp; Label:&nbsp;<input class="text medium-field" type="text" name="' + soy.$$escapeHtml(opt_data.name) + '-label" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value.label) + '"' : '') + ' title="The prompt for the user">Default Value:&nbsp;<input class="text medium-field" type="text" name="' + soy.$$escapeHtml(opt_data.name) + '-default" ' + ((opt_data.value) ? 'value="' + soy.$$escapeHtml(opt_data.value.defaultValue) + '"' : '') + ' title="The default value">', removeMode: 'delete'}) : '');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.addParameter.soyTemplateName = 'Confluence.Templates.PlaySQL.addParameter';
}


Confluence.Templates.PlaySQL.parameterLine = function(opt_data, opt_ignored) {
  return '<div class="field-group hidden"><button class="playsql-parameter-remove remove-mode-' + soy.$$escapeHtml(opt_data.removeMode) + ' button" title="Click to hide this option">Remove</button><label for="' + soy.$$escapeHtml(opt_data.name) + '">' + soy.$$escapeHtml(opt_data.label) + '</label>' + soy.$$filterNoAutoescape(opt_data.html) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.parameterLine.soyTemplateName = 'Confluence.Templates.PlaySQL.parameterLine';
}


Confluence.Templates.PlaySQL.datasourceOptions = function(opt_data, opt_ignored) {
  var output = '' + ((opt_data.spaceKey) ? '<option value="space:' + soy.$$escapeHtml(opt_data.spaceKey) + '" selected="selected">Space ' + soy.$$escapeHtml(opt_data.spaceKey) + '</option>' + ((! (opt_data.spaceKey == opt_data.currentSpaceKey)) ? '<option value="space:">Current Space</option>' : '') : (opt_data.contextName) ? '<option value="name:' + soy.$$escapeHtml(opt_data.contextName) + '" selected="selected">' + soy.$$escapeHtml(opt_data.contextName) + '</option><option value="space:">Current Space</option>' : '<option value="space:" selected="selected">Current Space</option>');
  var datasourceList110 = opt_data.datasources;
  var datasourceListLen110 = datasourceList110.length;
  for (var datasourceIndex110 = 0; datasourceIndex110 < datasourceListLen110; datasourceIndex110++) {
    var datasourceData110 = datasourceList110[datasourceIndex110];
    output += (datasourceData110.name) ? (! (opt_data.contextName == datasourceData110.name)) ? '<option value="name:' + soy.$$escapeHtml(datasourceData110.name) + '">$' + soy.$$escapeHtml(datasource.name) + '</option>' : '' : (datasourceData110.spaceKey) ? (! (opt_data.spaceKey == datasourceData110.spaceKey) && ! (opt_data.currentSpaceKey == datasourceData110.spaceKey)) ? '<option value="space:' + soy.$$escapeHtml(datasourceData110.spaceKey) + '">Space ' + soy.$$escapeHtml(datasourceData110.spaceKey) + '</option>' : '' : '';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.datasourceOptions.soyTemplateName = 'Confluence.Templates.PlaySQL.datasourceOptions';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro.js' */
(function($){

    var checkNotNull = window.PlaySQL.Helpers.checkNotNull;

    /**
     * @deprecated this id is not unique on the page
     * @param id
     * @returns {*}
     */
    function byId(id) {
        if (window.PlaySQL.Spreadsheet.spreadsheets[id]) {
            return window.PlaySQL.Spreadsheet.spreadsheets[id];
        }

        if (id.hasClass && id.hasClass("playsql-spreadsheet-placeholder")) {
            // The guy substituted a jquery element for the id. Swap that.
            return byPlaceholder(id);
        } else {
            var $placeholder = $(".playsql-spreadsheet-placeholder[data-macro-spreadsheet-id='" + id + "'");
            if ($placeholder.size() != 1) throw "No placeholder with ID " + id;
            return byPlaceholder($placeholder);
        }
    }
    function byPlaceholder($placeholder) {
        var spreadsheet = $placeholder.data('playsql-spreadsheet');
        if (spreadsheet) return spreadsheet;
        spreadsheet = {
            $placeholder: $placeholder,
            id : $placeholder.attr('data-macro-spreadsheet-id'),
            context : $placeholder.attr('data-macro-context'),
            label: undefined,
            columns: undefined,
            whereClause : $placeholder.attr('data-macro-where-clause'),
            whereClauseColumnFilters : undefined,
            whereClauseConsolidated : undefined,
            orderbyClause : $placeholder.attr('data-macro-orderby-clause'),
            displayColumns : $placeholder.attr('data-macro-display-columns'),
            pagination: undefined,
            permlevel : $placeholder.attr('data-macro-permlevel'),
            perms : window.PlaySQL.Helpers.parsePerms($placeholder.attr('data-macro-permlevel')),
            customEmptyMessage : $placeholder.attr('data-macro-custom-empty-message'),
            decimalSeparator : '.',
            defaultCase: undefined,
            dialect: undefined,
            mode: undefined, // Mode: READ_ONLY or READ_WRITE
            systemColumnsMode: undefined, // JUST_USE or SYNTHETIC
            // When we want to pipe the requests to the server, we just create an array here.
            requestPipe : undefined,
            totals: undefined,
            /* If provided, this definition is used instead of the model
             * saved in the database for the time of this request. Optional.
             */
            queryModelOverride: undefined,
            /* The list of user parameters. To be displayed before the spreadsheet. */
            userParameters: [],
            /* If user parameters are present, whether the form should be displayed */
            useForm: undefined,
            options : {
                onDisplay: undefined,
                onSelectionSet: undefined,
                onChangeTotals: undefined,
                saveTotals: undefined,
                saveColumn: undefined
            },
            /* Disables focusing on cells while the js is editing the spreadsheet (pasteHandler) */
            disableFocusManagement: false
        };

        if (!spreadsheet.id) throw "No ID on placeholder " + $placeholder.html();
        $placeholder.data('playsql-spreadsheet', spreadsheet);

        /**
         * Builds and returns the base url for a rest request
         * @param endpoint the resource name, such as "/data". The last path can
         *          be an object, in this case it's considered as the query params
         */
        var baseUrl = function(endpoint, paths, queryParams) {
            var args = [spreadsheet.context + "/" + spreadsheet.id];
            for (var i = 0 ; i < arguments.length ; i++) {
                args.push(arguments[i]);
            }
            return PlaySQL.SPI.baseUrl.apply(this, args);
        }

        var baseUrlForContext = function(endpoint, paths, queryParams) {
            var args = [spreadsheet.context];
            for (var i = 0 ; i < arguments.length ; i++) {
                args.push(arguments[i]);
            }
            return PlaySQL.SPI.baseUrl.apply(this, args);
        }

        /** Loads the spreadsheet.
         */
        var load = function(urlParameters, requestOptions) {
            if($.browser.msie && $.browser.version <= 8) {
                checkNotNull($placeholder.find(".playsql-message-inner")).text("Internet Explorer 8 is not supported.");
                return;
            }
            spreadsheet.whereClauseConsolidated = window.PlaySQL.Spreadsheet.ColumnToolbar.buildWhereClause(spreadsheet.whereClause, spreadsheet.whereClauseColumnFilters, spreadsheet.dialect);
            notifyMacroBrowserIfExists(spreadsheet);
            var urlOptions = {
                whereClause : spreadsheet.whereClauseConsolidated,
                orderby : spreadsheet.orderbyClause,
                columns: spreadsheet.displayColumns
            };
            // At first load, we can send the provided user parameters
            $.each($placeholder[0].attributes, function(){
                if (this.specified && this.name.indexOf("data-user-parameter-") == 0) {
                    var attrName = this.name.substr("data-".length);
                    urlOptions[attrName] = this.value;
                }
            });
            // On subsequent calls we can send back the parameters returned by the first call
            if (!!spreadsheet.userParameters && spreadsheet.userParameters.length > 0) {
                for (var i = 0; i < spreadsheet.userParameters.length ; i++) {
                    var param = spreadsheet.userParameters[i];
                    if (!param.builtIn) {
                        var paramName = "user-parameter-" + param.cleanName;
                        if (typeof param.value != "undefined") {
                            urlOptions[paramName] = param.value;
                        }
                    }
                }
            }
            $.extend(urlOptions, urlParameters);

            if (!spreadsheet.id) {
                AJS.log("Placeholder has no spreadsheet id: ", $placeholder);
                return;
            }
            var displayCallback = function(data, status, request){
                var colNames = request.getResponseHeader("X-COL-NAMES").split(","),
                    tableDef = data.tableDef;
                /*colLabels = request.getResponseHeader("X-COL-LABELS").split(","),
                 colRenderers = request.getResponseHeader("X-COL-RENDERERS").split(","),
                 colTypes = request.getResponseHeader("X-COL-TYPES").split(","),*/
                function findCol(name) {
                    for (var i in tableDef.columns)
                        if (tableDef.columns[i].name == name)
                            return tableDef.columns[i];
                    throw "Column not found: " + name;
                }
                var columns = colNames.map(function(name, i){
                    var colDefinition = findCol(name);
                    return readColumnDefinition(i, colDefinition, $placeholder);
                });
                spreadsheet.columns = columns;
                spreadsheet.totals = tableDef.totals || [];
                spreadsheet.perms = window.PlaySQL.Helpers.intersect(window.PlaySQL.Helpers.parsePerms(tableDef.perms), spreadsheet.perms);
                spreadsheet.customEmptyMessage = tableDef.customEmptyMessage;
                spreadsheet.userParameters = filterBuiltInParameters(data.userParameters || []);
                spreadsheet.useForm = data.useForm;
                spreadsheet.orderbyClause = data.orderBy || "";

                spreadsheet.defaultCase = request.getResponseHeader("X-DIALECT_DEFAULT_CASE");
                spreadsheet.dialect = request.getResponseHeader("X-DIALECT");
                if (spreadsheet.defaultCase != "LOWER" && spreadsheet.defaultCase != "UPPER") {
                    $("#create-query-button, #create-spreadsheet-button").hide();
                    throw "Invalid default case: " + defaultCase;
                }
                spreadsheet.mode = request.getResponseHeader("X-MODE"); // READ_ONLY or READ_WRITE
                spreadsheet.systemColumnsMode = data.systemColumnsMode;
                spreadsheet.label = tableDef.label;
                spreadsheet.pagination = window.PlaySQL.Helpers.parsePagination(data.pagination);
                spreadsheet.css = new window.PlaySQL.Helpers.CssObject($placeholder);

                renderCells(columns, data.data);

                var errorMessage = data.errorMessage != undefined && data.errorMessage.length > 1 ? (data.errorMessage.charAt(0).toUpperCase() + data.errorMessage.slice(1)) : "";

                var html = Confluence.Templates.PlaySQL.fullTable({
                    name: spreadsheet.id,
                    columns: columns,
                    data: data.data,
                    totals: data.totals,
                    pagination: spreadsheet.pagination,
                    recoverableErrorMessage: errorMessage,
                    customEmptyMessage: spreadsheet.customEmptyMessage,
                    editorUrl: $placeholder.attr("data-editor-url"),
                    userParameters: spreadsheet.userParameters,
                    useForm: spreadsheet.useForm,
                    useCache: data.useCache,
                    squeeze: spreadsheet.squeeze,
                    whereClauseColumnFilters : spreadsheet.whereClauseColumnFilters
                });

                // Remove the Position column
                columns.splice(1, 1);
                for (var index = 0 ; index < columns.length ; index++) {
                    columns[index].index = index;
                }

                $placeholder.html(html);
                bindSpreadsheet();
                triggerDisplayEvents();
                if (errorMessage) {
                    // Success without formulas
                    spreadsheet.options.onDisplay && spreadsheet.options.onDisplay(spreadsheet, "PARTIAL_SUCCESS", data);
                } else {
                    // Total success
                    spreadsheet.options.onDisplay && spreadsheet.options.onDisplay(spreadsheet, "SUCCESS", data);
                }
            };
            var failCallback = function(jqXHR, error, reason){
                if (requestOptions && requestOptions.failureCallback) {
                    if (requestOptions.failureCallback(jqXHR) === false) {
                        return;
                    }
                }
                // Is it a 4xx error?
                if (Math.round(jqXHR.status/100) * 100 == 400) {
                    try {
                        // If the BAD_REQUEST is specially formatted by Play SQL
                        var data = $.parseJSON(jqXHR.responseText);
                        var message;
                        if (data.type == "SQL_SYNTAX") {
                            message = "There is an error in the SQL syntax: " + data.message;// + "\n" + data.sql;
                        } else {
                            message = data.message || "Error";
                        }
                        if (data.userParameters) {
                            spreadsheet.userParameters = filterBuiltInParameters(data.userParameters);
                        }

                        var html = Confluence.Templates.PlaySQL.fullTable({
                            name: spreadsheet.id,
                            columns: [],
                            data: [],
                            totals: undefined,
                            recoverableErrorMessage: message,
                            customEmptyMessage: spreadsheet.customEmptyMessage,
                            editorUrl: $placeholder.attr("data-editor-url"),
                            userParameters: spreadsheet.userParameters
                        });

                        $placeholder.html(html);
                        bindSpreadsheet();
                        triggerDisplayEvents();
                        // The error can be recovered because it comes from the user, and probably the userParameters
                        // were provided
                        spreadsheet.options.onDisplay && spreadsheet.options.onDisplay(spreadsheet, "PARTIAL_FAILURE", data);
                        return;
                    } catch (err) {
                        // Swallow and proceed to the next section
                        AJS.log(err);
                    }
                }
                var message = "Sorry, the spreadsheet couldn't be displayed: " + reason
                        + " (HTTP status code: " + jqXHR.status + ")",
                    $area = $placeholder.find(".playsql-message-inner");
                AJS.logError("PlaySQL error: " + message + "\n" + jqXHR.responseText);
                if ($area.size() > 0) {
                    $area.text(message);
                    $placeholder.find(".hidden").text(jqXHR.responseText);
                } else {
                    window.PlaySQL.Messages.addMessage("error", message, "save-spreadsheet-bean")
                }
                // The response couldn't even be parsed and/or the error isn't 4xx.
                spreadsheet.options.onDisplay && spreadsheet.options.onDisplay(spreadsheet, "FAILURE");
            }

            if (typeof spreadsheet.queryModelOverride != "undefined") {
                // "Preview" mode, where the queryModel is posted with the data
                var url = baseUrl("/data/preview", urlOptions);
                $.ajax({
                    url: url,
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    timeout: 180000,
                    cache: false,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(spreadsheet.queryModelOverride)
                }).done(displayCallback).fail(failCallback);

            } else {
                // Normal mode
                var url = baseUrl("/data", urlOptions);
                $.ajax({
                    url: url,
                    type: 'GET',
                    contentType: "application/json; charset=utf-8",
                    timeout: 180000,
                    cache: false
                }).done(displayCallback).fail(failCallback);
            }
            return false;
        }
        var notifyMacroBrowserIfExists = function(){
            window.setTimeout(function() {
                try {
                    var macroFilterInput = window.parent &&
                        window.parent.document &&
                        window.parent.document.getElementById("macro-param-where-clause");
                    if (macroFilterInput) {
                        $(macroFilterInput).val(PlaySQL.spreadsheet.whereClauseConsolidated);
                    }
                } catch (err) {
                    AJS.log("Error while trying to notify the Macro Browser ", err);
                }
            });
        }
        var filterBuiltInParameters = function(userParameters) {
            if (!userParameters) return userParameters;
            var newList = [];
            for (var i = 0 ; i < userParameters.length ; i++) {
                if (!userParameters[i].builtIn) {
                    userParameters[i].cleanName = userParameters[i].name.toLowerCase().replace(/[^a-z0-9]/g, "");
                    newList.push(userParameters[i]);
                }
            }
            return newList;
        }

        // Calls each renderer for the cells
        var renderCells = function(cols, data, totals) {
            for (var rowIndex in data) {
                var row = data[rowIndex],
                    rowMetadataText = row[1][0],
                    rowMetadata;
                try {
                    rowMetadata = AJS.$.parseJSON(rowMetadataText);
                } catch (err) {}
                for (var cellIndex in row) {
                    var cell = row[cellIndex],
                        col = cols[cellIndex],
                        renderer = window.PlaySQL.Spreadsheet.renderers[col.viewRenderer || col.renderer],
                        cellMetadata = rowMetadata && rowMetadata["c_" + col.name];
                    // Cell already contains [FE value, BE value].
                    // Let's add the rendered content
                    cell.push(renderer.renderCellContents(cell[0], spreadsheet, col));
                    // Let's add the css classes
                    cell.push(buildCssClassesForCell(cell[0], cellMetadata));
                    // And the styles
                    cell.push(buildCssStylesForCell(cell[0], cellMetadata));
                }
            }
        }

        /** This is where I bind all events on buttons and get the spreadsheet alive */
        var bindSpreadsheet = function() {
            var editorUrl = $placeholder.attr('data-editor-url');
            editorUrl = editorUrl? editorUrl : PlaySQL.SPI.contextPath + "/playsql-base-plugin/spreadsheet-editor.action?" +
                $.param({key: spreadsheet.context.split(":")[1], spreadsheetId: spreadsheet.id});
            if (!spreadsheet.perms.hasPerm('ADD_COLS')) {
                spreadsheet.$placeholder.find(".add-column a").addClass("hidden");
            }
            if (!spreadsheet.perms.hasPerm('ADD_ROWS')) {
                spreadsheet.$placeholder.find(".totals-row a").addClass("hidden");
            }

            $placeholder.find("thead tr.playsql-col-headers th:first-child").html("<a href='" + editorUrl + "' target = '_top'>&nbsp;</a>");
            var sSelection = window.PlaySQL.Selection.forTable($placeholder),
                alreadyInitialized = sSelection.alreadyInitialized;

            sSelection.init({
                onInit: function(){
                    window.PlaySQL.Selection.attach($placeholder, sSelection, {
                        "click thead tr.playsql-col-headers th.add-column a": addColumn,
                        "click th.add-row a": function($this, e){
                            e.preventDefault();
                            addRow(undefined);
                            return false;
                        },
                        "key f2": displayCellProperties,
                        "key backspace": removeCellContents,
                        "key delete": removeCellContents
                    });
                },
                canSelectFooter: spreadsheet.perms.hasPerm('EDIT_TOTALS'),
                columnSecondClick : columnSecondClick,
                rowSecondClick : rowSecondClick,
                saveCells: function($cells) {
                    // We use a timeout because we need to leave enough time for the DatePicker and the PagePicker to
                    // register the [enter] event, put their value in the $input, and save.
                    window.setTimeout(function(){
                        var totalsModified = false;
                        spreadsheet.requestPipe = spreadsheet.requestPipe || [];
                        $cells.each(function(){
                            var $cell = $(this);
                            if ($cell.is("tr.totals-row > *.editing")) {
                                if (spreadsheet.perms.hasPerm('EDIT_TOTALS')) {
                                    window.PlaySQL.Totals.saveTotal(spreadsheet.totals, $cell);
                                    totalsModified = true;
                                }
                            } else {
                                if (spreadsheet.perms.hasPerm('EDIT_CELLS') || spreadsheet.perms.hasPerm('Q_VIEW_EDIT')) {
                                    var cell = getCell($(this));
                                    cell.renderer.saveAndView();
                                }
                            }
                        });
                        spreadsheet.sprayRequestPipe();
                        if (totalsModified) {
                            saveTotals();
                        }
                    }, 0);
                },
                editCell: function($cell) {
                    if ($cell.parent().is("tr.totals-row") && !$cell.is(":last-child")) {
                        if (!$cell.hasClass("editing")) {
                            if (!spreadsheet.perms.hasPerm('EDIT_TOTALS')) return;
                            if (!$cell.hasClass("aui-dropdown2-trigger") && spreadsheet.totals.length > 0) {
                                var totals = spreadsheet.totals,
                                    menu = {
                                        "edit": ["Edit", window.PlaySQL.Totals.editTotal, totals, $cell],
                                        "addLeft": ["Split cell (on the left)", window.PlaySQL.Totals.addTotal, totals, $cell, -1],
                                        "addRight": ["Split cell (on the right)", window.PlaySQL.Totals.addTotal, totals, $cell, 1],
                                        "remove": ["Remove this total", window.PlaySQL.Totals.removeTotal, totals, $cell, saveTotals]
                                    };
                                if (!(parseInt($cell.attr('colspan')) >= 2))
                                    delete menu["addRight"];
                                if (!(parseInt($cell.attr('colspan')) >= 3))
                                    delete menu["addLeft"];
                                window.PlaySQL.Selection.bindMenu($cell, menu);
                            } else {
                                // Zyva, edit his gddm cell...
                                $cell.removeClass("aui-dropdown2-trigger")
                                    .removeAttr('aria-controls aria-haspopup aria-owns');
                                window.PlaySQL.Totals.editTotal(spreadsheet.totals, $cell);
                            }
                        }
                    } else {
                        // Body cells
                        if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT')) return;
                        cellSecondClick($cell);
                    }
                },
                cancelEdit : function($cell) {
                    if ($cell.parent().is("tr.totals-row")) {
                        var rendered = $cell.attr("data-rendered");
                        if ($cell.hasClass("editing") && rendered !== undefined) {
                            window.PlaySQL.Selection.inlineDialog && window.PlaySQL.Selection.inlineDialog.hide();
                            $cell.html(rendered).removeClass("editing");
                        }
                    } else {
                        var cell = getCell($cell);
                        cell.renderer.cancelEdit();
                    }
                },
                getCell : getCell,
                colOf : colOf,
                popupTrigger: ".totals-row .totals-calculation",
                popupContentFn: function($content, trigger, showPopup) {
                    var fields = {},
                        exampleTemplates = ['SUM(%s)', 'ROUND(AVG(%s))', 'MAX(%s)'],
                        exampleTemplatesVarchar = ['MAX(%s)'],
                        examples = [],
                        examplesVarchar = [],
                        fieldName, type, template,
                        isSystemField,
                        tableName = spreadsheet.id;
                    for (var i in spreadsheet.columns) {
                        fieldName = spreadsheet.columns[i].name;
                        isSystemField = spreadsheet.columns[i].statusPK || spreadsheet.columns[i].statusPosition;
                        type = spreadsheet.columns[i].type;
                        if (typeof type == "undefined") {
                            type = "\"Undefined\"";
                        }
                        if (spreadsheet.defaultCase == "LOWER" && fieldName.toLowerCase() != fieldName
                            || spreadsheet.defaultCase == "UPPER" && fieldName.toUpperCase() != fieldName) {
                            fieldName = '"' + fieldName + '"';
                        }
                        fields[type] = (fields[type] || []).concat(fieldName);
                        if (!isSystemField) {
                            if (type == 'INTEGER' || type == 'NUMERIC') {
                                template = exampleTemplates[examples.length % exampleTemplates.length];
                                examples.push(template.replace('%s', fieldName));
                            } else if ((type == 'VARCHAR' || type == 'TEXT') && examplesVarchar.length < exampleTemplatesVarchar.length) {
                                template = exampleTemplatesVarchar[examplesVarchar.length % exampleTemplatesVarchar.length];
                                examplesVarchar.push(template.replace('%s', fieldName));
                            }
                        }
                    }
                    if (spreadsheet.defaultCase == "LOWER" && tableName.toLowerCase() != tableName
                        || spreadsheet.defaultCase == "UPPER" && tableName.toUpperCase() != tableName)
                        tableName = '"' + tableName + '"';

                    $content.unbind()
                        .html(Confluence.Templates.PlaySQL.formulaHelp({fields:fields, examples:examples.concat(examplesVarchar), tableName: tableName}));
                    $content.on("click", ".examples a", function() {
                        $(trigger).val($(this).text()).focus();
                        window.PlaySQL.Selection.inlineDialog && window.PlaySQL.Selection.inlineDialog.hide();
                        return false;
                    });
                    showPopup();
                },
                pasteHandler: pasteHandler,
                addRow : addRow,
                updateColumnWidth : updateColumnWidth
            });

            if (!alreadyInitialized) {
                $placeholder.on("click", ".pagination-squeeze", function (e) {
                    e.preventDefault();
                    $(this).closest("table.playsql").toggleClass("squeeze-mode");
                    spreadsheet.squeeze = true;
                });
                $placeholder.on("click", ".pagination-number, .pagination-see-all-rows", function (e) {
                    e.preventDefault();
                    var offset = parseInt($(this).data("offset"));
                    var limit = parseInt($(this).data("limit"));
                    if (!isNaN(limit)) {
                        $(this).addClass("aui-icon aui-icon-wait");
                        spreadsheet.load({limit: limit});
                    } else if (!isNaN(offset)) {
                        // (...) As simple as that...
                        // So much tame weitin afore plementin't...
                        spreadsheet.load({offset: offset});
                    }
                });
                $placeholder.on("click", ".pagination-full-screen", function() {
                    var placeholder = $placeholder[0];
                    if ($placeholder.hasClass("fullscreen")) {
                        $placeholder.removeClass("fullscreen");
                        if(document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if(document.mozCancelFullScreen) {
                            document.mozCancelFullScreen();
                        } else if(document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        }
                        $(".pagination-full-screen")
                            .removeClass("aui-iconfont-unfocus").addClass("aui-iconfont-focus")
                            .text("Full screen");
                        return;
                    } else {
                        $(".pagination-full-screen")
                            .addClass("aui-iconfont-unfocus").removeClass("aui-iconfont-focus")
                            .text("Exit full screen");
                        $placeholder.addClass("fullscreen");
                        if (!placeholder) {
                            AJS.error("Full screen request, but no placeholder");
                        } else if (placeholder.requestFullscreen) {
                            placeholder.requestFullscreen();
                        } else if (placeholder.mozRequestFullScreen) {
                            placeholder.mozRequestFullScreen();
                        } else if (placeholder.webkitRequestFullscreen) {
                            placeholder.webkitRequestFullscreen();
                        } else if (placeholder.msRequestFullscreen) {
                            placeholder.msRequestFullscreen();
                        } else {
                            AJS.error("Full screen request, but the browser doesn't support it");
                            return;
                        }
                    }
                });
            }

            // Also bind the user parameters
            $placeholder.find(".playsql-user-parameters-form").on("click", ".submit", function(e){
                e.preventDefault();
                var $form = $(this).closest(".playsql-user-parameters-form");
                if (!!spreadsheet.userParameters) {
                    for (var i = 0 ; i < spreadsheet.userParameters.length ; i++) {
                        var param = spreadsheet.userParameters[i];
                        param.value = $form.find("#user-parameter-" + param.cleanName).val();
                    }
                }
                spreadsheet.load();
            });
            $placeholder.find("#user-parameter-refresh-query").on("click", function(e){
                e.preventDefault();
                spreadsheet.load({"refreshCache": "true"});
            });

            // Trigger event, so function handlers can be overridden
            // We pass the sSelection object rather than just override handlers because they may need the original
            // handlers
            spreadsheet.options.onSelectionSet && spreadsheet.options.onSelectionSet(sSelection);
        };

        var saveTotals = function() {
            var totals = spreadsheet.totals,
                urlOptions = {};

            if (!!spreadsheet.userParameters) {
                for (var i = 0; i < spreadsheet.userParameters.length ; i++) {
                    var param = spreadsheet.userParameters[i];
                    if (!param.builtIn && typeof param.value != "undefined") {
                        var paramName = "user-parameter-" + param.cleanName;
                        urlOptions[paramName] = param.value;
                    }
                }
            }

            var url = baseUrl("/totals", urlOptions);

            window.PlaySQL.Totals.updateColspans(totals, spreadsheet.$placeholder);

            var successCallback = function(data, status, request){
                if (!data.message) {
                    var $footer = $(Confluence.Templates.PlaySQL.totalsRow({
                        totals: data.totals,
                        pagination: spreadsheet.pagination,
                        columnCount: spreadsheet.columns.length - 1
                    }));
                    $placeholder.find("tfoot").html($footer.contents());
                    if (!spreadsheet.perms.hasPerm("ADD_ROWS")) {
                        $placeholder.find(".totals-row a").addClass("hidden");
                    }
                    spreadsheet.options.onChangeTotals && spreadsheet.options.onChangeTotals(spreadsheet);
                } else {
                    var message = data.errorMessage;
                    message = message.replace("ERROR: ", "");
                    $placeholder.find("tfoot td").first().text(message + ". Edit the total again to fix the formula.");
                }
            };
            var failureCallback = function(jqXHR, error, reason){
                if (jqXHR.status == 400) {
                    try {
                        var data = JSON.parse(jqXHR.responseText);
                        if (data != null) {
                            var message = data.message || "Error";
                            message = message.replace("ERROR: ", "");
                            if (data.type == "SQL_SYNTAX") {
                                message += " - Edit the total again to fix the formula.";
                            }
                            $placeholder.find("tfoot td").first().text(message);
                            return;
                        }
                    } catch (err) {
                        // Can't manage the JSON. Proceed to the next section
                    }
                }
                window.PlaySQL.Messages.addMessage("error", "The settings for the totals couldn't be saved",
                    "change-totals", jqXHR.responseText);
            };

            if (spreadsheet.options.saveTotals) {
                spreadsheet.options.saveTotals(spreadsheet, urlOptions, successCallback, failureCallback);
            } else {
                $.ajax({
                    url: url,
                    type: 'PUT',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(totals)
                }).done(successCallback)
                    .fail(failureCallback);
            }
        }

        var updateTotals = function() {
            if (!spreadsheet.perms.hasPerm('EDIT_TOTALS')) return;
            var url = baseUrl("", { fields: "totals" });
            $.ajax({
                url: url,
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                cache: false
            }).done(function(data, status, request){
                var $footer = $(Confluence.Templates.PlaySQL.totalsRow({
                    totals: data.totals,
                    pagination: spreadsheet.pagination,
                    columnCount: spreadsheet.columns.length - 1
                }));
                $placeholder.find("tfoot").html($footer.contents());
            }).fail(function(jqXHR, error, reason){
                window.PlaySQL.Messages.addMessage("error", "The totals couldn't be retrieved",
                    "change-totals", jqXHR.responseText);
            });
        }

        var triggerDisplayEvents = function() {
            var cssWordWrap = spreadsheet.css && spreadsheet.css.module("word-wrap");
            for (var i in spreadsheet.columns) {
                var column = spreadsheet.columns[i],
                    renderer = checkNotNull(window.PlaySQL.Spreadsheet.renderers[column.viewRenderer || column.renderer]);
                renderer.onColumnDisplay(spreadsheet, column);
                if (column.width != null) {
                    updateColumnWidth(column, column.width, false);
                }
                if (cssWordWrap) {
                    if (column.formats && column.formats.wordwrap == 'true') {
                        cssWordWrap.getRule({column: column.name}).body['white-space'] = 'pre-wrap';
                    } else {
                        cssWordWrap.getRule({column: column.name}).body['white-space'] = null;
                    }
                }
            }

            if (spreadsheet.selectedRecord) {
                var $row = $placeholder.find("tr[data-row-id=" + spreadsheet.selectedRecord + "] > *:not(.right-padding)");
                $row.addClass("selected");
                $row.first().addClass("focused");
                spreadsheet.selectedRecord = undefined;
            }

            window.PlaySQL.Helpers.applyCss(spreadsheet.css, "word-wrap");
        };

        var cellSecondClick = function ($cell) {
            var cell = getCell($cell);
            if (cell) {
                if (!$cell.hasClass("editing")) {
                    if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', cell.column)) return;
                    cell.renderer.edit();
                    cell.renderer.focus();
                } else if ($cell.find("*:focus").length == 0) {
                    cell.renderer.focus();
                }
            }
        }

        var columnSecondClick = function($header) {
            if ($header.hasClass("editing"))
                return;
            var column = colOf($header);
            spreadsheet.inlinedialog = window.PlaySQL.Spreadsheet.ColumnToolbar.create(spreadsheet, column, $header);
            spreadsheet.inlinedialog.show();
        }

        /** Updates the width of the column. If save is true, save, otherwise it's still the user dragging or
         * the spreadsheet initializing. */
        var updateColumnWidth = function($header, width, save) {
            // $header can either be the column definition or the $th.
            var column = $header instanceof $ ? colOf($header) : $header,
                newColumn = column.copy(),
                columnCss = spreadsheet.css.module("column-width").getRule({column: column.name});
            if (!($header instanceof $)) $header = null;
            if (width == null) {
                delete columnCss.body["min-width"];
                delete columnCss.body["max-width"];
                delete columnCss.body["width"];
                delete columnCss.body["font-size"];
            } else {
                if (width < 20) {
                    width = 0;
                    columnCss.body["font-size"] = "0";
                } else {
                    delete columnCss.body["font-size"];
                }
                columnCss.body["min-width"] = width + "px";
                columnCss.body["max-width"] = width + "px";
                columnCss.body["width"] = width + "px";
            }
            PlaySQL.Helpers.applyCss(spreadsheet.css, "column-width");
            if (save) {
                newColumn.width = width;
                // Attempt to save, don't tell anything in failure/success
                saveColumn($header, column, newColumn, ["WIDTH"]);
            }
        }

        var rowSecondClick = function($header) {
            var rowIds = $placeholder
                    .find(".selected")
                    .closest("tr")
                    .map(function(index, tr){return $(tr).attr("data-row-id");}),
                menu = {
                    "delete": ["Delete", deleteRows, rowIds]
                };
            checkNotNull($header.parent().attr('data-row-id'));
            if (!spreadsheet.perms.hasPerm('REMOVE_ROWS')) delete menu["delete"];
            if (Object.keys(menu).length > 0)
                window.PlaySQL.Selection.bindMenu($header, menu);
        }

        /**
         * Finds a <tr/>
         * @param position the position
         * @returns $row
         */
        var findRowByPosition = function(position) {
            var $row;
            if (position != undefined) {
                $row = $placeholder.find("tr[data-row-position='" + position + "']");
            } else {
                throw "Not implemented";
            }
            if ($row.size() == 0)
                throw "Couldn't find the row: " + position;
            return $row;
        }

        var findRowByPk = function(jointSpreadsheetKey, pk) {
            if (arguments.length == 1) {
                pk = jointSpreadsheetKey;
                jointSpreadsheetKey = undefined;
            }
            if (jointSpreadsheetKey == undefined && typeof pk === "string" && pk.indexOf("-") != -1) {
                jointSpreadsheetKey = pk.substr(0, pk.indexOf("-"));
                pk = pk.substr(pk.indexOf("-") + 1);
            }
            if (pk instanceof $ && pk.is("tr")) {
                return pk;
            } else if (jointSpreadsheetKey != undefined) {
                for (var i in spreadsheet.columns) {
                    var formats = spreadsheet.columns[i].formats;
                    if (formats["joint-table"] == jointSpreadsheetKey) {
                        var nthChild = spreadsheet.columns[i].index + 1, // the nth-child is 1-based
                            $jointIdCell = $placeholder.find("td:nth-child(" + nthChild + ")[data-value='" + checkNotNull(pk) + "']");
                        return checkNotNull($jointIdCell, pk).parent();
                    }
                }
                throw "Can't find an ID column for " + spreadsheetKey;
            } else {
                var $row = $placeholder.find("tr[data-row-id='" + checkNotNull(pk) + "']");
                return checkNotNull($row, pk);
            }
        }

        var getRecordIds = function($cell, useJointId) {
            var id = $cell.closest("tr").attr("data-row-id"),
                result = {id:id};
            if (useJointId) {
                var cell = spreadsheet.getCell($cell),
                    jointId = cell.column.formats["joint-id"],
                    jointTable = cell.column.formats["joint-table"];
                if (jointTable) {
                    // This cell is the joint id
                    result.jointId = cell.$cell.attr("data-value");
                    result.jointIdName = cell.column.name;
                    result.jointIdCell = cell;
                    result.jointTable = jointTable;
                    result.jointFk = cell.column.formats["joint-fk"];
                } else if (jointId) {
                    var idCell = spreadsheet.getCell(id, jointId);
                    if (!idCell) throw "There is no cell for the column " + jointId + " on the row " + $cell.closest("tr").attr("data-row-id");
                    var idValue = idCell.$cell.attr("data-value");
                    result.jointId = idValue;
                    result.jointIdName = jointId;
                    result.jointIdCell = idCell;
                    result.jointTable = idCell.column.formats["joint-table"];
                    result.jointFk = idCell.column.formats["joint-fk"];
                }
            }
            return result;
        }

        /** Returns a cell handler.
         * Syntax: getCell($td) returns {cell} - Please pass the td, not an inner element.
         * Syntax: getCell($row, colName) returns {cell}
         * Syntax: getCell($row, colNumber) returns {cell}
         * Syntax: getCell([jointSpreadsheetKey,] rowPrimaryKey, colName) returns {cell}
         * Syntax: getCell([jointSpreadsheetKey,] rowPrimaryKey, colNumber) returns {cell}
         */
        var getCell = function(jointSpreadsheetKey, row, col) {
            var $cell,
                $row,
                column,
                isColumnHeader,
                renderer,
                rendererInstance,
                viewRenderer,
                viewRendererInstance,
                rowId;
            if (arguments.length == 2) {
                col = arguments[1];
                row = arguments[0];
                jointSpreadsheetKey = undefined;
                if (typeof row === "string" && row.indexOf("-") != -1) {
                    jointSpreadsheetKey = row.substr(0, row.indexOf("-"));
                    $row = findRowByPk(row);
                }
            } else if (arguments.length == 1) {
                row = arguments[0];
                jointSpreadsheetKey = undefined;
            }
            if (col == undefined) {
                if (row == undefined) return undefined;
                $cell = row;
                if (!$cell instanceof $)
                    throw "Cell isn't a jQuery object: " + $cell;
                if (!$cell.is("td,th")) {
                    AJS.log("Cell isn't a td/th: " + $cell + " (it's a " + $cell.prop("tagName") + ")");
                    return undefined;
                }
                if (!$cell.closest(".playsql-spreadsheet-placeholder").is(spreadsheet.$placeholder)) {
                    AJS.log("Cell isn't on the current spreadsheet");
                    return undefined;
                }
            } else if (jointSpreadsheetKey != undefined) {
                var $row = findRowByPk(jointSpreadsheetKey, row);

                if ($.isNumeric(col)) {
                    $cell = $row.children().eq(col);
                } else {
                    // The 'col' name is the name of the joint column
                    var colDefinition = colOf(jointSpreadsheetKey, col);
                    if (colDefinition == null) return undefined;
                    $cell = $row.children().eq(colDefinition.index);
                }
            } else {
                $row = findRowByPk(row);
                if ($.isNumeric(col)) {
                    $cell = $row.children().eq(col);
                } else {
                    var col2 = colOf(col);
                    if (col2 == undefined) return undefined;
                    $cell = $row.children().eq(col2.index);
                }
            }
            if ($cell.index() >= spreadsheet.columns.length) {
                return undefined;
            } else if ($cell.find(".playsql-message-inner").size() > 0) {
                return undefined;
            }
            column = spreadsheet.columns[$cell.index()];
            isColumnHeader = $cell.is("thead > tr.playsql-col-headers > th");
            renderer = isColumnHeader
                ? window.PlaySQL.Spreadsheet.renderers["header"]
                : window.PlaySQL.Spreadsheet.renderers[column.renderer];
            rendererInstance = renderer.forCell(spreadsheet, $cell);
            if (!isColumnHeader && !!column.formula && column.viewRenderer) {
                viewRenderer = window.PlaySQL.Spreadsheet.renderers[column.viewRenderer];
                viewRendererInstance = viewRenderer.forCell(spreadsheet, $cell);
            }
            rowId = $cell.closest("tr").attr("data-row-id");
            return {
                $cell: $cell,
                isColumnHeader: isColumnHeader,
                column : column,
                renderer : checkNotNull(rendererInstance, column.renderer),
                viewRenderer : viewRendererInstance,
                rowId: rowId
            }
        }

        var getRowMetadata = function($cell) {
            return $cell.closest("tr").data("row-metadata");
        }
        var getCellMetadata = function($cell, path) {
            var rowMetadata = getRowMetadata($cell),
                column = spreadsheet.columns[$cell.index()];
            var cellMetadata = rowMetadata && rowMetadata["c_" + column.name];
            if (cellMetadata && path) {
                return cellMetadata[path];
            } else {
                return cellMetadata;
            }
        }

        /** Given a cell (or header cell), find the column.
         * Usage: colOf($cell)
         * Usage: colOf("firstcolumn")
         * Usage: colOf(3)
         * Usage: colOf("spreadsheetKey", "firstcolumn")
         * */
        var colOf = function(spreadsheetKey, $cell) {
            if ($cell == undefined) {
                $cell = spreadsheetKey;
                spreadsheetKey = null;
            }
            if ($cell instanceof $)
                return spreadsheet.columns[$cell.index()];
            else if (typeof $cell == "string") {
                var colName = $cell;
                if (spreadsheetKey) {
                    var jointIdColumn = {};
                    for (var i in spreadsheet.columns) {
                        var formats = spreadsheet.columns[i].formats;
                        if (formats["joint-table"] == spreadsheetKey) {
                            jointIdColumn = spreadsheet.columns[i];
                            break;
                        }
                    }
                    for (var i in spreadsheet.columns) {
                        var formats = spreadsheet.columns[i].formats,
                            jointColumnName = formats["joint-column"] || spreadsheet.columns[i].name;
                        if (formats["joint-id"] == jointIdColumn.name && jointColumnName == colName) {
                            return spreadsheet.columns[i];
                        }
                    }
                    return undefined;
                } else {
                    for (var i in spreadsheet.columns) {
                        if (spreadsheet.columns[i].name == colName)
                            return spreadsheet.columns[i];
                    }
                }
                return undefined;
            } else if (typeof $cell == "number") {
                var colIndex = $cell;
                return spreadsheet.columns[colIndex];
            }
            throw "colOf: Couldn't parse the argument: " + $cell;
        }

        /** Returns all cells for the provided column definition */
        var $findColumnCells = function(column, includeHeader) {
            if (!column) return $();
            var $allCells = this.$placeholder.find("tbody td:nth-child(" + (column.index+1) + ")");
            if (includeHeader) {
                $allCells = $allCells.add(this.$placeholder.find("thead th[data-name='" + column.name + "']"));
            }
            return $allCells;
        }

        var addRow = function(beforePosition) {
            addRows(1, beforePosition);
        }

        var addRows = function(count, beforePosition) {
            if (!spreadsheet.perms.hasPerm('ADD_ROWS')) return false;
            // Remove the message placeholder if present
            var $messageRow = $placeholder.find("tr.playsql-message");
            if ($messageRow.size() != 0) $messageRow.remove();

            var data = [],
                $newRows = [],
                colNames = spreadsheet.columns.map(function(column){return column.name;});
            colNames.splice(1, 0, "POSITION");

            for (var j = 0; j < count; j++) {
                var row = emptyRow(colNames.length);

                // Make the row
                var template = Confluence.Templates.PlaySQL.oneRow({row:row}),
                    $row;
                // Insert the row
                if (beforePosition)
                    $row = $(template).insertBefore(findRowByPosition(beforePosition));
                else
                    $row = $(template).appendTo($placeholder.find("tbody"));
                // Edit all cells
                $row.children("td").first().each(function(i) {
                    var $cell = $(this),
                        cell = getCell($cell);
                    cell.renderer.edit();
                    cell.renderer.focus();
                    $placeholder.find(".focused").removeClass("focused selected");
                    $cell.addClass("focused selected");
                });
                // Spin the row header
                window.PlaySQL.Messages.spin($row.find("th:first")).on(undefined, "The row is being created on the server side. You cannot submit cells until the row is ready.");
                // Keep'em until we get the answer from the REST servlquest
                data[j] = row.splice(1, 1); // We don't send much data because we're just creating rows
                $newRows[j] = $row;
            }
            colNames = ["POSITION"];

            // Ajax to get the ID
            var url = baseUrl("/data");
            $.ajax({
                url: url,
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(data),
                headers: {
                    "X-COL-NAMES": colNames
                }
            }).done(function(data, status, request){
                for (var i = 0 ; i < data.insertedData.length && i < $newRows.length ; i++) {
                    var idCell = getCell($newRows[i], 0);
                    idCell.renderer.setOriginalValue(data.insertedData[i], data.insertedData[i]);
                }
                dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                window.PlaySQL.Messages.addMessage("error", "The row couldn't be created.", "add-row", jqXHR.responseText);
                for (var i = 0 ; i < $newRows.length ; i++) {
                    var $row = $newRows[i];
                    if ($row.text().length < 10) {
                        $row.remove();
                    }
                    $row.children("td:not(:last-child)").addClass("invalid").attr("title", "The row couldn't be created.");
                }
            });
            return false;
        };

        var deleteRows = function (rowIds){
            rowIds.each(function(index, rowId) {
                deleteRow(rowId);
            });
        };

        var deleteRow = function (rowId){
            if (!spreadsheet.perms.hasPerm('REMOVE_ROWS')) return;
            var $row = findRowByPk(rowId),
                url = baseUrl("/data", checkNotNull(rowId));

            var spinner = window.PlaySQL.Messages.spin($row.children().first())
                .on(500, "Deleting the row");
            $.ajax({
                url: url,
                type: 'DELETE'
            }).done(function(data, status, request){
                $row.remove();
                dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                spinner.off();
                window.PlaySQL.Messages.addMessage("error", "The row couldn't be deleted because of a " +
                "communication error with the server. ", "save-spreadsheet-bean", jqXHR.responseText);
            });
        };

        var addJointRow = function(argument, callback) {
            if (!spreadsheet.perms.hasPerm("Q_VIEW_EDIT")) return;
            var $cell, cell;
            if (argument instanceof $) {
                $cell = argument;
                cell = spreadsheet.getCell($cell);
            } else if (argument && argument.$cell) {
                cell = argument;
                $cell = cell.$cell;
            } else {
                throw "Not implemented: addJointRow with argument " + argument;
            }
            window.PlaySQL.Messages.spin($cell).on(500, "The row is being created in the table on the server side. You cannot submit values until the row is ready.");
            if (!cell || !cell.column.formats) {
                window.PlaySQL.Messages.addMessage("error", "It seems like the properties of the joint table are incorrect. Please run the Joint Table wizard again.", "add-row");
                return;
            }
            var jointTable = cell.column.formats["joint-table"];
            var jointFkDestination = cell.column.formats["joint-fk-dest"],
                jointFk = cell.column.formats["joint-fk"];
            var pk = cell.rowId;
            if (jointFkDestination && jointFkDestination != "ID") {
                var jointFkDestinationCell = spreadsheet.getCell(pk, jointFkDestination);
                if (!jointFkDestinationCell) throw "The FK destination is " + jointFkDestination + " but there is no such " +
                    "column for the row " + pk;
                var jointFkDestinationValue =  jointFkDestinationCell.renderer.getValue();
                if (!jointFkDestinationValue) throw "The FK destination is " + jointFkDestinationValue + " but the value is " +
                    "void for the pk " + pk;
                pk = jointFkDestinationValue;
            }

            // Ajax to get the ID
            var url = PlaySQL.SPI.baseUrl(spreadsheet.context + "/" + jointTable + "/data"),
                colNames = "POSITION," + jointFk,
                data = [[[], [pk]]];
            $.ajax({
                url: url,
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(data),
                headers: {
                    "X-COL-NAMES": colNames
                }
            }).done(function(data, status, request){
                window.PlaySQL.Messages.spin($cell).off();
                if (data.insertedData.length != 1) {
                    window.PlaySQL.Messages.addMessage("error", "The row couldn't be created.", "add-row", jqXHR.responseText);
                } else {
                    cell.renderer.setOriginalValue(data.insertedData[0], data.insertedData[0]);
                }
                callback && callback();
                spreadsheet.dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                window.PlaySQL.Messages.spin($cell).off();
                window.PlaySQL.Messages.addMessage("error", "The row couldn't be created.", "add-row", jqXHR.responseText);
            });
        }

        var removeJointRow = function($cell) {
            if (!spreadsheet.perms.hasPerm("Q_VIEW_EDIT")) return;
            var spinner = window.PlaySQL.Messages.spin($cell).on(500, "Deleting the row");
            var cell = spreadsheet.getCell($cell);
            if (!cell || !cell.column.formats) {
                spinner.off();
                window.PlaySQL.Messages.addMessage("error", "It seems like the properties of the joint table are incorrect. Please run the Joint Table wizard again.", "remove-row");
                return;
            }
            var jointTable = cell.column.formats["joint-table"],
                jointId = cell.column.name,
                pk = $cell.attr("data-value");
            if (!pk) return;

            // Ajax to remove the ID
            var url = PlaySQL.SPI.baseUrl(spreadsheet.context + "/" + jointTable + "/data/" + pk);

            $.ajax({
                url: url,
                type: 'DELETE'
            }).done(function(data, status, request){
                spinner.off();
                cell.renderer.setOriginalValue(null);
                for (var i in spreadsheet.columns) {
                    var column = spreadsheet.columns[i];
                    if (column.formats["joint-id"] == jointId) {
                        var cellToDelete = spreadsheet.getCell($cell.parent(), column.index);
                        cellToDelete.$cell.empty().removeAttr("data-value").removeClass("editing saving invalid");
                    }
                }
                spreadsheet.dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                spinner.off();
                window.PlaySQL.Messages.addMessage("error", "The row couldn't be deleted.", "remove-row", jqXHR.responseText);
            });
        }

        var recalculateFormulas = function($cells) {
            var rowId = $cells.size() == 1 ? $cells.closest("tr").attr("data-row-id") : undefined,
                options = { reindex: true };
            if (rowId != undefined) options.pkvalue = rowId;
            var url = spreadsheet.baseUrl("/metadata", options);
            $.ajax({
                url: url,
                type: 'PUT',
                dataType: "json"
            }).done(function(data, status, request){
                dispatchCellValues(data.data, data.tableDef);
            }).fail(function(jqXHR, error, reason){
                var data,
                    message;

                if (jqXHR.status == 400 || (jqXHR.status == 500 && jqXHR.responseText.charAt(0) == '{')) {
                    try {
                        data = JSON.parse(jqXHR.responseText);
                        if (data != null) {
                            message = data.message || "Error";
                        }
                    } catch (err) {
                        // Can't understand the json. No worries, keep going.
                    }
                }

                if (data && data.type == "FORMULA_ERROR") {
                    // If the cell couldn't be found, display the message with a popup
                    window.PlaySQL.Messages.addMessage("error", message, jqXHR.responseText);
                    return;
                }
            });
        }
        /**
         * Saves some cell's metadata, such as the formula
         * @param $cell
         * @param name name of the property
         * @param value the value, or null if the property must be deleted
         * @return true if some data was changed/saved, false otherwise
         */
        var saveCellMetadata = function($cell, name, value) {
            if (!$cell.is("td") || $cell.hasClass("right-padding")) return;
            if (!spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) return;
            var rowId = $cell.parent().attr("data-row-id"),
                column = checkNotNull(colOf($cell), $cell),
                // We make a deep copy because we don't want to modify the original metadata until it's
                // saved on the server side
                rowMetadata = $.extend(true, {}, getRowMetadata($cell)) || {},
                colName2 = "c_" + column.name;
            // If an update request was already piped, start with the rowMetadata of that request
            spreadsheet.requestPipe = spreadsheet.requestPipe || [];
            var indexPreviousRequest = undefined;
            for (var i in spreadsheet.requestPipe || []) {
                var req = spreadsheet.requestPipe[i];
                if (req.column == "POSITION" && req.rowId == rowId) {
                    rowMetadata = req.value ? $.parseJSON(req.value) : {};
                    indexPreviousRequest = i;
                    break;
                }
            }
            var property = {};
            property[name] = value;
            var properties = rowMetadata[colName2];
            if (!properties) {
                if (value == undefined) {
                    // No data to modify, there are no cellMetadata and the value is null.
                    return false;
                }
                rowMetadata[colName2] = property;
            } else {
                if (value == undefined || value == null) {
                    if (properties[name] == undefined) {
                        // No data to modify, there are cellMetadata but none for this property
                        return false;
                    }
                    delete properties[name];
                    if (Object.keys(properties).length == 0) {
                        delete rowMetadata[colName2];
                    }
                } else if (properties[name] == value) {
                    // No data to modify
                    return false;
                } else {
                    properties[name] = value;
                }
            }
            if (Object.keys(rowMetadata).length == 0) {
                rowMetadata = null;
            }

            // Now update the value in the POSITION column.
            if (indexPreviousRequest != undefined) {
                spreadsheet.requestPipe.splice(indexPreviousRequest, 1);
            }
            spreadsheet.requestPipe.push({
                spreadsheet: undefined,
                rowId : rowId,
                column : "POSITION",
                value: rowMetadata != null ? JSON.stringify(rowMetadata) : null
            });
            return true;
        }
        var saveCell = function($cell, value) {
            var rowId = $cell.parent().attr("data-row-id"),
                column = checkNotNull(colOf($cell), $cell),
                jointIdColumnName = column.formats && column.formats["joint-id"],
                data = [[value]],
                spreadsheetKey = null,
                columnName = column.name;
            if (jointIdColumnName) {
                columnName = column.formats["joint-column"] || columnName;
                var jointIdColumn = checkNotNull(colOf(jointIdColumnName), jointIdColumnName);
                spreadsheetKey = jointIdColumn.formats && jointIdColumn.formats["joint-table"];
                rowId = $cell.parent().children().eq(jointIdColumn.index).attr("data-value");
                if (rowId == null) {
                    window.PlaySQL.Messages.addMessage("error", "There is no row for the cell which is being saved.");
                    return;
                }
            }

            spreadsheet.requestPipe = spreadsheet.requestPipe || [];
            var changeRequest = {
                spreadsheet: spreadsheetKey,
                rowId: rowId,
                column: columnName,
                value: value
            };
            spreadsheet.requestPipe.push(changeRequest);
        }

        /** Processes the spreadsheet.requestPipe queue. It's in the form:
         * - spreadsheet (can be undefined)
         * - rowId
         * - column
         * - value (the value itself, no subarray)
         *
         * In return, call dispatchCellValues() or mark the cells in error.
         */
        var sprayRequestPipe = function() {
            if (spreadsheet.requestPipe == undefined) return;
            var requestPipe = spreadsheet.requestPipe,
                rows = [],// Rows' index is "spreadsheetid-rowid"
                req, row, url, rowId,
                colNames, data;
            spreadsheet.requestPipe = undefined;
            // Group by row
            for (var i = 0; i < requestPipe.length ; i++) {
                req = requestPipe[i];
                if (req == null) continue;
                // req.spreadsheet may be null or undefined
                rowId = (req.spreadsheet ? req.spreadsheet + "-" : "-") + req.rowId;
                rows[rowId] = rows[rowId] || [];
                rows[rowId].push(req);
            }

            // Submit... well, submit all rows... yeah, yeah separately, because
            // Postgres doesn't like recovering from an exception in a transaction, so we wouldn't know which
            // cells fail... that's gonna flush...
            for (var i in rows) {
                //!\ this 'i' in the foreach loop takes the list of keys, it's very different from 0..rows.length because
                // the updates rows are not continuous.
                row = rows[i];
                url = !row[0].spreadsheet ? baseUrl("/data", checkNotNull(row[0].rowId))
                                          : baseUrlForContext(row[0].spreadsheet, "/data", checkNotNull(row[0].rowId)),
                    colNames = row.map(function(cell) {return cell.column;}).join(",");
                data = row.map(function(cell) {return [cell.value];});
                $.ajax({
                    url: url,
                    type: 'PUT',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(data),
                    headers: {
                        "X-COL-NAMES" : colNames
                    }
                }).done(function(data, status, request){
                    dispatchCellValues(data.data, data.tableDef);
                }).fail(function(jqXHR, error, reason){
                    var colNames = this.headers["X-COL-NAMES"].split(","),
                        urlParts = this.url.split("/"),
                        spreadsheetKey = urlParts[urlParts.length - 3],
                        spreadsheetKey2 = spreadsheetKey != spreadsheet.id ? spreadsheetKey : null,
                        rowId = urlParts[urlParts.length - 1],
                        rowId2 = spreadsheetKey2 && (spreadsheetKey2 + "-" + rowId) || rowId,
                        colName, cell,
                        data,
                        message;

                    if (jqXHR.status == 400 || (jqXHR.status == 500 && jqXHR.responseText.charAt(0) == '{')) {
                        try {
                            data = JSON.parse(jqXHR.responseText);
                            if (data != null) {
                                message = data.message || "Error";
                            }
                        } catch (err) {
                            // Can't understand the json. No worries, keep going.
                        }
                    }

                    for (var i = 0; i < colNames.length; i++) {
                        colName = $.trim(colNames[i]);
                        if (colName == "POSITION") {
                            // If the POSITION column was changed, it's a bit complicated.
                        } else {
                            cell = getCell(spreadsheetKey2, rowId, colName);
                            cell.renderer.markInError(message);
                        }
                    }

                    if (data && data.type == "FORMULA_ERROR") {
                        if (colName == "POSITION") {
                            var $row = findRowByPk(spreadsheetKey2, rowId),
                                $cellsWithFormula = $row && $row.find(".saving.formula"),
                                cell = $cellsWithFormula && getCell($cellsWithFormula),
                                errorList = data.errorList,
                                firstError = errorList && errorList.length > 0 && errorList[0],
                                firstErrorPosition = firstError && (firstError.line == 1) && firstError.position;
                            if (cell) {
                                cell.renderer.markInError(message);
                                cell.renderer.focus(firstErrorPosition);
                                return;
                            }
                        }
                        // If the cell couldn't be found, display the message with a popup
                        window.PlaySQL.Messages.addMessage("error", message, jqXHR.responseText);
                        return;
                    }
                });
            }
        };

        /** Shared method between saveCell, sprayRequestPipe and insert/remove rows:
         * It reads the data and the tableDef and updates them all. It's useful in order
         * to update all dependencies of a formula, whether you're inserting, deleting or
         * editing a row.
         * @param data the data - usually the data.data property of the JSON response
         * @param tableDef the table definition - usually the data.tableDef property.
         */
        function dispatchCellValues(data, tableDef) {
            for (var rowNum in data) {
                var id,
                    row = data[rowNum],
                    jointSpreadsheetKey = tableDef.name != spreadsheet.id ? tableDef.name : undefined,
                    rowMetadata = undefined;
                for (var i in tableDef.columns) {
                    var col = tableDef.columns[i];
                    if (col.statusPK) {
                        id = row[i][0];
                    } else if (id != undefined && col.statusPosition) {
                        rowMetadata = row[i][0];
                        try {
                            rowMetadata = $.parseJSON(rowMetadata) || {};
                        } catch (err) {
                            rowMetadata = {};
                        }
                        var $row = findRowByPk(jointSpreadsheetKey, id);
                        $row.data("row-metadata", rowMetadata);
                    } else if (id != undefined && !col.statusPosition) {
                        var cell = getCell(jointSpreadsheetKey, id, col.name),
                            cellMetadata = cell && getCellMetadata(cell.$cell);
                        if (cell == undefined) {
                            // Because of formulas and joint cells, it could happen that we get cells which aren't on the current page
                            continue;
                        } else if (!cell.$cell.hasClass("editing")) {
                            cell.renderer.setOriginalValue(row[i][0], row[i][1]);
                        }
                        cell.$cell.attr("style", buildCssStylesForCell(undefined, cellMetadata) || "");
                        if (cellMetadata && cellMetadata["formula"]) {
                            cell.$cell.addClass("formula");
                        } else {
                            cell.$cell.removeClass("formula");
                        }
                    }
                }
            }
            AJS.$.debounce(updateTotals, 500);
        }

        var saveColumn = function($header, column, newColumn, changes, successCallback, failureCallback) {
            function innerSuccessCallback(oldName) {
                if (changes.indexOf("RENAME") != -1 || changes.indexOf("CHLBL") != -1) {
                    // $header exists when called from the inline dialog, and doesn't when called
                    // from the "renderer-specific" sub-inline dialog, which doesn' matter because
                    // we don't modify the label there and the caller redraws the whole column
                    // anyway.
                    if ($header) {
                        var cell = checkNotNull(getCell($header));
                        cell.renderer.view();
                    }
                }
                // When renaming, if any row uses this column, then the full spreadsheet needs to be reloaded for
                // the metadata.
                if (changes.indexOf("RENAME") != -1) {
                    var rowsWithMetadata = $placeholder.find("tr[data-row-metadata]").filter(function() {
                        var metadata = $(this).data("row-metadata");
                        if (!metadata) return false;
                        if (!oldName || JSON.stringify(metadata).indexOf(oldName) == -1) return false;
                        return true;
                    });
                    if (rowsWithMetadata.length > 0) {
                        spreadsheet.load();
                    }
                }
                if (changes.indexOf("CHFMA") != -1) {
                    testSpreadsheet(column.name, function (success, value) {
                        if (success) {
                            spreadsheet.load();
                            successCallback && successCallback();
                        } else {
                            failureCallback && failureCallback(value);
                        }
                    });
                } else {
                    // in 'else' because only a CHFMA would be asynchronous
                    successCallback && successCallback();
                }
            }
            if (spreadsheet.options.saveColumn) {
                spreadsheet.options.saveColumn(spreadsheet, column, newColumn, changes,
                    innerSuccessCallback, failureCallback);
            } else {
                var after = "";
                if (changes.indexOf("MOVE") != -1) {
                    after = changes.indexOf("MOVE") != -1 ? newColumn.after : "";
                    delete newColumn.after;
                }

                var url = spreadsheet.baseUrl("/cols", checkNotNull(column.name), {
                        confirm: changes.join(","),
                        after: after
                    }),
                    data = newColumn;
                $.ajax({
                    url: url,
                    type: 'PUT',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(data)
                }).done(function (data, status, request) {
                    var columnDef = window.PlaySQL.Spreadsheet.readColumnDefinition(column.index, data),
                        oldName = column.name;
                    column.name = columnDef.name;
                    column.label = columnDef.label;
                    column.type = columnDef.type;
                    column.length = columnDef.length;
                    column.formula = columnDef.formula;
                    column.renderer = columnDef.renderer;
                    column.viewRenderer = columnDef.viewRenderer;
                    column.formats = columnDef.formats;
                    column.width = columnDef.width;
                    innerSuccessCallback(oldName);
                }).fail(function (jqXHR, error, reason) {
                    try {
                        // If the BAD_REQUEST is specially formatted by Play SQL
                        var data = $.parseJSON(jqXHR.responseText);
                        failureCallback && failureCallback(data.message);
                        return;
                    } catch (err) {
                        // Swallow and proceed to the next section
                        AJS.log(err);
                    }
                    failureCallback && failureCallback(jqXHR.responseText);
                });
            }
        }
        /** Do create the column in the back-end
         * At the time of calling, the column shouldn't be among the spreadsheet.columns.
         */
        var createColumn = function($cell, column) {
            if (!spreadsheet.perms.hasPerm('ADD_COLS')) return;
            var url = baseUrl("/cols", checkNotNull(column.name)),
                data = {
                    name: checkNotNull(column.name),
                    type: checkNotNull(column.type),
                    label: checkNotNull(column.label),
                    renderer: checkNotNull(column.renderer),
                    viewRenderer: column.viewRenderer,
                    options: undefined
                };
            $.ajax({
                url: url,
                type: 'PUT',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(data)
            }).done(function(data, status, request){
                var cell = getCell($cell),
                    col = colOf($cell);
                col.name = column.name;
                col.type = column.type;
                col.label = column.label;
                col.renderer = column.renderer;
                col.viewRenderer = column.viewRenderer;
                cell.renderer.view();
            }).fail(function(jqXHR, error, reason){
                window.PlaySQL.Messages.addMessage("error", "The column couldn't be created: " + column.label,
                    "change-col", jqXHR.responseText);
                $cell.removeClass("saving").addClass("invalid").attr("title", "The column couldn't be created");
            });
        }

        var emptyRow = function(length) {
            var result = [];
            for (var i = 0 ; i < length; i++) {
                result[i] = ["", "", ""]; // The third value is usually provided by renderCells()
            }
            return result;
        }

        function incrementColSpan($tds) {
            if ($tds == null || $tds.size() < 1) {
                return;
            }
            $tds.each(function(i, $td) {
                $td = $($td);
                var span = parseInt($td.attr('colspan')) || 1;
                $td.attr('colspan', span + 1);
            });
        }

        /** Manages adding a column in the HTML */
        var addColumnUI = function(column) {
            window.PlaySQL.Selection.forTable(column.$placeholder).unselectAll();

            // Enlarge TBODY
            column.$placeholder.find("tbody tr td:last-child").each(function() {
                var $this = $(this);
                if ($this.parent().is(".playsql-message")) {
                    incrementColSpan($this);
                } else {
                    var $td = $("<td></td>", {
                        "data-value": "",
                        "data-rendered": ""
                    }).insertBefore($this);
                }
            });

            // Enlarge THEAD

            var $th = $("<th></th>", {
                "data-name": column.name,
                "data-type": column.type,
                "data-renderer": column.renderer,
                "data-view-renderer": column.viewRenderer,
                "data-status-pk": column.statusPK ? "true" : undefined,
                "data-status-position": column.statusPosition ? "true" : undefined,
                "text": column.label
            }).insertBefore(column.$placeholder.find("thead tr.playsql-col-headers th:last-child"));

            incrementColSpan(column.$placeholder.find("tr.pagination-row td:not(.right-padding)"));
            incrementColSpan(column.$placeholder.find("tr.playsql-message td:not(.right-padding)"));

            // Enlarge TBOTTOM
            incrementColSpan(column.$placeholder.find("tfoot tr td:not(:last-child)").last());

            return $th;
        }

        // Add a column on the front-end
        var addColumn = function($this, e) {
            if (!spreadsheet.perms.hasPerm('ADD_COLS')) return;

            var column = {
                name: "",
                label: "New column",
                type: "TEXT",
                renderer: "link",
                viewRenderer: undefined,
                formats: {},
                width: null,
                $placeholder: $placeholder,
                index: spreadsheet.columns.length,
                copy: spreadsheet.columns[1].copy
            };

            var $th = addColumnUI(column);

            spreadsheet.columns.push(column);

            // Move the header to 'edit'
            var cell = getCell($th).renderer;
            cell.edit();
            cell.focus();

            saveTotals();

            e.preventDefault();
            return false;
        }

        var deleteColumn = function($cell) {
            if (!spreadsheet.perms.hasPerm('REMOVE_COLS')) return;
            window.PlaySQL.Selection.forTable($placeholder).unselectAll();
            var column = colOf($cell);

            // The column name could be empty if the user was still creating the column
            // and pressed Esc. Otherwise we ask him to confirm.
            if (column.name != "" && !confirm(("You are about to delete the column '$1' (label: $2). The operation cannot be cancelled " +
                "and the contents of the cells will be lost. Are you sure?")
                    .replace("$1", column.name).replace("$2", column.label))) {
                return false;
            }

            spreadsheet.columns.splice(column.index, 1);
            // Reindex the columns
            for (var index = 0 ; index < spreadsheet.columns.length ; index++) {
                spreadsheet.columns[index].index = index;
            }

            checkNotNull($placeholder.find("thead > tr.playsql-col-headers > *").eq(column.index)).remove();
            $placeholder.find("tbody td:nth-child(" + (column.index+1) + ")").remove();
            removeTotalAtColumn(spreadsheet.totals, column.index - 1);

            // We don't need to remove it server-side if we were just editing the column
            if (column.name) {
                var url = baseUrl("/cols", checkNotNull(column.name)),
                    data = {
                        name: checkNotNull(column.name),
                        type: checkNotNull(column.type),
                        label: checkNotNull(column.label),
                        options: undefined
                    };
                $.ajax({
                    url: url + "?" + $.param({ confirm: 'DELETE' }),
                    type: 'DELETE',
                    contentType: "application/json; charset=utf-8"
                }).done(function (data, status, request) {
                    // Do nothing, show nothing.
                    saveTotals();
                }).fail(function (jqXHR, error, reason) {
                    window.PlaySQL.Messages.addMessage("error", "The column couldn't be deleted: " + column.label,
                        "change-col", jqXHR.responseText);
                });
            } else {
                saveTotals();
            }

            return false;
        }

        /**
         * Move a column. If shift < 0, move to the left. If > 0, move to the right. If 0, noops.
         * @param $header
         * @param shift
         */
        var moveColumn = function(column, shift, successCallback, failureCallback) {
            var newColumn = column.copy();
            var theoreticalIndex;

            if (shift < 0) {
                theoreticalIndex = column.index - 1 + shift;
                if (theoreticalIndex < 0) theoreticalIndex = 0;
            } else if (shift > 0) {
                theoreticalIndex = column.index + shift;
                if (theoreticalIndex >= spreadsheet.columns.length) theoreticalIndex = spreadsheet.columns.length - 1;
            } else {
                throw "Invalid shift: " + shift;
            }

            if (theoreticalIndex == 0) {
                // We have to hard-code it because the column 'POSITION' is stripped
                // at display time
                newColumn.after = "POSITION";
            } else {
                newColumn.after = spreadsheet.columns[theoreticalIndex].name;
            }

            // We can afford not passing $header, because we're not using it in saveColumn
            // in this situation.
            saveColumn(undefined, column, newColumn, ["MOVE"], function(){
                successCallback && successCallback();
            }, function(message){
                failureCallback && failureCallback(message);
            });
        }

        /**
         * Remove the total for the right column
         * @param totals the totals array (the model)
         * @param columnIndex the column index, starting at 0 = the first column / the 0 index in totals (Column ID = -1)
         */
        var removeTotalAtColumn = function(totals, columnIndex) {
            if (!totals || totals.length == 0) return;
            var position = 0;
            $placeholder.find("tfoot > tr > *:not(:first-child):not(.right-padding)").each(function(index){
                var $th = $(this),
                    span = parseInt($th.attr("colspan")) || 1,
                    totalDef = totals[index];
                if (columnIndex >= position && columnIndex < position + span) {
                    // That's where we remove something
                    if (span >= 3) {
                        $th.attr("colspan", --span);
                        totalDef.colspan = span;
                        return false;
                    } else if (span == 2) {
                        $th.removeAttr("colspan");
                        totalDef.colspan = 1;
                        return false;
                    } else {
                        $th.remove();
                        totals.splice(index, 1);
                        return false;
                    }
                } else {
                    position += span;
                }
            });
        }

        /*var startRenameColumn = function($header) {
         var renderer = getCell($header).renderer;
         renderer.edit();
         renderer.focus();
         }*/

        var renderAllColumn = function(column) {
            var renderer = window.PlaySQL.Spreadsheet.renderers[column.viewRenderer || column.renderer];
            $placeholder.find("tbody > tr > td:nth-child(" + (1+column.index) + ")").each(function(){
                var $cell = $(this),
                    value = $cell.attr('data-value');
                if (!$cell.hasClass("editing saving")) {
                    $cell.html(renderer.renderCellContents(value, spreadsheet, column));
                }
            });
        }

        var sortCol = function($header, way, nulls) {
            // Parse spreadsheet's order by clause
            var clause = window.PlaySQL.Helpers.parseOrderByClause(spreadsheet.orderbyClause),
                col = checkNotNull(colOf($header)),
                colname = '"' + col.name + '"',
                perform = true;
            way = way || 'REVERSE';
            for (var i = 0 ; i < clause.length ; i++) {
                if (clause[i].field.indexOf(colname) == 0) {
                    if (i == 0) {
                        if (way == clause[i].way && nulls == clause[i].nulls) return;
                        if (way == 'REVERSE') {
                            way = clause[i].way.toUpperCase() == 'ASC' ? 'DESC' : 'ASC';
                        } else if (way == 'NO-SORTING') {
                            clause.splice(i, 1);
                            perform = false;
                            break;
                        }
                        clause[i].way = way;
                        clause[i].nulls = nulls;
                        perform = false;
                        break;
                    } else {
                        // Delete and make it the primary sorting
                        clause.splice(i, 1);
                        break;
                    }
                }
            }
            if (perform && way != 'NO-SORTING') {
                if (way == 'REVERSE') way = 'ASC';
                var cast = col.type == 'VARCHAR' || col.type == 'TEXT' ? '::text'
                    : col.type == 'INTEGER' || col.type == 'BIG_INTEGER' || col.type == 'BOOLEAN' || col.type == 'DATE' || col.type == 'TIME' || col.type == 'NUMERIC' || col.type == 'DOUBLE' ? '::' + col.type
                    : '';
                clause.unshift({
                    field: colname,// + cast,
                    way: way,
                    nulls: nulls
                });
            }
            var clauseString = window.PlaySQL.Helpers.buildOrderByClause(clause);
            spreadsheet.orderbyClause = clauseString;
            AJS.log("ORDER BY " + clauseString);
            spreadsheet.load();
        }

        var pasteHandler = function($contenteditable) {
            // Make a big array of the values: { rows -> { cells -> [ value, formula ] } }
            var allValues = [],
                $placeholder = this.$placeholder,
                $focused = $placeholder.find(".focused"),
                $selected = $placeholder.find(".selected"),
                isPlaySQLPasteSource = $contenteditable.find("table > thead").length != 0,
                columnHeaders = [];
            if (isPlaySQLPasteSource) {
                columnHeaders = $contenteditable.find("table > thead th").map(function(i, el){return $(el).text();});
                // Remove the columns which contain a th, i.e. the ID column
                $contenteditable.find("table > tbody > tr:first > th").each(function(index, th){
                    columnHeaders.splice($(th).index(), 1);
                });
                // Chop the head off, keep the body, Vive la Revolution!
                $contenteditable.find("table > thead, table > tbody > tr > th").remove();
            }
            var $row, $cell, cell;
            $contenteditable.find("table tr").each(function(){
                var $tr = $(this),
                    $cells = $tr.find("th,td"),
                    row = [];
                $cells.each(function(){
                    var $cell = $(this),
                        value = $cell.attr("data-value"),
                        formula = $cell.attr("data-cell-metadata-formula");
                    if (typeof value == 'undefined') {
                        value = $cell.text();
                    }
                    row.push([value, formula]);
                });
                allValues.push(row);
            });
            if (allValues.length == 0) {
                // Did the person start typing?
                if ($.trim($contenteditable.html()).length > 0 && $contenteditable.html() != "&#x200B;" && $contenteditable.html() != "\u200B") {
                    var walker = document.createTreeWalker($contenteditable[0], NodeFilter.SHOW_ALL, null, false),
                        text = "",
                        blockNodes = ['DIV', 'BR', 'P', 'LI', 'DL', 'DD', 'DT', 'FORM', 'PRE', 'TR'];
                    while (node = walker.nextNode()) {
                        if (blockNodes.indexOf(node.nodeName) != -1) {
                            text += "\n";
                        } else if (node.nodeType == Node.TEXT_NODE) {
                            text += node.nodeValue;
                        }
                    }
                    var rows = $.trim(text).split(/\r?\n\r?/);
                    for (var i in rows) {
                        // The map() function returns the [value, formula] pair
                        allValues.push(rows[i].split(/\t/)
                            .map(function(e){return [e, undefined]}));
                    }

                    if (catchTextShortcuts(allValues)) {
                        $contenteditable.empty();
                        return;
                    }
                } else {
                    return;
                }
            }
            // Don't let foreign content in the table...
            $contenteditable.empty();
            if ($focused.is("tbody th")) {
                $focused = $focused.next(":not(.right-padding)");
            } else if ($focused.is("thead th")) {
                alert("You are attempting to paste into a full column. The contents will only be pasted into the visible rows.");
            }
            if ($focused.length == 0)
                return;
            var originCol = $focused.index(),
                originRow = $focused.closest("tr").index(),
                maxRows = $placeholder.find("> table > tbody tr").length - originRow,
                missingRows = Math.max(0, allValues.length - maxRows),
                spreadsheetWidth = spreadsheet.columns.length,
                maxCols = spreadsheetWidth - originCol,
                missingCols = allValues[0].length - maxCols,
                pasteAtOrigin = $selected.size() == 1,
                pasteWithRepeat = allValues.length == 1,
                pasteWithinSelection = $selected.size() > 1;
            spreadsheet.disableFocusManagement = true;

            if (missingRows > 0) {
                this.addRows(missingRows);
            }
            var column;
            if (missingCols > 0) {
                var createMoreCols = spreadsheet.perms.hasPerm('ADD_COLS') &&
                    confirm("The data you're attempting to paste is wider than the number of columns. Do you want Play SQL to kindly create columns for you?");
                if (createMoreCols) {
                    var columnsToCreate = [],
                        columnNamesToCreate = [];
                    for (var i = spreadsheetWidth; i < spreadsheetWidth + missingCols; i++) {
                        column = {
                            name: spreadsheet.defaultCase == 'LOWER' ? "newcolumn" : "NEWCOLUMN",
                            label: "New column",
                            type: "TEXT",
                            length: undefined,
                            renderer: "link",
                            viewRenderer: undefined,
                            formats: {},
                            width: undefined,
                            $placeholder: $placeholder,
                            index: spreadsheet.columns.length
                        };
                        if (columnHeaders[i - originCol]) {
                            column.label = columnHeaders[i - originCol];
                            column.name = window.PlaySQL.Helpers.generateKey(column.label, spreadsheet.defaultCase);
                        }
                        column.name = getUniqueColumnName(spreadsheet.columns, column.name);
                        //column.name = getUniqueColumnName(columnsToCreate, column.name);

                        addColumnUI(column);
                        spreadsheet.columns.push(column);
                        columnsToCreate.push({
                            name: checkNotNull(column.name),
                            type: checkNotNull(column.type),
                            label: checkNotNull(column.label),
                            renderer: checkNotNull(column.renderer),
                            viewRenderer: undefined,
                            options: undefined
                        });
                        columnNamesToCreate.push(column.name);
                        maxCols++;
                    }

                    var url = baseUrl("/cols");
                    $.ajax({
                        url: url,
                        type: 'POST',
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: JSON.stringify(columnsToCreate)
                    }).done(function(data, status, request){
                        var columns = data.columns;
                        for (var i in columns) {
                            var column = columns[i];
                            if (columnNamesToCreate.indexOf(column.name) == -1) {
                                continue;
                            }
                            var col = colOf(column.name),
                                cell = getCell($cell);
                            col.name = column.name;
                            col.type = column.type;
                            col.label = column.label;
                            col.renderer = column.renderer;
                            col.viewRenderer = column.viewRenderer;
                            cell.renderer.view();
                        }
                    }).fail(function(jqXHR, error, reason){
                        window.PlaySQL.Messages.addMessage("error", "The column couldn't be created: " + column.label,
                            "change-col", jqXHR.responseText);
                        $cell.addClass("invalid").attr("title", "The column couldn't be created");
                    });
                }
            }

            function paste(cell, value) {
                var formula = value[1],
                    value = value[0];
                if (cell) {
                    if (formula) {
                        spreadsheet.saveCellMetadata($cell, "formula", formula);
                    } else {
                        cell.renderer.edit(value);
                    }
                    cell.$cell.addClass("selected");
                }
            }
            // Get going, paste values in cells
            if (pasteWithRepeat) {
                $selected.closest("tr").each(function(){
                    var $row = $(this);
                    for (var col in allValues[0]) {
                        if (parseInt(col) >= maxCols) break;
                        $cell = $row.find("th,td").eq(parseInt(col) + originCol);
                        if (!$cell.hasClass("selected")) continue;
                        cell = getCell($cell);
                        paste(cell, allValues[0][col]);
                    }
                });
            } else if (pasteAtOrigin || pasteWithinSelection) {
                for (var row in allValues) {
                    $row = $placeholder.find("> table.playsql > tbody tr").eq(parseInt(row) + originRow);
                    for (var col in allValues[row]) {
                        if (parseInt(col) >= maxCols) break;
                        $cell = $row.find("th,td").eq(parseInt(col) + originCol);
                        if (pasteWithinSelection && !$cell.hasClass("selected")) continue;
                        cell = getCell($cell);
                        paste(cell, allValues[row][col]);
                    }
                }
            }

            window.PlaySQL.Selection.forTable($placeholder).unselectAll();
            spreadsheet.disableFocusManagement = false;
            cell = cell || getCell($focused)
            if (cell) {
                cell.$cell.addClass("selected focused");
                cell.renderer.focus(true);
            }
            spreadsheet.sprayRequestPipe();
        }

        function catchTextShortcuts(allValues) {
            // It used to be that we'd catch '=' and display the column's formula editor. Not anymore:
            // now we have cell-local formulas and they're managed seamlessly by the cell renderer.
            // var text = allValues.toString()
            /*if (text == "=") {
                var $cell = $placeholder.find(".focused").first(),
                    cell = getCell($cell);
                if ($cell.index() > 0 && cell != undefined) {
                    cell.renderer.editFormula();
                    return true;
                }
            }*/
            return false;
        }

        /** Fetches 1 row of the spreadsheet, to check whether there's an error
         * @param colname the name of the column for which we want to return the sample value
         */
        var testSpreadsheet = function(colname, callback) {
            var url = baseUrl("/data", {
                limit: 1
            });

            $.ajax({
                url: url,
                type: 'GET',
                contentType: "application/json; charset=utf-8",
                timeout: 180000,
                cache: false
            }).done(function(data, status, request){
                var colNames = request.getResponseHeader("X-COL-NAMES").split(","),
                    tableDef = data.tableDef,
                    colIndex, message;
                for (var i in tableDef.columns)
                    if (tableDef.columns[i].name == colname) {
                        colIndex = i;
                        break;
                    }
                if (colIndex == undefined) {
                    return callback(false, "Column " + colname + " doesn't exist");
                }
                var column = readColumnDefinition(colIndex, tableDef.columns[i], undefined),
                    value = data.data.length > 0 ? data.data[0][colIndex][0] : undefined;

                message = data.errorMessage;
                if (data.errorMessage) {
                    message = message.replace("Error with a calculated column:", "");
                    message = message.replace("ERROR: ", "");
                    message = message.replace(/: syntax error at or near ""[a-zA-Z0-9]+""/, "");
                    message = message.replace(/ Position: [\d]+/, "");
                    return callback(false, message);
                } else {
                    return callback(true, value);
                }
            }).fail(function(jqXHR, error, reason) {
                var message = "The test of the spreadsheet was unsuccessful: " + jqXHR.responseText;
                callback(false, message);
            });
        }

        function displayCellProperties(e) {
            window.PlaySQL.Spreadsheet.CellProperties.display(spreadsheet, $(".selected"));
        }

        function removeCellContents(e) {
            var $cells = $placeholder.find("td.selected:not(.right-padding)");
            if ($cells.size() == 0 || $cells.filter(".editing").size() > 0) return;
            // We don't want to let the browser go to the previous page (because of the Backspace key) if a
            // cell is selected
            e.preventDefault();

            if (spreadsheet.perms.hasPerm("EDIT_CELLS") || spreadsheet.perms.hasPerm("Q_VIEW_EDIT")) {
                if ($cells.size() > 1) {
                    if (!confirm("Do you want to delete the contents of " + $cells.size() + " cells?")) return;
                }
                $cells.each(function () {
                    var $cell = $(this);
                    if ($cell.hasClass("joint-id-renderer")) {
                        if ($cell.find(".joint-id-remove").size() > 0) {
                            if (!confirm("This cell is a foreign key to a joint table. Do you want to delete the full row of the joint table?")) return;
                            spreadsheet.removeJointRow($cell);
                        }
                    } else if (spreadsheet.perms.hasPerm("EDIT_CELLS") || spreadsheet.perms.hasPerm('Q_VIEW_EDIT', spreadsheet.colOf($cell))) {
                        spreadsheet.saveCell($cell, null);
                        if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                            spreadsheet.saveCellMetadata($cell, "formula", null);
                        }
                    }
                });
                spreadsheet.sprayRequestPipe();
            }
        }

        function getUniqueColumnName(columns, name) {
            for (var i = 0 ; i < columns.length ; i++) {
                var suggestedName = name + (i != 0 ? i : ""),
                    found = false;
                for (var j in columns) {
                    if (columns[j].name == suggestedName) {
                        found = true;
                        break;
                    }
                }
                if (!found) return suggestedName;
            }
            return "";
        }

        function buildCssClassesForCell(value, cellMetadata) {
            if (cellMetadata && cellMetadata.formula) {
                return "formula";
            }
            if (value != undefined && value.charAt(0) == "=") {
                return "anti-formula";
            }
            return undefined;
        }
        function buildCssStylesForCell(value, cellMetadata) {
            if (cellMetadata && cellMetadata["background-color"]) {
                return "background-color: " + cellMetadata["background-color"] + ";";
            }
            return undefined;
        }

        /** Reset the properties of the spreadsheet, as if never been touched by a user on this page */
        function reset() {
            // Reset the Order By and the Filters
            spreadsheet.orderbyClause = $placeholder.attr('data-macro-orderby-clause');
            spreadsheet.whereClauseColumnFilters = undefined;
            // Reset the User Parameters
            spreadsheet.userParameters = undefined;
        }

        // Append all methods to 'this' and return it
        var result = $.extend(spreadsheet, {
            load: load,
            reset: reset,
            // Finding elements
            colOf: colOf,
            getRecordIds: getRecordIds,
            getCell: getCell,
            getCellMetadata : getCellMetadata,
            getRowMetadata : getRowMetadata,
            findRowByPosition: findRowByPosition,
            findRowByPk: findRowByPk,
            $findColumnCells : $findColumnCells,
            // Actions on elements
            addRow: addRow,
            addRows: addRows,
            deleteRow: deleteRow,
            deleteRows: deleteRows,
            addJointRow: addJointRow,
            removeJointRow: removeJointRow,
            sprayRequestPipe: sprayRequestPipe,
            saveCell: saveCell,
            saveCellMetadata: saveCellMetadata,
            recalculateFormulas: recalculateFormulas,
            dispatchCellValues: dispatchCellValues,
            updateColumnWidth: updateColumnWidth,
            //renameColumn: renameColumn,
            saveColumn: saveColumn,
            createColumn: createColumn,
            deleteColumn: deleteColumn,
            moveColumn: moveColumn,
            renderAllColumn : renderAllColumn,
            sortCol: sortCol,
            pasteHandler: pasteHandler,
            // Helpers
            emptyRow: emptyRow,
            baseUrl: baseUrl
        });
        window.PlaySQL.Spreadsheet.spreadsheets[spreadsheet.id] = result;
        window.PlaySQL.spreadsheet = result;
        return result;
    } // End of byPlaceholder()

    function readColumnDefinition(index, colDefinition, $placeholder) {
        return {
            name: colDefinition.name,
            label: colDefinition.label,
            type: colDefinition.type,
            length: colDefinition.length,
            formula: colDefinition.formula,
            renderer: checkNotNull(colDefinition.renderer, colDefinition),
            viewRenderer: colDefinition.viewRenderer,
            statusPK: colDefinition.statusPK,
            statusPosition: colDefinition.statusPosition,
            formats: colDefinition.formats || {},
            width: colDefinition.width,
            index: index,
            $placeholder: $placeholder,
            copy : function() {
                // Copy a subset of the column for the purpose of sending it to save
                return {
                    name: this.name,
                    label: this.label,
                    type: this.type,
                    length: this.length,
                    formula: this.formula,
                    renderer: this.renderer,
                    viewRenderer: this.viewRendrer,
                    statusPK: this.statusPK,
                    statusPosition: this.statusPosition,
                    width: this.width,
                    formats: $.extend(true, {}, this.formats)
                }
            }
        };
    }

    function registerRenderer(renderer) {
        window.PlaySQL.Spreadsheet.renderers[renderer.key] = renderer;
    }

    function initializeAll() {
        var anchor = window.location.hash,
            recordId;
        if (anchor && anchor.indexOf("#")==0) {
            recordId = parseInt(anchor.substring(1));
            if (isNaN(recordId)) {
                recordId = undefined;
            }
        }

        $(".playsql-spreadsheet-placeholder").each(function(){
            try {
                var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($(this));
                spreadsheet.selectedRecord = recordId;
                spreadsheet.load();
            } catch (err) {
                AJS.log("Error while loading spreadsheet: ", err);
            }
        });
    }

    window.PlaySQL = window.PlaySQL || {};
    window.PlaySQL = window.PlaySQL;
    window.PlaySQL.Spreadsheet = window.PlaySQL.Spreadsheet || {
        byId: byId,
        byPlaceholder: byPlaceholder,
        initializeAll : initializeAll,
        spreadsheets: {},
        renderers: {},
        readColumnDefinition: readColumnDefinition
    };

    $(function () {

        if (!window.PlaySQL.Spreadsheet.initialized) {
            AJS.trigger("playsql-spreadsheet-init", { register: registerRenderer });
            AJS.unbind("playsql-spreadsheet-init");
            window.PlaySQL.Spreadsheet.initialized = true;
            window.PlaySQL.Selection.setupCopyHandler({
                pasteHandler: function($contenteditableDiv) {
                    // 'this' refers to the ss
                    return this.pasteHandler($contenteditableDiv);
                }
            });
        }

        // Load spreadsheets by default, except if we're in the Query Editor
        if ($("body.query-editor-mode").size() == 0) {
            window.PlaySQL.Spreadsheet.initializeAll();
        }
    });

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderer-base.js' */
(function($){
    /**
     * The API boundary is:
     * - The TD/TH belongs to spreadsheet-macro.js,
     * - The renderer is free with the innerHTML,
     * - The CSS class of the td/th is part of the API. The spreadsheet communicates with the renderers
     * through the methods of RendererBase; the renderers communicate with the spreadsheet using
     * the object passed in forCell(spreadsheet, $cell).
     *
     * Cells have a state cycle represented by the CSS classes:
     * - none: The cell is in view mode.
     * - editing: The cell contains an HTML input or any kind of data-entry element.
     * cleaned by forCell().edit() as the last resort.
     * - saving: The cell is being saved. We're waiting for server feedback and we don't
     * know yet whether it is saved. Once we receive it we'll immediately switch to
     * view or invalid mode.
     * - invalid: The value in the cell is invalid. It can't be saved.
     *
     * Other css classes:
     * - selected, focused
     * - formula: The cell contains a formula / the formula editor. The 'formula' class
     * is supposed to be there as soon as we know it's a formula (=when we write the TD)
     * or when we detect it's a formula (=when the user types '=').
     * - anti-formula: The cell starts with a '=' but is not a formula. This class is set
     * at the same time as 'formula' (when we build the TD or when the user clicks 'remove
     * formula') and will be removed if the user removes the '='.
     */
    AJS.bind("playsql-spreadsheet-init", function(event, api) {

        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }

        var RendererBase = function() {
            return {
                key : "base-renderer",
                getI18nName : function() {
                    // Default implementation, please override...
                    return this.key;
                },
                isSystemRenderer : function() {
                    return true;
                },
                isSupportedType : function() {
                    throw "Not Implemented";
                },
                getDefaultType : function() {
                    throw "Not Implemented";
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value === null || value === undefined) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    value = AJS.escapeHtml(value);
                    if (column.formats.css) {
                        var styles = $.parseJSON(column.formats.css),
                            styleAttr = "";
                        for (var key in styles) {
                            styleAttr = key + ":" + styles[key] + ";";
                        }
                        value = outerHtml($("<span>", {
                            style: styleAttr,
                            html: value
                        })).replace(/\n/g, "<br>\n");
                    }

                    return value;
                },
                onColumnDisplay : function(spreadsheet, column) {
                    // This method is triggered whenever the table is done displaying.
                    // Place additional code about cell rendering: binding handlers,
                    // displaying pictures or mapping external data.
                },
                createInputBox: function(value) {
                    return $("<input>", {
                        type: 'text',
                        value: value
                    });
                },
                /** This is only a helper method you can use to override createInputBox */
                createTextareaBox: function(value) {

                    function resizeTextarea() {
                        var $this = $(this);
                        if (this.clientHeight != this.scrollHeight) {
                            $this.height(this.scrollHeight);
                        }
                    }

                    window.setTimeout(function(){
                        $(".playsql textarea.uninitialized, .playsql-form-macro textarea.uninitialized").each(function(){
                            $(this).removeClass("uninitialized");
                            resizeTextarea.apply(this);
                        });
                    }, 0);

                    return $("<textarea>", {
                        text: value,
                        height: 1,
                        "class": "uninitialized"
                    }).on("keyup.playsqlresizetextarea keydown.playsqlresizetextarea change.playsqlresizetextarea", resizeTextarea);
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){

                    if (term.length > 0) {
                        window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterString(column, term, data);
                    }
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    callback();
                },
                /**
                 * Prepares the cell for edition
                 * @param spreadsheet
                 * @param $cell
                 * @param setValueByRef an array of the value to set. If provided, it will return "formula" if it
                 * starts with "=" and "ok" otherwise. It means it will override the status of the cell being a formula.
                 * @return the status:
                 *  - "ok" if it can be edited,
                 *  - "set" if the cell is already being edited and only the value must be set
                 *  - "formula" if it must be edited as a formula,
                 *  - "no" if it can't be edited
                 */
                checkBeforeEdit : function(spreadsheet, $cell, setValueByRef) {
                    if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', spreadsheet.colOf($cell))) {
                        return "no";
                    }
                    if (setValueByRef[0]) {
                        if (setValueByRef[0].charAt(0) == "=" && !$cell.hasClass("anti-formula")) {
                            if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                                return "formula";
                            } else {
                                $cell.addClass("anti-formula");
                            }
                        }
                    } else {
                        if ($cell.hasClass("formula")) {
                            if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                                setValueByRef[0] = spreadsheet.getCellMetadata($cell, "formula");
                                return "formula";
                            } else {
                                $cell.addClass("anti-formula").removeClass("formula");
                            }
                        }
                    }
                    if ($cell.hasClass("editing") || $cell.hasClass("saving")) {
                        return "set";
                    }
                    if (setValueByRef[0] == "'") {
                        $cell.addClass("anti-formula");
                        setValueByRef[0] = "";
                    }
                    $cell.removeClass("formula");
                    // Check if it's a joint table
                    var recordIds = spreadsheet.getRecordIds($cell, true);
                    if (recordIds.jointIdName && !recordIds.jointId) {
                        spreadsheet.addJointRow(recordIds.jointIdCell.$cell);
                    }

                    return "ok";
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = this,
                        operations = {
                            parent : parent,
                            /**
                             * Switch the cell to edit mode
                             * @param setValue optional. Sets the value. If so, it will re-evaluate whether it's a formula. It means
                             * if you pass a value which doesn't start with '=', it will set this value, replacing the formula.
                             */
                            edit: function(setValue) {
                                var setValueByRef = [setValue],
                                    situation = window.PlaySQL.Spreadsheet.rendererBase.checkBeforeEdit(spreadsheet, $cell, setValueByRef);
                                // If the value was changed, use it
                                setValue = setValueByRef[0];

                                switch (situation) {
                                    case "no": return;
                                    case "formula":
                                        /* TODO Formulas activation/deactivation here */
                                        window.PlaySQL.Spreadsheet.FormulaEditor.edit(spreadsheet, $cell, this, setValue);
                                        return;
                                    case "ok": break;
                                    case "set": break;
                                        setValue = this.parseValue(setValue);
                                        if (setValue != undefined) {
                                            $cell.find("input, textarea").val(setValue);
                                            $cell.find("div[contenteditable]").text(setValue);
                                        }
                                        return;
                                    default:
                                        throw "Not Implemented: situation " + situation;
                                }

                                setValue = this.parseValue(setValue);

                                $cell.addClass("editing");
                                // Keep the old value for cancel
                                $cell.attr('data-rendered', $cell.html());
                                var $input = parent.createInputBox(setValue != undefined ? setValue : $cell.attr('data-value'));

                                $input.appendTo($cell.empty());

                                var rendererInstance = this;
                                $input.keyup(function(){
                                    rendererInstance.validate(true);
                                }).on("blur.playsql-autocommit", function(){
                                    var $this = $(this),
                                        $cell = $this.closest("td");
                                    if (!$cell.hasClass("aui-dropdown2-trigger") && !$cell.hasClass("no-autocommit")) {
                                        window.setTimeout(function() {
                                            rendererInstance.saveAndView();
                                            spreadsheet.sprayRequestPipe();
                                        }, 0);
                                    }
                                });
                            },
                            parseValue : function(value) {
                                if (value == undefined) return value;
                                return $.trim(value);
                            },
                            /**
                             * Sets the focus on whatever HTML widget is central to this cell.
                             *
                             * No effect if the cell isn't in 'editing'.
                             *
                             * Beware to call this method on a 'click', not on a 'mousedown',
                             * because the 'click' event after a 'mousedown' resets the focus to the
                             * clicked element.
                             */
                            focus: function(withCaret, selEnd) {
                                if ($cell.hasClass("editing") && !spreadsheet.disableFocusManagement) {
                                    var $input = checkNotNull($cell.find("input, textarea, div[contenteditable]")).focus();
                                    if (withCaret == undefined)
                                        $input.select();
                                    else if (withCaret == true) {
                                        var el = $input[0],
                                            value = el.value || el.textContent;
                                        el.selectionStart = el.selectionEnd = value.length;
                                    } else if (typeof withCaret == "number") {
                                        var el = $input[0],
                                            value = el.value || el.textContent;
                                        el.selectionStart = withCaret;
                                        el.selectionEnd = selEnd != undefined ? selEnd : value.length;
                                    }
                                }
                            },
                            /** Returns from any state to view, by rendering the value which was provided by the server side */
                            view: function(value) {
                                // Allow for the value being null
                                if (value === undefined) {
                                    value = $cell.attr("data-value");
                                }
                                var viewRenderer = spreadsheet.getCell($cell).viewRenderer;
                                var rendered = (viewRenderer || this).parent.renderCellContents(value, spreadsheet, spreadsheet.colOf($cell));
                                $cell.html(rendered);
                                $cell.removeClass("editing saving invalid");
                                $cell.tipsy("disable");
                                $(".tipsy").remove();
                            },
                            getValue: function() {
                                return $cell.attr("data-value");
                            },
                            setOriginalValue: function(formulaValue, backendValue) {
                                this.view(formulaValue);
                                if (backendValue !== undefined) {
                                    $cell.attr("data-value", backendValue);
                                } else {
                                    $cell.attr("data-value", formulaValue);
                                }
                            },
                            validate: function(transformIfFormula) {
                                if ($cell.hasClass("formula")) {
                                    return window.PlaySQL.Spreadsheet.FormulaEditor.validate(spreadsheet, $cell, this);
                                }
                                var column = spreadsheet.colOf($cell),
                                    length = column.length,
                                    type = column.type,
                                    $input = $cell.find("input, textarea"),
                                    cellVal = $input.size() > 0 ? $input.val() : $cell.find("div[contenteditable]").text(),
                                    valid = true,
                                    message = "";
                                if (cellVal.length > 0) {
                                    if (cellVal.charAt(0) != "=") {
                                        // Not relevant anymore
                                        $cell.removeClass("anti-formula");
                                    } else {
                                        // The cell starts with '='
                                        if (transformIfFormula === true
                                            && !$cell.hasClass("anti-formula")
                                            && spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                                            /* TODO Formula activation/deactivation here */
                                            window.PlaySQL.Spreadsheet.FormulaEditor.edit(spreadsheet, $cell, this, cellVal);
                                            this.focus(true);
                                            return true;
                                        }
                                    }
                                } else {
                                    $cell.removeClass("anti-formula");
                                }
                                if (length) {
                                    if (cellVal != undefined && cellVal.length > length) {
                                        valid = false;
                                        message = "The maximum size is " + length;
                                    }
                                }
                                if (type == "INTEGER" || type == "BIG_INTEGER") {
                                    valid = valid && /^[ +-]?\d* *$/.test(cellVal);
                                    message = "An integer is expected";
                                }
                                if (valid) {
                                    $cell.removeClass("invalid").removeAttr("title");
                                    $cell.tipsy("disable");
                                    $cell.tipsy("hide");
                                } else {
                                    $cell.addClass("invalid").attr("title", message);
                                    $cell.tipsy({delayIn: 0});
                                    $cell.tipsy("enable");
                                    $cell.tipsy("show");
                                }
                                return valid;
                            },
                            /**
                             * Renders the cell with a temporary placeholder representing the value entered
                             * by the user. Then call spreadsheet.saveCell($cell, val) to actually save
                             * the cell. saveCell() is in charge of calling .view() with the server-side
                             * value.
                             *
                             * Adds the class 'saving' and removes 'editing'.
                             */
                            saveAndView: function() {
                                if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                                if (!this.validate()) {
                                    return;
                                }
                                var rowId = $cell.closest("tr").attr("data-row-id");
                                if (rowId == undefined || rowId == "") {
                                    return;
                                }
                                var column = spreadsheet.colOf($cell);
                                if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', column)) return;

                                if ($cell.hasClass("formula")) {
                                    window.PlaySQL.Spreadsheet.FormulaEditor.saveAndView(spreadsheet, $cell, this);
                                    return;
                                }

                                var $input = $cell.find("input, textarea"),
                                    val = $input.size() > 0 ? $input.val() : $cell.find("div[contenteditable]").text(),
                                    previousValue = $cell.attr('data-value'),
                                    rendered = this.parent.renderCellContents(val, spreadsheet, column);
                                if (val == '') {
                                    val = null;
                                }
                                if (previousValue == val) {
                                    $cell.html($cell.attr('data-rendered')).removeClass('editing');
                                    return;
                                }

                                $cell.attr('data-value', val);
                                // Keep the value for cancel
                                $cell.attr('data-rendered', rendered);

                                $cell.html(rendered).addClass("saving").removeClass("editing");
                                spreadsheet.saveCell($cell, val);
                                window.PlaySQL.Spreadsheet.FormulaEditor.checkAndSaveFormulaRemoval(spreadsheet, $cell);
                            },
                            cancelEdit: function() {
                                if ($cell.hasClass("formula")) {
                                    window.PlaySQL.Spreadsheet.FormulaEditor.cancelEdit(spreadsheet, $cell, this);
                                    return;
                                }
                                var rendered = $cell.attr('data-rendered');
                                if (rendered == undefined) {
                                    $cell.empty().removeClass("editing");
                                } else {
                                    $cell.html(rendered).removeClass("editing");
                                }
                            },
                            markInError: function(reason) {
                                $cell.addClass("invalid").attr("title", reason || "The cell couldn't be saved. Check the input and try again.");
                                // Transform as a tooltip
                                $cell.tooltip({delayIn: 0}); // Call Confluence's default values
                                $cell.tipsy("enable");
                                $cell.tipsy("show");
                                if (!$cell.hasClass("editing")) {
                                    this.edit();
                                    $cell.removeClass("saving");
                                }
                            }
                        };
                    return operations;
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var formats = column.formats,
                        jointIdColumn = formats["joint-id"],
                        jointTable = formats["joint-table"],
                        jointColumn = formats["joint-column"],
                        jointFK = formats["joint-fk"];
                    if (jointColumn == column.name) jointColumn = undefined;
                    if (jointIdColumn) {
                        var idColumn = spreadsheet.colOf(jointIdColumn);
                        if (idColumn) {
                            jointTable = idColumn.formats["joint-table"];
                        }
                    }
                    if (jointIdColumn || jointTable) {
                        $div.append(Confluence.Templates.PlaySQL.columnPropertiesJoint({
                            jointIdColumn: jointIdColumn,
                            jointTable: jointTable,
                            jointColumn: jointColumn,
                            jointFK: jointFK
                        }));
                    }
                },
                getFormatValues : function($form, column) {
                    var result = {},
                        jointId = $form.find("#column-joint-id").val(),
                        jointColumn = $form.find("#column-joint-column").val(),
                        jointTable = $form.find("#column-joint-table").val(),
                        jointFK = $form.find("#column-joint-fk").val();
                    if (jointId) result["joint-id"] = jointId;
                    if (jointColumn && jointColumn != column.name) result["joint-column"] = jointColumn;
                    if (jointTable) result["joint-table"] = jointTable;
                    if (jointFK) result["joint-fk"] = jointFK;
                    return result;
                }
            };
        };

        window.PlaySQL.Spreadsheet.RendererBase = RendererBase;
        window.PlaySQL.Spreadsheet.rendererBase = new RendererBase();

        var DefaultRenderer = function() {
            var base = window.PlaySQL.Spreadsheet.rendererBase;
            return $.extend({}, base, {
                key: "as-string",
                getI18nName : function() {
                    return "Texte"
                },
                isSupportedType : function(type) {
                    return "VARCHAR" == type || "TEXT" == type;
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                createInputBox : function(value) {
                    return this.createTextareaBox(value);
                }
            });
        };
        api.register(new DefaultRenderer());

        function checkNotNull(value, message) {
            if (value == undefined) {
                throw "Unexpectedly undefined value: " + value + "(" + message + ")";
            }
            if (value instanceof $) {
                if (value.size() == 0)
                    throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
            }
            return value;
        }
    });

})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderers.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {
        var RendererBase = window.PlaySQL.Spreadsheet.RendererBase;

        var MarkdownRenderer = function() {
            var base = new RendererBase();
            return $.extend({}, base, {
                key: "markdown",
                getI18nName : function() {
                    return "Markdown"
                },
                isSupportedType : function(type) {
                    return "VARCHAR" == type || "TEXT" == type;
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                createInputBox : function(value) {
                    return this.createTextareaBox(value);
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value === null || value === undefined) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    return value;
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments);
                    var template = Confluence.Templates.PlaySQL.columnPropertiesMarkdown({});
                    $div.append(template);
                    return result;
                }
            });
        };
        api.register(new MarkdownRenderer());

        /* Parses a user entry
         * @param decimalSeparator ".", "," or null if decimals should be truncated.
         * @return the number or null
         */
        function parseNumber(string, decimalSeparator) {
            if (string == undefined) return string;
            if (/^\s*-?[0-9]*\s*$/.test(string)) return $.trim(string);
            var result = "",
                hasNumberStarted = false,
                hasPeriodBeenMet = false,
                hasCommaBeenMet = false,
            // The Guessed is the last one that appears, and that doesn't appear twice.
                guessedDecimalSeparator = undefined;
            for (var i = 0; i < string.length ; i++) {
                var character = string[i];
                switch (true) {
                    case character == "-" && !hasNumberStarted:
                        result += character;
                        break;
                    case character == ".":
                        if (hasPeriodBeenMet) guessedDecimalSeparator = ",";
                        hasPeriodBeenMet = true;
                        result += character;
                        break;
                    case character == ",":
                        if (hasCommaBeenMet) guessedDecimalSeparator = ".";
                        hasCommaBeenMet = true;
                        result += character;
                        break;
                    case /\d/.test(character):
                        hasNumberStarted = true;
                        result += character;
                        break;
                }
            }
            if (guessedDecimalSeparator == undefined) {
                if (hasPeriodBeenMet && hasCommaBeenMet) {
                    guessedDecimalSeparator = result.indexOf(".") > result.indexOf(",") ? "." : ",";
                } else if (hasPeriodBeenMet ^ hasCommaBeenMet) {
                    guessedDecimalSeparator = hasPeriodBeenMet ? "." : ",";
                }
            }
            if (guessedDecimalSeparator == undefined) {
                return result;
            }
            if (guessedDecimalSeparator == decimalSeparator) {
                return result;
            }
            if (decimalSeparator == undefined) {
                result = result.substr(0, result.indexOf(decimalSeparator));
                result = result.replace(/,\./g, "");
                return result;
            }
            // Remove all thousand separators
            result = guessedDecimalSeparator == "." ? result.replace(/,/g, "") : result.replace(/\./g, "");
            result = result.replace(guessedDecimalSeparator, decimalSeparator);
            return result;
        }

        var NumericRenderer = function() {
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "numeric",
                getI18nName : function() {
                    return "D\u00e9cimal"
                },
                isSupportedType : function(type) {
                    return type == "INTEGER" || type == "BIG_INTEGER" || type == "NUMERIC" || type == "DOUBLE";
                },
                getDefaultType : function() {
                    return "NUMERIC";
                },
                isSystemRenderer : function() {
                    return false;
                },
                onColumnDisplay : function(spreadsheet, column) {
                    spreadsheet.$findColumnCells(column).addClass("numeric-renderer");
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autocompleteFilterNumber(column, term, data);
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    callback();
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    var that = this;
                    return $.extend({}, parent, {
                        validate : function(transformIfFormula) {
                            var $input = $cell.find("input");
                            if ($input.size == 0) return false;
                            var originalVal = $input.val();
                            if ($cell.hasClass("formula") || !$cell.hasClass("anti-formula") && originalVal.charAt(0) == "=") {
                                /* TODO Formula activation/deactivation here */
                                return parent.validate(transformIfFormula);
                            }
                            var newVal = parseNumber(originalVal, spreadsheet.decimalSeparator);
                            if (newVal != originalVal) {
                                $input.val(newVal);
                                $input.attr("title", "Only numbers are accepted").tipsy({delayIn: 0});
                            }
                            return parent.validate(transformIfFormula);
                        }
                    });
                }
            });
        };
        api.register(new NumericRenderer());

        function formatNumber(value, format) {
            function ofMatch(regex, group) {
                var regexMatched = regex.exec(format);
                group = group || 0;
                if (regexMatched != null && regexMatched.length > group) {
                    return regexMatched[group];
                }
                return undefined;
            }
            function pad(str, length, reverse, maxLength) {
                if (maxLength != undefined) str = reverse ? str.substr(0, Math.min(str.length, maxLength)) : str.substr(-Math.min(str.length, maxLength));
                while (str.length < length) {
                    str = reverse ? str + "0" : "0" + str;
                }
                if (length == 0 && str == "0") return "";
                return str;
            }
            var colour = ofMatch(/^([a-z]+);/);
            if (colour != undefined) format = format.substr(format.indexOf(";") + 1);
            var styles = { },
                separatorsRegex = /[0#](.)[0#]/g,
                thousandSeparator = ofMatch(separatorsRegex, 1),
                decimalSeparator = ofMatch(separatorsRegex, 1),
                numbersBeforeDecimal = (decimalSeparator !== undefined ? format.split(decimalSeparator)[0] : format).replace(/[^0]/g, ''),
                numbersAfterDecimal = (decimalSeparator !== undefined ? format.split(decimalSeparator)[1] : "").replace(/[^0#]/g, ''),
                zeroesBeforeDecimal = numbersBeforeDecimal.length,
                zeroesAfterDecimal = numbersAfterDecimal.replace(/[^0]/g, '').length,
                maxAfterDecimal = numbersAfterDecimal.length,
            /*numberStart = Math.min(format.indexOf("0"), format.indexOf("#")),
             numberEnd = Math.min(format.indexOf("0"), format.indexOf("#")),*/
                decimalMultiple = Math.pow(10, maxAfterDecimal),
                integerPart = Math.abs(parseInt(value)).toString(),
                paddedIntegerPart = pad(integerPart, zeroesBeforeDecimal),
                separatedIntegerPart = paddedIntegerPart.replace(/\B(?=(\d{3})+(?!\d))/g, thousandSeparator != "#" ? thousandSeparator : ""),
                decimalPart = (Math.round(parseFloat(value.substr(value.indexOf(".") || value.indexOf(","))) * decimalMultiple)/decimalMultiple).toString().substr(2),
                paddedDecimalPart = pad(decimalPart, zeroesAfterDecimal, true, maxAfterDecimal),
                formattedValue = separatedIntegerPart + (paddedDecimalPart != "" ? decimalSeparator + paddedDecimalPart : "");

            value = format.replace(/[0#].*[0#]/, formattedValue);

            if (colour != null) {
                styles["color"] = colour;
            }

            return {
                value: value,
                styles: styles
            };
        }

        var IntegerRenderer = function() {
            var base = new NumericRenderer();
            return $.extend({}, base, {
                key: "integer",
                getI18nName : function() {
                    return "Entier"
                },
                getDefaultType : function() {
                    return "INTEGER";
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        // We don't need to customize the validate method, since the parent does it already
                    });
                }
            });
        };
        api.register(new IntegerRenderer());

        var CurrencyRenderer = function() {
            var base = new NumericRenderer();
            return $.extend({}, base, {
                key: "currency",
                getI18nName : function() {
                    return "Monnaie"
                },
                isSystemRenderer : function() {
                    return false;
                },
                isSupportedType : function(type) {
                    // TODO: Require an nine-figure license fee for those who use BIG_INTEGER on the Currency render
                    return type == "NUMERIC" || type == "DOUBLE" || type == "INTEGER" || type == "BIG_INTEGER";
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == undefined) return "<span class='not-a-value'>&nbsp;</span>";
                    var flt = parseFloat(value),
                        format;
                    if (isNaN(flt)) return "<span class='not-a-value'>&nbsp;</span>";
                    if (flt == 0) format = column.formats['equalZero'];
                    else if (flt < 0) {
                        format = column.formats['belowZero'];
                    }
                    if (format === undefined || format === "") {
                        format = column.formats['aboveZero'];
                        if (flt < 0 && format.indexOf("-") == -1)
                            format = format.replace(/([#0])/, "-$1");
                    }
                    if (format === undefined || format === "") {
                        format = "$ #,##0.######";
                        if (flt < 0) format = "darkred;$ -#,##0.######";
                    }
                    var formatted = formatNumber(value, format),
                        styles = column.formats && $.parseJSON(column.formats.css) || {},
                        columnErsatz;
                    $.extend(styles, formatted.styles);
                    columnErsatz = { formats : { css : $.toJSON(styles) }};
                    return base.renderCellContents.call(this, formatted.value, spreadsheet, columnErsatz);
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments),
                        aboveZero = column.formats && column.formats["aboveZero"],
                        equalZero = column.formats && column.formats["equalZero"],
                        belowZero = column.formats && column.formats["belowZero"];

                    var template = Confluence.Templates.PlaySQL.columnPropertiesCurrencyField({
                        aboveZero: aboveZero,
                        equalZero: equalZero,
                        belowZero: belowZero
                    });
                    $div.append(template);
                    return result;
                },
                getFormatValues : function($form, column) {
                    return {
                        aboveZero: $form.find("#column-aboveZero").val(),
                        equalZero: $form.find("#column-equalZero").val(),
                        belowZero: $form.find("#column-belowZero").val()
                    };
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        // No need to override validate(), because we inherit from NumericRenderer anyway
                    });
                }
            });
        };
        api.register(new CurrencyRenderer());

        function jointIdClickHandler(e) {
            e.preventDefault();
            var $this = $(this),
                add = $this.hasClass("joint-id-add"),
                remove = $this.hasClass("joint-id-remove"),
                $th = $this.closest(".joint-id-renderer"),
                $placeholder = $th.closest(".playsql-spreadsheet-placeholder");
            if ($th.size() == 0 || $placeholder.size() == 0) return;
            var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder($placeholder);

            if (add) {
                spreadsheet.addJointRow($th);
            } else if (remove) {
                spreadsheet.removeJointRow($th);
            }
        }

        var JointIdRenderer = function(){
            var base = new IntegerRenderer();
            return $.extend({}, base, {
                key: "joint-id",
                getI18nName : function() {
                    return "Joint ID"
                },
                onColumnDisplay : function(spreadsheet, column) {
                    base.onColumnDisplay.call(this, spreadsheet, column);
                    spreadsheet.$findColumnCells(column).addClass("joint-id-renderer");
                    spreadsheet.$placeholder.off("click.joint-table");
                    spreadsheet.$placeholder.on("click.joint-table", ".joint-id-add, .joint-id-remove", jointIdClickHandler);
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (!spreadsheet.perms.hasPerm("Q_VIEW_EDIT")) {
                        if (value == null) return "";
                        return AJS.escapeHtml(value);
                    }
                    if (value === null || value === undefined) {
                        return '<span class="joint-id-value"></span>'
                             + '<a href="#" class="joint-id-add"><span class="aui-icon-small aui-iconfont-add"></span></a>';
                    }
                    value = AJS.escapeHtml("" + value);
                    return '<span class="joint-id-value">' + value + '</span>'
                         + '<a href="#" class="joint-id-remove"><span class="aui-icon-small aui-iconfont-remove"></span></a>';
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        edit: function() {
                            // Add or remove the row
                        },
                        setOriginalValue : function(value) {
                            if (value == null) {
                                $cell.removeAttr("data-value");
                            } else {
                                $cell.attr("data-value", value);
                            }
                            $cell.html(this.parent.renderCellContents(value, spreadsheet));
                        }
                    });
                }
            });
        };
        api.register(new JointIdRenderer());

        var IdRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "id",
                getI18nName : function() {
                    return "Identifiant"
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        edit: function() {
                            // No-op: Don't edit the ID
                        },
                        setOriginalValue : function(value) {
                            if (value === null) value = "";
                            $cell.attr("data-value", value).text(value);
                            $cell.parent().attr("data-row-id", value);
                        }
                    });
                }
            });
        };
        api.register(new IdRenderer());

        var BooleanRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "boolean",
                getI18nName : function() {
                    return "Bool\u00e9en"
                },
                isSupportedType : function(type) {
                    return type == "BOOLEAN";
                },
                getDefaultType : function() {
                    return "BOOLEAN";
                },
                isSystemRenderer : function() {
                    return false;
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){

                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    data.addEntry({
                        label: "TRUE",
                        tip: "constant",
                        sql: "$col = TRUE",
                        replaceColName: "$col"
                    });
                    data.addEntry({
                        label: "FALSE",
                        tip: "constant",
                        sql: "$col = FALSE",
                        replaceColName: "$col"
                    });
                    callback();
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    } else if (value == "true") {
                        return outerHtml($("<span></span>", {
                            "class": "aui-icon aui-icon-small aui-iconfont-success",
                            "text": value,
                            "title": value
                        }));
                    } else if (value == "false") {
                        return outerHtml($("<span></span>", {
                            "class": "aui-icon aui-icon-small aui-iconfont-remove",
                            "text": value,
                            "title": value
                        }));
                    }
                    return AJS.escapeHtml(value);
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        // Nothing to extend
                        focus: function() {
                            if ($cell.hasClass("editing") && !spreadsheet.disableFocusManagement) {
                                window.setTimeout(function() {
                                    var $select = $cell.find("select");
                                    if ($select.size() == 0) return; // Maybe the formulas kicked in
                                    $select.focus().select();
                                }, 0);
                            }
                        },
                        edit: function(setValue) {
                            var setValueByRef = [setValue],
                                    situation = window.PlaySQL.Spreadsheet.rendererBase.checkBeforeEdit(spreadsheet, $cell, setValueByRef);
                                // If the value was changed, use it
                                setValue = setValueByRef[0];
                            switch (situation) {
                                case "no": return;
                                case "formula":
                                    /* TODO Formula activation/deactivation here */
                                    window.PlaySQL.Spreadsheet.FormulaEditor.edit(spreadsheet, $cell, this, setValue);
                                    return;
                                case "ok": break;
                                case "set": break;
                                    setValue = this.parseValue(setValue);
                                    if (typeof setValue != "undefined") {
                                        if (setValue == "true") {
                                            $cell.find("select").val('true');
                                        } else if (setValue == "false") {
                                            $cell.find("select").val('false');
                                        } else {
                                            $cell.find("select").val('');
                                        }
                                    }
                                    return;
                                default:
                                    throw "Not Implemented: situation " + situation;
                            }

                            setValue = this.parseValue(setValue);
                            $cell.addClass("editing");
                            // Keep the old value for cancel
                            $cell.attr('data-rendered', $cell.html());
                            var $input = $("<select>", {
                                html: "<option value=''>No value</option>"
                                + "<option value='true'>True</option>"
                                + "<option value='false'>False</option>"
                            }).val(setValue !== undefined ? setValue : $cell.attr('data-value'));
                            $input.appendTo($cell.empty());

                            var rendererInstance = this;
                            $input.keyup(function(){rendererInstance.validate(true);})
                                .on("blur.playsql-autocommit", function(){
                                    var $this = $(this),
                                        $cell = $this.closest("td");
                                    if (!$cell.hasClass("aui-dropdown2-trigger")) {
                                        rendererInstance.saveAndView();
                                        spreadsheet.sprayRequestPipe();
                                    }
                                });
                        },
                        parseValue: function(value) {
                            if (value == undefined) return value;
                            if ($.trim(value) == '') return '';
                            if (['true', 't', '1', 'yes', 'y'].indexOf(value.toLowerCase()) != -1) {
                                return "true";
                            } else if (['false', 'f', '0', 'no', 'n'].indexOf(value.toLowerCase()) != -1) {
                                return "false";
                            } else {
                                return value;
                            }
                        },
                        saveAndView: function() {
                            if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                            if ($cell.hasClass("formula")) {
                                window.PlaySQL.Spreadsheet.FormulaEditor.saveAndView(spreadsheet, $cell, this);
                                return;
                            }
                            if (!this.validate()) return;
                            if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', spreadsheet.colOf($cell))) return;
                            var $input = checkNotNull($cell.find("select")),
                                val = $input.val(),
                                column = spreadsheet.colOf($cell),
                                rendered = this.parent.renderCellContents(val, spreadsheet, column);
                            $cell.attr('data-value', val);
                            // Keep the value for cancel
                            $cell.attr('data-rendered', rendered);

                            $cell.html(rendered).addClass("saving").removeClass("editing");
                            spreadsheet.saveCell($cell, val);
                            window.PlaySQL.Spreadsheet.FormulaEditor.checkAndSaveFormulaRemoval(spreadsheet, $cell);
                        }
                    });
                }
            });
        };
        api.register(new BooleanRenderer());

        var formatDate = function(date, format) {
            if (!date || !format) return date;
            if (!(date instanceof Date)) {
                // Format is expected to be yyyy-MM-dd, as per JDBC specs
                var dateComponents = date.split("-");
                if (dateComponents.length != 3) return dateComponents;
                date = new Date(parseInt(dateComponents[0]), parseInt(dateComponents[1])-1, parseInt(dateComponents[2]));
            }
            var ddd2 = date.getDay(),
                d = date.getDate(),
                M = date.getMonth() + 1,
                yyyy = date.getFullYear(),
                dd = (d < 10 ? "0" : "") + d,
                MM = (M < 10 ? "0" : "") + M,
                yy2 = yyyy % 100,
                yy = (yy2 < 10 ? "0" : "") + yy2,
                ddd = [ "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"][ddd2],
                dddd = [ "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"][ddd2],
                MMM = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][M-1],
                MMMM = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][M-1],
                result = format;
            // Mundane replacement...
            result = result.replace(/^(([^"]|"[^"]*")*)dddd/, '$1"' + dddd + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)ddd/, '$1"' + ddd + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)dd/, '$1"' + dd + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)d/, '$1"' + d + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)yyyy/, '$1"' + yyyy + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)yy/, '$1"' + yy + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)MMMM/, '$1"' + MMMM + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)MMM/, '$1"' + MMM + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)MM/, '$1"' + MM + '"');
            result = result.replace(/^(([^"]|"[^"]*")*)M/, '$1"' + M + '"');
            result = result.replace(/"/g, '');
            return result;
        }

        window.PlaySQL.Spreadsheet.formatDate = formatDate;

        var DateRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                parent: base,
                key: "date",
                getI18nName : function() {
                    return "Calendrier"
                },
                isSupportedType : function(type) {
                    return type == "DATE";
                },
                getDefaultType : function() {
                    return "DATE";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value && column.formats && column.formats.dateFormat) {
                        value = formatDate(value, column.formats.dateFormat);
                    }
                    return base.renderCellContents.call(this, value, spreadsheet, column);
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterDate(column, term, data);
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    callback();
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        focus: function(withCaret) {
                            if (!spreadsheet.disableFocusManagement && $cell.hasClass("editing")) {
                                var $input = $cell.find("input");
                                if ($input.datePicker) {
                                    // Yay! AUI 5.1's date picker is in!
                                    $(".aui-inline-dialog:has(.ui-datepicker), .aui-datepicker-dialog").remove();
                                }
                                parent.focus(withCaret);
                            }
                        },
                        edit: function(setValue) {
                            var setValueByRef = [setValue],
                                situation = window.PlaySQL.Spreadsheet.rendererBase.checkBeforeEdit(spreadsheet, $cell, setValueByRef);
                            // If the value was changed, use it
                            setValue = setValueByRef[0];

                            switch (situation) {
                                case "no": return;
                                case "formula":
                                    /* TODO Formula activation/deactivation here */
                                    window.PlaySQL.Spreadsheet.FormulaEditor.edit(spreadsheet, $cell, this, setValue);
                                    return;
                                case "ok": break;
                                case "set": break;
                                    setValue = this.parseValue(setValue);
                                    if (typeof setValue != 'undefined') $cell.find("input, textarea").val(setValue);
                                    return;
                                default:
                                    throw "Not Implemented: situation " + situation;
                            }

                            setValue = this.parseValue(setValue);
                            $cell.addClass("editing");
                            // Keep the old value for cancel
                            $cell.attr('data-rendered', $cell.html());
                            var $input = $("<input>", {
                                type: 'date',
                                value: setValue != undefined ? setValue : $cell.attr('data-value'),
                                "class": "aui-date-picker"
                            });
                            $input.appendTo($cell.empty());

                            var rendererInstance = this;
                            $input.datePicker && $input.addClass("save-when-closing-datepicker").datePicker({
                                'overrideBrowserDefault': true,
                                onSelect: function(el, date) {
                                    rendererInstance.saveAndView();
                                    spreadsheet.sprayRequestPipe();
                                }
                            });
                        },
                        validate: function(transformIfFormula) {
                            if ($cell.hasClass("editing")) {
                                var $input = $cell.find("input"),
                                    value = $input.val();
                                if (($cell.hasClass("formula") || !$cell.hasClass("anti-formula")) && value.indexOf("=") == 0) {
                                    /* TODO Formula activation/deactivation here */
                                    return parent.validate(transformIfFormula);
                                }
                                $input.val(this.parseValue(value));
                                var parentValue = parent.validate(transformIfFormula);
                                return parentValue;
                            }
                            return false;
                        },
                        parseValue: function(value) {
                            if (value == undefined) return value;
                            value = $.trim(value);
                            if (value == '') return value;
                            if (/[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}/.test(value)) return value;
                            if (/[0-9]{2}-[0-9]{2}-[0-9]{2}/.test(value)) return value.replace(/([0-9]{2})-([0-9]{2})-([0-9]{2})/, "20$1-$2-$3");
                            if (/[0-9]{4}[^0-9]+[0-9]{1,2}[^0-9]+[0-9]{1,2}/.test(value)) return value.replace(/([0-9]{4})([^0-9]+)([0-9]{1,2})([^0-9]+)([0-9]{1,2})/, "$1-$3-$5");
                            if (/[0-9]{1,2}[^0-9]+[0-9]{1,2}[^0-9]+[0-9]{4}/.test(value)) return value.replace(/([0-9]{1,2})([^0-9]+)([0-9]{1,2})([^0-9]+)([0-9]{4})/, "$5-$3-$1");
                            // Is there... text? In a DATE?
                            var parsed = new Date(value);
                            if (parsed instanceof Date && !isNaN(parsed.getTime())) {
                                // slice(-2) returns the last 2 chars of the string: It's padding with leading 0s.
                                return parsed.getFullYear() + '-' + ("0" + (parsed.getMonth()+1)).slice(-2) + '-' + ("0" + parsed.getDate()).slice(-2);
                            }
                            return '';
                        },
                        saveAndView : function() {
                            if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                            if ($cell.hasClass("formula")) {
                                window.PlaySQL.Spreadsheet.FormulaEditor.saveAndView(spreadsheet, $cell, this);
                                return;
                            }
                            $(".aui-datepicker-dialog").remove();
                            var $input = $cell.find("input");
                            $input.val(this.parseValue($input.val()));
                            var parentValue = parent.saveAndView();
                            return parentValue;
                        }
                    });
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments),
                        dateFormat = column.formats && column.formats["dateFormat"];

                    var template = Confluence.Templates.PlaySQL.columnPropertiesDateFormatField({ dateFormat: dateFormat });
                    $div.append(template);
                    return result;
                },
                getFormatValues : function($form, column) {
                    return {
                        dateFormat: $form.find("#column-dateFormat").val()
                    };
                }
            });
        };
        api.register(new DateRenderer());

        var HeaderRenderer = function() {
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            return $.extend({}, base, {
                key: "header",
                getI18nName : function() {
                    return "Header"
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        view: function() {
                            var column = spreadsheet.colOf($cell);
                            $cell.empty()
                                .text(column.label)
                                .attr("data-name", column.name)
                                .attr("title", column.name)
                                .attr("data-type", column.type)
                                .attr("data-renderer", column.renderer);
                            if (column.statusPK) $cell.attr("data-status-pk", "true");
                            if (column.statusPosition) $cell.attr("data-status-position", "true");

                            $cell.removeClass("editing saving");
                        },
                        edit: function() {
                            if ($cell.hasClass("editing") || $cell.hasClass("saving"))
                                return;
                            if (!spreadsheet.perms.hasPerm('EDIT_COLS_FE')) return;
                            var column = checkNotNull(spreadsheet.colOf($cell), $cell);
                            if (!!column.name) {
                                // We don't rename columns by pressing Enter on them anymore
                                return;
                            }

                            $cell.addClass("editing focused selected");
                            // Remove the magic menu
                            $cell.removeClass("aui-dropdown2-trigger")
                                .removeAttr('aria-controls aria-haspopup aria-owns');

                            $cell.attr('data-rendered', $cell.html());
                            var column = checkNotNull(spreadsheet.colOf($cell), $cell);

                            var $input = $("<input>", {
                                type: 'text',
                                "class": "column-label",
                                value: column.label
                            });
                            $cell.empty().append($input);
                            $input.on("blur.playsql-autocommit", function() {
                                spreadsheet.getCell($cell).renderer.saveAndView();
                                spreadsheet.sprayRequestPipe();
                            });
                        },
                        saveAndView: function() {
                            if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                            if (!spreadsheet.perms.hasPerm('EDIT_COLS_FE')) return;
                            var label = $cell.find("input.column-label").val(),
                                column = spreadsheet.colOf($cell),
                                name = window.PlaySQL.Helpers.generateKey(label, spreadsheet.defaultCase);
                            if (!column.name) {
                                $cell.removeClass("editing invalid").addClass("saving").text(label);
                                var iterate = true;
                                while (iterate == true) {
                                    iterate = false;
                                    for (var i in spreadsheet.columns) {
                                        if (spreadsheet.columns[i].name == name) {
                                            name += "1";
                                            label += "1";
                                            iterate = true;
                                            break;
                                        }
                                    }
                                }
                                spreadsheet.createColumn($cell, {
                                    name: name,
                                    type: "TEXT",
                                    label: label,
                                    renderer: column.renderer,
                                    viewRenderer: column.viewRenderer,
                                    index: column.index
                                });
                            } else {
                                throw "The column shouldn't be editable inline.";
                            }
                        },
                        cancelEdit: function() {
                            var column = spreadsheet.colOf($cell);
                            if (column.name == "") {
                                spreadsheet.deleteColumn($cell);
                            } else {
                                parent.cancelEdit.apply(this, arguments);
                            }
                        }
                    });
                }
            });
        }
        api.register(new HeaderRenderer());

        var StatusRenderer = function() {
            var base = new RendererBase();
            return $.extend({}, base, {
                key: "status",
                getI18nName : function() {
                    return "Ic\u00f4ne"
                },
                isSystemRenderer : function() {
                    return false;
                },
                isSupportedType : function(type) {
                    return type == "VARCHAR" || type == "TEXT";
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                splitMappings : function(serialized) {
                    if (serialized == undefined) {
                        return {};
                    } else {
                        try {
                            var value = $.parseJSON(serialized);
                            if (value) return value;
                            return {};
                        } catch (err) {
                            return {};
                        }
                    }
                },
                autoCompleteFilter: function(spreadsheet, column, term, data, callback){
                    var statusList = column.formats["status"];
                    column.statusMappings = this.splitMappings(statusList);
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterList(column, term, data, Object.keys(column.statusMappings));

                    if (term.length > 0) {
                        window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterString(column, term, data);
                    }
                    window.PlaySQL.Spreadsheet.ColumnToolbar.autoCompleteFilterSQL(column, term, data);
                    callback();
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }

                    if (!column.statusMappings) {
                        var statusList = column.formats["status"];
                        column.statusMappings = this.splitMappings(statusList);
                        for (var status in column.statusMappings) {
                            if (column.statusMappings[status].indexOf("data:image") == 0
                                || column.statusMappings[status].indexOf("/") == 0
                                || column.statusMappings[status].indexOf("://") != -1) {
                                // Use a CSS instead
                                column.statusMappings[status] = addCssClass({
                                    "background-image": "url('" + column.statusMappings[status] + "')"
                                });
                            }
                        }
                    }
                    var data = column.statusMappings[value] || "";
                    if (data) {
                        var $span = $("<span></span>", {
                            "class": "playsql-status-value " + data,
                            "text": value,
                            "title": value
                        });

                        return $("<div></div>", {
                            html: $span
                        }).html();
                    } else {
                        return $("<div></div>", {
                            text: value
                        }).html();
                    }
                },
                createInputBox : function(value) {
                    return this.createTextareaBox(value);
                },
                forCell: function(spreadsheet, $cell) {
                    var parent = base.forCell.apply(this, arguments);
                    return $.extend({}, parent, {
                        /* Nothing to override */
                    });
                },
                appendRendererDetailsTo: function(spreadsheet, $div, column) {
                    var result = base.appendRendererDetailsTo.apply(this, arguments),
                        statusses = column.formats && column.formats["status"];

                    var mappings = this.withDefaultFormatValues(column, this.splitMappings(statusses));
                    var template = Confluence.Templates.PlaySQL.columnPropertiesValueMappingField({ mappings: mappings });
                    $div.append(template);

                    $("#value-mappings .add").click(function(){
                        var template = Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow({ key: "", value: "" });
                        $("#value-mappings tbody").append(template);
                    });
                    $("#value-mappings").on("click", ".remove-mapping", function() {
                        $(this).closest("#value-mappings tr").remove();
                    });

                    return result;
                },
                getFormatValues : function($form, column) {
                    var mappings = {};
                    $form.find("#value-mappings tr").each(function(){
                        var $this = $(this),
                            key = $this.find("input[name='key']").val(),
                            value = $this.find("input[name='value']").val();
                        if (key != undefined && key != "") {
                            mappings[key] = value;
                        }
                    });

                    return { status: $.toJSON(mappings) };
                },
                withDefaultFormatValues : function(column, mappings) {
                    if (Object.keys(mappings).length == 0 && column.renderer != "status" && column.viewRenderer != "status") {
                        // Load values for the demo effect
                        return {
                            "true": "aui-icon aui-icon-small aui-iconfont-success",
                            "false": "aui-icon aui-icon-small aui-iconfont-remove",
                            "ok": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAASFBMVEX///8UiSwUiSwUiSwUiSwUiSwUiSz///8UiSxksXQjkDmn07Cj0a2DwZB+vox7vYlstXv2+/f0+fVAn1Tw9/Le7uHX6trS6NawFlV2AAAAB3RSTlMAEWaqu8zuQLwGJgAAAGZJREFUeF5tj0cSxCAMBDFpBue4+/+fGgGlA+W+TauUjGAdM86ayhDYCEPJkUoUI3Ul5H4N40jSGs/G9VtJelNqkk884otYJu7AnyoOTMBMFZwBbKzUoelOLfu2VrH9YV+n98/177+rqQbbMcOFQgAAAABJRU5ErkJggg=="
                        }
                    }
                    return mappings;
                }
            });
        };
        api.register(new StatusRenderer());


        function checkNotNull(value, message) {
            if (value == undefined) {
                throw "Unexpectedly undefined value: " + value + "(" + message + ")";
            }
            if (value instanceof $) {
                if (value.size() == 0)
                    throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
            }
            return value;
        }

        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }
    });

    var dynamicCss = document.createElement('style'),
        dynamicCssCount = 0;
    dynamicCss.type = 'text/css';
    //dynamicCss.innerHTML = '.cssClass { color: #F00; }';
    document.getElementsByTagName('head')[0].appendChild(dynamicCss);

    function addCssClass(contents) {
        var html = dynamicCss.innerHTML,
            name = "dynamicRule" + (++dynamicCssCount),
            rules = "",
            content;
        for (var key in contents) {
            content = contents[key];
            reducedQuotes = content.replace(/'[^'\\]*'/g, '').replace(/'[^"\\]*"/g, '')
            if (reducedQuotes.indexOf("'") != -1
                || reducedQuotes.indexOf('"') != -1
                || reducedQuotes.indexOf(";") != -1
                || reducedQuotes.indexOf("\\") != -1
            ) {
                AJS.logError("Illegal css string: " + content);
                continue;
            }
            if (!(/^[-a-zA-Z0-9 .]*$/.test(key))) {
                AJS.logError("Illegal css key: " + key);
            }
            rules += "\n    $key : $value ;".replace("$key", key).replace("$value", content);
        }

        var newRule = "\n.$name { $rules }".replace("$name", name).replace("$rules", rules);
        html += newRule;
        dynamicCss.innerHTML = html;

        AJS.log("Dynamic css: ", dynamicCss.innerHTML);
        return name;
    }
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderers-links.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {

        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }

        var LinkRenderer = function(){
            var base = new window.PlaySQL.Spreadsheet.RendererBase();
            window.PlaySQL.Spreadsheet.Applinks = {
                latch: 0,
                projects: {}
            };

            function getJIRAProject(name) {
                var projectKey = name && name.split("-")[0];
                if (!window.PlaySQL.Spreadsheet.Applinks.projects[projectKey] || window.PlaySQL.Spreadsheet.Applinks.projects[projectKey].status == 'UNKNOWN') {
                    window.PlaySQL.Spreadsheet.Applinks.projects[projectKey] = { status: "SEARCHING" };

                    var url = PlaySQL.SPI.baseUrlOld("jiralinks", {issue: projectKey});
                    $.ajax({
                        url: url,
                        type: 'GET',
                        contentType: "application/json; charset=utf-8"
                    }).done(function (data, status, request) {
                        window.PlaySQL.Spreadsheet.Applinks.projects[projectKey] = {
                            status: "FOUND",
                            baseUrl: data.substr(0, data.length - projectKey.length - 1)
                        };
                        ajaxDone();
                    }).fail(function (jqXHR, error, reason) {
                        window.PlaySQL.Spreadsheet.Applinks.projects[projectKey] = { status: "UNKNOWN" };
                        AJS.log("Can't find JIRA project for " + projectKey);
                    });
                }
                return window.PlaySQL.Spreadsheet.Applinks.projects[projectKey];
            }

            function ajaxDone() {
                var $toRender = $("a.jira-issue-to-render");
                $toRender.each(function(){
                    var $this = $(this),
                        key = $this.attr('data-jira-key'),
                        project = getJIRAProject(key);
                    if (project.status == "FOUND") {
                        $this.attr('href', project.baseUrl + key).removeClass("jira-issue-to-render");
                    }
                });
            }

            function render(value) {
                if (/^[A-Z-]+[0-9]+$/.test(value)) {
                    var project = getJIRAProject(value);

                    if (project.status == "FOUND") {
                        return outerHtml($("<a></a>", {
                            href: project.baseUrl + value,
                            "data-jira-key": value,
                            text: value
                        }));
                    }
                    return outerHtml($("<a></a>", {
                        href: undefined,
                        "data-jira-key": value,
                        "class": "jira-issue-to-render",
                        text: value
                    }));
                }
                return AJS.escapeHTML(value);
            }

            return $.extend({}, base, {
                key: "link",
                getI18nName : function() {
                    return "Lien"
                },
                isSupportedType : function(type) {
                    return type == "VARCHAR" || type == "TEXT";
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    // URL is at the beginning
                    if (value.indexOf(":") != -1 || value.indexOf("@") != -1) {
                        var protocolIndexOf = value.indexOf(":"),
                            spaceIndexOf = value.indexOf(" "),
                            linkText = value,
                            linkHref = value;
                        if (spaceIndexOf != -1) {
                            if (spaceIndexOf > protocolIndexOf) {
                                linkText = value.substring(spaceIndexOf + 1);
                                linkHref = value.substring(0, spaceIndexOf);
                            } else {
                                // Link in the middle of a text
                                value = AJS.escapeHtml(value);
                                var values = value.split(" ");
                                for (var i in values) {
                                    var valueI = values[i];
                                    if (/^[a-z][a-z0-9+.-]+:[^ ]/i.test(valueI)) {
                                        values[i] = "<a href='" + valueI + "'>" + valueI + "</a>";
                                    } else if (valueI.indexOf("@") != -1) {
                                        values[i] = "<a href='mailto:" + valueI + "'>" + valueI + "</a>";
                                    }
                                }
                                return values.join(" ");
                            }
                        }
                        return outerHtml($("<a></a>", {
                            href: linkHref.indexOf("@") != -1 && linkHref.indexOf("mailto:") == -1 ? "mailto:" + linkHref : linkHref,
                            text: linkText
                        })).replace(/\n/g, "<br>\n");
                    }
                    var jiraIssue = /^[A-Z]+-[0-9]+$/
                    if (jiraIssue.test(value)) {
                        return render(value);
                    }
                    return AJS.escapeHtml(value).replace(/\n/g, "<br>\n");
                },
                createInputBox : function(value) {
                    return this.createTextareaBox(value);
                },
                forCell: function(spreadsheet, $cell) {
                    var result = base.forCell.apply(this, arguments);
                    return $.extend(result, {
                        // Nothing to extend here
                    });
                }
            });
        };
        api.register(new LinkRenderer());

        function checkNotNull(value, message) {
            if (value == undefined) {
                throw "Unexpectedly undefined value: " + value + "(" + message + ")";
            }
            if (value instanceof $) {
                if (value.size() == 0)
                    throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
            }
            return value;
        }
    });
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-renderers-entities.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {

        function outerHtml($value) {
            return $(document.createElement("div")).html($value).html();
        }

        var PageRenderer = function(){
            var parent = new window.PlaySQL.Spreadsheet.RendererBase();

            return $.extend({}, parent, {
                key: "confluencecontent",
                getI18nName : function() {
                    return "S\u00e9lection de page"
                },
                isSupportedType : function(type) {
                    return type == "VARCHAR" || type == "TEXT";
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    var parts = value.split(";");
                    if (parts.length >= 3) {
                        var contentId = parts[0],
                            spaceKey = parts[1],
                            title = parts.slice(2).join(";");
                        var href = PlaySQL.SPI.contextPath + "/pages/viewpage.action?pageId=" + AJS.escapeHtml(contentId),
                            $link = $("<a>", {
                                href : href,
                                text: title
                            });
                        return outerHtml($link);
                    } else {
                        return AJS.escapeHtml(value).replace(/\n/g, "<br>\n");
                    }
                },
                createInputBox : function(value) {
                    // The value we display to the user should be user-friendly. It's when the autocomplete is triggered
                    // that the correct value is inserted.
                    var parts = !!value && value.split(";");
                    if (parts && parts.length > 2 && !!parts[2]) {
                        value = parts[2];
                    }
                    var $input = parent.createInputBox(value);
                    // https://developer.atlassian.com/display/CONFDEV/JavaScript+Components
                    $input.addClass("autocomplete-confluence-content").attr("data-template", "{id};{space.key};{title}");
                    window.setTimeout(function(){
                        $input.closest("td").addClass("no-autocommit pagepicker no-move");
                        AJS.Confluence.Binder.autocompleteConfluenceContent($input.parent());
                        $input.on("selected.autocomplete-content", function() {
                            $input.parent().removeClass("no-autocommit");
                        });
                    }, 0);
                    return $input;
                },
                forCell: function(spreadsheet, $cell) {
                    var result = parent.forCell.apply(this, arguments);
                    return $.extend(result, {
                        saveAndView: function() {
                            if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                            if (!this.validate()) {
                                return;
                            }
                            var rowId = $cell.closest("tr").attr("data-row-id");
                            if (rowId == undefined || rowId == "") {
                                return;
                            }
                            var column = spreadsheet.colOf($cell);
                            var $input = $cell.find("input, textarea"),
                                val = $input.val();
                            if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', column)) return;
                            if ($cell.hasClass("formula") || !$cell.hasClass("anti-formula") && val.charAt(0) == "=") {
                                /* TODO Formula activation/deactivation here */
                                window.PlaySQL.Spreadsheet.FormulaEditor.saveAndView(spreadsheet, $cell, this);
                                return;
                            }
                            var previousValue = $cell.attr('data-value');
                            if (val == '') {
                                val = null;
                            }
                            // If the user didn't change the cell text, then there's only the title by default.
                            // The BE format (=previousValue) contains: "{pageId};page;{title}", therefore
                            // we must compare val to the third part.
                            if (previousValue == val || previousValue.split(";")[2] == val) {
                                $cell.html($cell.attr('data-rendered')).removeClass('editing');
                                return;
                            }
                            var rendered = this.parent.renderCellContents(val, spreadsheet, column);

                            $cell.attr('data-value', val);
                            // Keep the value for cancel
                            $cell.attr('data-rendered', rendered);

                            $cell.html(rendered).addClass("saving").removeClass("editing");
                            spreadsheet.saveCell($cell, val);
                            window.PlaySQL.Spreadsheet.FormulaEditor.checkAndSaveFormulaRemoval(spreadsheet, $cell);
                        }
                    });
                }
            });
        };
        api.register(new PageRenderer());


        var UserRenderer = function(){
            var parent = new window.PlaySQL.Spreadsheet.RendererBase();

            return $.extend({}, parent, {
                key: "confluenceuser",
                getI18nName : function() {
                    return "S\u00e9lection dutilisateurs"
                },
                isSupportedType : function(type) {
                    return type == "VARCHAR" || type == "TEXT";
                },
                getDefaultType : function() {
                    return "TEXT";
                },
                isSystemRenderer : function() {
                    return false;
                },
                renderCellContents: function(value, spreadsheet, column) {
                    if (value == null) {
                        return "<span class='not-a-value'>&nbsp;</span>";
                    }
                    var parts = value.split(";");
                    if (parts.length >= 4) {
                        var username = parts[0],
                            type = parts[1],
                            id = parts[2],
                            title = parts.slice(3).join(";");
                        var href = PlaySQL.SPI.contextPath + "/display/~" + AJS.escapeHtml(username),
                            $link = $("<a>", {
                                href : href,
                                text: title,
                                "class": "confluence-userlink user-mention", // userlink-0
                                "data-linked-resource-id": id,
                                "data-linked-resource-type": "user",
                                "data-username": username,
                                "data-base-url": AJS.Meta.get("base-url")
                            });
                        window.setTimeout(function(){
                            // to ensure user hover over user links work
                            Confluence.Binder.userHover();
                        }, 0);
                        return outerHtml($link);
                    } else {
                        return AJS.escapeHtml(value).replace(/\n/g, "<br>\n");
                    }
                },
                createInputBox : function(value) {
                    // The value we display to the user should be user-friendly. If it's saved,
                    // the back-end will rebuild the value with the user key and full name.
                    if (!!value) {
                        value = value.split(";")[0];
                    }
                    var $input = parent.createInputBox(value);
                    // https://developer.atlassian.com/display/CONFDEV/JavaScript+Components
                    // Note: It looks like the data-template attribute doesn't work.
                    $input.addClass("autocomplete-user").attr("data-template", "{username}");
                    window.setTimeout(function(){
                        $input.closest("td").addClass("no-autocommit userpicker no-move");
                        if (AJS.Confluence.Binder.autocompleteUserOrGroup) {
                            // The method searches in the whole page. We give a scope in the first argument.
                            AJS.Confluence.Binder.autocompleteUserOrGroup($input.parent());
                        } else if (AJS.Confluence.Binder.autocompleteUserOrGroup) {
                            AJS.Confluence.Binder.autocompleteUser($input.parent());
                        }
                        $input.on("selected.autocomplete-user", function() {
                            $input.parent().removeClass("no-autocommit");
                        });
                    }, 0);
                    return $input;
                },
                forCell: function(spreadsheet, $cell) {
                    var result = parent.forCell.apply(this, arguments);
                    return $.extend(result, {
                        saveAndView: function() {
                            if (!$cell.hasClass("editing") || $cell.hasClass("saving")) return;
                            if (!this.validate()) {
                                return;
                            }
                            var rowId = $cell.closest("tr").attr("data-row-id");
                            if (rowId == undefined || rowId == "") {
                                return;
                            }
                            var column = spreadsheet.colOf($cell);
                            var $input = $cell.find("input, textarea"),
                                val = $input.val();
                            if (!spreadsheet.perms.hasPerm('EDIT_CELLS') && !spreadsheet.perms.hasPerm('Q_VIEW_EDIT', column)) return;
                            if ($cell.hasClass("formula") || !$cell.hasClass("anti-formula") && val.charAt(0) == "=") {
                                /* TODO Formula activation/deactivation here */
                                window.PlaySQL.Spreadsheet.FormulaEditor.saveAndView(spreadsheet, $cell, this);
                                return;
                            }

                            var previousValue = $cell.attr('data-value');
                            if (val == '') {
                                val = null;
                            }
                            if (previousValue == val || previousValue.split(";")[0] == val) {
                                $cell.html($cell.attr('data-rendered')).removeClass('editing');
                                return;
                            }
                            var rendered = this.parent.renderCellContents(val, spreadsheet, column);

                            $cell.attr('data-value', val);
                            // Keep the value for cancel
                            $cell.attr('data-rendered', rendered);

                            $cell.html(rendered).addClass("saving").removeClass("editing");
                            spreadsheet.saveCell($cell, val);
                            window.PlaySQL.Spreadsheet.FormulaEditor.checkAndSaveFormulaRemoval(spreadsheet, $cell);
                        }
                    });
                }
            });
        };
        api.register(new UserRenderer());

        function checkNotNull(value, message) {
            if (value == undefined) {
                throw "Unexpectedly undefined value: " + value + "(" + message + ")";
            }
            if (value instanceof $) {
                if (value.size() == 0)
                    throw "Unexpectedly empty jquery element: " + value + "(" + message + ")";
            }
            return value;
        }
    });
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-column-properties.js' */
(function($){
    AJS.bind("playsql-spreadsheet-init", function(event, api) {

        window.PlaySQL.Spreadsheet.ColumnToolbar = {
            autoCompleteFilterSQL: function(column, term, data){
                // SQL?
                if (/[a-z =<>]/.test(term)) {
                    if (/(AND|OR|\(|\))/g.test(term.toUpperCase())) {
                        data.addEntry({
                            label: term.toUpperCase(),
                            tip: "keyword",
                            type: "strict",
                            sql: " " + term.toUpperCase() + " "
                        });
                    } else if (/^(IS\s*|IS\s+NULL|NULL)$/.test(term.toUpperCase())) {
                        data.addEntry({
                            label: "IS NULL",
                            tip: "keyword",
                            sql: "$col IS NULL",
                            replaceColName: "$col"
                        });
                    } else {
                        // And always display the raw user's entry
                        if (/\$col\b/.test(term)) {
                            data.addEntry({
                                label: AJS.escapeHtml(term.replace(/\$col\b/g, column.name)),
                                tip: "sql",
                                sql: term,
                                replaceColName: "$col"
                            });
                        }
                        if (term.indexOf("=") == 0) {
                            if ($.trim(term) != "=") {
                                data.addEntry({
                                    label: AJS.escapeHtml("$col " + term),
                                    tip: "sql",
                                    sql: "$col " + term,
                                    replaceColName: "$col"
                                });
                            }
                        } else {
                            /* Don't suggest a sql literal. Rather improve the filter.
                             data.addEntry({
                             label: AJS.escapeHtml(term),
                             tip: "sql literal",
                             sql: term
                             });*/
                        }
                    }
                } else if (term.length == 0) {
                    data.addEntry({
                        label: "AND",
                        tip: "keyword",
                        type: "strict",
                        sql: " AND "
                    });
                    data.addEntry({
                        label: "OR",
                        tip: "keyword",
                        type: "strict",
                        sql: " OR "
                    });
                }
            },
            autocompleteFilterNumber: function(column, term, data){
                var charAt0 = /^[=<>]/.test(term) && term.charAt(0),
                    potentialNumber = charAt0 && term.substr(1) || term,
                    number = /[.,][0-9]/.test(potentialNumber) ? parseFloat(potentialNumber) : parseInt(potentialNumber);
                if (/[ -.]*[0-9].*-.*/.test(term)) { // Two numbers?
                    // Dodge the first minus, in the case of "-3.14--3.13"
                    var position = term.indexOf("-", 1),
                        exprA = term.substr(0, position),
                        exprB = term.substr(position + 1),
                        numberA = /[.,][0-9]/.test(exprA) ? parseFloat(exprA) : parseInt(exprA),
                        numberB = /[.,][0-9]/.test(exprB) ? parseFloat(exprB) : parseInt(exprB);
                    if (!isNaN(numberA)) {
                        if (isNaN(numberB)) {
                            numberB = numberA + 1;
                        }
                        data.addEntry({
                            label: numberA + "&ndash;" + numberB,
                            sql: "$col BETWEEN ? AND ?",
                            tip: "between",
                            replaceColName: "$col",
                            arguments: [numberA, numberB]
                        });
                    }
                } else if (!isNaN(number)) { // One number?
                    if (!charAt0 || charAt0 == "=")
                        data.addEntry({
                            label: "= " + number,
                            sql: "$col = ?",
                            tip: "equals",
                            replaceColName: "$col",
                            arguments: [number]
                        });

                    if (!charAt0 || charAt0 == ">")
                        data.addEntry({
                            label: "&gt; " + number,
                            sql: "$col > ?",
                            tip: "min",
                            replaceColName: "$col",
                            arguments: [number]
                        });

                    if (!charAt0 || charAt0 == "<")
                        data.addEntry({
                            label: "&lt; " + number,
                            sql: "$col < ?",
                            tip: "max",
                            replaceColName: "$col",
                            arguments: [number]
                        });
                    data.addEntry({
                        label: number + "" + (number+1), // endash:  emdash: 
                        sql: "$col BETWEEN ? AND ?",
                        tip: "between",
                        replaceColName: "$col",
                        arguments: [number, number+1]
                    });
                } else {
                    if (!term || charAt0 == "=")
                        data.addEntry({
                            label: "= 10",
                            sql: "$col = 10",
                            tip: "equals"
                        });
                    if (!term || charAt0 == "<")
                        data.addEntry({
                            label: "< 10",
                            sql: "$col < 10",
                            replaceColName: "$col",
                            tip: "max"
                        });
                    if (!term || charAt0 == ">")
                        data.addEntry({
                            label: "> 10",
                            sql: "$col > 10",
                            replaceColName: "$col",
                            tip: "min"
                        });
                    if (!term)
                        data.addEntry({
                            label: "10&ndash;20",
                            sql: "$col between 10 and 20",
                            replaceColName: "$col",
                            tip: "range"
                        });
                }
            },
            autoCompleteFilterString: function(column, term, data){
                if ($.trim(term).length > 0) {
                    data.addEntry({
                        label: "= " + AJS.escapeHtml(term),
                        tip: "equals",
                        sql: "UPPER($col) = UPPER(?)",
                        replaceColName: "$col",
                        arguments: [term]
                    });
                    if (term.indexOf("%") != -1) {
                        data.addEntry({
                            label: "LIKE '" + AJS.escapeHtml(term) + "'",
                            sql: "$col LIKE ?",
                            tip: "sql",
                            replaceColName: "$col",
                            arguments: [term]
                        });
                    } else {
                        if (window.PlaySQL && window.PlaySQL.spreadsheet && window.PlaySQL.spreadsheet.dialect && PlaySQL.spreadsheet.dialect.indexOf("MySQL") != -1) {
                            // MySQL is a long story
                            data.addEntry({
                                label: "%" + AJS.escapeHtml(term) + "%",
                                tip: "contains",
                                sql: "$col LIKE CONCAT('%', ?, '%')",
                                replaceColName: "$col",
                                arguments: [term]
                            });
                        } else {
                            // General, normal, sane, non-crazytamreputain case
                            data.addEntry({
                                label: "%" + AJS.escapeHtml(term) + "%",
                                tip: "contains",
                                sql: "$col LIKE ('%' || ? || '%')",
                                replaceColName: "$col",
                                arguments: [term]
                            });
                        }
                    }
                }
            },
            autoCompleteFilterDate: function(column, term, data){
                var spreadsheet = window.PlaySQL.Spreadsheet.byPlaceholder(column.$placeholder);
                if (spreadsheet.dialect != 'com.playsql.jdbc.dialect.PostgreSQLDDLDialect') {
                    data.addEntry({
                        label: "Dates are only supported for Postgres",
                        tip: "information",
                        sql: "",
                        type: "strict"
                    });
                    return;
                }
                var operator = /^[<>=]/.test(term) && term.charAt(0),
                    potentialValue = operator && term.substr(1) || term,
                    date, yyyymmdd;

                if ($.trim(potentialValue).length > 0) {
                    date = new Date(potentialValue);
                    if (!date || isNaN(date.getTime())) {
                        date = new Date();
                    }
                } else {
                    date = new Date();
                }
                var yyyy = date.getFullYear().toString();
                var mm = (date.getMonth()+1).toString();
                var dd  = date.getDate().toString();
                yyyymmdd = yyyy + "-" + (mm[1]?mm:"0"+mm[0]) + "-" + (dd[1]?dd:"0"+dd[0]);
                if (!operator || operator == "<")
                    data.addEntry({
                        label: "< " + date.toDateString(),
                        tip: "max",
                        sql: "$col <= ?",
                        replaceColName: "$col",
                        arguments: [yyyymmdd]
                    });
                if (!operator || operator == ">")
                    data.addEntry({
                        label: "> " + date.toDateString(),
                        tip: "min",
                        sql: "$col >= ?",
                        replaceColName: "$col",
                        arguments: [yyyymmdd]
                    });
                if (!operator || operator == "=")
                    data.addEntry({
                        label: "= " + date.toDateString(),
                        tip: "equals",
                        sql: "$col = ?",
                        replaceColName: "$col",
                        arguments: [yyyymmdd]
                    });
            },
            autoCompleteFilterList: function(column, term, data, list){
                for (var i in list) {
                    var word = list[i];
                    if (word.indexOf(term) != -1) {
                        data.addEntry({
                            label: AJS.escapeHtml(word),
                            tip: "value",
                            sql: "$col = ?",
                            replaceColName: "$col",
                            arguments: [word]
                        });
                    }
                }
            },
            buildWhereClause : function (whereClause, whereClauseColumnFilters, dialect) {
                var whereClause2 = "";
                if (whereClauseColumnFilters) {
                    function quoteColumnName(dialect, columnName) {
                        if (!!columnName) {
                            if (!!dialect && dialect.indexOf("MySQL") != -1) {
                                return '`' + columnName + '`';
                            } else {
                                // Assuming Postgres behaviour
                                return '"' + columnName + '"';
                            }

                        }
                        return columnName;
                    }
                    for(var columnName in whereClauseColumnFilters) {
                        var filters = whereClauseColumnFilters[columnName],
                            quotedColumnName = quoteColumnName(dialect, columnName),
                            columnSQL = "",
                        // if strict, the next operand won't try to insert a conjunction like OR/AND
                            strict = true,
                            multiple = false;
                        if (filters) {
                            if (filters.length > 1) multiple = true;
                            for (var i in filters) {
                                var detail = filters[i],
                                    sql = detail.sql;
                                if (detail.arguments) {
                                    for(var j in detail.arguments) {
                                        var value = detail.arguments[j];
                                        if (typeof value != "number") {
                                            value = "'" + window.PlaySQL.Helpers.escapeSqlString(value) + "'";
                                        }
                                        sql = sql.replace("?", value);
                                    }
                                }
                                if (detail.replaceColName) {
                                    sql = sql.replace(/\$col\b/g, quotedColumnName);
                                }
                                if (!strict && detail.type != "strict") {
                                    columnSQL += " OR ";
                                }
                                columnSQL += sql;
                                strict = detail.type == "strict";
                            }
                        }
                        // If there's at least one condition, append it to the whereClause2 with AND
                        if (columnSQL != "") {
                            if (multiple) {
                                whereClause2 += " AND (" + columnSQL + ")";
                            } else {
                                whereClause2 += " AND " + columnSQL;
                            }
                        }
                    }
                }
                if (whereClause && whereClause2.indexOf(" AND ") == 0) {
                    return "(" + whereClause + ")" + whereClause2;
                } else if (whereClause) {
                    return whereClause;
                } else {
                    return whereClause2.substr(4);
                }
            },
            create: function (spreadsheet, column, $header) {
                // Check if there's already an inline dialog for this column
                if (spreadsheet.inlinedialog) {
                    if (spreadsheet.inlinedialog.column == column) {
                        return spreadsheet.inlinedialog;
                    }
                }

                var orderbyClause = window.PlaySQL.Helpers.parseOrderByClause(spreadsheet.orderbyClause),
                    orderbyDef = {},
                    renderer = window.PlaySQL.Spreadsheet.renderers[column.renderer],
                    viewRenderer = window.PlaySQL.Spreadsheet.renderers[column.viewRenderer || column.renderer];

                for (var i in orderbyClause) {
                    if (orderbyClause[i].field == '"' + column.name + '"') {
                        orderbyDef = orderbyClause[i];
                        break;
                    }
                }
                column.rendererName = renderer ? renderer.getI18nName() : "?";
                column.viewRendererName = viewRenderer ? viewRenderer.getI18nName() : "?";

                var inlinedialog = AJS.InlineDialog($header, "col-properties",
                    function ($content, trigger, showPopup) {
                        $content.closest("#inline-dialog-col-properties").addClass("small-inline");
                        $content.css("width", "");
                        $content.html(Confluence.Templates.PlaySQL.columnPropertiesInlineDialog({
                            column: column,
                            orderbyDef: orderbyDef,
                            hasColFEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_FE'),
                            hasColBEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_BE')
                        }));
                        showPopup();
                        $content.find(".sort-none, .sort-desc, .sort-asc").click(function (e) {
                            e.preventDefault();
                            var $this = $(this),
                                way = $this.hasClass("sort-desc") ? "DESC"
                                    : $this.hasClass("sort-asc") ? "ASC"
                                    : "NO-SORTING",
                                nulls = orderbyDef.nulls;
                            spreadsheet.sortCol($header, way, nulls);
                            spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                            return false;
                        });
                        $content.find(".nulls-default, .nulls-first, .nulls-last").click(function (e) {
                            e.preventDefault();
                            var $this = $(this),
                                way = orderbyDef.way,
                                nulls = $this.hasClass("nulls-default") ? undefined
                                    : $this.hasClass("nulls-first") ? "FIRST"
                                    : "LAST";
                            spreadsheet.sortCol($header, way, nulls);
                            spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                            return false;
                        });
                        $content.on("click", ".btn-properties", function (e) {
                            e.preventDefault();
                            window.PlaySQL.Spreadsheet.ColumnToolbar.displayProperties(spreadsheet, column, inlinedialog);
                        });/*
                         $content.on("click", ".btn-properties1", function (e) {
                         e.preventDefault();
                         spreadsheet.inlinedialog.close();
                         displayColProps(spreadsheet, $header);
                         });*/

                        var allFilterAutocompleteData = [],
                            initialValue = [];
                        // Initialize with the spreadsheet's values
                        if (spreadsheet.whereClauseColumnFilters && spreadsheet.whereClauseColumnFilters[column.name]) {
                            var filters = spreadsheet.whereClauseColumnFilters[column.name];
                            for(var i in filters) {
                                var filter = filters[i];
                                allFilterAutocompleteData.push(filter);
                                initialValue.push(i);
                            }
                        }

                        function formatResult(state) {
                            if (!state.id) return state.text; // optgroup
                            var complement = allFilterAutocompleteData[state.id].tip;
                            if (complement) {
                                return allFilterAutocompleteData[state.id].label + '<span class="playsql-filter-tip">' + complement + '</span>';
                            } else {
                                return allFilterAutocompleteData[state.id].label;
                            }
                        }

                        function formatSelection(state) {
                            if (!state.id) return state.text; // optgroup
                            return allFilterAutocompleteData[state.id].label;
                        }

                        $content.find("#playsql-inline-filter5").auiSelect2({
                            multiple: true,
                            placeholder: "Filter",
                            formatResult: formatResult,
                            formatSelection: formatSelection,
                            escapeMarkup: function (m) {
                                return m;
                            },
                            formatNoMatches: function(term) {
                                return "Enter a filter"
                            },
                            query: function (query) {
                                var term = query.term,
                                    data = {
                                        results: [],
                                        addEntry: function (json) {
                                            allFilterAutocompleteData.push(json);
                                            this.results.push({id: allFilterAutocompleteData.length - 1, text: json.label});
                                            AJS.log("Added entry: ", allFilterAutocompleteData[allFilterAutocompleteData.length - 1]);
                                        }
                                    };
                                if (viewRenderer && viewRenderer.autoCompleteFilter) {
                                    viewRenderer && viewRenderer.autoCompleteFilter(spreadsheet, column, term, data, function () {
                                        query.callback(data);
                                    });
                                } else {
                                    data.addEntry({
                                        label: "No filter available for " + column.viewRendererName,
                                        sql: undefined
                                    });
                                }

                                query.callback(data);
                            },
                            initSelection: function($element, callback){
                                var data = [];
                                $($element.val().split(",")).each(function(){
                                    if (this != "" && typeof this != "undefined") {
                                        data.push({id: this, text: "-loading #" + this});
                                    }
                                });
                                if (data.length > 0) {
                                    $element.parent().addClass("hovered");
                                }
                                callback(data);
                            }
                        }).auiSelect2("val", initialValue)
                            .on("change", function(){
                                var values = $content.find("#playsql-inline-filter5").auiSelect2("val").map(function(id){
                                    return allFilterAutocompleteData[id];
                                });
                                $("#inline-dialog-col-properties .error").remove();
                                spreadsheet.whereClauseColumnFilters = spreadsheet.whereClauseColumnFilters || {};
                                var initialFilter = spreadsheet.whereClauseColumnFilters[column.name];
                                spreadsheet.whereClauseColumnFilters[column.name] = values;
                                spreadsheet.load(undefined, {failureCallback: function(jqXHR){
                                    if (Math.round(jqXHR.status/100) * 100 == 400) {
                                        try {
                                            // If the BAD_REQUEST is specially formatted by Play SQL
                                            var data = $.parseJSON(jqXHR.responseText);
                                            var message;
                                            if (data.type == "SQL_SYNTAX") {
                                                message = data.message || "Error";// + "\n" + data.sql;
                                            } else {
                                                message = data.message || "Error";
                                            }
                                            $("#inline-dialog-col-properties .aui-buttons").last().after("<br><span class=\"error\"></span><br>&nbsp;");
                                            $("#inline-dialog-col-properties .error").text(message);
                                            return false;
                                        } catch (err) {
                                            // Swallow and proceed to the next section
                                            AJS.log(err);
                                        }
                                    }
                                }});
                            });


                        $content.find(".filter-input5").mouseenter(function () {
                            $(this).parent().addClass("hovered");
                            /*$content.find(".inline-filter5-on-hover-display").removeClass("hidden");
                             // Allow for the time for the fade-in effect
                             window.setTimeout(function(){$content.find(".inline-filter5-on-hover-display").addClass("hovered");}, 0);*/
                        });
                        $content.find("#apply-inline-filter").click(function(e){
                            e.preventDefault();
                            var values = $content.find("#playsql-inline-filter5").auiSelect2("val").map(function(id){
                                return allFilterAutocompleteData[id];
                            });
                            spreadsheet.whereClauseColumnFilters = spreadsheet.whereClauseColumnFilters || {};
                            spreadsheet.whereClauseColumnFilters[column.name] = values;
                            spreadsheet.inlinedialog.close();
                            spreadsheet.load();
                        });
                        $content.on("click", ".btn-cancel", function (e) {
                            e.preventDefault();
                            spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                        });
                        var $formulaField = $content.find(".column-formula");
                        $formulaField.blur(function () {
                            window.setTimeout(function () {
                                $formulaField.removeClass("aui-dropdown2-trigger")
                                    .removeAttr('aria-controls aria-haspopup aria-owns');
                            }, 100);
                        }).keyup(function (e) {
                            window.setTimeout(function () {
                                if ($formulaField.val() == "=") {
                                    if (!$formulaField.attr("aria-owns")) {
                                        $formulaField
                                            .attr('aria-owns', 'dropdown-wizards')
                                            .attr('aria-haspopup', 'true')
                                            .addClass('aui-dropdown2-trigger')
                                            .trigger("aui-button-invoke");
                                    }
                                } else {
                                    if ($("#dropdown-wizards:visible").length > 0) {
                                        $formulaField.trigger("aui-button-invoke");
                                    }
                                    $formulaField
                                        .attr('aria-owns', '')
                                        .attr('aria-haspopup', '')
                                        .removeClass('aui-dropdown2-trigger');
                                }
                            }, 0);
                        });

                        return false;
                    }, {
                        noBind: true,
                        persistent: true,
                        hideCallback: function () {
                            spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                        },
                        hideDelay: 10000000/*,
                         gravity: "n",
                         onTop: true*/
                    }
                );
                inlinedialog.column = column;
                inlinedialog.close = function(){
                    inlinedialog.remove();
                    $(".tipsy.tipsy-n, #null-sorting-dropdown").remove();
                    $("body, .playsql-spreadsheet-placeholder th").off(".playsql-inlinedialog");
                    if (spreadsheet.inlinedialog == this) {
                        spreadsheet.inlinedialog = undefined;
                    }
                }
                var onClickOutsideInlineDialog = function (e) {
                    if (!spreadsheet.inlinedialog || !spreadsheet.inlinedialog.is(":visible")) return;
                    var target = e.target || this;
                    var $this = $(target);
                    if ($this.closest("#inline-dialog-col-properties, " +
                        "#null-sorting-dropdown, " +
                        "#select2-drop, #select2-drop-mask, #select2-drop-mask").size() > 0) return;
                    // If it's not in the DOM, it was detached, therefore it's probably the Configure button
                    if (!$.contains(document.documentElement, target)) return;
                    spreadsheet.inlinedialog.close();
                };
                $("body").on("click.playsql-inlinedialog", "*", onClickOutsideInlineDialog);
                // For elements which answer 'false' to clicks:
                $(".playsql-spreadsheet-placeholder th").on("click.playsql-inlinedialog", onClickOutsideInlineDialog);
                return inlinedialog;
            }, // End of the 'create' function
            displayProperties : function(spreadsheet, column, inlinedialog){
                $(".tipsy.tipsy-n").remove();
                var isFirst = true;
                var isLast = true;
                var position = spreadsheet.columns.indexOf(column);
                if (position + 1 != spreadsheet.columns.length) isLast = false;
                for (var i = 0; i < position ; i++)
                    if (!spreadsheet.columns[i].statusPK && !spreadsheet.columns[i].statusPK)
                        isFirst = false;
                // We brutally replace the inline dialog's contents with the new form
                var template = Confluence.Templates.PlaySQL.columnPropertiesDetails({
                    column: column,
                    hasColFEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_FE'),
                    hasColBEPerm: spreadsheet.perms.hasPerm('EDIT_COLS_BE'),
                    isFirst: isFirst,
                    isLast: isLast
                });
                var $content = $("#inline-dialog-col-properties .contents").empty().html(template),
                    $header = column.$placeholder.find("th:nth-child(" + (column.index + 1) + ")");
                $(".btn-advanced").click(function(e){
                    e.preventDefault();
                    $(".remove-when-show-advanced-details").remove();
                    window.PlaySQL.Spreadsheet.ColumnToolbar.displayAdvancedProperties(spreadsheet, column, inlinedialog);
                });

                // Select the default quick renderer, if any
                var bestGuess = getQuickRendererBestGuess(column);
                if (bestGuess != undefined) {
                    $content.find("[data-quick-renderer='" + bestGuess + "']").addClass("active");
                }

                if (!spreadsheet.perms.hasPerm('EDIT_COLS_FE')) {
                    $content.find(".quick-renderer").remove();
                } else {
                    $content.find(".quick-renderer").each(function (i) {
                        var $this = $(this),
                            action = $this.attr("data-quick-renderer"),
                            proposition = getProposedRenderer(action, column),
                            renderer = window.PlaySQL.Spreadsheet.renderers[proposition.renderer];
                        if (!renderer) {
                            $this.remove();
                        }
                        if (!renderer.isSupportedType(column.type)) {
                            if (!spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                                $this.remove();
                            }
                        }
                    });
                }
                // Remove intermediary groups of button, to avoid the empty-space effect
                $content.find(".aui-buttons:empty").remove();
                if (!window.PlaySQL.Helpers.hasMinVersion("5.5.0")) $content.find(".aui-iconfont-calendar").parent().text("D");
                $content.on("click", ".quick-renderer", function (e) {
                    e.preventDefault();
                    var $this = $(this),
                        $parent = $this.closest(".aui-toolbar2");
                    $parent.find(".quick-renderer").removeClass("active");
                    $this.addClass("active enforce");
                });
                function saveColumnFormula(formula, viewRenderer) {
                    var changes = [],
                        newColumn = {
                            name: column.name,
                            label: column.label,
                            type: column.type,
                            formula: column.formula,
                            renderer: column.renderer,
                            viewRenderer: column.viewRenderer,
                            length: column.length,
                            width: column.width,
                            formats: column.formats
                        };
                    if (formula != newColumn.formula) {
                        changes.push("CHFMA");
                        newColumn.formula = formula;
                    }
                    if (viewRenderer != newColumn.viewRenderer) {
                        changes.push("CHRDR");
                        newColumn.viewRenderer = viewRenderer;
                    }
                    if (changes.length == 0) return;

                    spreadsheet.saveColumn($header, column, newColumn, changes, function () {
                        spreadsheet.load();
                    }, function (message) {
                        window.PlaySQL.Messages.addMessage("error", "The wizard couldn't update the formula. The spreadsheet will be reloaded", "wizard-formula", message);
                        spreadsheet.load();
                    });
                }

                function saveColumnFormulaFailure(message) {
                    window.PlaySQL.Messages.addMessage("error", "The wizard couldn't update the formula.", "wizard-formula", message);
                }

                function submitColumnPopupCallback() {
                    var $label = $content.find(".column-label"),
                        $name = $content.find(".column-name"),
                        $formula = $content.find(".column-formula"),
                        $type = $content.find("#column-type:visible"),
                        $renderer = $content.find("#column-renderer:visible"),
                        $viewRenderer = $content.find("#view-renderer:visible"),
                        $quickRenderer = $content.find(".quick-renderer.active.enforce").first(),
                        $wordWrap = $content.find(".column-word-wrap"),
                        $length = $content.find("#column-length:visible"),
                        changes = [],
                        hasFormula = $formula.val(),
                        newColumn = {
                            name: column.name,
                            label: column.label,
                            type: column.type,
                            formula: column.formula,
                            renderer: column.renderer,
                            length: column.length,
                            width: column.width,
                            formats: undefined
                        };
                    if ($label.size() > 0 && $label.val() != column.label) {
                        newColumn.label = $label.val();
                        if ($.trim(newColumn.label).length == 0) {
                            $("#inline-dialog-col-properties .error").last().text("A label is required.");
                            return;
                        }
                        changes.push("CHLBL");
                    }
                    if ($name.size() > 0 && $name.val() != column.name) {
                        newColumn.name = $.trim($name.val());
                        if (newColumn.name.length == 0) {
                            $("#inline-dialog-col-properties .error").last().text("A name is required. This is the key of the column.");
                            return;
                        }
                        if (spreadsheet.colOf(newColumn.name) != undefined) {
                            $("#inline-dialog-col-properties .error").last().text("Another column already uses this name.");
                            return;
                        }
                        changes.push("RENAME");
                    }
                    if ($formula.val() != (column.formula || "")) {
                        changes.push("CHFMA");
                        newColumn.formula = $formula.val();
                    }
                    if ($quickRenderer.size() == 1) {
                        // When we update with a quick renderer, we reuse the existing format details.
                        // We only reset format details if the "Advanced" panel was shown and quick renderers removed.
                        newColumn.formats = column.formats;
                        var action = $quickRenderer.attr("data-quick-renderer"),
                            proposition = getProposedRenderer(action, column);
                        var renderer = window.PlaySQL.Spreadsheet.renderers[proposition.renderer];
                        // We don't change the backend type:
                        // - If there's a formula. It's not a problem since we'll detect a potential type mismatch soon enough.
                        // - If the current type is compatible with the proposed renderer (unless the proposition requires enforcing the type)
                        if (hasFormula) {
                            // We change the renderer of the formula
                            changes.push("CHRDR");
                            newColumn.viewRenderer = proposition.renderer;
                            if (proposition.formats) {
                                newColumn.formats = $.extend({}, newColumn.formats, proposition.formats);
                                changes.push("CHFMT");
                            }
                        } else if (renderer.isSupportedType(column.type) && (!proposition.updateType || !spreadsheet.perms.hasPerm('EDIT_COLS_BE'))) {
                            // We just change the renderer of the column
                            changes.push("CHRDR");
                            newColumn.renderer = proposition.renderer;
                            if (proposition.formats) {
                                newColumn.formats = $.extend({}, newColumn.formats, proposition.formats);
                                changes.push("CHFMT");
                            }
                        } else if (spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                            // We change the back-end type of the column
                            changes.push("CHTYPE");
                            changes.push("CHRDR");
                            newColumn.type = renderer.getDefaultType();
                            newColumn.length = undefined;
                            newColumn.renderer = proposition.renderer;
                            if (proposition.formats) {
                                newColumn.formats = $.extend({}, newColumn.formats, proposition.formats);
                                changes.push("CHFMT");
                            }
                        } else {
                            // The quick renderer shouldn't have been displayed anyway
                            message = "Unsupported type: " + column.type + " and can't change type to " + renderer.getDefaultType();
                            window.PlaySQL.Helpers.checkNotNull($("#inline-dialog-col-properties .error").last()).text(message);
                            return;
                        }
                    } else {
                        // We only look at the type/renderer/length/formatDetail fields if no Quick Renderer
                        // was selected
                        if ($type.size() > 0 && $type.val() != newColumn.type) {
                            changes.push("CHTYPE");
                            newColumn.type = $type.val();
                        }
                        if ($renderer.size() > 0 && $renderer.val() != newColumn.renderer) {
                            changes.push("CHRDR");
                            newColumn.renderer = $renderer.val();
                        }
                        if ($viewRenderer.size() > 0) {
                            newColumn.viewRenderer = $viewRenderer.val();
                            if (newColumn.viewRenderer == newColumn.renderer) newColumn.viewRenderer = undefined;
                            if (newColumn.viewRenderer == "") newColumn.viewRenderer = undefined;
                            if (newColumn.viewRenderer != column.viewRenderer) {
                                changes.push("CHRDR");
                                newColumn.viewRenderer = $viewRenderer.val();
                            }
                        }
                        if ($length.size() > 0 && $length.val() != newColumn.length) {
                            newColumn.length = parseInt($length.val());
                            if (isNaN(newColumn.length)) newColumn.length = undefined;
                            if (newColumn.length == undefined) {
                                $content.find(".for-length .error").last().text("The length is mandatory.");
                                return;
                            }
                            if (newColumn.length != column.length) changes.push("CHTYPE");
                        }
                        var newRenderer = window.PlaySQL.Spreadsheet.renderers[newColumn.viewRenderer || newColumn.renderer];
                        var oldFormats = column.formats,
                            newFormats = newRenderer.getFormatValues($content, newColumn);

                        function isEqual(newFormats, oldFormats) {
                            if ((newFormats == undefined) ^ (oldFormats == undefined)) {
                                return false;
                            } else if (newFormats != undefined && oldFormats != undefined) {
                                if (Object.keys(newFormats).length != Object.keys(oldFormats).length) {
                                    return false;
                                } else {
                                    for (var key in newFormats) {
                                        if (newFormats[key] != oldFormats[key]) {
                                            return false;
                                        }
                                    }
                                }
                            }
                            return true;
                        }

                        if (!isEqual(newFormats, oldFormats)) {
                            changes.push("CHFMT");
                        }
                        newColumn.formats = newFormats;
                    }
                    if ($wordWrap.is(":checked")) {
                        newColumn.formats = newColumn.formats || {};
                        if (newColumn.formats.wordwrap != 'true') {
                            newColumn.formats.wordwrap = 'true';
                            changes.push("CHFMT");
                        }
                    } else {
                        if (newColumn.formats && newColumn.formats.wordwrap) {
                            delete newColumn.formats["wordwrap"];
                            changes.push("CHFMT");
                        }
                    }

                    if (changes.length == 0) {
                        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                        return;
                    }

                    spreadsheet.saveColumn($header, column, newColumn, changes, function () {
                        // Remove cache. Sorry for breaking encapsulation.
                        column.statusMappings = undefined;
                        spreadsheet.renderAllColumn(column);
                        if (changes.indexOf("CHFMT") != -1) {
                            var cssWordWrap = spreadsheet.css.module("word-wrap");
                            if (newColumn.formats && newColumn.formats.wordwrap == 'true') {
                                cssWordWrap.getRule({column: newColumn.name}).body['white-space'] = 'pre-wrap';
                            } else {
                                cssWordWrap.getRule({column: newColumn.name}).body['white-space'] = null;
                            }
                            window.PlaySQL.Helpers.applyCss(spreadsheet.css, "word-wrap");
                        }
                        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                    }, function (message) {
                        window.PlaySQL.Helpers.checkNotNull($("#inline-dialog-col-properties .error").last()).text(message);
                    });
                    return;
                }

                $content.find(".wizardGMaps").click(function () {
                    window.PlaySQL.Spreadsheet.ColumnToolbar.wizardGMaps(spreadsheet, $header, column, saveColumnFormula, saveColumnFormulaFailure);
                });
                $content.find(".wizardForeignKey").click(function () {
                    window.PlaySQL.Spreadsheet.ColumnToolbar.wizardForeignKey(spreadsheet, $header, column, saveColumnFormula, saveColumnFormulaFailure);
                });
                $content.on("click", ".btn-delete", function (e) {
                    e.preventDefault();
                    if (!spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                        alert("Permissions are required to delete columns");
                        return;
                    }
                    spreadsheet.inlinedialog.close();
                    spreadsheet.deleteColumn($header);
                });
                var shift = 0,
                    shiftTimeoutHandlerId = undefined,
                    shiftedColumn = undefined;
                function shiftTimeoutHandler() {
                    spreadsheet.moveColumn(shiftedColumn, shift, function(){
                        spreadsheet.load();
                        spreadsheet.inlinedialog.close();
                    }, function(message){
                        $content.find(".error").last().text("Couldn't move the column. " + message + " Please reload the spreadsheet");
                        window.setTimeout(function(){ spreadsheet.load(); }, 5000);
                    });
                    shift = 0;
                }
                $content.on("click", ".btn-move-left, .btn-move-right", function(e){
                    shiftedColumn = shiftedColumn || spreadsheet.colOf($header);
                    e.preventDefault();
                    if (!spreadsheet.perms.hasPerm('EDIT_COLS_BE')) {
                        alert("Permissions are required to move columns");
                        return;
                    }
                    var isLeft = $(this).hasClass("btn-move-left");
                    if (isLeft) shift--; else shift++;
                    if (shiftTimeoutHandlerId) window.clearTimeout(shiftTimeoutHandlerId);
                    shiftTimeoutHandlerId = window.setTimeout(shiftTimeoutHandler, 500);
                    // Provide visual feedback. We're destroying the sync bw DOM and internal state
                    // but we're reloading the spreadsheet a second later
                    if (isLeft) {
                        if ($header.index() > 1)
                            $header.insertBefore($header.prev());
                    } else {
                        if (!$header.next().is(".right-padding"))
                            $header.insertAfter($header.next());
                    }
                });
                $content.on("click", ".btn-submit", submitColumnPopupCallback);
                $content.on("keypress", function (e) {
                    if (e.which == 13) {
                        submitColumnPopupCallback();
                        return false;
                    } else if (e.which == 27) {
                        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                        return false;
                    }
                });
                $content.find(".playsql-tipsy").tipsy();
            },
            displayAdvancedProperties : function(spreadsheet, column, inlinedialog) {
                var hasFormula = !!column.formula,
                    renderers = getRenderers(column.type),
                    $template = $(Confluence.Templates.PlaySQL.columnPropertiesAdvanced({
                        name: column.name,
                        hasFormula: hasFormula,
                        renderer: column.renderer,
                        viewRenderer: column.viewRenderer || column.renderer,
                        coltype: column.type,
                        length: column.length,
                        renderers: renderers,
                        dataTypes: DATA_TYPES,
                        canChangeBackEndCols : spreadsheet.perms.hasPerm('EDIT_COLS_BE')
                    }));
                $("#inline-dialog-col-properties .contents .advanced-properties > tbody").append($template);

                function updateFieldType() {
                    var $select = $("#column-type"),
                        val = $select.val(),
                        $message = $select.parent().children(".description"),
                        $editRendererCombo = $("#column-renderer"),
                        editRenderer = column.renderer;

                    if (val != column.type) {
                        var text = ("The original type is {}. If you save, the column will be transformed to {}. The conversion" +
                        " is up to the database system, not Play SQL. You may or may not be satisfied with the new values.")
                            .replace("{}", column.type).replace("{}", val);
                        $message.text(text);
                    } else {
                        $message.empty();
                    }

                    for (var i in DATA_TYPES) {
                        if (DATA_TYPES[i].name == val) {
                            $(".for-length").toggleClass("hidden", !DATA_TYPES[i].hasLength);
                            break;
                        }
                    }

                    // Update the list of renderers in the combo
                    renderers = getRenderers(val);
                    $editRendererCombo.empty();
                    for (var i in renderers.sameTypeRenderers) {
                        var el = renderers.sameTypeRenderers[i];
                        $("<option>", {
                            value: el.key,
                            text: el.name,
                            selected: editRenderer == el.key
                        }).appendTo($editRendererCombo);
                    }
                    updateRenderer();
                }

                function updateRenderer() {
                    var $select = hasFormula ? $("#view-renderer") : $("#column-renderer"),
                        val = $select.val(),
                        $placeholderTable = $("#inline-dialog-col-properties .advanced-properties > tbody");
                    renderer = window.PlaySQL.Spreadsheet.renderers[val];

                    $("#inline-dialog-col-properties .format-details").remove();

                    renderer.appendRendererDetailsTo(spreadsheet, $placeholderTable, column);
                }

                $("#column-type").change(updateFieldType);
                $(hasFormula ? "#view-renderer" : "#column-renderer").change(updateRenderer);

                updateFieldType();
            }
        } // End of window.PlaySQL.Spreadsheet.ColumnToolbar

        var DATA_TYPES = [{name:'VARCHAR', hasLength: true},
            {name:'TEXT'},
            {name:'INTEGER'},
            {name:'BIG_INTEGER'},
            {name:'BOOLEAN'},
            {name:'DATE'},
            {name:'NUMERIC'},
            {name:'DOUBLE'}];

        function displayColProps(spreadsheet, $cell) {
            if (!spreadsheet.perms.hasPerm('EDIT_COLS_FE')) return;
            var column = spreadsheet.colOf($cell),
                dialog = window.PlaySQL.Spreadsheet.ColumnProperties(spreadsheet, column, spreadsheet.perms.hasPerm('EDIT_COLS_BE'));
            dialog.show();
        }


        var QUICK_RENDERERS = {
            "euro":   { renderer: "currency", formats: {aboveZero: "# ##0,00 "}},
            "dollar": { renderer: "currency", formats: {aboveZero: "$ #,##0.00"}},
            "integer": { renderer: "integer"},
            "decimal": { renderer: "currency", formats: {aboveZero: "#,##0.00"}, updateType: true},
            "markdown": { renderer: "markdown"},
            "text": { renderer: "as-string"},
            "link": { renderer: "link"},
            "boolean": { renderer: "boolean"},
            "date-picker": { renderer: "date"},
            "user-picker": { renderer: "confluenceuser"},
            "date-picker": { renderer: "date"},
            "page-picker": { renderer: "confluencecontent"}
        };

        function getQuickRendererBestGuess(column) {
            var action;
            for (action in QUICK_RENDERERS) {
                var quickRenderer = QUICK_RENDERERS[action],
                    matches = true;
                if (quickRenderer.renderer != (column.viewRenderer || column.renderer)) continue;
                for (var formatKey in quickRenderer.formats) {
                    if (column.formats == null || column.formats[formatKey] != quickRenderer.formats[formatKey]) {
                        matches = false;
                        break;
                    }
                }
                if (matches) {
                    return action;
                }
            }
            if ((column.viewRenderer || column.renderer) == "currency") {
                action = "integer";
                return action;
            }
            return undefined;
        }

        function getProposedRenderer(action, column) {
            var result = QUICK_RENDERERS[action];

            if (action == "integer") {
                if (column.type == "NUMERIC") {
                    result.renderer = "currency";
                    result.formats = {aboveZero: "#,##0"};
                } else {
                    result.renderer = "integer";
                }
            }
            return result;
        }

        function getRenderers(colType) {
            var sameTypeRenderers = [],
                otherTypeRenderers = [],
                renderers = window.PlaySQL.Spreadsheet.renderers;
            for (var key in renderers) {
                if (renderers[key].isSystemRenderer()) continue;
                var r = {
                    key: key,
                    name: renderers[key].getI18nName()
                }
                if (renderers[key].isSupportedType(colType)) {
                    sameTypeRenderers.push(r);
                } else {
                    otherTypeRenderers.push(r);
                }
            }
            return {
                sameTypeRenderers : sameTypeRenderers,
                otherTypeRenderers : otherTypeRenderers
            }
        }

        window.PlaySQL.Spreadsheet.ColumnToolbar.wizardForeignKey = function(spreadsheet, $header, column, successCallback, failureCallback) {

            var inlineDialog = AJS.InlineDialog($header, "wizard-foreign-key", function($content, trigger, showPopup) {
                $content.css("width", "450px");
                $content.html(Confluence.Templates.PlaySQL.wizardForeignKeyInlineDialog({}));

                $content.find(".btn-submit").click(function(){
                    var formula = $content.find(".preview").attr("data-result"),
                        targetColumnRenderer = $content.find("#targetlabel option:checked").attr("data-renderer");
                    if (!formula) {
                        $content.find(".error").last().text("All fields are mandatory");
                        return;
                    }
                    successCallback && successCallback(formula, targetColumnRenderer);
                    inlineDialog && inlineDialog.close();
                });
                showPopup();

                $content.find("select").change(function(){
                    function quoteIfNecessary(columnname) {
                        if (columnname == undefined) return columnname;
                        if (spreadsheet.defaultCase == "LOWER") {
                            if (columnname.toLowerCase() != columnname) {
                                columnname = '"' + columnname + '"';
                            }
                        } else if (spreadsheet.defaultCase == "UPPER") {
                            if (columnname.toUpperCase() != columnname) {
                                columnname = '"' + columnname + '"';
                            }
                        } else {
                            columnname = '"' + columnname + '"';
                        }
                        return columnname;
                    }
                    var targettable = $content.find("#targettable").val(),
                        targetlabel = $content.find("#targetlabel").val(),
                        targetid = $content.find("#targetid").val(),
                        sourcecolumn = $content.find("#sourcecolumn").val(),
                        formula = "= " + quoteIfNecessary(targettable) + "." + quoteIfNecessary(targetlabel)
                            + " WHERE " + quoteIfNecessary(targettable) + "." + quoteIfNecessary(targetid) + "=" + quoteIfNecessary(sourcecolumn),
                        $previewArea = $content.find(".preview");

                    if (!!targettable && !!targetlabel && !!targetid && !!sourcecolumn) {
                        $previewArea.text(formula).attr("data-result", formula);
                        $content.find(".error").last().text("");
                    } else {
                        $previewArea.html("&nbsp;").attr("data-result", "");
                    }
                });

                var url = PlaySQL.SPI.baseUrlOld("autocomplete/" + spreadsheet.context),
                    $selectTargetTable = $content.find("#targettable"),
                    $selectTargetLabel = $content.find("#targetlabel"),
                    $selectTargetId = $content.find("#targetid"),
                    $selectSourceColumn = $content.find("#sourcecolumn");

                // Load the table list
                $.ajax({
                    url: url,
                    type: 'GET',
                    contentType: "application/json; charset=utf-8"
                }).done(function(data){
                    var tables = data.tables["current schema"];
                    $selectTargetTable.empty();
                    $("<option>", {
                        value: "",
                        text: "-- Select a table to lookup"
                    }).appendTo($selectTargetTable);
                    for (var i in tables) {
                        $("<option>", {
                            value: tables[i].name,
                            text: tables[i].label
                        }).appendTo($selectTargetTable);
                    }
                }).fail(function(data){
                    failureCallback && failureCallback("Couldn't load the table list");
                });

                // Load the local columns
                $.ajax({
                    url: url + "/" + spreadsheet.id,
                    type: 'GET',
                    contentType: "application/json; charset=utf-8"
                }).done(function(data){
                    var tables = data.tables["current schema"],
                        tableName
                    $selectSourceColumn.empty();
                    for (var i in tables) {
                        if (tables[i].name == spreadsheet.id) {
                            var columns = tables[i].columns;
                            for (var j in columns) {
                                $("<option>", {
                                    value: columns[j].name,
                                    text: tables[i].label + "." + columns[j].label + (column.name == columns[j].name ? " (this column)" : "")
                                }).appendTo($selectSourceColumn);
                            }
                        }
                    }
                    $selectSourceColumn.val(column.name);
                }).fail(function(data){
                    failureCallback && failureCallback("Couldn't load the table list");
                });

                // Load the other columns
                $selectTargetTable.change(function(){
                    $.ajax({
                        url: url + "/" + $selectTargetTable.val(),
                        type: 'GET',
                        contentType: "application/json; charset=utf-8"
                    }).done(function(data){
                        var tables = data.tables["current schema"],
                            tableName
                        $selectTargetLabel.empty();
                        $selectTargetId.empty();
                        $("<option>", {
                            value: "",
                            text: "-- Select the column to display"
                        }).appendTo($selectTargetLabel);
                        $("<option>", {
                            value: "",
                            text: "-- Select the key"
                        }).appendTo($selectTargetId);
                        for (var i in tables) {
                            if (tables[i].name == $selectTargetTable.val()) {
                                var columns = tables[i].columns;
                                for (var j in columns) {
                                    $("<option>", {
                                        value: columns[j].name,
                                        text: tables[i].label + "." + columns[j].label,
                                        "data-renderer": columns[j].renderer
                                    }).appendTo($selectTargetLabel)
                                        .clone().appendTo($selectTargetId)
                                }
                            }
                        }
                        $selectTargetId.val("ID");
                    }).fail(function(data){
                        failureCallback && failureCallback("Couldn't load the table list");
                    });
                });
            }, {
                noBind: true,
                hideCallback: function(){
                    inlineDialog && inlineDialog.close();
                },
                hideDelay: 10000000
            });
            inlineDialog.close = function() {
                inlineDialog && inlineDialog.remove();
            };
            inlineDialog.show();
        }

        window.PlaySQL.Spreadsheet.ColumnToolbar.wizardGMaps = function(spreadsheet, $header, column, successCallback, failureCallback) {
            if (column.type != 'VARCHAR' && column.type != 'TEXT') {
                var message = "Please change the type of the column to Link before proceeding.";
                failureCallback && failureCallback(message) || alert(message);
                return;
            }
            var inlineDialog = AJS.InlineDialog($header, "wizard-gmaps", function($content, trigger, showPopup) {
                $content.css("width", "450px");
                $content.html(Confluence.Templates.PlaySQL.wizardGMapsInlineDialog({
                    columns: spreadsheet.columns,
                    currentcolumn: column.name
                }));
                $content.find(".btn-submit").click(function(){
                    var sourceColumn = $content.find("#sourcecolumn").val(),
                        url = $content.find("#url").val(),
                        display = $content.find("input[name='display']:checked").attr("id"),
                        convertToSql = $content.find("#convert-to-sql").is(":checked"),
                        formula = "= TO_URL('" + url + "', " + sourceColumn;
                    if (display == "display-link") {
                        formula += ")";
                    } else if (display == "display-field") {
                        formula += ", " + sourceColumn + ")";
                    } else if (display == "display-label") {
                        formula += ", 'Link')";
                    }
                    successCallback(formula, 'link');
                    inlineDialog && inlineDialog.close();
                });
                showPopup();
            }, {
                noBind: true,
                hideCallback: function(){
                    inlineDialog && inlineDialog.close();
                },
                hideDelay: 10000000
            });
            inlineDialog.close = function() {
                inlineDialog && inlineDialog.remove();
            };
            inlineDialog.show();
        }
    });
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-formula-editor.js' */
(function(){
window.Confluence = window.Confluence || {};
window.window.PlaySQL = window.window.PlaySQL || {};
window.window.PlaySQL.Spreadsheet = window.window.PlaySQL.Spreadsheet || {};
window.window.PlaySQL.Spreadsheet.FormulaEditor = window.window.PlaySQL.Spreadsheet.FormulaEditor || {

    /**
     * Displays the formula editor for this cell.
     * If the cell was in edit mode, cancel it first.
     */
    edit : function(spreadsheet, $cell, renderer, setValue) {
        var inlinedialog;
        if (!spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
            // Should never reach there because checkBeforeEdit() should return 'no'
            return false;
        }
        if ($cell.hasClass("editing") && !$cell.hasClass("formula")) {
            renderer.cancelEdit();
        }

        // Keep the old value for cancel
        if (!$cell.hasClass("saving")) {
            $cell.attr('data-rendered', $cell.html());
        }

        $cell.addClass("editing formula");

        // Define the value. If the cell was in error, the last correct value is the text of the cell.
        // Otherwise it is provided through the parameters and it comes from the cellMetadata.
        if ($cell.hasClass("invalid") || $cell.hasClass("saving")) {
            // The cell is re-edited after an invalid state
            setValue = $cell.text();
            if (setValue.charAt(0) == "=") {
                setValue = setValue.substr(1);
            }
            $cell.removeClass("saving");
        } else {
            // The cell is edited for the first time.
            if (setValue == undefined) {
                setValue = "";
            } else if (setValue.charAt(0) == "=") {
                setValue = setValue.substr(1);
            }
            $cell.attr('data-cell-metadata-formula', "=" + setValue);
        }

        var selectionManager = window.PlaySQL.Selection.forTable(spreadsheet.$placeholder);

        // Add the input field
        var $input = $("<div>", {
                        contenteditable: true,
                        "class": 'formula-editor playsql-formula',
                        text: setValue
                    });
        $input.appendTo($cell.empty().append("=&nbsp;"));
        // Key movements while editing the formula
        $input.on("keydown", function(e){
            // This time it's Play SQL's bindings that we want to skip
            e.stopPropagation();
            window.PlaySQL.Spreadsheet.FormulaEditor.saveSelection($input);
            // And we want to map a few keys
            var keyCombination = window.PlaySQL.Helpers.getKeyCombinationDetail(e);
            if (keyCombination.key == "backspace") {
                var caret = window.PlaySQL.Helpers.caretSelection($input[0]);
                if (caret == undefined) return;
                if (caret.position == 0 && caret.length == 0) {
                    e.preventDefault();
                    window.PlaySQL.Spreadsheet.FormulaEditor.removeFormula(spreadsheet, $cell, renderer);
                    renderer.focus();
                }
            } else if (keyCombination.canonical == "up"
                || keyCombination.canonical == "down"
                || keyCombination.canonical == "enter") {
                e.preventDefault();
            }
            // We need to wait for the character to be inserted
            window.setTimeout(function() {
                var result = window.PlaySQL.Spreadsheet.FormulaEditor.triggerKeyboardCellSelection(spreadsheet, $cell, $input, inlinedialog, e);
                if (result) {
                    window.PlaySQL.Spreadsheet.FormulaEditor.triggerAutocompletion(spreadsheet, $cell, $input, inlinedialog, e);
                }
            }, 0);
        }).on("keypress", function(e) {
            // Note: Keypress is only generated on actual characters after keydown, not on ESC/ENTER
            // We want to dodgeskip Confluence's keyboard shortcuts while we're in there, especially 'c' for Create
            e.stopPropagation();
            window.PlaySQL.Spreadsheet.FormulaEditor.saveSelection($input);
        }).on("input, keyup", function(e){
            window.PlaySQL.Spreadsheet.FormulaEditor.saveSelection($input);
            window.PlaySQL.Spreadsheet.FormulaEditor.highlightCellsAtCaret(spreadsheet, $input);
            debouncedTriggerSyntaxColoration();
            spreadsheet.inlinedialog && spreadsheet.inlinedialog.refresh();
        }).on("click", function(e) {
            window.PlaySQL.Spreadsheet.FormulaEditor.saveSelection($input);
            window.PlaySQL.Spreadsheet.FormulaEditor.highlightCellsAtCaret(spreadsheet, $input);
        });
        var debouncedTriggerSyntaxColoration = $.debounce(function(){
            if (!$input.is(":visible")) return;
            window.PlaySQL.Spreadsheet.FormulaEditor.triggerSyntaxColoration($input, spreadsheet, inlinedialog);
        }, 500);

        // Create the inline dialog
        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close && spreadsheet.inlinedialog.close();
        var javadoc = null;
        inlinedialog = AJS.InlineDialog($cell, "formula-editor",
            function ($content, trigger, showPopup) {
                $content.css("width", "");
                $content.closest("#inline-dialog-formula-editor").addClass("small-inline");
                $content.html(Confluence.Templates.PlaySQL.formulaEditor({
                    javadoc : javadoc
                }));
                showPopup();
                $(document).on("mouseenter.playsql-inlinedialog", "#inline-dialog-formula-editor .autocomplete-item", function(){
                    $(this).addClass("active").siblings().removeClass("active");
                }).on("click.playsql-inlinedialog", "#inline-dialog-formula-editor .autocomplete-item", function(){
                    var $item = $(this);
                    $input.focus();
                    window.PlaySQL.Spreadsheet.FormulaEditor.insertAutocomplete(spreadsheet, $item);
                });
                $("#inline-dialog-formula-editor .btn-cancel").click(function(){
                    window.PlaySQL.Spreadsheet.FormulaEditor.closeDialog(spreadsheet, true);
                });
                $("#inline-dialog-formula-editor .btn-submit").click(function(){
                    // Save the cell
                    var cell = spreadsheet.getCell($cell);
                    if (cell != null) {
                        cell.renderer.saveAndView();
                        spreadsheet.sprayRequestPipe();
                    }
                });

                return false;
            }, {
                noBind: true,
                persistent: true,
                hideCallback: function () {
                    if (spreadsheet.inlinedialog) {
                        if (!spreadsheet.inlinedialog.redisplay || !spreadsheet.inlinedialog.redisplay.isRedisplaying) {
                            spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                        }
                    }
                },
                hideDelay: 10000000,
                gravity: "e"
            }
        );
        spreadsheet.inlinedialog = inlinedialog;
        inlinedialog.name = "formula-editor";
        inlinedialog.$input = $input;
        inlinedialog.append = function(formulaAddition) {
            var $field = $cell.find(".formula-editor").first();
            if (formulaAddition instanceof $) {
                var caret = window.PlaySQL.Helpers.caretSelection($field[0], $field.data("saved-selection")),
                    range = caret.range;
                // Either the caret is in the middle of a subrule-value-cell, either something is selected,
                // either we insert at the end. We position the caret at the end of the insert.
                if (caret.length === 0) {
                    // If the cursor is over a cell reference, select the whole <span>
                    if (caret.position > 0) {
                        window.PlaySQL.Helpers.setSelection(range, $field[0], caret.position - 1, "setStart");
                    }
                    var $parentRef = $(range.startContainer).closest(".subrule-value-cell");
                    if ($parentRef.size() == 1) {
                        //range = document.createRange();
                        range.setEndAfter($parentRef[0]);
                        // If the last character before the cursor is not alphanum or *,
                        // we'll consider the user has added a separator and we won't replace the last element
                        var lastChar = range.toString();
                        if (/[^a-zA-Z0-9*:\[\]]/.test(lastChar)) {
                            range.collapse(false);
                        } else {
                            range.setStartBefore($parentRef[0]);
                        }
                    } else if (!$(range.startContainer).closest("td").hasClass("editing")) {
                        // The caret isn't in the formula cell. Move it in.
                        range = document.createRange();
                        var node = $field[0].childNodes.length > 0 ? $field[0].childNodes[$field[0].childNodes.length - 1] : $field[0];
                        range.setStart(node, node.length);
                        range.setEnd(node, node.length);
                    } else {
                        // Cancel the selection modification we've made earlier
                        range.collapse(false);
                    }
                }
                range.deleteContents();
                range.insertNode(formulaAddition[0]);
                // Refocus
                $field.focus();
                var selection = window.getSelection();
                selection.removeAllRanges();
                range.collapse(false);
                selection.addRange(range);
                $field.data("saved-selection", range);
            } else if (typeof formulaAddition == "string") {
                $field.val($field.val() + formulaAddition);
                // Refocus
                $field.focus();
            } else {
                throw "inlinedialog.append(): Unknown object: " + formulaAddition;
            }
        }
        inlinedialog.setJavadoc = function(data) {
            javadoc = Confluence.Templates.PlaySQL.javadoc(data);
            inlinedialog.redisplay && inlinedialog.redisplay();
        }
        inlinedialog.close = function(){
            inlinedialog.remove();
            if (spreadsheet.inlinedialog == inlinedialog) spreadsheet.inlinedialog = undefined;
            selectionManager.options.cssClassMap = undefined;
            window.PlaySQL.Spreadsheet.FormulaEditor.closeDialog(spreadsheet, false);
        }
        inlinedialog.redisplay = function() {
            inlinedialog.redisplay.isRedisplaying = true;
            inlinedialog.hide();
            inlinedialog.show();
            inlinedialog.redisplay.isRedisplaying = false;
        }
        var onClickOutsideInlineDialog = function (e) {
            if (!spreadsheet.inlinedialog || !spreadsheet.inlinedialog.is(":visible")) return false;
            var target = e.target || this;
            var $this = $(target),
                $targetCell = $this.closest("td,th");
            // Abort if the user clicks in the current cell
            if ($targetCell.is(inlinedialog.$input.closest("td, th"))) return;
            // Abort if the user clicks in an inline dialog
            if ($this.closest("#inline-dialog-formula-editor" //+
                //"#null-sorting-dropdown, " +
                //"#select2-drop, #select2-drop-mask, #select2-drop-mask"
            ).size() > 0) return;
            // If it's not in the DOM, it was detached, therefore it's probably button of the Inline Dialog
            // which was removed.
            if (!$.contains(document.documentElement, target)) return;

            // Ok, so now we have a click on a cell. Wait for playsql-selection.js to complete, then
            // look at what cell-ref-active brings back.
            window.setTimeout(function(){
                if (!spreadsheet.inlinedialog || spreadsheet.inlinedialog.name != "formula-editor") return;
                var $selection = spreadsheet.$placeholder.find(".cell-ref-active")
                                    .not(spreadsheet.inlinedialog.$input.closest("td"));
                if ($selection.size() == 0) {
                    // console.log("A click for a formula was lost");
                } else if ($selection.is("thead th")) {
                    $selection = $selection.filter("thead th").first();
                    var colName = $selection.attr("data-name");
                    var $el = $("<span>", {"class": "subrule-value-range subrule-range-all"})
                        .append($("<span>", {
                                    "class": "subrule-column-identifier",
                                    text: colName
                                }))
                        .append($("<span>", {
                                    "class": "subrule-range-all",
                                    text: ":*"
                                }));
                    inlinedialog.append($el);
                } else {
                    var $selection = $selection.first("td");
                    var cell = spreadsheet.getCell($selection),
                        currentCell = spreadsheet.getCell(inlinedialog.$input.closest("td")),
                        $el;
                    if (!cell) return;
                    if (!!currentCell && cell.rowId == currentCell.rowId) {
                        $el = $("<span>", {
                                "class": "subrule-value-cell subrule-cell-same-row subrule-column-identifier",
                                text: cell.column.name
                            });
                    } else {
                        $el = $("<span>", {"class": "subrule-value-cell subrule-cell-row-id"})
                            .append($("<span>", {
                                "class": "subrule-column-identifier",
                                text: cell.column.name
                            }))
                            .append(":")
                            .append($("<span>", {
                                "class": "subrule-row-id-digits",
                                text: cell.rowId
                            }));
                    }
                    inlinedialog.append($el);
                }
            }, 10);
            return;

            // Check whether we should append the formula instead
            var cell = spreadsheet.getCell($targetCell);
            if (cell) {
                if ($targetCell[0] == $cell[0]){
                    // Let something else take action: The user probably selected text in the formula
                    return true;
                }
                // Build a range definition
                var row = ":" + (cell.isColumnHeader ? "*" : $cell.closest("tr").attr("data-row-id"));
                var columnName = cell.column.name;
                var formulaAddition = columnName + row;
                inlinedialog.append(formulaAddition);
                // Here add colors for the formula
            }
            // If we don't prevent bubbling, each of the parents will receive the same click
            return false;
        };
        spreadsheet.$placeholder.on("mouseup.playsql-inlinedialog", "td, th", onClickOutsideInlineDialog);

        selectionManager.options.cssClassMap = { "selected": "cell-ref-active", "focused": "cell-ref-focused" };
        inlinedialog.show();
        inlinedialog.find(".remove-formula-link").click(function(e){
            e.preventDefault();
            window.PlaySQL.Spreadsheet.FormulaEditor.removeFormula(spreadsheet, $cell, renderer);
            return false;
        });
        debouncedTriggerSyntaxColoration();
        return inlinedialog;
    },
    triggerAutocompletion: function(spreadsheet, $cell, $input, inlinedialog, event) {
        var text = $input.text(),
            caret = window.PlaySQL.Helpers.caretSelection($input[0]);
        if (text.length == 0 || caret.position == undefined) return;
        var textBeforeCaret = text.substr(0, caret.position),
            parsed = window.PlaySQL.Helpers.parseFunctionAtCaret(textBeforeCaret),
            targetTable = parsed.currentTable || spreadsheet.id;
        window.PlaySQL.Helpers.getFunctionList(spreadsheet.context, targetTable, function (functionList) {
            if (!functionList || functionList.length == 0) return;
            var options = {},
                current = parsed.current && parsed.current.toLowerCase();
            function highlight(substring, text) {
                // If 'text' is part of HTML tags used here, don't take the risk
                if (new RegExp("<.*" + substring + ".*>").test(text)) return text;
                return text.replace(new RegExp("(" + substring + ")", 'i'), "<b>$1</b>");
            }
            if (current) {
                var candidates = [];
                for (var i in functionList.functions) {
                    var item = functionList.functions[i],
                        matches = item.name.toLowerCase().indexOf(current) == 0,
                        description = item.description,
                        priority = 1;
                    if (!matches && item.keywords) {
                        for (var i in item.keywords)
                            if (item.keywords[i].toLowerCase().indexOf(current) == 0) {
                                priority = 2;
                                matches = true;
                                description += " (keyword: " + highlight(current, item.keywords[i]) + ")";
                                break;
                            }
                    }
                    if (!matches && description) {
                        if (description.toLowerCase().indexOf(current) != -1) {
                            description = highlight(current, description);
                            priority = 20;
                            matches = true;
                        }
                    }
                    if (matches) {
                        candidates.push({
                            name: priority < 2 ? highlight(current, item.name) : item.name,
                            autocomplete: item.name,
                            type: "function",
                            // Override the description
                            detail: $.extend({}, item, {description:description}),
                            priority: priority
                        });
                    }
                }
                for (var i in functionList.columnNames) {
                    var item = functionList.columnNames[i];
                    if (item.name.toLowerCase().indexOf(current) == 0) {
                        candidates.push({
                            name: highlight(current, item.name),
                            autocomplete: item.name,
                            type: "column",
                            detail: item,
                            priority : 3
                        });
                    }
                }
                for (var i in functionList.tables) {
                    var item = functionList.tables[i];
                    if (item.name.toLowerCase().indexOf(current) == 0) {
                        candidates.push({
                            name: highlight(current, item.name),
                            autocomplete: item.name,
                            type: "table",
                            detail: item,
                            priority : 4
                        });
                    }
                }
                for (var i in functionList.constants) {
                    var item = functionList.constants[i];
                    if (item.name.toLowerCase().indexOf(current) == 0) {
                        candidates.push({
                            name: highlight(current, item.name),
                            autocomplete: item.name,
                            type: item.type,
                            detail: item,
                            priority : 5
                        });
                    }
                }
                // Sort by priority
                candidates.sort(function(a, b) {return a && a.priority && b && b.priority ? a.priority - b.priority : 0 });
                options.candidates = candidates;
            }
            if (parsed.parentFn) {
                var functionDef = functionList.functions.filter(function(f){ return f.name == parsed.parentFn })[0];
                if (!functionDef) {
                    options.parentFnNotFound = parsed.parentFn;
                } else {
                    options.parentFn = functionDef;
                }
            }
            inlinedialog.setJavadoc(options);
        });
    },
    triggerSyntaxColoration : function($input, spreadsheet, inlinedialog) {
        // Replace the contents of the cell with syntax-highlighted contents
        var text = $input.text(),
            url = PlaySQL.SPI.baseUrlOld("autocomplete/" + spreadsheet.context + "/" + spreadsheet.id + "/checkFormula"),
            caret = window.PlaySQL.Helpers.caretSelection($input[0]);
        if (caret.length != 0 || text.length < 3) {
            spreadsheet.$placeholder
                .find(".cell-ref-inactive, .cell-ref-active")
                .removeClass("cell-ref-inactive cell-ref-active");
            return;
        }

        url += "?" + $.param({
            formula: text,
            column: "col1",
            caretPosition: caret.position
        });

        $.ajax({
            url: url,
            type: 'GET',
            contentType: "application/json; charset=utf-8"
        }).done(function(data){
            if (!$input.is(":visible")) return;
            var caret = window.PlaySQL.Helpers.caretSelection($input[0]),
                inputText = $input.text();
            if (caret.length != 0) return;
            if (data.formula != inputText) {
                declassifyFormulaPartsAtCaretPosition();
                return;
            }
            // The markup is good and matches the input. We can update the formula, reposition the caret,
            // and update the cell-ref-active and cell-ref-inactive.
            var markupHtml = data.markup,
                markupText = $("<div>").html(markupHtml).text();
            if (markupText != inputText) {
                if (inputText.indexOf(markupText) == 0) {
                    // The user has just added a few letters. We can still recover by appended the added
                    // text.
                    markupHtml += AJS.escapeHtml(inputText.substr(markupText.length));
                } else {
                    declassifyFormulaPartsAtCaretPosition();
                    return;
                }
            }

            $input.html(markupHtml);
            //inlinedialog.setJavadoc(data.currentFunctions.length > 0 && data.currentFunctions[data.currentFunctions.length - 1]);

            var range = document.createRange();
            window.PlaySQL.Helpers.setSelection(range, $input[0], caret.position, "setEnd");
            range.collapse(false); // to end
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            $input.data("saved-selection", range);

            spreadsheet.$placeholder
                .find(".cell-ref-inactive, .cell-ref-active")
                .removeClass("cell-ref-inactive cell-ref-active");

            var $current = getCurrentFormulaElement();
            $input.find(".subrule-value-cell, .subrule-value-range").not($current).each(function(){
                highlightOriginCells(spreadsheet, $input, $(this), "cell-ref-inactive", "");
            });
            highlightOriginCells(spreadsheet, $input, $current, "cell-ref-active", "");

        }).fail(function(jqXHR, error, reason){
            AJS.log("Can't get syntax highlighting for formula: " + text);
            declassifyFormulaPartsAtCaretPosition();
        });
    },
    highlightCellsAtCaret: function(spreadsheet, $input) {
        // If the caret in a formula is above a cell reference, we need to highlight it is active
        // and highlight other references as inactive
        spreadsheet.$placeholder.find(".cell-ref-active").addClass("cell-ref-inactive").removeClass("cell-ref-active");
        var $current = getCurrentFormulaElement();
        highlightOriginCells(spreadsheet, $input, $current, "cell-ref-active", "cell-ref-inactive");
    },
    triggerKeyboardCellSelection: function(spreadsheet, $cell, $input, inlinedialog, e){
        var keyCombinationDetail =  window.PlaySQL.Helpers.getKeyCombinationDetail(e),
            $li = $("#inline-dialog-formula-editor .autocomplete-item.active");
        switch (keyCombinationDetail.canonical) {
            case "up":
                //e.preventDefault();
                $li = $li.removeClass("active").prev(".autocomplete-item").addClass("active");
                if ($li.size() == 0) {
                    $("#inline-dialog-formula-editor .autocomplete-item").last().addClass("active");
                }
                return false;
            case "down":
                //e.preventDefault();
                $li = $li.removeClass("active").next(".autocomplete-item").addClass("active");
                if ($li.size() == 0) {
                    $("#inline-dialog-formula-editor .autocomplete-item").first().addClass("active");
                }
                return false;
            case "enter":
                //e.preventDefault();
                var success = window.PlaySQL.Spreadsheet.FormulaEditor.insertAutocomplete(spreadsheet, $li);
                if (!success) {
                    // Save the cell
                    var cell = spreadsheet.getCell($cell);
                    if (cell != null) {
                        cell.renderer.saveAndView();
                        spreadsheet.sprayRequestPipe();
                    }
                }
                return false;
            case "esc":
                window.PlaySQL.Spreadsheet.FormulaEditor.cancelEdit(spreadsheet, $cell);
                break;
        }
        return true;
    },
    /** Keeps the selection in the data of the $input */
    saveSelection: function($input) {
        var selection = window.getSelection();
        if (selection.rangeCount > 0) {
            var range = selection.getRangeAt(0).cloneRange();
            $input.data("saved-selection", range);
        }
    },
    /* Inserts the autocompleted value into the formula
    * Syntax: insertAutocomplete(spreadsheet, $(".autocomplete-item.active"))
    * @return true if something was autocompleted, false otherwise (if false, the user prolly wanted to save the cell)
    * */
    insertAutocomplete: function(spreadsheet, $li){
        // Check if the active dialog is still the formula editor
        var inlinedialog = spreadsheet.inlinedialog;
        if (!inlinedialog || !inlinedialog.name == "formula-editor") return false;
        var $input = inlinedialog.$input;
        var autocompleteText, autocompleteType;
        if ($li instanceof $) {
            if ($li.size() == 0) return;
            autocompleteText = $li.attr("data-autocomplete");
            autocompleteType = $li.attr("data-autocomplete-type");
        } else {
            autocompleteText = arguments[1];
            autocompleteType = arguments[2];
        }
        var autocompleteText2 = autocompleteType == "function" ? autocompleteText + "(" : autocompleteText;
        var regex = /^[a-zA-Z0-9_:]+\(?$/;

        function selectTextMatchingRegex(range, regex, el, method) {
            var startingFromEnd = (method == "setEnd");
            if (el.nodeType == 3) {
                // Loop from the beginning or from the end of the text
                for (var i = startingFromEnd ? el.length : 0 ; i <= el.length && i >= 0 ; startingFromEnd ? i-- : i++) {
                    // We clone because there's a risk we collapse it
                    var range2 = range.cloneRange();
                    range2[method](el, i);
                    if (range2.collapsed) return false;
                    var text = range2.toString();
                    if (regex.test(text)) {
                        // The selection is set. Stop here.
                        range[method](el, i);
                        return true;
                    }
                }
            } else if (el.childNodes) {
                if (!startingFromEnd) {
                    for (var i in el.childNodes) {
                        var result = selectTextMatchingRegex(range, regex, el.childNodes[i], method);
                        // If the result is true or false, return it
                        if (typeof result != "undefined") return result;
                    }
                } else {
                    // Same loop, but starting from the end
                    for (var i = el.childNodes.length - 1 ; i >= 0 ; i--) {
                        var result = selectTextMatchingRegex(range, regex, el.childNodes[i], method);
                        // If the result is true or false, return it
                        if (typeof result != "undefined") return result;
                    }
                }
            }
        }

        var selection = window.getSelection();
        if (!selection.rangeCount) {
            $input.append(document.createTextNode(autocompleteText2));
            return true;
        }
        var range = selection.getRangeAt(0);
        var root = $(range.startContainer).closest("[contenteditable]")[0];
        if (!root) return true;
        if (selectTextMatchingRegex(range, regex, root, "setStart")) {
            range.deleteContents();
        }
        if (selectTextMatchingRegex(range, regex, root, "setEnd")) {
            range.deleteContents();
        }
        var newNode = document.createTextNode(autocompleteText2);
        range.insertNode(newNode);
        range.collapse(false);
        selection.removeAllRanges();
        selection.addRange(range);

        // Now find the functionDef and reset the javadoc
        spreadsheet.inlinedialog.setJavadoc("");
        window.PlaySQL.Helpers.getFunctionList(spreadsheet.context, spreadsheet.id, function (functionList) {
            if (!functionList || functionList.length == 0 || !functionList.functions) return;
            var functionDef = functionList.functions.filter(function(f){ return f.name == autocompleteText; })[0];
            // The function may be empty if 'spreadsheet.id' is not the same as parsed.currentTable.
            if (!functionDef) return;
            spreadsheet.inlinedialog.setJavadoc({parentFn: functionDef});
        });
        window.PlaySQL.Spreadsheet.FormulaEditor.triggerSyntaxColoration($input, spreadsheet, inlinedialog);
        return true;
    },
    validate: function(spreadsheet, $cell, renderer) {
        // Formulas can always be stored
        return true;
    },
    saveAndView: function(spreadsheet, $cell, renderer) {
        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
        $cell.removeClass("invalid");
        var formula = "=" + $cell.find(".formula-editor").text(),
            previousValue = $cell.attr("data-cell-metadata-formula");
        if (formula == previousValue) {
            this.cancelEdit(spreadsheet, $cell, renderer);
            return;
        }
        if (formula.trim() == "=") {
            // Just delete the contents
            $cell.removeAttr('data-rendered');
            this.cancelEdit(spreadsheet, $cell, renderer);
            if (spreadsheet.saveCellMetadata($cell, "formula", null))
                spreadsheet.sprayRequestPipe();
            return;
        }

        $cell.empty()
            .text(formula)
            .addClass("saving").removeClass("editing");

        if (spreadsheet.saveCellMetadata($cell, "formula", formula)) {
            spreadsheet.sprayRequestPipe();
        } else {
            $cell.html($cell.attr("data-rendered"));
        }
    },
    cancelEdit: function(spreadsheet, $cell) {
        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
        $cell.tipsy("disable");
        $(".tipsy").remove();
        var rendered = $cell.attr('data-rendered');
        if (rendered == undefined) {
            $cell.empty().removeClass("editing saving invalid");
        } else {
            $cell.html(rendered).removeClass("editing saving invalid");
        }
    },
    /**
     * Turns the cell back to a normally-rendered cell and sets the anti-formula class
     */
    removeFormula: function(spreadsheet, $cell, renderer) {
        var value = "=" + $cell.find(".formula-editor").text();
        window.PlaySQL.Spreadsheet.FormulaEditor.cancelEdit(spreadsheet, $cell, renderer);
        $cell.removeClass("formula").addClass("anti-formula");
        renderer.edit(value);
    },
    checkAndSaveFormulaRemoval: function(spreadsheet, $cell) {
        if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
            spreadsheet.saveCellMetadata($cell, "formula", null);
        }
    },
    /**
     * Feel free to trigger this function every time you're not sure whether the inline dialog / formula were closed.
     **/
    closeDialog: function(spreadsheet, cancelAllEditingFormulas){
        $(".tipsy.tipsy-n").remove();
        $(document).off(".playsql-inlinedialog");
        spreadsheet.$placeholder.off(".playsql-inlinedialog");
        spreadsheet.$placeholder.find(".cell-ref-inactive, .cell-ref-active").removeClass("cell-ref-inactive cell-ref-active");
        if (spreadsheet.inlinedialog && spreadsheet.inlinedialog.name == "formula-editor") {
            spreadsheet.inlinedialog.close();
        }
        var selectionManager = window.PlaySQL.Selection.forTable(spreadsheet.$placeholder);
        selectionManager.options.cssClassMap = undefined;
        if (cancelAllEditingFormulas) {
            var $editingCells = spreadsheet.$placeholder.find(".editing.formula");
            if ($editingCells.size() > 0) {
                window.PlaySQL.Spreadsheet.FormulaEditor.cancelEdit(spreadsheet, $editingCells);
            }
        }
        // Should there still be a reluctant dialog, kill it forcefully
        window.setTimeout(function(){ $("#inline-dialog-formula-editor").remove(); }, 0);
    }
};

function declassifyFormulaPartsAtCaretPosition() {
    var range = window.getSelection().rangeCount > 0 && window.getSelection().getRangeAt(0);
    if (!range || !range.collapsed) return;
    var $caretContainer = $(range.endContainer);
    // It only acts if the caret is within the formula
    $caretContainer.parents(".playsql-formula *").attr("class", "");
    return;
}

function getCurrentFormulaElement() {
    var sel = window.getSelection();
    if (!sel.rangeCount > 0) return $([]);
    var range = sel.getRangeAt(0),
        $startNode = $(range.startContainer.parentNode);
    return $startNode.closest(".subrule-value-cell, .subrule-value-range");
}

function highlightOriginCells(spreadsheet, $input, $formulaCellOrRangeElement, cssClass, cssClassToRemove) {
    var $this = $formulaCellOrRangeElement,
        columnName = $this.is(".subrule-column-identifier") ? $this.text() : $this.find(".subrule-column-identifier").first().text(),
        rowNum = $this.find(".subrule-row-id-digits").text(),
        isRange = $this.is(".subrule-value-range");
    var column = spreadsheet.colOf(columnName);
    if (!column) return;
    rowNum = rowNum.replace(/[^0-9]/g, "");

    if (isRange) {
        spreadsheet.$findColumnCells(column, true).addClass(cssClass);

    } else {
        if (!rowNum) {
            var $formulaCell = $input.closest("th,td");
            if ($formulaCell.size() == 0) return;
            rowNum = spreadsheet.getCell($formulaCell).rowId;
        } else {
            if (spreadsheet.$placeholder.find("tr[data-row-id=" + rowNum + "]").size() == 0) return;
        }
        var cell = spreadsheet.getCell(rowNum, columnName);
        if (cell) cell.$cell.addClass(cssClass).removeClass(cssClassToRemove);
    }
}
})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/spreadsheet/spreadsheet-macro-cell-properties.js' */
window.Confluence = window.Confluence || {};
window.window.PlaySQL = window.window.PlaySQL || {};
window.window.PlaySQL.Spreadsheet = window.window.PlaySQL.Spreadsheet || {};
window.window.PlaySQL.Spreadsheet.CellProperties = window.window.PlaySQL.Spreadsheet.CellProperties || {

    lastChosenColor : undefined,

    /**
     * Displays the formula editor for this cell.
     * If the cell was in edit mode, cancel it first.
     */
    display : function(spreadsheet, $cells) {
        $cells = $cells.filter("td:not(.right-padding)");
        var size = $cells.size(),
            formula = undefined;
        if (spreadsheet.inlinedialog) {
            if (spreadsheet.inlinedialog.is("#inline-dialog-cell-properties")) {
                // We just close the current cell properties - we don't open new ones
                spreadsheet.inlinedialog.close();
                return;
            }
            spreadsheet.inlinedialog.close();
        }
        if (size == 0) return;
        // If one cell, display the formula
        if (size == 1) {
            formula = spreadsheet.getCellMetadata($cells, "formula");
        } else {
            formula = $cells.filter(".formula").size() > 0;
        }

        if (typeof window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor === "undefined") {
            // Retrieve the _declared_ bgColor, not the inherited css bgColor.
            window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor = $cells.first()[0].style.backgroundColor;
        }

        // Create the inline dialog
        spreadsheet.inlinedialog && spreadsheet.inlinedialog.close && spreadsheet.inlinedialog.close();
        var inlinedialog = AJS.InlineDialog($cells, "cell-properties",
            function ($content, trigger, showPopup) {
                $content.css("width", "");
                $content.closest("#inline-dialog-cell-properties").addClass("small-inline");
                $content.html(Confluence.Templates.PlaySQL.cellProperties({
                    formula: formula,
                    cellCount: size,
                    lastChosenColor: window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor,
                    palette:
                    // Pastel palette
                    [
                    ["#202020", "#404040", "#808080", "#bfbfbf", "#f2f2f2", "transparent"],
                    ["#948a55", "#b3aa7c", "#c4bd9b", "#d5d1b5", "#e6e4d2", "#f0ece1"],
                    ["#23518b", "#2a69a8", "#3173c4", "#4785d2", "#72a1dc", "#1f497e"],
                    ["#622524", "#953736", "#d9a094", "#e6bab8", "#f5dcdb", "#c0514d"],
                    ["#4e6326", "#72933d", "#c4d69b", "#d8e4bd", "#eff1de", "#9cbb59"],
                    ["#253f61", "#346092", "#95b3d8", "#b9cee5", "#dfe6f4", "#4f82bd"],
                    ["#b38808", "#f7c121", "#fcf9af", "#feffea", "#fefaec", "#fada7b"],
                    ["#901929", "#d9253e", "#f0a7b1", "#f5c4cb", "#fae2e5", "#e66c7d"],
                    ["#403154", "#654a7b", "#b4a2c7", "#ccc1db", "#e6e4ec", "#8065a2"],
                    ["#215b68", "#32859c", "#93cddf", "#b7dfe8", "#dbeff4", "#4aacc7"],
                    ["#994808", "#e16c0a", "#fab990", "#fdd5b5", "#feeada", "#f79646"]
                    ]
                    // AUI Palette
                    /*[["transparent"],
                        ["#205081", "#4a6785", "#3572b0", "#84bbc6", "#59afe1", "#ebf2f9"],
                        ["#14892c", "#67ab49", "#8eb021"],
                        ["#654982", "#ac707a"],
                        ["#d04437", "#f15c75", "#f691b2"],
                        ["#333333", "#999999", "#cccccc", "#707070", "#f5f5f5"],
                        ["#815b3a", "#f79232", "#d39c3f", "#f6c342", "#f1a257"]]*/
                    // Confluence palette:
                    // [["#000000","#800000","#ff0000","#ff00ff","#ff99cc"],["#993300","#ff6600","#ff9900","#ffcc00","#ffcc99"],["#333300","#808000","#99cc00","#ffff00","#ffff99"],["#003300","#008000","#339966","#00ff00","#ccffcc"],["#003366","#008080","#33cccc","#00ffff","#ccffff"],["#000080","#0000ff","#3366ff","#00ccff","#99ccff"],["#333399","#666699","#800080","#993366","#cc99ff"],["#333333","#808080","#999999","#c0c0c0","#ffffff"]]
                }));
                showPopup();
                if (spreadsheet.perms.hasPerm('EDIT_ROWS_METADATA')) {
                    $content.find(".color-item, .aui-button-split-main").click(function (e) {
                        e.preventDefault();
                        var $this = $(this).is(".color-item") ? $(this) : $(this).find("span"),
                            color = $this[0].style.backgroundColor;
                        if (color == "transparent" || /[^0-9]0\)$/.test(color)) color = null;
                        window.PlaySQL.Spreadsheet.CellProperties.lastChosenColor = color;
                        $cells.each(function () {
                            var $cell = $(this);
                            if ($cell.is("td")) {
                                //$cell.css("background-color", color);
                                $content.find(".aui-button-split-main span").css("background-color", color || "");
                                spreadsheet.saveCellMetadata($cell, "background-color", color);
                            }
                        });
                        spreadsheet.sprayRequestPipe();
                    });
                }
                $content.find(".formula-recalculate").click(function(e){
                    e.preventDefault();
                    spreadsheet.recalculateFormulas($cells);
                    spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                });
                $content.find("#playsql-color-picker-background .aui-button-split-more").click(function(){
                    var $arrow = $(this);
                    // Ensure it happens after the dialog was displayed
                    window.setTimeout(function(){
                        var $el = $("#playsql-color-picker-dropdown:visible");
                        if ($el.size() == 0 || !$arrow.is(":visible")) return;
                        if ($el.offset().top > $arrow.offset().top + 50) {
                            $el.css("top", (parseInt($el.css("top")) - window.scrollY) + "px");
                        }
                    }, 0);
                });

                return false;
            }, {
                noBind: true,
                persistent: true,
                hideCallback: function () {
                    spreadsheet.inlinedialog && spreadsheet.inlinedialog.close();
                },
                hideDelay: 10000000
            }
        );
        spreadsheet.inlinedialog = inlinedialog;
        inlinedialog.close = function(){
            inlinedialog.remove();
            $(".tipsy.tipsy-n").remove();
            $("body, .playsql-spreadsheet-placeholder th").off(".playsql-inlinedialog");
            if (spreadsheet.inlinedialog == this) {
                spreadsheet.inlinedialog = undefined;
            }
        }
        var onClickOutsideInlineDialog = function (e) {
            if (!spreadsheet.inlinedialog || !spreadsheet.inlinedialog.is(":visible")) return;
            var target = e.target || this;
            var $this = $(target);
            if ($this.closest("#inline-dialog-cell-properties").size() > 0) return;
            var selectionIsCorrect = $cells.size() == $(".selected").size();
            $cells.each(function() {
                if (!$(this).hasClass("selected"))
                    selectionIsCorrect = false;
                return selectionIsCorrect;
            });
            if (selectionIsCorrect)
                return;
            spreadsheet.inlinedialog.close();
            // If we don't prevent bubbling, each of the parents will receive the same click
            return false;
        };
        $("body").on("click.playsql-inlinedialog", "*", onClickOutsideInlineDialog);
        inlinedialog.show();
        return inlinedialog;
    }
};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.playsql.playsql-base-plugin:playsql-web', location = 'assets/core/soyjs/spreadsheet-macro.soy' */
// This file was automatically generated from spreadsheet-macro.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.PlaySQL.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PlaySQL == 'undefined') { Confluence.Templates.PlaySQL = {}; }


Confluence.Templates.PlaySQL.fullTable = function(opt_data, opt_ignored) {
  var output = Confluence.Templates.PlaySQL.userParamsForm(opt_data) + '<table id="playsql-' + soy.$$escapeHtml(opt_data.name) + '" class="playsql spreadsheet ' + ((opt_data.squeeze) ? 'squeeze-mode' : '') + '"><thead>' + Confluence.Templates.PlaySQL.paginationRow({pagination: opt_data.pagination, columnCount: opt_data.columns.length - 2}) + '<tr class="playsql-col-headers">';
  var columnList18 = opt_data.columns;
  var columnListLen18 = columnList18.length;
  if (columnListLen18 > 0) {
    for (var columnIndex18 = 0; columnIndex18 < columnListLen18; columnIndex18++) {
      var columnData18 = columnList18[columnIndex18];
      output += (! columnData18.statusPosition) ? '<th data-name="' + soy.$$escapeHtml(columnData18.name) + '" title="' + soy.$$escapeHtml(columnData18.name) + '" data-type="' + soy.$$escapeHtml(columnData18.type) + '" data-renderer="' + soy.$$escapeHtml(columnData18.renderer) + '" data-view-renderer="' + soy.$$escapeHtml(columnData18.viewRenderer ? columnData18.viewRenderer : '') + '"' + ((columnData18.statusPK) ? 'data-status-pk="true" title="' + soy.$$escapeHtml("Click on the red cell to open the spreadsheet editor") + '"' : '') + ((columnData18.statusPosition) ? 'data-status-position="true"' : '') + '>' + soy.$$escapeHtml(columnData18.label) + ((opt_data.whereClauseColumnFilters && opt_data.whereClauseColumnFilters[columnData18.name] && opt_data.whereClauseColumnFilters[columnData18.name].length > 0) ? '&nbsp;<span class="aui-icon aui-icon-small playsql-filtericon">(Filtered)</span>' : '') + '</th>' : '';
    }
  } else {
    output += '<th><a href="' + soy.$$escapeHtml(opt_data.editorUrl) + '" target="_blank">&nbsp;</a></th><th>&nbsp;</th>';
  }
  output += '<th class="add-column right-padding"><a href="#" title="' + soy.$$escapeHtml("Cliquez pour ajouter une nouvelle colonne.") + '">' + soy.$$escapeHtml("Ajouter une colonne") + '</a></th></tr>';
  var img__soy56 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAA3NCSVQICAjb4U/gAAAAG1BMVEX///87c687c687c687c687c687c6////87c68225wXAAAACXRSTlMAEWaqu8zu///VQmatAAAACXBIWXMAAAsSAAALEgHS3X78AAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABR0RVh0Q3JlYXRpb24gVGltZQA2LzEvMTM4qUXQAAAARklEQVQImWNgYFDu6DBiAALRDiAIZGBgzAAx2gQYWDvAIIBBo6OjvaKjo4nBA8JoYeiAAhADJIKNAVcM1w43EG4F3FKYMwD5VTVUBOW+rQAAAABJRU5ErkJggg==';
  output += ((opt_data.recoverableErrorMessage) ? '<tr class="playsql-message recoverable"><th>&nbsp;</th><td colspan="' + soy.$$escapeHtml(Math.max(2, opt_data.columns.length - 1)) + '"><div class="playsql-message-inner"><p><img src="' + soy.$$escapeHtml(img__soy56) + '" width="16" height="16" align="absmiddle" alt="" border="0" />&nbsp;' + soy.$$escapeHtml(opt_data.recoverableErrorMessage) + '<br/></p></div></td></tr>' : (opt_data.data.length == 0) ? '<tr class="playsql-message"><th>&nbsp;</th><td colspan="' + soy.$$escapeHtml(opt_data.columns.length - 1) + '"><div class="playsql-message-inner"><p><img src="' + soy.$$escapeHtml(img__soy56) + '" width="16" height="16" align="absmiddle" alt="" border="0"/>&nbsp;' + ((opt_data.customEmptyMessage) ? soy.$$escapeHtml(opt_data.customEmptyMessage) : soy.$$escapeHtml("Pas de donn\xe9es dans cette table.")) + '<br/></p></div></td></tr>' : '') + '</thead><tbody>';
  var rowList79 = opt_data.data;
  var rowListLen79 = rowList79.length;
  for (var rowIndex79 = 0; rowIndex79 < rowListLen79; rowIndex79++) {
    var rowData79 = rowList79[rowIndex79];
    output += Confluence.Templates.PlaySQL.oneRow({row: rowData79});
  }
  output += '</tbody>' + Confluence.Templates.PlaySQL.totalsRow({totals: opt_data.totals, pagination: opt_data.pagination, columnCount: opt_data.columns.length - 2}) + '</table><div id="custom-menu" class="aui-dropdown2 aui-style-default"></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.fullTable.soyTemplateName = 'Confluence.Templates.PlaySQL.fullTable';
}


Confluence.Templates.PlaySQL.totalsRow = function(opt_data, opt_ignored) {
  var output = '<tfoot>';
  if (opt_data.totals) {
    output += '<tr class="totals-row"><th class="add-row"><a href="#">' + soy.$$escapeHtml("Ajouter une ligne") + '</a></th>';
    var cellList96 = opt_data.totals;
    var cellListLen96 = cellList96.length;
    for (var cellIndex96 = 0; cellIndex96 < cellListLen96; cellIndex96++) {
      var cellData96 = cellList96[cellIndex96];
      output += '<td colspan="' + soy.$$escapeHtml(cellData96.first) + '"><span class="total-label">' + soy.$$escapeHtml(cellData96.second) + ' </span><span class="total-value">' + soy.$$escapeHtml(cellData96.third) + '</span></td>';
    }
    output += '<td class="right-padding">&nbsp;</td></tr>';
  } else {
    output += '<tr class="totals-row"><th class="add-row"><a href="#">' + soy.$$escapeHtml("Ajouter une ligne") + '</a></th><td colspan="' + soy.$$escapeHtml(opt_data.columnCount) + '" class="edit-on-first-click">&nbsp;</td><td class="right-padding">&nbsp;</td></tr>';
  }
  output += Confluence.Templates.PlaySQL.paginationRow(opt_data) + '</tfoot>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.totalsRow.soyTemplateName = 'Confluence.Templates.PlaySQL.totalsRow';
}


Confluence.Templates.PlaySQL.paginationRow = function(opt_data, opt_ignored) {
  return '' + ((opt_data.pagination) ? '<tr class="pagination-row"><td colspan="' + soy.$$escapeHtml(opt_data.columnCount + 2) + '"><a href="#" class="pagination-squeeze aui-icon aui-icon-small aui-iconfont-custom-bullet playsql-tipsy" title="Reduce margins to squeeze more data on the screen">Squeeze</a><a href="#" class="pagination-full-screen aui-icon aui-icon-small aui-iconfont-focus playsql-tipsy" title="Full screen">Full screen</a>' + ((opt_data.pagination.firstPage == null) ? '<span class="pagination-first pagination-number active">&lt;&lt;</span>' : '<a href="#" class="pagination-first pagination-number" data-offset="' + soy.$$escapeHtml(opt_data.pagination.firstPage) + '">&lt;&lt;</a>') + ((opt_data.pagination.previousPage == null) ? '<span class="pagination-previous pagination-number active">&lt;</span>' : '<a href="#" class="pagination-previous pagination-number" data-offset="' + soy.$$escapeHtml(opt_data.pagination.previousPage) + '">&lt;</a>') + '&nbsp;' + soy.$$escapeHtml(opt_data.pagination.offset + 1) + ' &ndash; ' + soy.$$escapeHtml(opt_data.pagination.pageEnd + 1) + '&nbsp; of ' + soy.$$escapeHtml(opt_data.pagination.count) + ((opt_data.pagination.limit < 100000) ? '&nbsp; (<a href="#" class="pagination-see-all-rows" data-limit="1000000">See all</a>) &nbsp;' : '') + ((opt_data.pagination.nextPage == null) ? '<span class="pagination-next pagination-number active">&gt;</span>' : '<a href="#" class="pagination-next pagination-number" data-offset="' + soy.$$escapeHtml(opt_data.pagination.nextPage) + '">&gt;</a>') + ((opt_data.pagination.lastPage == null) ? '<span class="pagination-last pagination-number active">&gt;&gt;</span>' : '<a href="#" class="pagination-last pagination-number" data-offset="' + soy.$$escapeHtml(opt_data.pagination.lastPage) + '">&gt;&gt;</a>') + '</td></tr>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.paginationRow.soyTemplateName = 'Confluence.Templates.PlaySQL.paginationRow';
}


Confluence.Templates.PlaySQL.oneRow = function(opt_data, opt_ignored) {
  var output = '';
  var rowId__soy210 = opt_data.row[0][0] ? opt_data.row[0][0] : '';
  var position__soy211 = opt_data.row[1][0] ? opt_data.row[1][0] : '';
  output += '<tr data-row-id="' + soy.$$escapeHtml(rowId__soy210) + '" data-row-metadata="' + soy.$$escapeHtml(position__soy211) + '">';
  var cellList217 = opt_data.row;
  var cellListLen217 = cellList217.length;
  for (var cellIndex217 = 0; cellIndex217 < cellListLen217; cellIndex217++) {
    var cellData217 = cellList217[cellIndex217];
    if (cellIndex217 == 0) {
      output += '<th data-value="' + soy.$$escapeHtml(cellData217[0] ? cellData217[0] : '') + '" data-saved-value="' + soy.$$escapeHtml(cellData217[0] ? cellData217[0] : '') + '">' + soy.$$escapeHtml(rowId__soy210) + '</th>';
    } else if (cellIndex217 != 1) {
      var value__soy228 = '' + soy.$$escapeHtml(cellData217[0] != null ? cellData217[0] : '');
      var rawValue__soy230 = '' + soy.$$escapeHtml(cellData217[1] != null ? cellData217[1] : '');
      output += '<td ' + ((cellData217[3]) ? 'class="' + soy.$$escapeHtml(cellData217[3]) + '"' : '') + ' ' + ((cellData217[4]) ? 'style="' + soy.$$escapeHtml(cellData217[4]) + '"' : '') + ' data-value="' + soy.$$filterNoAutoescape(rawValue__soy230) + '">' + soy.$$filterNoAutoescape(cellData217[2]) + '</td>';
    }
  }
  output += '<td class="right-padding">&nbsp;</td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.oneRow.soyTemplateName = 'Confluence.Templates.PlaySQL.oneRow';
}


Confluence.Templates.PlaySQL.userParamsForm = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.useForm) {
    if (opt_data.userParameters && opt_data.userParameters.length > 0) {
      output += '<form class="aui"><div class="playsql-user-parameters-form">';
      var paramList259 = opt_data.userParameters;
      var paramListLen259 = paramList259.length;
      for (var paramIndex259 = 0; paramIndex259 < paramListLen259; paramIndex259++) {
        var paramData259 = paramList259[paramIndex259];
        output += '<div class="field-group"><label for="user-parameter-' + soy.$$escapeHtml(paramData259.name) + '">' + soy.$$escapeHtml(paramData259.label) + '</label><input class="text" type="text" class="playsql-user-parameter" id="user-parameter-' + soy.$$escapeHtml(paramData259.cleanName) + '" name="user-parameter-' + soy.$$escapeHtml(paramData259.cleanName) + '" value="' + soy.$$escapeHtml(paramData259.valueOrDefault) + '"></div>';
      }
      output += '<div class="buttons-container"><div class="buttons"><input class="button submit" type="submit" value="Run" id="user-parameter-run-query">' + ((opt_data.useCache) ? '<a class="cancel" id="user-parameter-refresh-query">Refresh the cache</a>' : '') + '</div></div></div></form>';
    } else if (opt_data.useCache) {
      output += '<a href="#" id="user-parameter-refresh-query">Refresh the cache for this table</a>';
    }
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.userParamsForm.soyTemplateName = 'Confluence.Templates.PlaySQL.userParamsForm';
}


Confluence.Templates.PlaySQL.columnPropertiesDetails = function(opt_data, opt_ignored) {
  return '<form class="aui"><div class="aui-toolbar2"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-secondary"><div class="aui-buttons"><a class="btn-cancel" href="#">' + soy.$$escapeHtml("Annuler") + '</a><a class="aui-button btn-submit playsql-tipsy" href="#" title="' + soy.$$escapeHtml("Enregistrer") + '"><span class="aui-icon aui-icon-small aui-iconfont-success">' + soy.$$escapeHtml("Enregistrer") + '</span></a></div><div class="aui-buttons">' + ((! opt_data.isFirst) ? '<a class="aui-button playsql-fulltext-button playsql-tipsy btn-move-left" href="#" title="' + soy.$$escapeHtml("Move this column to the left. All instances of this spreadsheet will display columns in the same order.") + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '>&lt;</a>' : '') + ((! opt_data.isLast) ? '<a class="aui-button playsql-fulltext-button playsql-tipsy btn-move-right" href="#" title="' + soy.$$escapeHtml("Move this column to the right. All instances of this spreadsheet will display columns in the same order.") + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '>&gt;</a>' : '') + '</div><div class="aui-buttons"><a class="aui-button btn-delete playsql-tipsy" href="#" title="' + soy.$$escapeHtml("Supprimer la colonne") + '" ' + ((! opt_data.hasColBEPerm) ? 'aria-disabled="true"' : '') + '><span class="aui-icon aui-icon-small aui-iconfont-delete">' + soy.$$escapeHtml("Supprimer la colonne") + '</span></a></div></div></div></div><table border="0" class="advanced-properties"><tbody><tr><td>' + soy.$$escapeHtml("Libell\xe9 :") + '</td><td><input class="text column-label" value="' + soy.$$escapeHtml(opt_data.column.label) + '" ' + ((! opt_data.hasColFEPerm) ? 'disabled="disabled"' : '') + '/></td></tr><tr><td>' + soy.$$escapeHtml("Nom :") + '</td><td><input class="text column-name" value="' + soy.$$escapeHtml(opt_data.column.name) + '" ' + ((! opt_data.hasColBEPerm) ? 'disabled="disabled"' : '') + '/></td></tr><tr><td>' + soy.$$escapeHtml("CLF:") + '</td><td><input class="text column-formula long-field" value="' + soy.$$escapeHtml(opt_data.column.formula ? opt_data.column.formula : '') + '" ' + ((! opt_data.hasColBEPerm) ? 'disabled="disabled"' : '') + '/><div id="dropdown-wizards" class="aui-dropdown2 aui-style-default"><ul class="aui-list-truncate"><li><a href="#" class="wizardForeignKey">' + soy.$$escapeHtml("\x3d Afficher une valeur d\x27une autre table") + '</a></li><li><a href="#" class="wizardGMaps">' + soy.$$escapeHtml("\x3d Cr\xe9er un lien d\x27une adresse vers Google Maps") + '</a></li><li><a href="http://documentation.play-sql.com/display/PUBLIC/Formulas" target="_blank">' + soy.$$escapeHtml("? Aide sur les formules") + '</a></li></ul></div></td></tr>' + ((opt_data.hasColBEPerm) ? '<tr class="formula-helpers"><td>&nbsp;</td><td><div class="description">' + soy.$$filterNoAutoescape(AJS.format("Entrez \x27\x27\x27\x3d\x27\x27\x27 pour \x3ca href\x3d\x22{0}\x22 {1}\x3el\x27\x27\x27assistant Formules\x3c/a\x3e\x26nbsp; ou \x3ca href\x3d\x22{2}\x22 target\x3d\x22_blank\x22\x3etrouvez de l\x27\x27aide\x3c/a\x3e.",'#','class="show-wizards aui-dropdown2-trigger" aria-owns="dropdown-wizards" aria-haspopup="true"','http://documentation.play-sql.com/display/PUBLIC/Formulas')) + '</div></td></tr>' : '') + '<tr class="remove-when-show-advanced-details"><td>&nbsp;</td><td><div class="aui-toolbar2"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-primary"><div class="aui-buttons"><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="euro" href="#" title="' + soy.$$escapeHtml("Euro") + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-euro">' + soy.$$escapeHtml("Euro") + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="dollar" href="#" title="' + soy.$$escapeHtml("Dollar") + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-dollar">' + soy.$$escapeHtml("Dollar") + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="integer" href="#" title="' + soy.$$escapeHtml("Entier") + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-number">' + soy.$$escapeHtml("Entier") + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="decimal" href="#" title="' + soy.$$escapeHtml("D\xe9cimal") + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-zeroes">' + soy.$$escapeHtml("D\xe9cimal") + '</span></a></div><div class="aui-buttons"><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="markdown" href="#" title="' + soy.$$escapeHtml("Markdown (texte enrichi). Voir laide.") + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-markdown">' + soy.$$escapeHtml("Markdown (texte enrichi). Voir laide.") + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="text" href="#" title="' + soy.$$escapeHtml("Texte") + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-text">' + soy.$$escapeHtml("Texte") + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="link" href="#" title="' + soy.$$escapeHtml("Lien") + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-link">' + soy.$$escapeHtml("Lien") + '</span></a></div><div class="aui-buttons"><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="boolean" href="#" title="' + soy.$$escapeHtml("Bool\xe9en") + '"><span class="aui-icon aui-icon-small playsql-iconfont playsql-iconfont-boolean">' + soy.$$escapeHtml("Bool\xe9en") + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="date-picker" href="#" title="' + soy.$$escapeHtml("Calendrier") + '"><span class="aui-icon aui-icon-small aui-iconfont-calendar">' + soy.$$escapeHtml("Calendrier") + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="user-picker" href="#" title="' + soy.$$escapeHtml("S\xe9lection dutilisateurs") + '"><span class="aui-icon aui-icon-small aui-iconfont-user">' + soy.$$escapeHtml("S\xe9lection dutilisateurs") + '</span></a><a class="aui-button quick-renderer playsql-tipsy" data-quick-renderer="page-picker" href="#" title="' + soy.$$escapeHtml("S\xe9lection de page") + '"><span class="aui-icon aui-icon-small aui-iconfont-doc aui-iconfont-page-default">' + soy.$$escapeHtml("S\xe9lection de page") + '</span></a></div></div></div></div></td></tr><tr class="formula-helpers"><td>' + soy.$$escapeHtml("Formats") + '</td><td><input type="checkbox" class="column-word-wrap test" id="column-word-wrap" ' + ((opt_data.column.formats && opt_data.column.formats.wordwrap == 'true') ? ' checked="on" ' : '') + ' /><label for="column-word-wrap">' + soy.$$escapeHtml("Wrap text on several lines.") + '</label></td></tr><tr class="remove-when-show-advanced-details"><td>&nbsp;</td><td><a href="#" class="btn-advanced">' + soy.$$escapeHtml("Avanc\xe9...") + '</a></td></tr></tbody></table><div class="error"></div><div class="button-panel" id="inline-dialog-col-properties-submit-panel"><a class="aui-button btn-submit" href="#">' + soy.$$escapeHtml("Enregistrer") + '</a><a href="#" class="cancel btn-cancel">' + soy.$$escapeHtml("Annuler") + '</a></div></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesDetails.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesDetails';
}


Confluence.Templates.PlaySQL.columnPropertiesInlineDialog = function(opt_data, opt_ignored) {
  return '<form class="aui"><div class="aui-toolbar2"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-primary"><div class="aui-buttons"><a class="aui-button btn-properties playsql-tipsy" href="#" title="' + soy.$$escapeHtml("Configure. Get detailed options about the column properties, including the type, length, number of decimals, currency, renderer.") + '" ' + ((! opt_data.hasColFEPerm) ? 'aria-disabled="true"' : '') + '><span class="aui-icon aui-icon-small aui-iconfont-configure">' + soy.$$escapeHtml("Propri\xe9t\xe9s") + '</span></a></div><div class="aui-buttons"><a href="#" class="aui-button orderby-selector ' + ((opt_data.orderbyDef.way == 'DESC') ? 'sort-asc' : (opt_data.orderbyDef.way == 'ASC') ? 'sort-none' : 'sort-desc') + '">' + ((opt_data.orderbyDef.way == 'DESC') ? soy.$$escapeHtml("Tri: DESC") : (opt_data.orderbyDef.way == 'ASC') ? soy.$$escapeHtml("Tri: ASC") : soy.$$escapeHtml("Non tri\xe9")) + '</a><button class="aui-button aui-dropdown2-trigger aui-button-split-more" aria-haspopup="true" aria-owns="null-sorting-dropdown">' + soy.$$escapeHtml("Nulls") + '</button></div><div id="null-sorting-dropdown" class="aui-dropdown2 aui-style-default" data-dropdown2-alignment="left"><div class="aui-dropdown2-section"><ul class="aui-list-truncate"><li><a href="#" class="aui-dropdown2-radio sort-none ' + ((opt_data.orderbyDef.way != 'DESC' && opt_data.orderbyDef.way != 'ASC') ? 'checked' : '') + '">' + soy.$$escapeHtml("Non tri\xe9") + '</a></li><li><a href="#" class="aui-dropdown2-radio sort-desc ' + ((opt_data.orderbyDef.way == 'DESC') ? 'checked' : '') + '">' + soy.$$escapeHtml("Descendant") + '</a></li><li><a href="#" class="aui-dropdown2-radio sort-asc ' + ((opt_data.orderbyDef.way == 'ASC') ? 'checked' : '') + '">' + soy.$$escapeHtml("Ascendant") + '</a></li></ul></div><div class="aui-dropdown2-section"><ul class="aui-list-truncate"><li><a href="#" class="aui-dropdown2-radio nulls-default ' + ((opt_data.orderbyDef.nulls != 'FIRST' && opt_data.orderbyDef.nulls != 'LAST' && opt_data.orderbyDef.way != null) ? 'checked' : '') + '">' + soy.$$escapeHtml("D\xe9faut") + '</a></li><li><a href="#" class="aui-dropdown2-radio nulls-first ' + ((opt_data.orderbyDef.nulls == 'FIRST') ? 'checked' : '') + '">' + soy.$$escapeHtml("Nulls en premier") + '</a></li><li><a href="#" class="aui-dropdown2-radio nulls-last ' + ((opt_data.orderbyDef.nulls == 'LAST') ? 'checked' : '') + '">' + soy.$$escapeHtml("Nulls en dernier") + '</a></li></ul></div></div><div class="aui-buttons"><input id="playsql-inline-filter5" type="hidden" class="filter-input5"></div></div></div></div></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesInlineDialog.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesInlineDialog';
}


Confluence.Templates.PlaySQL.columnPropertiesAdvanced = function(opt_data, opt_ignored) {
  var output = '<tr class="format-details"><td colspan="2"><h3>' + soy.$$escapeHtml("Propri\xe9t\xe9s de la colonne de base de donn\xe9es") + '</h3></td></tr><tr class="for-type"><td>' + soy.$$escapeHtml("Type :") + '</td><td><select class="select" id="column-type" name="type" title="' + soy.$$escapeHtml("S\xe9lectionnez un type pour vos donn\xe9es") + '"' + ((! opt_data.canChangeBackEndCols) ? 'disabled="on"' : '') + '>';
  var typeList485 = opt_data.dataTypes;
  var typeListLen485 = typeList485.length;
  for (var typeIndex485 = 0; typeIndex485 < typeListLen485; typeIndex485++) {
    var typeData485 = typeList485[typeIndex485];
    output += '<option value="' + soy.$$escapeHtml(typeData485.name) + '"' + ((typeData485.name == opt_data.coltype) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(typeData485.label != null ? typeData485.label : typeData485.name) + '</option>';
  }
  output += '</select><div class="description"></div><div class="error" class="hidden"></div></td></tr><tr class="' + ((opt_data.length == null) ? 'hidden' : '') + ' for-length"><td>Length</td><td><input class="text" id="column-length" name="length" value="' + soy.$$escapeHtml(opt_data.length != null ? opt_data.length : '') + '"/><div class="error" class="hidden"></div></td></tr><tr class="for-renderer ' + ((opt_data.hasFormula) ? 'hidden' : '') + '"><td>' + soy.$$escapeHtml("Rendu") + '</td><td><select class="select" id="column-renderer" name="renderer" title="' + soy.$$escapeHtml("S\xe9lectionnez le rendu \xe0 utiliser pour \xe9diter la donn\xe9e") + '"><optgroup label="Same type (' + soy.$$escapeHtml(opt_data.coltype) + ')">';
  var rendererItemList513 = opt_data.renderers.sameTypeRenderers;
  var rendererItemListLen513 = rendererItemList513.length;
  for (var rendererItemIndex513 = 0; rendererItemIndex513 < rendererItemListLen513; rendererItemIndex513++) {
    var rendererItemData513 = rendererItemList513[rendererItemIndex513];
    output += '<option value="' + soy.$$escapeHtml(rendererItemData513.key) + '"' + ((rendererItemData513.key == opt_data.renderer) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(rendererItemData513.name) + '</option>';
  }
  output += '</optgroup></select><div class="description"></div><div class="error" class="hidden"></div></td></tr><tr class="for-view-renderer ' + ((! opt_data.hasFormula) ? 'hidden' : '') + '"><td>' + soy.$$escapeHtml("Rendu de la formule") + '</td><td><select class="select" id="view-renderer" name="view-renderer" title="' + soy.$$escapeHtml("S\xe9lectionnez un rendu pour afficher vos donn\xe9es") + '"><optgroup label="Same type (' + soy.$$escapeHtml(opt_data.coltype) + ')">';
  var rendererItemList535 = opt_data.renderers.sameTypeRenderers;
  var rendererItemListLen535 = rendererItemList535.length;
  for (var rendererItemIndex535 = 0; rendererItemIndex535 < rendererItemListLen535; rendererItemIndex535++) {
    var rendererItemData535 = rendererItemList535[rendererItemIndex535];
    output += '<option value="' + soy.$$escapeHtml(rendererItemData535.key) + '"' + ((rendererItemData535.key == opt_data.viewRenderer) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(rendererItemData535.name) + '</option>';
  }
  output += '</optgroup>';
  if (opt_data.canChangeBackEndCols) {
    output += '<optgroup label="Different type">';
    var rendererItemList550 = opt_data.renderers.otherTypeRenderers;
    var rendererItemListLen550 = rendererItemList550.length;
    for (var rendererItemIndex550 = 0; rendererItemIndex550 < rendererItemListLen550; rendererItemIndex550++) {
      var rendererItemData550 = rendererItemList550[rendererItemIndex550];
      output += '<option value="' + soy.$$escapeHtml(rendererItemData550.key) + '" ' + ((rendererItemData550.key == opt_data.viewRenderer) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(rendererItemData550.name) + '</option>';
    }
    output += '</optgroup>';
  }
  output += '</select><div class="description">' + soy.$$escapeHtml("Rend le r\xe9sultat de la formule. V\xe9rifiez que le type convient \xe0 la formule (selon que ce soit un entier, une date, du texte...)") + '</div><div class="error" class="hidden"></div></td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesAdvanced.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesAdvanced';
}


Confluence.Templates.PlaySQL.columnPropertiesJoint = function(opt_data, opt_ignored) {
  return '' + ((opt_data.jointIdColumn) ? '<tr><td>' + soy.$$escapeHtml("Joint ID") + '</td><td><input class="text" id="column-joint-id" name="column-joint-id" value="' + soy.$$escapeHtml(opt_data.jointIdColumn) + '" disabled="disabled"/><div class="description">' + soy.$$escapeHtml("All edits will be saved in the joint table. See the Joint ID column for more info.") + '</div><div class="error"></div></td></tr><tr><td>' + soy.$$escapeHtml("Joint column") + '</td><td><input class="text" id="column-joint-column" name="column-joint-column" ' + ((opt_data.jointColumn) ? 'value="' + soy.$$escapeHtml(opt_data.jointColumn) + '"' : '') + ' disabled="disabled"/><div class="description">' + soy.$$escapeHtml(AJS.format("Name of the column in \x22{$jointTable}\x22. Optional.",opt_data.jointTable)) + ' </div><div class="error"></div></td></tr>' : '<tr><td>' + soy.$$escapeHtml("Joint table") + '</td><td><div class="free-text-in-form"></div><input class="text" id="column-joint-id" name="column-joint-id" value="' + soy.$$escapeHtml(opt_data.jointTable) + '" disabled="disabled"/><div class="description">' + soy.$$escapeHtml("All edits will be saved in the joint table.") + '</div><div class="error"></div></td></tr><tr><td>' + soy.$$escapeHtml("Joint FK") + '</td><td><div class="free-text-in-form"></div><input class="text" id="column-joint-fk" name="column-joint-fk" value="' + soy.$$escapeHtml(opt_data.jointFK) + '" disabled="disabled"/><div class="description">' + soy.$$escapeHtml("The foreign key (FK) column.") + '</div><div class="error"></div></td></tr>');
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesJoint.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesJoint';
}


Confluence.Templates.PlaySQL.columnPropertiesDateFormatField = function(opt_data, opt_ignored) {
  var output = '<tr class="format-details"><td for="dateFormat">' + soy.$$escapeHtml("Format d\x27affichage") + '</td><td><input class="text" id="column-dateFormat" name="dateFormat" ' + ((opt_data.dateFormat) ? 'value="' + soy.$$escapeHtml(opt_data.dateFormat) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml("Optionnel. Exemple: \x22yyyy-MM-dd\x22 ou \x22ddd dd/MM/yyyy\x22") + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['dateFormat']) {
    var errorList613 = opt_data.fieldErrors['dateFormat'];
    var errorListLen613 = errorList613.length;
    for (var errorIndex613 = 0; errorIndex613 < errorListLen613; errorIndex613++) {
      var errorData613 = errorList613[errorIndex613];
      output += '<div class="error">' + soy.$$escapeHtml(errorData613) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesDateFormatField.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesDateFormatField';
}


Confluence.Templates.PlaySQL.columnPropertiesMarkdown = function(opt_data, opt_ignored) {
  return '<tr class="format-details"><td></td><td><p>The cells will be rendered using the <a href="https://github.com/sirthias/pegdown">PegDown</a> syntax:</p><ul><li>*One star*: <em>Emphasis</em></li><li>**Two stars**: <b>Bold</b></li><li>`Back-quotes`: <code>Code</code></li><li>![Alt text](/path/to/img.jpg): Image</li><li>&lt;http://example.com&gt;: Links</li><li># Hash: Title</li><li>## Double Hash: Sub-title</li><li>* Star (at the beginning of the line): List</li></td></tr>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesMarkdown.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesMarkdown';
}


Confluence.Templates.PlaySQL.columnPropertiesCurrencyField = function(opt_data, opt_ignored) {
  var output = '<tr class="format-details"><td colspan="2"><h3>' + soy.$$escapeHtml("D\xe9tail du rendu mon\xe9taire") + '</h3></td></tr><tr class="format-details"><td for="aboveZero">' + soy.$$escapeHtml("Nombre positif") + '</td><td><input class="text" id="column-aboveZero" name="aboveZero" ' + ((opt_data.aboveZero) ? 'value="' + soy.$$escapeHtml(opt_data.aboveZero) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml("Exemple: \x22$ #,##0.00\x22 ou \x22# ##0,00 \u20ac\x22") + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['aboveZero']) {
    var errorList639 = opt_data.fieldErrors['aboveZero'];
    var errorListLen639 = errorList639.length;
    for (var errorIndex639 = 0; errorIndex639 < errorListLen639; errorIndex639++) {
      var errorData639 = errorList639[errorIndex639];
      output += '<div class="error">' + soy.$$escapeHtml(errorData639) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</td></tr><tr class="format-details"><td for="equalZero">' + soy.$$escapeHtml("Z\xe9ro") + '</td><td><input class="text" id="column-equalZero" name="equalZero" ' + ((opt_data.equalZero) ? 'value="' + soy.$$escapeHtml(opt_data.equalZero) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml("Optionnel") + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['equalZero']) {
    var errorList659 = opt_data.fieldErrors['equalZero'];
    var errorListLen659 = errorList659.length;
    for (var errorIndex659 = 0; errorIndex659 < errorListLen659; errorIndex659++) {
      var errorData659 = errorList659[errorIndex659];
      output += '<div class="error">' + soy.$$escapeHtml(errorData659) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</td></tr><tr class="format-details"><td for="belowZero">' + soy.$$escapeHtml("Nombres n\xe9gatifs") + '</td><td><input class="text" id="column-belowZero" name="belowZero" ' + ((opt_data.belowZero) ? 'value="' + soy.$$escapeHtml(opt_data.belowZero) + '"' : '') + '/><div class="description">' + soy.$$escapeHtml("Optionnel. Exemple: \x22darkred;$# ###.00\x22") + '</div>';
  if (opt_data.fieldErrors && opt_data.fieldErrors['belowZero']) {
    var errorList679 = opt_data.fieldErrors['belowZero'];
    var errorListLen679 = errorList679.length;
    for (var errorIndex679 = 0; errorIndex679 < errorListLen679; errorIndex679++) {
      var errorData679 = errorList679[errorIndex679];
      output += '<div class="error">' + soy.$$escapeHtml(errorData679) + '</div>';
    }
  } else {
    output += '<div class="error" class="hidden"></div>';
  }
  output += '</td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesCurrencyField.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesCurrencyField';
}


Confluence.Templates.PlaySQL.columnPropertiesValueMappingField = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<tr class="format-details"><td colspan="2"><h3>' + soy.$$escapeHtml("D\xe9tail du rendu en ic\xf4ne") + '</h3></td></tr><tr class="format-details"><td>' + soy.$$escapeHtml("Mapping de valeurs") + '</td><td><p>' + soy.$$filterNoAutoescape(AJS.format("Associer les valeurs \xe0 des ic\xf4nes. Entrez la \x3ca href\x3d\x22{0}\x22\x3eclasse CSS\x3c/a\x3e ou la \x3ca href\x3d\x22{1}\x22\x3edata url\x3c/a\x3e.",'https://developer.atlassian.com/design/latest/iconography.html','http://dataurl.net/#dataurlmaker')) + '</p><table class="aui aui-table-interactive" id="value-mappings"><thead><tr><th>' + soy.$$escapeHtml("Valeur") + '</th><th>' + soy.$$escapeHtml("Ic\xf4ne") + '</th><th><a class="add" href="#" title="' + soy.$$escapeHtml("Ajouter un mapping") + '"><span class="aui-icon aui-icon-small aui-iconfont-add" data-unicode="UTF+E002" original-title="">' + soy.$$escapeHtml("Ajouter un mapping") + '</span></a></th></tr></thead><tbody>';
  var keyList704 = soy.$$getMapKeys(opt_data.mappings);
  var keyListLen704 = keyList704.length;
  for (var keyIndex704 = 0; keyIndex704 < keyListLen704; keyIndex704++) {
    var keyData704 = keyList704[keyIndex704];
    output += Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow({key: keyData704, value: opt_data.mappings[keyData704]});
  }
  output += '</tbody></table></td></tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesValueMappingField.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesValueMappingField';
}


Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow = function(opt_data, opt_ignored) {
  return '<tr><td><input type="text" value="' + soy.$$escapeHtml(opt_data.key) + '" name="key"></td><td><input type="text" value="' + soy.$$escapeHtml(opt_data.value) + '" name="value"></td><td><a href="#" class="remove-mapping" title="' + soy.$$escapeHtml("Retirer") + '"><span class="aui-icon aui-icon-small aui-iconfont-remove">' + soy.$$escapeHtml("Retirer") + '</span></a></td></tr>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow.soyTemplateName = 'Confluence.Templates.PlaySQL.columnPropertiesValueMappingRow';
}


Confluence.Templates.PlaySQL.wizardGMapsInlineDialog = function(opt_data, opt_ignored) {
  var output = '<form class="aui" id="wizard-gmaps-dialog"><h2>' + soy.$$escapeHtml("Assistant formules: Afficher un lien") + '</h2><fieldset><div class="field-group sourcecolumn"><label for="sourcecolumn">' + soy.$$escapeHtml("Colonne source") + '<span class="aui-icon icon-required"> required</span></label><select class="select long-field" id="sourcecolumn" name="sourcecolumn" title="' + soy.$$escapeHtml("Choisissez quelle colonne contient l\x27expression recherch\xe9e") + '">';
  var columnList728 = opt_data.columns;
  var columnListLen728 = columnList728.length;
  for (var columnIndex728 = 0; columnIndex728 < columnListLen728; columnIndex728++) {
    var columnData728 = columnList728[columnIndex728];
    output += '<option value="' + soy.$$escapeHtml(columnData728.name) + '"' + ((columnData728.name == opt_data.currentcolumn) ? 'selected="selected"' : '') + '>' + soy.$$escapeHtml(columnData728.label) + '</option>';
  }
  output += '</select></div><div class="field-group url"><label for="url">' + soy.$$escapeHtml("URL") + '<span class="aui-icon icon-required"> required</span></label><input class="text long-field" type="text" id="url" name="url" value="http://maps.google.com?q=%s"><div class="description">' + soy.$$escapeHtml("%s sera remplac\xe9 par l\x27expression recherch\xe9e") + '</div></div></fieldset><fieldset class="group"><legend><span>' + soy.$$escapeHtml("Libell\xe9 :") + '</span></legend><div class="radio"><input class="radio" type="radio" name="display" id="display-link"><label for="display-link">' + soy.$$escapeHtml("Afficher le lien") + '</label></div><div class="radio"><input class="radio" type="radio" checked="checked" name="display" id="display-field"><label for="display-field">' + soy.$$escapeHtml("Afficher l\x27expression recherch\xe9e") + '</label></div><div class="radio"><input class="radio" type="radio" name="display" id="display-label"><label for="display-label">' + soy.$$escapeHtml("Afficher le texte fixe \x27Link\x27") + '</label></div></fieldset><fieldset class="group hidden"><legend><span>' + soy.$$escapeHtml("Format") + '</span></legend><div class="checkbox"><input class="checkbox" type="checkbox" name="convert-to-sql" id="convert-to-sql"/><label for="convert-to-sql">' + soy.$$escapeHtml("Convertir la formule en SQL") + '</label></div></fieldset><div class="error"></div><div class="button-panel"><a class="aui-button btn-submit" href="#">' + soy.$$escapeHtml("Terminer") + '</a></div></form>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.wizardGMapsInlineDialog.soyTemplateName = 'Confluence.Templates.PlaySQL.wizardGMapsInlineDialog';
}


Confluence.Templates.PlaySQL.wizardForeignKeyInlineDialog = function(opt_data, opt_ignored) {
  return '<form class="aui" id="wizard-foreign-key-dialog"><h2>' + soy.$$escapeHtml("Assistant Formule: Cl\xe9 \xe9trang\xe8re") + '</h2><fieldset><h3>Label</h3><div class="field-group targettable"><label for="targettable">' + soy.$$escapeHtml("Table cible") + '</label><select class="select long-field" id="targettable" name="targettable" title="' + soy.$$escapeHtml("Choisissez la table dans laquelle la valeur doit \xeatre recherch\xe9e") + '"></select></div><div class="field-group targetlabel"><label for="targetlabel">Label</label><select class="select long-field" id="targetlabel" name="targetlabel" title="' + soy.$$escapeHtml("Choisissez la valeur \xe0 afficher") + '"></select></div><h3>ID Columns</h3><div class="field-group targetid"><label for="targetid">' + soy.$$escapeHtml("Identifiant de la table \xe0 afficher") + '</label><select class="select long-field" id="targetid" name="targetid" title="' + soy.$$escapeHtml("Choisir la colonne identifiant") + '"></select></div><div class="field-group sourcecolumn"><label for="sourcecolumn">' + soy.$$escapeHtml("Colonne source") + '</label><select class="select long-field" id="sourcecolumn" name="sourcecolumn" title="' + soy.$$escapeHtml("Choisir la cl\xe9 \xe9trang\xe8re dans la table locale") + '"></select></div></fieldset><fieldset class="group hidden"><legend><span>' + soy.$$escapeHtml("Format") + '</span></legend><div class="checkbox"><input class="checkbox" type="checkbox" name="convert-to-sql" id="convert-to-sql"/><label for="convert-to-sql">' + soy.$$escapeHtml("Convertir la formule en SQL") + '</label></div></fieldset><fieldset class="group"><legend><span>' + soy.$$escapeHtml("Preview") + '</span></legend><p class="preview free-text-in-form">&nbsp;</p><div class="error free-text-in-form"></div></fieldset><div class="button-panel"><a class="aui-button btn-submit" href="#">' + soy.$$escapeHtml("Terminer") + '</a></div></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.wizardForeignKeyInlineDialog.soyTemplateName = 'Confluence.Templates.PlaySQL.wizardForeignKeyInlineDialog';
}


Confluence.Templates.PlaySQL.formulaEditor = function(opt_data, opt_ignored) {
  return '<form class="aui top-label"><div class="field-group"><div class="description javadoc-autocomplete"><div class="aui-buttons formula-editor-buttons"><a class="aui-button btn-help playsql-tipsy" title="' + soy.$$escapeHtml("? Aide sur les formules") + '" href="http://documentation.play-sql.com/display/PUBLIC/Formulas+2" target="_blank"><span class="aui-icon aui-icon-small aui-iconfont-help">' + soy.$$escapeHtml("? Aide sur les formules") + '</span></a><a class="aui-button btn-cancel playsql-tipsy" href="#" title="' + soy.$$escapeHtml("Cancel [esc]") + '"><span class="aui-icon aui-icon-small aui-iconfont-undo">' + soy.$$escapeHtml("Annuler") + '</span></a><a class="aui-button btn-submit playsql-tipsy" href="#" title="' + soy.$$escapeHtml("Save [enter]") + '"><span class="aui-icon aui-icon-small aui-iconfont-success">' + soy.$$escapeHtml("Enregistrer") + '</span></a></div>' + ((opt_data.javadoc == null) ? '<p>Functions: SUM, MIN, MAX, COUNT...</p>' : '<p>' + soy.$$filterNoAutoescape(opt_data.javadoc) + '</p>') + '</div></div></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.formulaEditor.soyTemplateName = 'Confluence.Templates.PlaySQL.formulaEditor';
}


Confluence.Templates.PlaySQL.cellProperties = function(opt_data, opt_ignored) {
  var output = '<form class="aui top-label"><div class="field-group"><div class="aui-toolbar2" role="toolbar"><div class="aui-toolbar2-inner"><div class="aui-toolbar2-group"><div class="aui-toolbar2-primary"><div id="playsql-color-picker-background" class="aui-buttons"><a class="aui-button aui-button-split-main" href="#"><span style="background-color:' + soy.$$escapeHtml(opt_data.lastChosenColor) + ';">&nbsp;</span></a><a class="aui-button aui-button-split-more aui-dropdown2-trigger" aria-haspopup="true" href="#" aria-controls="playsql-color-picker-dropdown" aria-owns="playsql-color-picker-dropdown">Color picker</a></div><div id="playsql-color-picker-dropdown" class="aui-dropdown2 aui-style-default aui-layer" data-aui-alignment-container="playsql-color-picker-background" aria-hidden="true">';
  var rowList811 = opt_data.palette;
  var rowListLen811 = rowList811.length;
  for (var rowIndex811 = 0; rowIndex811 < rowListLen811; rowIndex811++) {
    var rowData811 = rowList811[rowIndex811];
    var colorList812 = rowData811;
    var colorListLen812 = colorList812.length;
    for (var colorIndex812 = 0; colorIndex812 < colorListLen812; colorIndex812++) {
      var colorData812 = colorList812[colorIndex812];
      output += '<a class="color-item" style="background-color: ' + soy.$$escapeHtml(colorData812) + ';">Color</a>';
    }
    output += '<br/>';
  }
  output += '</div></div></div></div></div><div class="description">' + ((opt_data.formula) ? '<p>Formula: ' + soy.$$escapeHtml(opt_data.formula == true ? 'Yes' : opt_data.formula) + ' <a href="#" class="formula-recalculate">Recalculate</a></p>' : '') + ((opt_data.cellCount > 1) ? '<p>' + soy.$$escapeHtml(opt_data.cellCount) + ' cells</p>' : '') + '</div></div></form>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.cellProperties.soyTemplateName = 'Confluence.Templates.PlaySQL.cellProperties';
}


Confluence.Templates.PlaySQL.javadoc = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '' + ((opt_data.parentFnNotFound) ? '<p class="javadoc-fn">No function found with name "' + soy.$$escapeHtml(opt_data.parentFnNotFound) + '"</p>' : '');
  if (opt_data.parentFn != null) {
    output += '<p><span class="javadoc-fn-signature">' + soy.$$escapeHtml(opt_data.parentFn.name);
    if (opt_data.parentFn.params) {
      output += '(';
      var paramList844 = opt_data.parentFn.params;
      var paramListLen844 = paramList844.length;
      for (var paramIndex844 = 0; paramIndex844 < paramListLen844; paramIndex844++) {
        var paramData844 = paramList844[paramIndex844];
        output += soy.$$escapeHtml(paramData844.javadocName) + ((! (paramIndex844 == paramListLen844 - 1)) ? ',&nbsp;' : '');
      }
      output += ')';
    } else {
      output += '()';
    }
    output += '</span><br>&nbsp;=&gt;&nbsp;<span class="javadoc-fn-description">' + soy.$$escapeHtml(opt_data.parentFn.description) + '</span></p>';
    if (opt_data.parentFn.params) {
      output += '<p>Parameters:<ul>';
      var paramList859 = opt_data.parentFn.params;
      var paramListLen859 = paramList859.length;
      for (var paramIndex859 = 0; paramIndex859 < paramListLen859; paramIndex859++) {
        var paramData859 = paramList859[paramIndex859];
        output += '<li><b>' + soy.$$escapeHtml(paramData859.javadocName) + '</b>:&nbsp;<i>' + soy.$$escapeHtml(paramData859.type) + ((paramData859.range) ? '[]' : '') + '</i>.' + soy.$$escapeHtml(paramData859.javadocDescription ? paramData859.javadocDescription : '') + '</li>';
      }
      output += '</ul>';
    }
    output += (opt_data.parentFn.example) ? '<p class="javadoc-fn-example">Example: ' + soy.$$escapeHtml(opt_data.parentFn.example) + '</p>' : '';
  }
  if (opt_data.candidates != null) {
    output += (opt_data.parentFn != null) ? '<hr><p>Autocompletion suggestions:</p>' : '';
    var candidateList882 = opt_data.candidates;
    var candidateListLen882 = candidateList882.length;
    for (var candidateIndex882 = 0; candidateIndex882 < candidateListLen882; candidateIndex882++) {
      var candidateData882 = candidateList882[candidateIndex882];
      output += '<li class="autocomplete-item" data-autocomplete="' + soy.$$escapeHtml(candidateData882.autocomplete) + '" data-autocomplete-type="' + soy.$$escapeHtml(candidateData882.type) + '">' + ((candidateData882.type == 'column') ? ' Column "' + soy.$$escapeHtml(candidateData882.detail.label) + '" (' + soy.$$filterNoAutoescape(candidateData882.name) + ')' : (candidateData882.type == 'table') ? ' Table "' + soy.$$escapeHtml(candidateData882.detail.label) + '" (' + soy.$$filterNoAutoescape(candidateData882.name) + ')' : (candidateData882.type == 'function') ? soy.$$filterNoAutoescape(candidateData882.name) + ':&nbsp;' + soy.$$filterNoAutoescape(candidateData882.detail.description) : soy.$$escapeHtml(candidateData882.type) + ': ' + soy.$$filterNoAutoescape(candidateData882.name)) + '</li>';
    }
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.PlaySQL.javadoc.soyTemplateName = 'Confluence.Templates.PlaySQL.javadoc';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.aui.staging:confluence-flags', location = 'flag/confluence-flag.js' */
define("confluence/flag",["ajs","jquery"],function(f,d){function h(a){var b=d('<span class="aui-icon icon-close" role="button" tabindex="0"></span>');b.click(function(){g(a)});b.keypress(function(b){if(b.which===f.keyCode.ENTER||b.which===f.keyCode.SPACE)g(a),b.preventDefault()});return a.find(".aui-message").append(b)[0]}function g(a){var b=a.get(0);b.setAttribute("aria-hidden","true");a=a.parent();i(a);b.dispatchEvent(new CustomEvent("aui-flag-close",{bubbles:!0}));return b}function i(a){a.hasClass("aui-flag-stack")&&
a.children('.aui-flag:not([aria-hidden="true"])').length&&(a.children(".aui-flag-stack-top-item").removeClass("aui-flag-stack-top-item"),a.children('.aui-flag:not([aria-hidden="true"])').last().addClass("aui-flag-stack-top-item"))}var j={body:"",close:"manual",title:"",type:"info",fifo:!1};return function(a){var a=d.extend({},j,a),b,c=a,c=f.template('<div class="aui-flag {extraClasses}"><div class="aui-message aui-message-{type} {type} {closeable} shadowed"><p class="title"><strong>{title}</strong></p>{body}<\!-- .aui-message --\></div></div>').fill({"body:html":c.body||
"",closeable:"never"===c.close?"":"closeable",title:c.title||"",type:c.type,extraClasses:c.extraClasses||""}).toString();b=d(c);b[0].close=function(){g(b)};"auto"===a.close?(h(b),b.find(".aui-message").addClass("aui-will-close"),setTimeout(function(){b[0].close()},5E3)):"manual"===a.close&&h(b);d("#aui-flag-container").find(".aui-flag").get().forEach(function(a){a.getAttribute("aria-hidden")==="true"&&d(a).remove()});c=d("#aui-flag-container");c.length||(c=d('<div id="aui-flag-container"></div>'),
d("body").prepend(c));if(a.stack){var e=d('[data-aui-flag-stack="'+a.stack+'"]');e.length||(e=d('<div data-aui-flag-stack="'+a.stack+'" class="aui-flag-stack"></div>'),e.appendTo(c));e.find('[aria-hidden="false"]').length||e.detach().appendTo(c);a.fifo?b.appendTo(e):b.prependTo(e);i(e)}else b.appendTo(c);a=b;a=a.length?a[0]:a;window.getComputedStyle(a,null).getPropertyValue("left");a=b.attr("aria-hidden","false")[0];a.dispatchEvent(new CustomEvent("aui-flag-show",{bubbles:!0}));return a}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.aui.staging:confluence-flags', location = 'flag/confluence-flag-scroll.js' */
define("confluence/flag-scroll",["jquery","ajs","confluence/meta","document"],function(c,j,k,l){function f(){var a=c("#"+g);if(a.find('.aui-flag[aria-hidden="false"]').length){var b;b=0;h?b=c("#header").height()+d:(b=e.scrollTop(),b=b<=i-d?i-Math.max(b,0):d);a.css("top",b)}}var d=20,i=71,g="aui-flag-container",h=!1,e;return function(a){e=(h=a("body").hasClass("theme-documentation"))?a("#splitter-content"):a(window);e.on("scroll",f);l.addEventListener("aui-flag-show",f);j.bind("rte-ready",function(){"page"===
k.get("content-type")&&a("#"+g).find('.aui-flag[aria-hidden="false"]').each(function(){this.close()})})}});require("confluence/module-exporter").safeRequire("confluence/flag-scroll",function(c){require("ajs").toInit(c)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'soy/comments.soy' */
// This file was automatically generated from comments.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Comments.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Comments == 'undefined') { Confluence.Templates.Comments = {}; }


Confluence.Templates.Comments.displayReplyEditorLoadingContainer = function(opt_data, opt_ignored) {
  return '<ol class="comment-threads"><li class="comment-thread">' + Confluence.Templates.Comments.displayCommentEditorCommon({comment: {ownerId: opt_data.contentId, parentId: opt_data.parentCommentId}, commenter: opt_data.commenter, state: 'loading', mode: 'reply'}) + '</li></ol>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayReplyEditorLoadingContainer.soyTemplateName = 'Confluence.Templates.Comments.displayReplyEditorLoadingContainer';
}


Confluence.Templates.Comments.displayTopLevelCommentEditorPlaceholder = function(opt_data, opt_ignored) {
  return '' + Confluence.Templates.Comments.displayCommentEditorCommon({comment: {ownerId: opt_data.contentId}, commenter: opt_data.commenter, state: 'placeholder', mode: 'add'});
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayTopLevelCommentEditorPlaceholder.soyTemplateName = 'Confluence.Templates.Comments.displayTopLevelCommentEditorPlaceholder';
}


Confluence.Templates.Comments.displayEditEditorContainer = function(opt_data, opt_ignored) {
  return '' + Confluence.Templates.Comments.displayCommentEditorCommon({comment: {ownerId: opt_data.contentId, id: opt_data.commentId}, commenter: opt_data.commenter, state: 'placeholder', mode: 'edit'});
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayEditEditorContainer.soyTemplateName = 'Confluence.Templates.Comments.displayEditEditorContainer';
}


Confluence.Templates.Comments.editorLoadErrorMessage = function(opt_data, opt_ignored) {
  return '<p>' + soy.$$escapeHtml(opt_data.message) + '</p><p><a href="' + soy.$$escapeHtml(opt_data.fallbackUrl) + '">' + soy.$$escapeHtml("R\xe9essayer") + '</a></p>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.editorLoadErrorMessage.soyTemplateName = 'Confluence.Templates.Comments.editorLoadErrorMessage';
}


Confluence.Templates.Comments.displayCommentEditorCommon = function(opt_data, opt_ignored) {
  var output = '<div class="quick-comment-container comment ' + soy.$$escapeHtml(opt_data.mode) + '">' + Confluence.Templates.Comments.userLogo({userInfo: opt_data.commenter}) + '<div class="quick-comment-body"><div class="quick-comment-loading-container" style="display:' + ((opt_data.state == 'loading') ? 'block' : 'none') + ';"></div><div id="editor-messages"></div><div id="all-messages"></div><form style="display:' + ((opt_data.state == 'loading') ? 'none' : 'block') + ';" class="quick-comment-form aui" method="post" ';
  switch (opt_data.mode) {
    case 'add':
      output += 'name="inlinecommentform" action="' + soy.$$escapeHtml("") + '/pages/doaddcomment.action?pageId=' + soy.$$escapeHtml(opt_data.comment.ownerId) + '"';
      break;
    case 'edit':
      output += 'name="editcommentform" action="' + soy.$$escapeHtml("") + '/pages/doeditcomment.action?pageId=' + soy.$$escapeHtml(opt_data.comment.ownerId) + '&commentId=' + soy.$$escapeHtml(opt_data.comment.id) + '"';
      break;
    case 'reply':
      output += 'name="threadedcommentform"  action="' + soy.$$escapeHtml("") + '/pages/doaddcomment.action?pageId=' + soy.$$escapeHtml(opt_data.comment.ownerId) + '&parentId=' + soy.$$escapeHtml(opt_data.comment.parentId) + '"';
      break;
  }
  output += ' >' + ((opt_data.mode == 'add') ? '<div title="' + soy.$$escapeHtml("Ajouter un commentaire") + '" class="quick-comment-prompt"><span>' + soy.$$escapeHtml("\xc9crire un commentaire\u2026") + '</span></div>' : '') + '</form></div></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayCommentEditorCommon.soyTemplateName = 'Confluence.Templates.Comments.displayCommentEditorCommon';
}


Confluence.Templates.Comments.userLogo = function(opt_data, opt_ignored) {
  return '<p class="comment-user-logo">' + ((opt_data.userInfo.userName == null) ? '<img class="userLogo logo anonymous" src="' + soy.$$escapeHtml("/s/fr_FR/6441/82994790ee2f720a5ec8daf4850ac5b7b34d2194/_") + '/images/icons/profilepics/anonymous.png" alt="' + soy.$$escapeHtml("Ic\xf4ne utilisateur") + ': ' + soy.$$escapeHtml("Anonyme") + '" title="' + soy.$$escapeHtml("Anonyme") + '">' : (opt_data.userInfo.profilePicture.isDefault) ? '<a class="userLogoLink" data-username="' + soy.$$escapeHtml(opt_data.userInfo.userName) + '" href="' + soy.$$escapeHtml("") + '/users/profile/editmyprofilepicture.action" title="' + soy.$$escapeHtml("Ajouter une image de vous-m\xeame") + '"><img class="userLogo logo defaultLogo" src="' + soy.$$escapeHtml("/s/fr_FR/6441/82994790ee2f720a5ec8daf4850ac5b7b34d2194/_") + '/images/icons/profilepics/add_profile_pic.png" alt="' + soy.$$escapeHtml("Ic\xf4ne utilisateur") + ': ' + soy.$$escapeHtml("Ajouter une image de vous-m\xeame") + '"></a>' : '<a class="userLogoLink" data-username="' + soy.$$escapeHtml(opt_data.userInfo.userName) + '" href="' + Confluence.Templates.User.userLinkUrl({username: opt_data.userInfo.userName}) + '"><img class="userLogo logo" src="' + soy.$$escapeHtml(opt_data.userInfo.profilePicture.path) + '" alt="' + soy.$$escapeHtml("Ic\xf4ne utilisateur") + ': ' + soy.$$escapeHtml(opt_data.userInfo.userName) + '" title="' + soy.$$escapeHtml(opt_data.userInfo.userName) + '"></a>') + '</p>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.userLogo.soyTemplateName = 'Confluence.Templates.Comments.userLogo';
}


Confluence.Templates.Comments.displayComment = function(opt_data, opt_ignored) {
  return '' + ((opt_data.comment.parentId == 0 && opt_data.firstReply) ? '<div id="comments-section" class="pageSection group"><div class="section-header"><h2 id="comments-section-title" class="section-title">' + soy.$$escapeHtml("Commentaire") + '</h2>' + Confluence.Templates.Comments.commentThread({comment: opt_data.comment, commenter: opt_data.commenter, highlight: opt_data.highlight, topLevel: true}) + '</div></div>' : (opt_data.firstReply) ? Confluence.Templates.Comments.commentThread({comment: opt_data.comment, commenter: opt_data.commenter, highlight: opt_data.highlight, topLevel: false}) : Confluence.Templates.Comments.commentThreadItem({comment: opt_data.comment, commenter: opt_data.commenter, highlight: true}));
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayComment.soyTemplateName = 'Confluence.Templates.Comments.displayComment';
}


Confluence.Templates.Comments.commentThread = function(opt_data, opt_ignored) {
  return '<ol class="comment-threads' + ((opt_data.topLevel) ? ' top-level" id="page-comments' : '') + '">' + Confluence.Templates.Comments.commentThreadItem(opt_data) + '</ol>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.commentThread.soyTemplateName = 'Confluence.Templates.Comments.commentThread';
}


Confluence.Templates.Comments.commentThreadItem = function(opt_data, opt_ignored) {
  return '<li id="comment-thread-' + soy.$$escapeHtml(opt_data.comment.id) + '" class="comment-thread">' + Confluence.Templates.Comments.commentView(opt_data) + '</li>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.commentThreadItem.soyTemplateName = 'Confluence.Templates.Comments.commentThreadItem';
}


Confluence.Templates.Comments.commentView = function(opt_data, opt_ignored) {
  return '<div class="comment' + ((opt_data.highlight == true) ? ' focused' : '') + '" id="comment-' + soy.$$escapeHtml(opt_data.comment.id) + '">' + Confluence.Templates.Comments.userLogo({userInfo: opt_data.commenter}) + '<div class="comment-header"><h4 class="author">' + ((opt_data.commenter.userName == null) ? soy.$$escapeHtml("Anonyme") : '<a href="' + soy.$$escapeHtml("") + '/display/~' + soy.$$escapeUri(opt_data.commenter.userName) + '" class="url fn confluence-userlink" data-username="' + soy.$$escapeHtml(opt_data.commenter.userName) + '">' + soy.$$escapeHtml(opt_data.commenter.displayName) + '</a>') + '</h4></div><div class="comment-body"><div class="comment-content wiki-content">' + soy.$$filterNoAutoescape(opt_data.comment.html) + '</div><div class="comment-actions">' + Confluence.Templates.Comments.displayCommentActions({section: 'secondary', actions: opt_data.comment.secondaryActions, commentId: opt_data.comment.id}) + Confluence.Templates.Comments.displayCommentActions({section: 'primary', actions: opt_data.comment.primaryActions, commentId: opt_data.comment.id}) + '</div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.commentView.soyTemplateName = 'Confluence.Templates.Comments.commentView';
}


Confluence.Templates.Comments.displayCommentActions = function(opt_data, opt_ignored) {
  var output = '<ul class="comment-actions-' + soy.$$escapeHtml(opt_data.section) + '">';
  if (opt_data.actions != null) {
    var itemList211 = opt_data.actions;
    var itemListLen211 = itemList211.length;
    for (var itemIndex211 = 0; itemIndex211 < itemListLen211; itemIndex211++) {
      var itemData211 = itemList211[itemIndex211];
      output += '<li ' + ((itemData211.style != null) ? ' class="' + soy.$$escapeHtml(itemData211.style) + '"' : '') + '><a ' + ((itemData211.tooltip != null) ? ' title="' + soy.$$escapeHtml(itemData211.tooltip) + '"' : '') + ' href="' + soy.$$escapeHtml(itemData211.url) + '" ' + ((itemData211.id) ? ' id="' + soy.$$escapeHtml(itemData211.id) + '-' + soy.$$escapeHtml(opt_data.commentId) + '"' : '') + '><span>' + soy.$$escapeHtml(itemData211.label) + '</span></a></li>\n';
    }
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Comments.displayCommentActions.soyTemplateName = 'Confluence.Templates.Comments.displayCommentActions';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'jscripts/comment-display-manager.js' */
define("confluence-quick-edit/comment-display-manager",["ajs","confluence/legacy","confluence/templates","jquery"],function(g,j,h,c){var i={_updateCommentSectionTitle:function(){var a=c("#comments-section-title");if(0!==a.length){var b=this.commentCount();1===b?a.text("Commentaire"):a.text(g.format("{0} commentaires",b))}},addComment:function(a,b,f,d){a={comment:b,commenter:a,highlight:f,context:{contextPath:g.Meta.get("context-path"),staticResourceUrlPrefix:g.Meta.get("static-resource-url-prefix")}};
if(this.hasComments()){if(0==b.parentId)a.firstReply=!1,f=c("#comments-section .comment-threads.top-level");else{var f=c("#comment-thread-"+b.parentId),e=f.children(".commentThreads");e.length?(a.firstReply=!1,f=e):a.firstReply=!0}d||this.clearFocus();d=c(h.Comments.displayComment(a));d.addClass("fadeInComment");f.append(d);this._updateCommentSectionTitle()}else a.firstReply=!0,d=c(h.Comments.displayComment(a)),d.addClass("fadeInComment"),c("#comments-section").prepend(d);j.Comments.bindRemoveConfirmation(b.id);
b=this.getCommentNode(b.id);b.scrollToElement();return b},addOrUpdateComment:function(a,b,c,d){var e=this.getCommentNode(b.id);return e?(e.find(".comment-content").html(b.html),d||this.clearFocus(),c&&e.addClass("focused"),e.addClass("fadeInComment"),e.scrollToElement(),e):this.addComment.apply(this,arguments)},isVisible:function(){return!c("#page-comments").hasClass("hidden")},hasComments:function(){return 0<this.commentCount()},commentCount:function(){return c("#comments-section .comment").not(".quick-comment-container").length},
clearFocus:function(){c(".comment").removeClass("focused")},getCommentNode:function(a){a=c("#comment-"+a);return a.length?a:null},getParentId:function(a){a=i.getCommentNode(a);return null!=a&&(a=a.closest("div.comment"),a.length)?(a=a.attr("id"),a=/\d+/.exec(a),parseInt(a)):0}};return i});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/comment-display-manager","Confluence.CommentDisplayManager");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-page', location = 'jscripts/scroll-util.js' */
define("confluence-quick-edit/scroll-util",["window","document","jquery"],function(a,c,e){return{scrollToElement:function(){this.scrollWindowToElement()||this.scrollOverflowContainerToElement();return this},scrollWindowToElement:function(){function b(){return"pageYOffset"in a?a.pageYOffset:c.documentElement.scrollTop}var f=b(),d;if("number"===typeof a.innerWidth)d=a.innerHeight;else if(c.documentElement&&c.documentElement.clientWidth)d=c.documentElement.clientHeight;else return this[0].scrollIntoView(!1),
!0;var g=this.offset().top,h=this.height();return g+h+40>f+d?(this[0].scrollIntoView(!1),a.scrollBy(0,40),f!=b()):!0},scrollOverflowContainerToElement:function(){var b=null;this.parents().each(function(){var a=e(this).css("overflow");if("auto"==a||"scroll"==a)return b=e(this),!1});if(!b)return!1;var a=b.height(),d=this.offset().top,c=this.height(),a=a-(d+c+40);0>a&&(b[0].scrollTop-=a);return!0}}});require("confluence/module-exporter").safeRequire("confluence-quick-edit/scroll-util",function(a){require("jquery").fn.extend(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'main/quick-reload.soy' */
// This file was automatically generated from quick-reload.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace QuickReload.Templates.
 */

if (typeof QuickReload == 'undefined') { var QuickReload = {}; }
if (typeof QuickReload.Templates == 'undefined') { QuickReload.Templates = {}; }


QuickReload.Templates.pageEdit = function(opt_data, opt_ignored) {
  return '' + QuickReload.Templates.container({content: '<div class="qr-notice-authors">' + QuickReload.Templates.noticeHeader({users: opt_data.pageEditors}) + '</div><div class="qr-notice-summary">' + aui.buttons.button({text: "Recharger la page", type: 'text', extraClasses: 'qr-notice-show aui-button-text'}) + QuickReload.Templates.summaryText({users: opt_data.pageEditors}) + '</div>'});
};
if (goog.DEBUG) {
  QuickReload.Templates.pageEdit.soyTemplateName = 'QuickReload.Templates.pageEdit';
}


QuickReload.Templates.pageComment = function(opt_data, opt_ignored) {
  return '' + QuickReload.Templates.container({content: '<div class="qr-notice-authors">' + QuickReload.Templates.noticeHeader({users: opt_data.commentUsers}) + ((opt_data.commentUsers.length == 1) ? '<span class="qr-notice-text">"' + soy.$$escapeHtml(opt_data.noticeText) + '"</span>' : '') + '</div><div class="qr-notice-summary">' + aui.buttons.button({text: '' + ((opt_data.commentUsers.length > 1) ? soy.$$escapeHtml("Afficher tout") : soy.$$escapeHtml("Afficher")), type: 'text', extraClasses: 'qr-notice-show aui-button-text'}) + QuickReload.Templates.summaryText({users: opt_data.commentUsers}) + '</div>'});
};
if (goog.DEBUG) {
  QuickReload.Templates.pageComment.soyTemplateName = 'QuickReload.Templates.pageComment';
}


QuickReload.Templates.inlineComment = function(opt_data, opt_ignored) {
  return '' + QuickReload.Templates.container({content: '<div class="qr-notice-authors">' + QuickReload.Templates.noticeHeader({users: opt_data.user}) + '<span class="qr-notice-text">"' + soy.$$escapeHtml(opt_data.noticeText) + '"</span></div><div class="qr-notice-summary">' + aui.buttons.button({text: '' + ((opt_data.reloadRequired) ? soy.$$escapeHtml("Recharger la page") : soy.$$escapeHtml("Afficher")), type: 'text', extraClasses: 'qr-notice-show aui-button-text', extraAttributes: ['data-reload-required', opt_data.reloadRequired]}) + QuickReload.Templates.summaryText({users: opt_data.user}) + '</div>'});
};
if (goog.DEBUG) {
  QuickReload.Templates.inlineComment.soyTemplateName = 'QuickReload.Templates.inlineComment';
}


QuickReload.Templates.container = function(opt_data, opt_ignored) {
  return '<div class="qr-container">' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
};
if (goog.DEBUG) {
  QuickReload.Templates.container.soyTemplateName = 'QuickReload.Templates.container';
}


QuickReload.Templates.noticeHeader = function(opt_data, opt_ignored) {
  var output = '';
  var userList68 = opt_data.users;
  var userListLen68 = userList68.length;
  for (var userIndex68 = 0; userIndex68 < userListLen68; userIndex68++) {
    var userData68 = userList68[userIndex68];
    output += (userIndex68 < 8) ? aui.avatar.avatar({size: 'small', avatarImageUrl: userData68.profilePicture.path, title: userData68.displayName != '' ? userData68.displayName : "Anonyme", extraClasses: 'qr-author-avatar'}) : '';
  }
  return output;
};
if (goog.DEBUG) {
  QuickReload.Templates.noticeHeader.soyTemplateName = 'QuickReload.Templates.noticeHeader';
}


QuickReload.Templates.summaryText = function(opt_data, opt_ignored) {
  var output = '';
  var lastModifier__soy78 = opt_data.users[0];
  var others__soy79 = opt_data.users.length - 1;
  output += '<span class="qr-notice-summary-text">' + soy.$$escapeHtml("par") + ' ' + Confluence.Templates.User.usernameLink({canView: false, username: lastModifier__soy78.userName, fullName: lastModifier__soy78.displayName != '' ? lastModifier__soy78.displayName : "Anonyme"}) + ((others__soy79 == 1) ? ' ' + soy.$$escapeHtml("et 1 autre") : '') + ((others__soy79 > 1) ? ' ' + soy.$$escapeHtml(AJS.format("et {0} autres",others__soy79)) : '') + '</span>';
  return output;
};
if (goog.DEBUG) {
  QuickReload.Templates.summaryText.soyTemplateName = 'QuickReload.Templates.summaryText';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'utils/quick-reload-timer.js' */
define("confluence-quick-reload/utils/quick-reload-timer",["jquery","underscore"],function(c,d){function a(b,a){this.options=c.extend({min:3E4,max:36E5,inactivity:12E4},a);d.bindAll(this,"start","stop","_now","_timeSinceLastSeen","_setActive","_setActivityTrigger","_clamp","_intervalMultiplier");this.callback=b;this._timer=null;this._setActivityTrigger(this._setActive)}a.prototype.start=function(b){this.lastSeenTimestamp=this._now();this.stop();b&&this.callback();var a=function(){this.callback();
c.call(this)},c=function(){this.stop();this._timer=setTimeout(d.bind(a,this),this.options.min*this._intervalMultiplier())};c.call(this)};a.prototype.stop=function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null)};a.prototype._setActive=function(){if(null!==this._timer){var b=this._timeSinceLastSeen()>this.options.inactivity;this.lastSeenTimestamp=this._now();b&&this.start(!0)}};a.prototype._setActivityTrigger=function(b){document.addEventListener("visibilitychange",function(){document.hidden||
b()},!1);c(window).focus(b);c("body").click(b);c(window).scroll(b)};a.prototype._now=function(){return(new Date).getTime()};a.prototype._timeSinceLastSeen=function(){return this._now()+1-this.lastSeenTimestamp};a.prototype._clamp=function(b,a,c){a=Math.max(Math.min(a,c),b);return isNaN(a)?b:a};a.prototype._intervalMultiplier=function(){var a=(document.hidden?3:1)*Math.ceil(this._timeSinceLastSeen()/this.options.inactivity);return this._clamp(1,this.options.max/this.options.min,a)};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'utils/quick-reload-count.js' */
define("confluence-quick-reload/utils/quick-reload-count",function(){function a(){this.count=0}var b=document.title;a.prototype.getCount=function(){return this.count};a.prototype.setCount=function(a){this.count=a;this._displayCount()};a.prototype._displayCount=function(){document.title=(0<this.count?"("+this.count+") ":"")+b};return new a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'handlers/quick-reload-comments.js' */
define("confluence-quick-reload/handlers/quick-reload-comments","ajs underscore jquery confluence/flag confluence-quick-reload/utils/quick-reload-count confluence/legacy".split(" "),function(h,c,e,k,g,d){function i(c){return c.comment.id}var a,f=[];return{results:[],property:"comments",ignoreOnce:function(c){f.push(c)},filterNewResults:function(d,a){if(a.length===0)return a;var b=c.map(d,i);return c.filter(a,function(a){if(a.comment.isInlineComment)return false;a=i(a);if(c.contains(b,a))return false;
a=e.inArray(a,f);if(a>=0){f.splice(a,1);return false}return true})},render:function(f){g.setCount(g.getCount()+f.length);var f={close:"manual",type:"info",extraClasses:"qr-flag",fifo:true,stack:"quickreload"},j=this.results.length>1?h.format("{0} Nouveaux commentaires",this.results.length):"Nouveau commentaire",b;b=c.clone(this.results);b.reverse();b=c.uniq(b,function(a){return a.commenter.userName});b=c.map(b,function(a){return a.commenter});var l=e("<div>").html(this.results[this.results.length-
1].comment.html).text();b=QuickReload.Templates.pageComment({commentUsers:b,noticeText:l});if(a===void 0||a.getAttribute("aria-hidden")==="true"){a=new k(e.extend({},{body:b,title:j},f));e(a).on("click",".qr-notice-show",c.bind(function(){var b=this.results;if(d&&d.CommentDisplayManager){d.CommentDisplayManager.clearFocus();c.map(b,function(a){var b=d.CommentDisplayManager.getCommentNode(i(a))!==null,a=d.CommentDisplayManager.addOrUpdateComment(a.commenter,a.comment,true,true);if(d.Likes&&!b){d.Likes.appendAction(e(a));
d.Likes.updateComment(e(a),{})}});d.CommentDisplayManager._updateCommentSectionTitle();h.trigger("ic-jim-async-supported")}a.close()},this));e(a).on("aui-flag-close",c.bind(function(){g.setCount(g.getCount()-this.results.length);this.results=[]},this))}else{e(a).find(".qr-container").replaceWith(b);e(a).find(".title").text(j)}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'handlers/quick-reload-inline-comments.js' */
define("confluence-quick-reload/handlers/quick-reload-inline-comments",["underscore","jquery","ajs","confluence/flag","confluence-quick-reload/utils/quick-reload-count"],function(b,f,h,q,l){function o(a,d,b,e,c){a=QuickReload.Templates.inlineComment({user:[a.commenter],noticeText:a&&a.comment&&f("<div>").text(a.comment.html).text(),reloadRequired:d});c=1<c?"Nouveaux commentaires en ligne":"Nouveau commentaire en ligne";c=new q(f.extend({},{title:c,body:a},{close:"manual",
type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"}));f(c).find(".qr-notice-show").click(b);d||f(c).find(".qr-notice-show").click(c.close);f(c).on("aui-flag-close",e)}function n(a){return 0===a.comment.parentId}function i(a){return n(a)?a.comment.id:a.comment.parentId}return{results:[],property:"comments",filterNewResults:function(a,d){d=b.clone(d);d=b.filter(d,function(a){return a.comment.isInlineComment&&a.commenter.userName!==h.Meta.get("remote-user")});if(0<d.length)var f=b.map(a,
i),e=b.filter(d,n),c=b.filter(d,function(a){return!n(a)}),g=b.map(e,i),j=b.map(c,i),k=b.difference(j,g),p=[],c=b.filter(c,function(a){return-1!==k.indexOf(a.comment.parentId)&&-1===p.indexOf(a.comment.parentId)?(p.push(a.comment.parentId),!0):!1}),e=e.concat(c),d=b.filter(e,function(a){return-1===f.indexOf(i(a))});return d},render:function(a){l.setCount(l.getCount()+a.length);b.each(a,function(a){var m=i(a),e=function(){h.trigger("qr:show-new-thread",m)},c=function(){var a=h.Meta.Links.canonical(),
b=-1===a.indexOf("?")?"?":"&";window.location=a+b+"focusedCommentId="+m+"#comment-"+m},g=function(){this.results=b.filter(this.results,function(a){return i(a)!==m});l.setCount(l.getCount()-1)},g=b.bind(g,this),j=this.results.length;if(n(a)){var k=new f.Deferred;k.fail(function(a){o(a,!0,c,g,j)});k.done(function(a){o(a,!1,e,g,j)});h.trigger("qr:add-new-highlight",[a,k])}else o(a,!1,e,g,j)},this)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'handlers/quick-reload-page.js' */
define("confluence-quick-reload/handlers/quick-reload-page",["underscore","jquery","ajs","confluence/flag","confluence-quick-reload/utils/quick-reload-count"],function(d,a,g,i,e){var c;return{results:[],property:"page",filterNewResults:function(c,a){return 0<a.length&&"string"!==typeof a[0]?a:[]},render:function(f){e.setCount(e.getCount()+f.length);var f={close:"manual",type:"info",extraClasses:"qr-flag",fifo:!0,stack:"quickreload"},h=1<this.results.length?g.format("{0} nouvelles modifications",this.results.length):
"Nouvelles modifications de la page",b;b=d.clone(this.results);b.reverse();b=d.uniq(b,function(a){return a.editor.userName});b=d.map(b,function(a){return a.editor});b=QuickReload.Templates.pageEdit({pageEditors:b});void 0===c||"true"===c.getAttribute("aria-hidden")?(c=new i(a.extend({},{body:b,title:h},f)),a(c).on("click",".qr-notice-show",function(){a(this).prop("disabled",!0).prepend('<span class="aui-icon aui-icon-wait"></span>&nbsp;');window.location.reload()}),a(c).on("aui-flag-close",d.bind(function(){e.setCount(e.getCount()-
this.results.length);this.results=[]},this))):(a(c).find(".qr-container").replaceWith(b),a(c).find(".title").text(h))}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-resources', location = 'main/quick-reload-manager.js' */
define("confluence-quick-reload/main/quick-reload-manager",["underscore","jquery","ajs","confluence-quick-reload/utils/quick-reload-timer"],function(h,f,g,i){function a(){this._isEnabled=!1;this.handlers=[];this.lastFetchTime=f('meta[name="confluence-request-time"]').attr("content")||(new Date).getTime();this._timer=null;h.bindAll(this,"addHandler","removeHandler","update","enable","disable","_onUpdateSuccess","_onUpdateError")}a.prototype.addHandler=function(d){for(var a=!1,e=0;e<this.handlers.length;e++)this.handlers[e]===
d&&(a=!0);!0!==a&&this.handlers.push(d)};a.prototype.removeHandler=function(d){if(d)for(var a=0;a<this.handlers.length;a++)if(this.handlers[a]===d){this.handlers.splice(a,1);break}};a.prototype.update=function(){f("body").hasClass("contenteditor")?this.disable():f.ajax({type:"GET",url:g.contextPath()+"/rest/quickreload/latest/"+g.Meta.get("page-id")+"?since="+encodeURIComponent(this.lastFetchTime),dataType:"json"}).done(this._onUpdateSuccess).fail(this._onUpdateError)};a.prototype.enable=function(){null===
this._timer&&(this._timer=new i(this.update));this._timer.start();this._isEnabled=!0};a.prototype.disable=function(){null!==this._timer&&this._timer.stop();this._isEnabled=!1};a.prototype.isEnabled=function(){return this._isEnabled};a.prototype._onUpdateSuccess=function(a,f,e){204!==e.status&&(this.lastFetchTime=a.time,h.map(this.handlers,function(c){var b=a[c.property];Array.isArray(b)||(b=[b]);b=c.filterNewResults(c.results,b);0<b.length&&(c.results=c.results.concat(b),c.render(b))},this))};a.prototype._onUpdateError=
function(a){a=a||{};if(a={404:"not found - the plugin has been probably been removed or disabled from Confluence",500:"generic server error",503:"service unavailable",504:"gateway timeout"}[a.status])this.disable(),g.log('Quick comment reload plugin has been disabled in this page due to a server error: "'+a+'". Please refresh the page to get it back.')};return new a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickreload:quick-reload-bootstrap', location = 'main/quick-reload-main.js' */
require("ajs confluence-quick-reload/main/quick-reload-manager confluence-quick-reload/handlers/quick-reload-comments confluence-quick-reload/handlers/quick-reload-inline-comments confluence-quick-reload/handlers/quick-reload-page confluence/legacy".split(" "),function(b,a,c,d,e,f){b.toInit(function(){if(!(b.DarkFeatures.isEnabled("quickreload.disabled")||!f.CommentDisplayManager||b.Meta.get("page-id")===void 0)){a.addHandler(c);a.addHandler(d);a.addHandler(e);a.enable();b.bind("page.commentAddedOrUpdated",
function(b,a){c.ignoreOnce(a.commentId)})}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/js/tablesorter-date-parser.js' */
(function(A){A(function(){A.tablesorter.addParser({id:"dateAttributeParser",is:function(B,D,C){return A(C).is(".content-report-table-macro .modified")
},format:function(B,D,C,E){return A(C).attr("data-sortable-date")
},type:"numeric"})
})
})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/soy/content-report-table.soy' */
// This file was automatically generated from content-report-table.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Plugins.ContentReport.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Plugins == 'undefined') { Confluence.Templates.Plugins = {}; }
if (typeof Confluence.Templates.Plugins.ContentReport == 'undefined') { Confluence.Templates.Plugins.ContentReport = {}; }


Confluence.Templates.Plugins.ContentReport.contentReportTable = function(opt_data, opt_ignored) {
  var output = '';
  var hasSocialColumn__soy3 = opt_data.showCommentsCount || opt_data.showLikesCount;
  if (opt_data.results.length == 0 && opt_data.blueprintKey) {
    output += '<div class="blueprint-blank-experience ' + soy.$$escapeHtml(opt_data.blueprintKey) + '"><div class="content"><h2>' + soy.$$escapeHtml(opt_data.blankTitle) + '</h2><p>' + soy.$$escapeHtml(opt_data.blankDescription) + '</p></div>' + ((opt_data.createButtonLabel) ? '<p><button class="create-from-template-button aui-button aui-button-primary" data-space-key="' + soy.$$escapeHtml(opt_data.dataSpaceKey) + '" data-content-blueprint-id="' + soy.$$escapeHtml(opt_data.contentBlueprintId) + '" href="' + soy.$$escapeHtml(opt_data.createContentUrl) + '" >' + soy.$$escapeHtml(opt_data.createButtonLabel) + '</button></p>' : '') + '</div>';
  } else {
    output += '<table class="aui content-report-table-macro' + ((hasSocialColumn__soy3) ? ' with-extra-columns' : '') + '"' + ((opt_data.analyticsKey) ? ' data-analytics-key="' + soy.$$escapeHtml(opt_data.analyticsKey) + '"' : '') + '><thead><tr><th>' + soy.$$escapeHtml("Title") + '</th><th>' + soy.$$escapeHtml("Creator") + '</th><th>' + soy.$$escapeHtml("Modified") + '</th></tr></thead><tbody>';
    var resultList43 = opt_data.results;
    var resultListLen43 = resultList43.length;
    if (resultListLen43 > 0) {
      for (var resultIndex43 = 0; resultIndex43 < resultListLen43; resultIndex43++) {
        var resultData43 = resultList43[resultIndex43];
        output += '<tr><td class="title"><a href="' + soy.$$escapeHtml(resultData43.urlPath) + '">' + soy.$$escapeHtml(resultData43.title) + '</a></td><td class="creator">' + Confluence.Templates.User.usernameLink({canView: opt_data.canViewProfiles, username: resultData43.creatorName, fullName: resultData43.creatorFullName, contextPath: opt_data.contextPath}) + '</td><td class="modified" data-sortable-date="' + soy.$$escapeHtml(resultData43.sortableDate) + '">' + soy.$$escapeHtml(resultData43.friendlyModificationDate) + '</td>' + ((hasSocialColumn__soy3) ? '<td class="social">' + ((opt_data.showCommentsCount && resultData43.commentCount != 0) ? '<span class="icon icon-comment"></span> <span class="count">' + soy.$$escapeHtml(resultData43.commentCount) + '</span>' : '') + ((opt_data.showLikesCount && resultData43.likeCount != 0) ? '<span class="icon icon-like"></span> <span class="count">' + soy.$$escapeHtml(resultData43.likeCount) + '</span>' : '') + '</td>' : '') + '</tr>';
      }
    } else {
      output += '<tr><td colspan="3">' + soy.$$escapeHtml("No content found.") + '</td></tr>';
    }
    output += '</tbody></table>' + ((opt_data.searchMoreResultsLinkUrl) ? '<div class="more-results"><a href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.searchMoreResultsLinkUrl) + '">' + soy.$$escapeHtml("Find more results") + '</a></div>' : '');
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.Plugins.ContentReport.contentReportTable.soyTemplateName = 'Confluence.Templates.Plugins.ContentReport.contentReportTable';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-content-report-plugin:resources', location = 'com/atlassian/confluence/plugins/content_report/js/content-report-analytics.js' */
AJS.$(function(A){A(".content-report-table-macro").on("click",".title a",function(D){var B=A(D.delegateTarget).data("analytics-key");
if(B){var C="content-report-table-macro.content-click."+B;
AJS.trigger("analytics",{name:C})
}})
});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-vendor-jquery-jquery-tablesorter', location = 'node_modules/@atlassian/aui/src/js-vendor/jquery/jquery.tablesorter.js' */
("undefined"===typeof window?global:window).__47c4166c48b8c662516d162bc8164e32=function(){var h=jQuery;h.extend({tablesorter:new function(){function e(){var a=arguments[0],b=1<arguments.length?Array.prototype.slice.call(arguments):a;if("undefined"!==typeof console&&"undefined"!==typeof console.log)console[/error/i.test(a)?"error":/warn/i.test(a)?"warn":"log"](b);else alert(b)}function o(a,b){e(a+" ("+((new Date).getTime()-b.getTime())+"ms)")}function p(a){for(var b in a)return!1;return!0}function m(a,
b,c){if(!b)return"";var g,d=a.config,j=d.textExtraction||"",e="",e="basic"===j?h(b).attr(d.textAttribute)||b.textContent||b.innerText||h(b).text()||"":"function"===typeof j?j(b,a,c):"function"===typeof(g=f.getColumnData(a,j,c))?g(b,a,c):b.textContent||b.innerText||h(b).text()||"";return h.trim(e)}function t(a){var b,c,g=a.config,d=g.$tbodies=g.$table.children("tbody:not(."+g.cssInfoBlock+")"),j,u,i,l,k,h,r,n,q,p=0,B="",t=d.length;if(0===t)return g.debug?e("Warning: *Empty table!* Not building a parser cache"):
"";g.debug&&(q=new Date,e("Detecting parsers for each column"));b=[];for(c=[];p<t;){j=d[p].rows;if(j[p]){u=g.columns;for(i=0;i<u;i++){l=g.$headers.filter('[data-column="'+i+'"]:last');k=f.getColumnData(a,g.headers,i);n=f.getParserById(f.getData(l,k,"extractor"));r=f.getParserById(f.getData(l,k,"sorter"));h="false"===f.getData(l,k,"parser");g.empties[i]=f.getData(l,k,"empty")||g.emptyTo||(g.emptyToBottom?"bottom":"top");g.strings[i]=f.getData(l,k,"string")||g.stringTo||"max";h&&(r=f.getParserById("no-parser"));
n||(n=!1);if(!r)a:{l=a;k=j;h=-1;r=i;for(var s=void 0,F=f.parsers.length,C=!1,w="",s=!0;""===w&&s;)h++,k[h]?(C=k[h].cells[r],w=m(l,C,r),l.config.debug&&e("Checking if value was empty on row "+h+", column: "+r+': "'+w+'"')):s=!1;for(;0<=--F;)if((s=f.parsers[F])&&"text"!==s.id&&s.is&&s.is(w,l,C)){r=s;break a}r=f.getParserById("text")}g.debug&&(B+="column:"+i+"; extractor:"+n.id+"; parser:"+r.id+"; string:"+g.strings[i]+"; empty: "+g.empties[i]+"\n");c[i]=r;b[i]=n}}p+=c.length?t:1}g.debug&&(e(B?B:"No parsers detected"),
o("Completed detecting parsers",q));g.parsers=c;g.extractors=b}function s(a){var b,c,g,d,j,u,i,l,k,p,r,n=a.config,q=n.$table.children("tbody"),t=n.extractors,s=n.parsers;n.cache={};n.totalRows=0;if(!s)return n.debug?e("Warning: *Empty table!* Not building a cache"):"";n.debug&&(l=new Date);n.showProcessing&&f.isProcessing(a,!0);for(j=0;j<q.length;j++)if(r=[],b=n.cache[j]={normalized:[]},!q.eq(j).hasClass(n.cssInfoBlock)){k=q[j]&&q[j].rows.length||0;for(g=0;g<k;++g)if(p={child:[]},u=h(q[j].rows[g]),
i=[],u.hasClass(n.cssChildRow)&&0!==g)c=b.normalized.length-1,b.normalized[c][n.columns].$row=b.normalized[c][n.columns].$row.add(u),u.prev().hasClass(n.cssChildRow)||u.prev().addClass(f.css.cssHasChild),p.child[c]=h.trim(u[0].textContent||u[0].innerText||u.text()||"");else{p.$row=u;p.order=g;for(d=0;d<n.columns;++d)if("undefined"===typeof s[d])n.debug&&e("No parser found for cell:",u[0].cells[d],"does it have a header?");else if(c=m(a,u[0].cells[d],d),c="undefined"===typeof t[d].id?c:t[d].format(c,
a,u[0].cells[d],d),c="no-parser"===s[d].id?"":s[d].format(c,a,u[0].cells[d],d),i.push(n.ignoreCase&&"string"===typeof c?c.toLowerCase():c),"numeric"===(s[d].type||"").toLowerCase())r[d]=Math.max(Math.abs(c)||0,r[d]||0);i[n.columns]=p;b.normalized.push(i)}b.colMax=r;n.totalRows+=b.normalized.length}n.showProcessing&&f.isProcessing(a);n.debug&&o("Building cache for "+k+" rows",l)}function w(a,b){var c=a.config,g=c.widgetOptions,d=a.tBodies,j=[],e=c.cache,i,l,k,m,r,n;if(p(e))return c.appender?c.appender(a,
j):a.isUpdating?c.$table.trigger("updateComplete",a):"";c.debug&&(n=new Date);for(r=0;r<d.length;r++)if(i=h(d[r]),i.length&&!i.hasClass(c.cssInfoBlock)){k=f.processTbody(a,i,!0);i=e[r].normalized;l=i.length;for(m=0;m<l;m++)j.push(i[m][c.columns].$row),(!c.appender||c.pager&&(!c.pager.removeRows||!g.pager_removeRows)&&!c.pager.ajax)&&k.append(i[m][c.columns].$row);f.processTbody(a,k,!1)}c.appender&&c.appender(a,j);c.debug&&o("Rebuilt table",n);!b&&!c.appender&&f.applyWidget(a);a.isUpdating&&c.$table.trigger("updateComplete",
a)}function z(a){var b,c,g,d,j,u,i,l=a.config;l.headerList=[];l.headerContent=[];l.debug&&(i=new Date);l.columns=f.computeColumnIndex(l.$table.children("thead, tfoot").children("tr"));d=l.cssIcon?'<i class="'+(l.cssIcon===f.css.icon?f.css.icon:l.cssIcon+" "+f.css.icon)+'"></i>':"";l.$headers=h(a).find(l.selectorHeaders).each(function(i){c=h(this);b=f.getColumnData(a,l.headers,i,!0);l.headerContent[i]=h(this).html();j=l.headerTemplate.replace(/\{content\}/g,h(this).html()).replace(/\{icon\}/g,d);l.onRenderTemplate&&
(g=l.onRenderTemplate.apply(c,[i,j]))&&"string"===typeof g&&(j=g);h(this).html('<div class="'+f.css.headerIn+'">'+j+"</div>");l.onRenderHeader&&l.onRenderHeader.apply(c,[i]);this.column=parseInt(h(this).attr("data-column"),10);var e=f.getData(c,b,"sortInitialOrder")||l.sortInitialOrder;this.order=/^d/i.test(e)||1===e?[1,0,2]:[0,1,2];this.count=-1;this.lockedOrder=!1;u=f.getData(c,b,"lockedOrder")||!1;"undefined"!==typeof u&&!1!==u&&(this.order=this.lockedOrder=/^d/i.test(u)||1===u?[1,1,1]:[0,0,0]);
c.addClass(f.css.header+" "+l.cssHeader);l.headerList[i]=this;c.parent().addClass(f.css.headerRow+" "+l.cssHeaderRow).attr("role","row");l.tabIndex&&c.attr("tabindex",0)}).attr({scope:"col",role:"columnheader"});A(a);l.debug&&(o("Built headers:",i),e(l.$headers))}function y(a,b,c){var g=a.config;g.$table.find(g.selectorRemove).remove();t(a);s(a);D(g.$table,b,c)}function A(a){var b,c,g,d=a.config;d.$headers.each(function(j,e){c=h(e);g=f.getColumnData(a,d.headers,j,!0);b="false"===f.getData(e,g,"sorter")||
"false"===f.getData(e,g,"parser");e.sortDisabled=b;c[b?"addClass":"removeClass"]("sorter-false").attr("aria-disabled",""+b);a.id&&(b?c.removeAttr("aria-controls"):c.attr("aria-controls",a.id))})}function x(a){var b,c,g=a.config,d=g.sortList,j=d.length,e=f.css.sortNone+" "+g.cssNone,i=[f.css.sortAsc+" "+g.cssAsc,f.css.sortDesc+" "+g.cssDesc],l=["ascending","descending"],k=h(a).find("tfoot tr").children().add(g.$extraHeaders).removeClass(i.join(" "));g.$headers.removeClass(i.join(" ")).addClass(e).attr("aria-sort",
"none");for(b=0;b<j;b++)if(2!==d[b][1]&&(a=g.$headers.not(".sorter-false").filter('[data-column="'+d[b][0]+'"]'+(1===j?":last":"")),a.length)){for(c=0;c<a.length;c++)a[c].sortDisabled||a.eq(c).removeClass(e).addClass(i[d[b][1]]).attr("aria-sort",l[d[b][1]]);k.length&&k.filter('[data-column="'+d[b][0]+'"]').removeClass(e).addClass(i[d[b][1]])}g.$headers.not(".sorter-false").each(function(){var a=h(this),b=this.order[(this.count+1)%(g.sortReset?3:2)],b=a.text()+": "+f.language[a.hasClass(f.css.sortAsc)?
"sortAsc":a.hasClass(f.css.sortDesc)?"sortDesc":"sortNone"]+f.language[0===b?"nextAsc":1===b?"nextDesc":"nextNone"];a.attr("aria-label",b)})}function G(a,b,c){if(a.isUpdating)return setTimeout(function(){G(a,b,c)},50);var g,d,j,e,i=a.config,l=!c[i.sortMultiSortKey],k=i.$table;k.trigger("sortStart",a);b.count=c[i.sortResetKey]?2:(b.count+1)%(i.sortReset?3:2);i.sortRestart&&(d=b,i.$headers.each(function(){if(this!==d&&(l||!h(this).is("."+f.css.sortDesc+",."+f.css.sortAsc)))this.count=-1}));d=b.column;
if(l){i.sortList=[];if(null!==i.sortForce){g=i.sortForce;for(j=0;j<g.length;j++)g[j][0]!==d&&i.sortList.push(g[j])}g=b.order[b.count];if(2>g&&(i.sortList.push([d,g]),1<b.colSpan))for(j=1;j<b.colSpan;j++)i.sortList.push([d+j,g])}else{if(i.sortAppend&&1<i.sortList.length)for(j=0;j<i.sortAppend.length;j++)e=f.isValueInArray(i.sortAppend[j][0],i.sortList),0<=e&&i.sortList.splice(e,1);if(0<=f.isValueInArray(d,i.sortList))for(j=0;j<i.sortList.length;j++)e=i.sortList[j],g=i.$headers.filter('[data-column="'+
e[0]+'"]:last')[0],e[0]===d&&(e[1]=g.order[b.count],2===e[1]&&(i.sortList.splice(j,1),g.count=-1));else if(g=b.order[b.count],2>g&&(i.sortList.push([d,g]),1<b.colSpan))for(j=1;j<b.colSpan;j++)i.sortList.push([d+j,g])}if(null!==i.sortAppend){g=i.sortAppend;for(j=0;j<g.length;j++)g[j][0]!==d&&i.sortList.push(g[j])}k.trigger("sortBegin",a);setTimeout(function(){x(a);E(a);w(a);k.trigger("sortEnd",a)},1)}function E(a){var b,c,g,d,j,e,i,h,k,m,r,n=0,q=a.config,s=q.textSorter||"",t=q.sortList,v=t.length,
w=a.tBodies.length;if(!q.serverSideSorting&&!p(q.cache)){q.debug&&(j=new Date);for(c=0;c<w;c++)e=q.cache[c].colMax,i=q.cache[c].normalized,i.sort(function(c,j){for(b=0;b<v;b++){d=t[b][0];h=t[b][1];n=0===h;if(q.sortStable&&c[d]===j[d]&&1===v)break;(g=/n/i.test(q.parsers&&q.parsers[d]?q.parsers[d].type||"":""))&&q.strings[d]?(g="boolean"===typeof q.string[q.strings[d]]?(n?1:-1)*(q.string[q.strings[d]]?-1:1):q.strings[d]?q.string[q.strings[d]]||0:0,k=q.numberSorter?q.numberSorter(c[d],j[d],n,e[d],a):
f["sortNumeric"+(n?"Asc":"Desc")](c[d],j[d],g,e[d],d,a)):(m=n?c:j,r=n?j:c,k="function"===typeof s?s(m[d],r[d],n,d,a):"object"===typeof s&&s.hasOwnProperty(d)?s[d](m[d],r[d],n,d,a):f["sortNatural"+(n?"Asc":"Desc")](c[d],j[d],d,a,q));if(k)return k}return c[q.columns].order-j[q.columns].order});q.debug&&o("Sorting on "+t.toString()+" and dir "+h+" time",j)}}function H(a,b){a[0].isUpdating&&a.trigger("updateComplete");h.isFunction(b)&&b(a[0])}function D(a,b,c){var g=a[0].config.sortList;!1!==b&&!a[0].isProcessing&&
g.length?a.trigger("sorton",[g,function(){H(a,c)},!0]):(H(a,c),f.applyWidget(a[0],!1))}function I(a){var b=a.config,c=b.$table;c.unbind("sortReset update updateRows updateCell updateAll addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave".split(" ").join(b.namespace+" ")).bind("sortReset"+b.namespace,function(g,d){g.stopPropagation();b.sortList=[];x(a);E(a);w(a);h.isFunction(d)&&d(a)}).bind("updateAll"+b.namespace,function(g,d,
c){g.stopPropagation();a.isUpdating=!0;f.refreshWidgets(a,!0,!0);f.restoreHeaders(a);z(a);f.bindEvents(a,b.$headers,!0);I(a);y(a,d,c)}).bind("update"+b.namespace+" updateRows"+b.namespace,function(b,d,c){b.stopPropagation();a.isUpdating=!0;A(a);y(a,d,c)}).bind("updateCell"+b.namespace,function(g,d,j,f){g.stopPropagation();a.isUpdating=!0;c.find(b.selectorRemove).remove();var e,l,k;l=c.find("tbody");k=h(d);g=l.index(h.fn.closest?k.closest("tbody"):k.parents("tbody").filter(":first"));e=h.fn.closest?
k.closest("tr"):k.parents("tr").filter(":first");d=k[0];if(l.length&&0<=g){l=l.eq(g).find("tr").index(e);k=k.index();b.cache[g].normalized[l][b.columns].$row=e;e="undefined"===typeof b.extractors[k].id?m(a,d,k):b.extractors[k].format(m(a,d,k),a,d,k);d="no-parser"===b.parsers[k].id?"":b.parsers[k].format(e,a,d,k);b.cache[g].normalized[l][k]=b.ignoreCase&&"string"===typeof d?d.toLowerCase():d;if("numeric"===(b.parsers[k].type||"").toLowerCase())b.cache[g].colMax[k]=Math.max(Math.abs(d)||0,b.cache[g].colMax[k]||
0);D(c,j,f)}}).bind("addRows"+b.namespace,function(g,d,j,e){g.stopPropagation();a.isUpdating=!0;if(p(b.cache))A(a),y(a,j,e);else{var d=h(d).attr("role","row"),f,l,k,o,r,n=d.filter("tr").length,q=c.find("tbody").index(d.parents("tbody").filter(":first"));(!b.parsers||!b.parsers.length)&&t(a);for(g=0;g<n;g++){l=d[g].cells.length;r=[];o={child:[],$row:d.eq(g),order:b.cache[q].normalized.length};for(f=0;f<l;f++)if(k="undefined"===typeof b.extractors[f].id?m(a,d[g].cells[f],f):b.extractors[f].format(m(a,
d[g].cells[f],f),a,d[g].cells[f],f),k="no-parser"===b.parsers[f].id?"":b.parsers[f].format(k,a,d[g].cells[f],f),r[f]=b.ignoreCase&&"string"===typeof k?k.toLowerCase():k,"numeric"===(b.parsers[f].type||"").toLowerCase())b.cache[q].colMax[f]=Math.max(Math.abs(r[f])||0,b.cache[q].colMax[f]||0);r.push(o);b.cache[q].normalized.push(r)}D(c,j,e)}}).bind("updateComplete"+b.namespace,function(){a.isUpdating=!1}).bind("sorton"+b.namespace,function(b,d,j,e){var i=a.config;b.stopPropagation();c.trigger("sortStart",
this);var l,k,o,m,n,q=a.config,b=d||q.sortList;q.sortList=[];h.each(b,function(a,b){m=parseInt(b[0],10);if(o=q.$headers.filter('[data-column="'+m+'"]:last')[0]){k=(k=(""+b[1]).match(/^(1|d|s|o|n)/))?k[0]:"";switch(k){case "1":case "d":k=1;break;case "s":k=n||0;break;case "o":l=o.order[(n||0)%(q.sortReset?3:2)];k=0===l?1:1===l?0:2;break;case "n":o.count+=1;k=o.order[o.count%(q.sortReset?3:2)];break;default:k=0}n=0===a?k:n;l=[m,parseInt(k,10)||0];q.sortList.push(l);k=h.inArray(l[1],o.order);o.count=
0<=k?k:l[1]%(q.sortReset?3:2)}});x(a);i.delayInit&&p(i.cache)&&s(a);c.trigger("sortBegin",this);E(a);w(a,e);c.trigger("sortEnd",this);f.applyWidget(a);h.isFunction(j)&&j(a)}).bind("appendCache"+b.namespace,function(b,d,c){b.stopPropagation();w(a,c);h.isFunction(d)&&d(a)}).bind("updateCache"+b.namespace,function(c,d){(!b.parsers||!b.parsers.length)&&t(a);s(a);h.isFunction(d)&&d(a)}).bind("applyWidgetId"+b.namespace,function(c,d){c.stopPropagation();f.getWidgetById(d).format(a,b,b.widgetOptions)}).bind("applyWidgets"+
b.namespace,function(b,d){b.stopPropagation();f.applyWidget(a,d)}).bind("refreshWidgets"+b.namespace,function(b,d,c){b.stopPropagation();f.refreshWidgets(a,d,c)}).bind("destroy"+b.namespace,function(b,d,c){b.stopPropagation();f.destroy(a,d,c)}).bind("resetToLoadState"+b.namespace,function(){f.refreshWidgets(a,!0,!0);b=h.extend(!0,f.defaults,b.originalSettings);a.hasInitialized=!1;f.setup(a,b)})}var f=this;f.version="2.17.7";f.parsers=[];f.widgets=[];f.defaults={theme:"default",widthFixed:!1,showProcessing:!1,
headerTemplate:"{content}",onRenderTemplate:null,onRenderHeader:null,cancelSelection:!0,tabIndex:!0,dateFormat:"mmddyyyy",sortMultiSortKey:"shiftKey",sortResetKey:"ctrlKey",usNumberFormat:!0,delayInit:!1,serverSideSorting:!1,headers:{},ignoreCase:!0,sortForce:null,sortList:[],sortAppend:null,sortStable:!1,sortInitialOrder:"asc",sortLocaleCompare:!1,sortReset:!1,sortRestart:!1,emptyTo:"bottom",stringTo:"max",textExtraction:"basic",textAttribute:"data-text",textSorter:null,numberSorter:null,widgets:[],
widgetOptions:{zebra:["even","odd"]},initWidgets:!0,initialized:null,tableClass:"",cssAsc:"",cssDesc:"",cssNone:"",cssHeader:"",cssHeaderRow:"",cssProcessing:"",cssChildRow:"tablesorter-childRow",cssIcon:"tablesorter-icon",cssInfoBlock:"tablesorter-infoOnly",selectorHeaders:"> thead th, > thead td",selectorSort:"th, td",selectorRemove:".remove-me",debug:!1,headerList:[],empties:{},strings:{},parsers:[]};f.css={table:"tablesorter",cssHasChild:"tablesorter-hasChildRow",childRow:"tablesorter-childRow",
header:"tablesorter-header",headerRow:"tablesorter-headerRow",headerIn:"tablesorter-header-inner",icon:"tablesorter-icon",info:"tablesorter-infoOnly",processing:"tablesorter-processing",sortAsc:"tablesorter-headerAsc",sortDesc:"tablesorter-headerDesc",sortNone:"tablesorter-headerUnSorted"};f.language={sortAsc:"Ascending sort applied, ",sortDesc:"Descending sort applied, ",sortNone:"No sort applied, ",nextAsc:"activate to apply an ascending sort",nextDesc:"activate to apply a descending sort",nextNone:"activate to remove the sort"};
f.log=e;f.benchmark=o;f.construct=function(a){return this.each(function(){var b=h.extend(!0,{},f.defaults,a);b.originalSettings=a;!this.hasInitialized&&f.buildTable&&"TABLE"!==this.tagName?f.buildTable(this,b):f.setup(this,b)})};f.setup=function(a,b){if(!a||!a.tHead||0===a.tBodies.length||!0===a.hasInitialized)return b.debug?e("ERROR: stopping initialization! No table, thead, tbody or tablesorter has already been initialized"):"";var c="",g=h(a),d=h.metadata;a.hasInitialized=!1;a.isProcessing=!0;
a.config=b;h.data(a,"tablesorter",b);b.debug&&h.data(a,"startoveralltimer",new Date);var j;j=h.fn.jquery.split(".");j[0]=parseInt(j[0],10);j=1<j[0]||1===j[0]&&4<=parseInt(j[1],10);b.supportsDataObject=j;b.string={max:1,min:-1,emptyMin:1,emptyMax:-1,zero:0,none:0,"null":0,top:!0,bottom:!1};/tablesorter\-/.test(g.attr("class"))||(c=""!==b.theme?" tablesorter-"+b.theme:"");b.table=a;b.$table=g.addClass(f.css.table+" "+b.tableClass+c).attr("role","grid");b.$headers=g.find(b.selectorHeaders);b.namespace=
b.namespace?"."+b.namespace.replace(/\W/g,""):".tablesorter"+Math.random().toString(16).slice(2);b.$table.children().children("tr").attr("role","row");b.$tbodies=g.children("tbody:not(."+b.cssInfoBlock+")").attr({"aria-live":"polite","aria-relevant":"all"});b.$table.find("caption").length&&b.$table.attr("aria-labelledby","theCaption");b.widgetInit={};b.textExtraction=b.$table.attr("data-text-extraction")||b.textExtraction||"basic";z(a);if(a.config.widthFixed&&0===h(a).find("colgroup").length){var u=
h("<colgroup>"),i=h(a).width();h(a.tBodies[0]).find("tr:first").children(":visible").each(function(){u.append(h("<col>").css("width",parseInt(1E3*(h(this).width()/i),10)/10+"%"))});h(a).prepend(u)}t(a);b.totalRows=0;b.delayInit||s(a);f.bindEvents(a,b.$headers,!0);I(a);b.supportsDataObject&&"undefined"!==typeof g.data().sortlist?b.sortList=g.data().sortlist:d&&(g.metadata()&&g.metadata().sortlist)&&(b.sortList=g.metadata().sortlist);f.applyWidget(a,!0);0<b.sortList.length?g.trigger("sorton",[b.sortList,
{},!b.initWidgets,!0]):(x(a),b.initWidgets&&f.applyWidget(a,!1));b.showProcessing&&g.unbind("sortBegin"+b.namespace+" sortEnd"+b.namespace).bind("sortBegin"+b.namespace+" sortEnd"+b.namespace,function(d){clearTimeout(b.processTimer);f.isProcessing(a);if(d.type==="sortBegin")b.processTimer=setTimeout(function(){f.isProcessing(a,true)},500)});a.hasInitialized=!0;a.isProcessing=!1;b.debug&&f.benchmark("Overall initialization time",h.data(a,"startoveralltimer"));g.trigger("tablesorter-initialized",a);
"function"===typeof b.initialized&&b.initialized(a)};f.getColumnData=function(a,b,c,g){if(!("undefined"===typeof b||null===b)){var a=h(a)[0],d,f=a.config;if(b[c])return g?b[c]:b[f.$headers.index(f.$headers.filter('[data-column="'+c+'"]:last'))];for(d in b)if("string"===typeof d&&(a=g?f.$headers.eq(c).filter(d):f.$headers.filter('[data-column="'+c+'"]:last').filter(d),a.length))return b[d]}};f.computeColumnIndex=function(a){var b=[],c=0,g,d,f,e,i,l,k,o,m,n;for(g=0;g<a.length;g++){i=a[g].cells;for(d=
0;d<i.length;d++){f=i[d];e=h(f);l=f.parentNode.rowIndex;e.index();k=f.rowSpan||1;o=f.colSpan||1;"undefined"===typeof b[l]&&(b[l]=[]);for(f=0;f<b[l].length+1;f++)if("undefined"===typeof b[l][f]){m=f;break}c=Math.max(m,c);e.attr({"data-column":m});for(f=l;f<l+k;f++){"undefined"===typeof b[f]&&(b[f]=[]);n=b[f];for(e=m;e<m+o;e++)n[e]="x"}}}return c+1};f.isProcessing=function(a,b,c){var a=h(a),g=a[0].config,d=c||a.find("."+f.css.header);b?("undefined"!==typeof c&&0<g.sortList.length&&(d=d.filter(function(){return this.sortDisabled?
!1:0<=f.isValueInArray(parseFloat(h(this).attr("data-column")),g.sortList)})),a.add(d).addClass(f.css.processing+" "+g.cssProcessing)):a.add(d).removeClass(f.css.processing+" "+g.cssProcessing)};f.processTbody=function(a,b,c){a=h(a)[0];if(c)return a.isProcessing=!0,b.before('<span class="tablesorter-savemyplace"/>'),c=h.fn.detach?b.detach():b.remove();c=h(a).find("span.tablesorter-savemyplace");b.insertAfter(c);c.remove();a.isProcessing=!1};f.clearTableBody=function(a){h(a)[0].config.$tbodies.children().detach()};
f.bindEvents=function(a,b,c){var a=h(a)[0],g,d=a.config;!0!==c&&(d.$extraHeaders=d.$extraHeaders?d.$extraHeaders.add(b):b);b.find(d.selectorSort).add(b.filter(d.selectorSort)).unbind(["mousedown","mouseup","sort","keyup"].join(d.namespace+" ")).bind(["mousedown","mouseup","sort","keyup"].join(d.namespace+" "),function(c,f){var e;e=c.type;if(!((c.which||c.button)!==1&&!/sort|keyup/.test(e)||e==="keyup"&&c.which!==13)&&!(e==="mouseup"&&f!==true&&(new Date).getTime()-g>250)){if(e==="mousedown"){g=(new Date).getTime();
return/(input|select|button|textarea)/i.test(c.target.tagName)?"":!d.cancelSelection}d.delayInit&&p(d.cache)&&s(a);e=h.fn.closest?h(this).closest("th, td")[0]:/TH|TD/.test(this.tagName)?this:h(this).parents("th, td")[0];e=d.$headers[b.index(e)];e.sortDisabled||G(a,e,c)}});d.cancelSelection&&b.attr("unselectable","on").bind("selectstart",!1).css({"user-select":"none",MozUserSelect:"none"})};f.restoreHeaders=function(a){var b=h(a)[0].config;b.$table.find(b.selectorHeaders).each(function(a){h(this).find("."+
f.css.headerIn).length&&h(this).html(b.headerContent[a])})};f.destroy=function(a,b,c){a=h(a)[0];if(a.hasInitialized){f.refreshWidgets(a,!0,!0);var g=h(a),d=a.config,e=g.find("thead:first"),o=e.find("tr."+f.css.headerRow).removeClass(f.css.headerRow+" "+d.cssHeaderRow),i=g.find("tfoot:first > tr").children("th, td");!1===b&&0<=h.inArray("uitheme",d.widgets)&&(g.trigger("applyWidgetId",["uitheme"]),g.trigger("applyWidgetId",["zebra"]));e.find("tr").not(o).remove();g.removeData("tablesorter").unbind("sortReset update updateAll updateRows updateCell addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave keypress sortBegin sortEnd resetToLoadState".split(" ").join(d.namespace+
" "));d.$headers.add(i).removeClass([f.css.header,d.cssHeader,d.cssAsc,d.cssDesc,f.css.sortAsc,f.css.sortDesc,f.css.sortNone].join(" ")).removeAttr("data-column").removeAttr("aria-label").attr("aria-disabled","true");o.find(d.selectorSort).unbind(["mousedown","mouseup","keypress"].join(d.namespace+" "));f.restoreHeaders(a);g.toggleClass(f.css.table+" "+d.tableClass+" tablesorter-"+d.theme,!1===b);a.hasInitialized=!1;delete a.config.cache;"function"===typeof c&&c(a)}};f.regex={chunk:/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,
chunks:/(^\\0|\\0$)/,hex:/^0x[0-9a-f]+$/i};f.sortNatural=function(a,b){if(a===b)return 0;var c,g,d,e,h,i;g=f.regex;if(g.hex.test(b)){c=parseInt(a.match(g.hex),16);d=parseInt(b.match(g.hex),16);if(c<d)return-1;if(c>d)return 1}c=a.replace(g.chunk,"\\0$1\\0").replace(g.chunks,"").split("\\0");g=b.replace(g.chunk,"\\0$1\\0").replace(g.chunks,"").split("\\0");i=Math.max(c.length,g.length);for(h=0;h<i;h++){d=isNaN(c[h])?c[h]||0:parseFloat(c[h])||0;e=isNaN(g[h])?g[h]||0:parseFloat(g[h])||0;if(isNaN(d)!==
isNaN(e))return isNaN(d)?1:-1;typeof d!==typeof e&&(d+="",e+="");if(d<e)return-1;if(d>e)return 1}return 0};f.sortNaturalAsc=function(a,b,c,g,d){if(a===b)return 0;c=d.string[d.empties[c]||d.emptyTo];return""===a&&0!==c?"boolean"===typeof c?c?-1:1:-c||-1:""===b&&0!==c?"boolean"===typeof c?c?1:-1:c||1:f.sortNatural(a,b)};f.sortNaturalDesc=function(a,b,c,g,d){if(a===b)return 0;c=d.string[d.empties[c]||d.emptyTo];return""===a&&0!==c?"boolean"===typeof c?c?-1:1:c||1:""===b&&0!==c?"boolean"===typeof c?c?
1:-1:-c||-1:f.sortNatural(b,a)};f.sortText=function(a,b){return a>b?1:a<b?-1:0};f.getTextValue=function(a,b,c){if(c){for(var g=a?a.length:0,d=c+b,c=0;c<g;c++)d+=a.charCodeAt(c);return b*d}return 0};f.sortNumericAsc=function(a,b,c,g,d,e){if(a===b)return 0;e=e.config;d=e.string[e.empties[d]||e.emptyTo];if(""===a&&0!==d)return"boolean"===typeof d?d?-1:1:-d||-1;if(""===b&&0!==d)return"boolean"===typeof d?d?1:-1:d||1;isNaN(a)&&(a=f.getTextValue(a,c,g));isNaN(b)&&(b=f.getTextValue(b,c,g));return a-b};f.sortNumericDesc=
function(a,b,c,g,d,e){if(a===b)return 0;e=e.config;d=e.string[e.empties[d]||e.emptyTo];if(""===a&&0!==d)return"boolean"===typeof d?d?-1:1:d||1;if(""===b&&0!==d)return"boolean"===typeof d?d?1:-1:-d||-1;isNaN(a)&&(a=f.getTextValue(a,c,g));isNaN(b)&&(b=f.getTextValue(b,c,g));return b-a};f.sortNumeric=function(a,b){return a-b};f.characterEquivalents={a:"\u00e1\u00e0\u00e2\u00e3\u00e4\u0105\u00e5",A:"\u00c1\u00c0\u00c2\u00c3\u00c4\u0104\u00c5",c:"\u00e7\u0107\u010d",C:"\u00c7\u0106\u010c",e:"\u00e9\u00e8\u00ea\u00eb\u011b\u0119",
E:"\u00c9\u00c8\u00ca\u00cb\u011a\u0118",i:"\u00ed\u00ec\u0130\u00ee\u00ef\u0131",I:"\u00cd\u00cc\u0130\u00ce\u00cf",o:"\u00f3\u00f2\u00f4\u00f5\u00f6",O:"\u00d3\u00d2\u00d4\u00d5\u00d6",ss:"\u00df",SS:"\u1e9e",u:"\u00fa\u00f9\u00fb\u00fc\u016f",U:"\u00da\u00d9\u00db\u00dc\u016e"};f.replaceAccents=function(a){var b,c="[",g=f.characterEquivalents;if(!f.characterRegex){f.characterRegexArray={};for(b in g)"string"===typeof b&&(c+=g[b],f.characterRegexArray[b]=RegExp("["+g[b]+"]","g"));f.characterRegex=
RegExp(c+"]")}if(f.characterRegex.test(a))for(b in g)"string"===typeof b&&(a=a.replace(f.characterRegexArray[b],b));return a};f.isValueInArray=function(a,b){var c,g=b.length;for(c=0;c<g;c++)if(b[c][0]===a)return c;return-1};f.addParser=function(a){var b,c=f.parsers.length,g=!0;for(b=0;b<c;b++)f.parsers[b].id.toLowerCase()===a.id.toLowerCase()&&(g=!1);g&&f.parsers.push(a)};f.getParserById=function(a){if("false"==a)return!1;var b,c=f.parsers.length;for(b=0;b<c;b++)if(f.parsers[b].id.toLowerCase()===
a.toString().toLowerCase())return f.parsers[b];return!1};f.addWidget=function(a){f.widgets.push(a)};f.hasWidget=function(a,b){a=h(a);return a.length&&a[0].config&&a[0].config.widgetInit[b]||!1};f.getWidgetById=function(a){var b,c,g=f.widgets.length;for(b=0;b<g;b++)if((c=f.widgets[b])&&c.hasOwnProperty("id")&&c.id.toLowerCase()===a.toLowerCase())return c};f.applyWidget=function(a,b){var a=h(a)[0],c=a.config,g=c.widgetOptions,d=[],e,m,i;if(!(!1!==b&&a.hasInitialized&&(a.isApplyingWidgets||a.isUpdating)))if(c.debug&&
(e=new Date),c.widgets.length&&(a.isApplyingWidgets=!0,c.widgets=h.grep(c.widgets,function(a,b){return h.inArray(a,c.widgets)===b}),h.each(c.widgets||[],function(a,b){if((i=f.getWidgetById(b))&&i.id)i.priority||(i.priority=10),d[a]=i}),d.sort(function(a,b){return a.priority<b.priority?-1:a.priority===b.priority?0:1}),h.each(d,function(d,e){if(e){if(b||!c.widgetInit[e.id])c.widgetInit[e.id]=!0,e.hasOwnProperty("options")&&(g=a.config.widgetOptions=h.extend(!0,{},e.options,g)),e.hasOwnProperty("init")&&
e.init(a,e,c,g);!b&&e.hasOwnProperty("format")&&e.format(a,c,g,!1)}})),setTimeout(function(){a.isApplyingWidgets=false},0),c.debug)m=c.widgets.length,o("Completed "+(!0===b?"initializing ":"applying ")+m+" widget"+(1!==m?"s":""),e)};f.refreshWidgets=function(a,b,c){var a=h(a)[0],g,d=a.config,j=d.widgets,o=f.widgets,i=o.length;for(g=0;g<i;g++)if(o[g]&&o[g].id&&(b||0>h.inArray(o[g].id,j)))d.debug&&e('Refeshing widgets: Removing "'+o[g].id+'"'),o[g].hasOwnProperty("remove")&&d.widgetInit[o[g].id]&&(o[g].remove(a,
d,d.widgetOptions),d.widgetInit[o[g].id]=!1);!0!==c&&f.applyWidget(a,b)};f.getData=function(a,b,c){var e="",a=h(a),d,f;if(!a.length)return"";d=h.metadata?a.metadata():!1;f=" "+(a.attr("class")||"");"undefined"!==typeof a.data(c)||"undefined"!==typeof a.data(c.toLowerCase())?e+=a.data(c)||a.data(c.toLowerCase()):d&&"undefined"!==typeof d[c]?e+=d[c]:b&&"undefined"!==typeof b[c]?e+=b[c]:" "!==f&&f.match(" "+c+"-")&&(e=f.match(RegExp("\\s"+c+"-([\\w-]+)"))[1]||"");return h.trim(e)};f.formatFloat=function(a,
b){if("string"!==typeof a||""===a)return a;var c,a=(b&&b.config?!1!==b.config.usNumberFormat:"undefined"!==typeof b?b:1)?a.replace(/,/g,""):a.replace(/[\s|\.]/g,"").replace(/,/g,".");/^\s*\([.\d]+\)/.test(a)&&(a=a.replace(/^\s*\(([.\d]+)\)/,"-$1"));c=parseFloat(a);return isNaN(c)?h.trim(a):c};f.isDigit=function(a){return isNaN(a)?/^[\-+(]?\d+[)]?$/.test(a.toString().replace(/[,.'"\s]/g,"")):!0}}});var m=h.tablesorter;h.fn.extend({tablesorter:m.construct});m.addParser({id:"no-parser",is:function(){return!1},
format:function(){return""},type:"text"});m.addParser({id:"text",is:function(){return!0},format:function(e,o){var p=o.config;e&&(e=h.trim(p.ignoreCase?e.toLocaleLowerCase():e),e=p.sortLocaleCompare?m.replaceAccents(e):e);return e},type:"text"});m.addParser({id:"digit",is:function(e){return m.isDigit(e)},format:function(e,o){var p=m.formatFloat((e||"").replace(/[^\w,. \-()]/g,""),o);return e&&"number"===typeof p?p:e?h.trim(e&&o.config.ignoreCase?e.toLocaleLowerCase():e):e},type:"numeric"});m.addParser({id:"currency",
is:function(e){return/^\(?\d+[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]|[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+\)?$/.test((e||"").replace(/[+\-,. ]/g,""))},format:function(e,o){var p=m.formatFloat((e||"").replace(/[^\w,. \-()]/g,""),o);return e&&"number"===typeof p?p:e?h.trim(e&&o.config.ignoreCase?e.toLocaleLowerCase():e):e},type:"numeric"});m.addParser({id:"ipAddress",is:function(e){return/^\d{1,3}[\.]\d{1,3}[\.]\d{1,3}[\.]\d{1,3}$/.test(e)},format:function(e,h){var p,v=e?e.split("."):"",t="",s=v.length;
for(p=0;p<s;p++)t+=("00"+v[p]).slice(-3);return e?m.formatFloat(t,h):e},type:"numeric"});m.addParser({id:"url",is:function(e){return/^(https?|ftp|file):\/\//.test(e)},format:function(e){return e?h.trim(e.replace(/(https?|ftp|file):\/\//,"")):e},type:"text"});m.addParser({id:"isoDate",is:function(e){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/.test(e)},format:function(e,h){return e?m.formatFloat(""!==e?(new Date(e.replace(/-/g,"/"))).getTime()||e:"",h):e},type:"numeric"});m.addParser({id:"percent",is:function(e){return/(\d\s*?%|%\s*?\d)/.test(e)&&
15>e.length},format:function(e,h){return e?m.formatFloat(e.replace(/%/g,""),h):e},type:"numeric"});m.addParser({id:"usLongDate",is:function(e){return/^[A-Z]{3,10}\.?\s+\d{1,2},?\s+(\d{4})(\s+\d{1,2}:\d{2}(:\d{2})?(\s+[AP]M)?)?$/i.test(e)||/^\d{1,2}\s+[A-Z]{3,10}\s+\d{4}/i.test(e)},format:function(e,h){return e?m.formatFloat((new Date(e.replace(/(\S)([AP]M)$/i,"$1 $2"))).getTime()||e,h):e},type:"numeric"});m.addParser({id:"shortDate",is:function(e){return/(^\d{1,2}[\/\s]\d{1,2}[\/\s]\d{4})|(^\d{4}[\/\s]\d{1,2}[\/\s]\d{1,2})/.test((e||
"").replace(/\s+/g," ").replace(/[\-.,]/g,"/"))},format:function(e,h,p,v){if(e){var p=h.config,t=p.$headers.filter("[data-column="+v+"]:last"),v=t.length&&t[0].dateFormat||m.getData(t,m.getColumnData(h,p.headers,v),"dateFormat")||p.dateFormat,e=e.replace(/\s+/g," ").replace(/[\-.,]/g,"/");"mmddyyyy"===v?e=e.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,"$3/$1/$2"):"ddmmyyyy"===v?e=e.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,"$3/$2/$1"):"yyyymmdd"===v&&(e=e.replace(/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/,
"$1/$2/$3"))}return e?m.formatFloat((new Date(e)).getTime()||e,h):e},type:"numeric"});m.addParser({id:"time",is:function(e){return/^(([0-2]?\d:[0-5]\d)|([0-1]?\d:[0-5]\d\s?([AP]M)))$/i.test(e)},format:function(e,h){return e?m.formatFloat((new Date("2000/01/01 "+e.replace(/(\S)([AP]M)$/i,"$1 $2"))).getTime()||e,h):e},type:"numeric"});m.addParser({id:"metadata",is:function(){return!1},format:function(e,m,p){e=m.config;e=!e.parserMetadataName?"sortValue":e.parserMetadataName;return h(p).metadata()[e]},
type:"numeric"});m.addWidget({id:"zebra",priority:90,format:function(e,o,p){var v,t,s,w,z,y,A=RegExp(o.cssChildRow,"i"),x=o.$tbodies;o.debug&&(z=new Date);for(e=0;e<x.length;e++)v=x.eq(e),y=v.children("tr").length,1<y&&(s=0,v=v.children("tr:visible").not(o.selectorRemove),v.each(function(){t=h(this);A.test(this.className)||s++;w=0===s%2;t.removeClass(p.zebra[w?1:0]).addClass(p.zebra[w?0:1])}));o.debug&&m.benchmark("Applying Zebra widget",z)},remove:function(e,m,p){for(var v,m=m.$tbodies,t=(p.zebra||
["even","odd"]).join(" "),p=0;p<m.length;p++)v=h.tablesorter.processTbody(e,m.eq(p),!0),v.children().removeClass(t),h.tablesorter.processTbody(e,v,!1)}});!0;return{}}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-tables-sortable', location = 'node_modules/@atlassian/aui/src/js/aui/tables-sortable.js' */
("undefined"===typeof window?global:window).__e53c69a9456096918821d2c4d35fe46a=function(){function h(e){var b=i;e.find("th").each(function(c,e){var a=(0,d.default)(e);b.headers[c]={};a.hasClass("aui-table-column-unsortable")?b.headers[c].sorter=!1:(a.attr("tabindex","0"),a.wrapInner("<span class='aui-table-header-content'/>"),a.hasClass("aui-table-column-issue-key")&&(b.headers[c].sorter="issue-key"))});e.tablesorter(b)}var f={};"use strict";Object.defineProperty(f,"__esModule",{value:!0});var a=
__2fd777cca7fe187ff4048afabed6a6b5,d=a&&a.__esModule?a:{"default":a};__47c4166c48b8c662516d162bc8164e32;var a=(a=__dd0dee18d8910035abf3563b0855343d)&&a.__esModule?a:{"default":a},i={sortMultiSortKey:"",headers:{},debug:!1,tabIndex:!1},g={setup:function(){d.default.tablesorter.addParser({id:"issue-key",is:function(){return!1},format:function(a){var b=a.split("-"),a=b[1],b=(b[0]+"..........").slice(0,10);return b+=("000000"+a).slice(-6)},type:"text"});d.default.tablesorter.addParser({id:"textSortAttributeParser",
is:function(a,b,c){return c.hasAttribute("data-sort-value")&&(!c.hasAttribute("data-sort-type")||"text"===c.getAttribute("data-sort-type"))},format:function(a,b,c){return c.getAttribute("data-sort-value")},type:"text"});d.default.tablesorter.addParser({id:"numericSortAttributeParser",is:function(a,b,c){return"numeric"===c.getAttribute("data-sort-type")&&c.hasAttribute("data-sort-value")},format:function(a,b,c){return c.getAttribute("data-sort-value")},type:"numeric"});(0,d.default)(".aui-table-sortable").each(function(){h((0,
d.default)(this))})},setTableSortable:function(a){h(a)}};(0,d.default)(g.setup);(0,a.default)("tablessortable",g);f.default=g;return f=f["default"]}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-sortable-tables:sortable-table-resources', location = 'js/SortableTables.js' */
define("confluence-sortable-tables/sortable-tables",["jquery","ajs","document"],function(b,g,h){function i(){var a=g.Meta.get("date.format"),b;a&&0!==a.length&&(a=a.toLowerCase()[0],"m"===a?b="mmddyyyy":"d"===a?b="ddmmyyyy":"y"===a&&(b="yyyymmdd"));return b}var f;return{init:function(){f=b("table").filter(function(){var a=b(this),e=a.find("td, th"),d=this.rows.length&&b(this.rows[0].cells),c;if("false"===a.attr("data-sortable")||-1<this.className.indexOf("tablesorter"))return!1;c=b.Event("makeSortable.SortableTables");
a.trigger(c);if(c.isDefaultPrevented()||!d||0===d.length)return!1;c=0;for(var f=e.length;c<f;c++)if(a=e[c],1!=a.rowSpan||1!=a.colSpan)return!1;return b(this.rows[0]).find("table").length||d.filter("th").length!==d.length||d.hasClass("nohighlight")?!1:this.rows[1]})},enable:function(){f.each(function(){if(-1<this.className.indexOf("tablesorter")||b(this).find("> thead:first").is(":visible"))return!0;var a=this.removeChild(this.tBodies[0]),e=b(a.children),e=Array.prototype.shift.call(e),d=h.createDocumentFragment(),
c=h.createElement("thead");d.appendChild(c);c.appendChild(e);d.appendChild(a);this.appendChild(d)});f.tablesorter({cssHeader:"sortableHeader",delayInit:!0,textExtraction:function(a){return g.trim(b(a).text())},dateFormat:i()})},refresh:function(){this.init();this.enable()}}});require("confluence/module-exporter").safeRequire("confluence-sortable-tables/sortable-tables",function(b){require("ajs").toInit(function(){b.init();setTimeout(b.enable,100)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/doctheme-utils.js' */
Confluence.DocThemeUtils=Confluence.DocThemeUtils||(function(f){var e;function c(){return(a().length)?true:false}function a(){if(!e){e=f("#splitter-content")}return e}function g(i){var h=f(i);f(i).appendTo(c()?a():f("body"));return h}function b(){return c()?a().scrollTop():f(document).scrollTop()}function d(){return c()?a().scrollLeft():f(document).scrollLeft()}return{isDocTheme:c,appendAbsolutePositionedElement:g,getMainContentScrollTop:b,getMainContentScrollLeft:d,getDocThemeContentElement:a}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/scrolling-inline-dialog.js' */
Confluence.ScrollingInlineDialog=function(a,d,c,b){var g=Confluence.DocThemeUtils.getDocThemeContentElement();var e=Confluence.DocThemeUtils.isDocTheme();b=b||{};if(!b.container&&e){b.container=g}var f=function(k,s,J,z){var v;var L="auto";var G;var p=-7;var q;var w;var u=e?g.width():AJS.$(window).width();var K=s.target.position();K.top+=e?g.scrollTop():0;K.left+=e?g.scrollLeft():0;var i=s.target.outerWidth();var m=K.left+i/2;var C=e?g.scrollTop()+AJS.$(window).height()-AJS.$("#footer").outerHeight():(window.pageYOffset||document.documentElement.scrollTop)+AJS.$(window).height();var n=10;var o=20;G=K.top+s.target.outerHeight()+z.offsetY;var H=k.find(".arrow").outerWidth();var j=k.outerWidth();var D=s.target.outerWidth();if(z.centerOnHighlight){if(j>D){v=K.left-(j-D)/2;q=m-v-H/2}else{v=K.left+z.offsetX;q=(j-H)/2}}else{v=K.left+z.offsetX;if(j>D){q=m-v-H/2}else{q=(j-H)/2}}q=(q<0)?0:q;var h=(e)?(K.top-g.scrollTop()):(K.top-(window.pageYOffset||document.documentElement.scrollTop));var A=z.maxHeight||0;var t=k.height();var r=h>Math.max(t,A);var l=(G+k.height())<C;w=(!l&&r)||z.onTop;z.onTop=w;var y=u-(v+j+n);if(w){G=K.top-t-8;p=t}if(w===false&&l===false){var x=(G+t)-C;var E=e?g.scrollTop()+x+AJS.$("#footer").outerHeight():(window.pageYOffset||document.documentElement.scrollTop)+x+o;var F=e?g:AJS.$("html, body");F.stop().animate({scrollTop:E},500)}if(z.isRelativeToMouse){if(y<0){L=n;v="auto";q=J.x-(AJS.$(window).width()-z.width)}else{v=J.x-20;q=J.x-v}}else{if(y<0){L=n;v="auto";var I=u-L;var B=I-j;q=m-B-H/2}}return{displayAbove:w,popupCss:{left:v,right:L,top:G},arrowCss:{position:"absolute",left:q,right:"auto",top:p}}};if(!b.calculatePositions){b.calculatePositions=f}return AJS.InlineDialog.call(this,a,d,c,b)};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/highlight-panel.js' */
Confluence.HighlightAction=(function(f){var d={};var c;var b={MAINCONTENT_AND_COMMENT:function(o){return Confluence.HighlightAction.RangeHelper.isSelectionInsideContent(f(".wiki-content"),o)},MAINCONTENT_ONLY:function(o){c=c||f(".wiki-content").first();return Confluence.HighlightAction.RangeHelper.isSelectionInsideContent(c,o)},COMMENT_ONLY:function(o){return Confluence.HighlightAction.RangeHelper.isSelectionInsideContent(f(".comment-content"),o)}};function a(p,q){var o={onClick:function(){},shouldDisplay:b.MAINCONTENT_AND_COMMENT};d[p]=f.extend(o,q)}function l(o){var p=d[o];if(!p){p=function(){AJS.logError("The button with key "+o+" doesn't have a registered handler")}}return p}function e(p){var o=Confluence.getContextPath()+"/rest/highlighting/1.0/insert-storage-fragment";return f.ajax({type:"POST",contentType:"application/json",url:o,data:JSON.stringify(p)})}function g(o){var p=Confluence.getContextPath()+"/rest/highlighting/1.0/insert-storage-column-table";return f.ajax({type:"POST",contentType:"application/json",url:p,data:JSON.stringify(o)})}function k(q,p,r){var o=i(r);o.tableColumnIndex=p;o.cellModifications=q;return o}function h(o,q){var p=i(q);p.xmlModification=o[0].xmlInsertion;return p}function j(o,q){var p=i(q);p.xmlModification=o;return p}function m(){if(window.getSelection){window.getSelection().empty&&window.getSelection().empty();window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}else{window.document.selection&&window.document.selection.empty()}}function i(p){var o={};o.pageId=p.pageId;o.selectedText=p.selectedText;o.index=p.index;o.numMatches=p.numMatches;o.lastFetchTime=n();return o}function n(){return f("meta[name='confluence-request-time']").attr("content")}return{registerButtonHandler:a,getButtonHandler:l,insertContentAtSelectionEnd:e,insertContentsInTableColumnCells:g,createTableInsertionBean:k,createInsertionBean:h,createXMLModificationBean:j,clearTextSelection:m,WORKING_AREA:b}})(AJS.$);Confluence.HighlightAction.RangeHelper=(function(h){function j(p){return{area:c(p),text:k(p),html:n(p),containingElement:d(p),range:p}}function c(q){var r=Confluence.DocThemeUtils.getMainContentScrollTop();var s=Confluence.DocThemeUtils.getMainContentScrollLeft();var w=q.getClientRects();if(!w.length&&q.parentElement()){var x=h(q.parentElement());var p=x.offset();w=[{top:p.top-((Confluence.DocThemeUtils.isDocTheme())?0:r),left:p.left-((Confluence.DocThemeUtils.isDocTheme())?0:s),bottom:p.top+x.height(),right:p.left+x.width()}]}var z=g(q,w);var u=function(E,D){var C={};C.top=E.top;C.left=E.left+s;C.bottom=D.bottom;if(E.left>=D.right){C.right=E.right}else{C.right=D.right}C.right=C.right+s;C.top=C.top+r;C.bottom=C.bottom+r;C.width=C.right-C.left;C.height=C.bottom-C.top;return C};var t=function(D){var C={};C.width=D.right-D.left;C.height=D.bottom-D.top;C.left=D.left+s;C.right=D.right+s;C.top=D.top+r;C.bottom=D.bottom+r;return C};var B=function(C){if(Confluence.DocThemeUtils.isDocTheme()){var D=Confluence.DocThemeUtils.getDocThemeContentElement().offset();C.left=C.left-D.left;C.right=C.right-D.left;C.top=C.top-D.top;C.bottom=C.bottom-D.top}return C};var A=B(u(z.first,z.last));var v=B(t(z.first));if(Confluence.HighlightAction.debug){var y=h("<div>").attr("id","highlight-actions-debug-helper");Confluence.DocThemeUtils.appendAbsolutePositionedElement(y).css(h.extend({position:"absolute",outline:"1px solid red"},A))}return{first:v,average:A}}function k(q){var p=(q.text!=undefined)?q.text:q.toString();return i(p)}function n(p){return(p.cloneContents)?h("<div>").append(p.cloneContents()).html():p.htmlText}function d(q){if(q.commonAncestorContainer){var p=q.commonAncestorContainer;if(p.nodeType==3){return p.parentNode}return p}else{if(q.parentElement){return q.parentElement()}}}function g(r,q){var p={};p.first=q[0];p.last=q[q.length-1];if(r.endOffset!=="undefined"){if(r.endOffset==0&&q.length>1){p.last=q[q.length-2]}}return p}function e(){if(window.getSelection&&window.getSelection().isCollapsed){return false}if(document.selection&&(document.selection.type=="None"||document.selection.createRange().htmlText=="")){return false}var s;if(window.getSelection){var p=window.getSelection();s=p.getRangeAt(p.rangeCount-1)}else{if(document.selection){s=document.selection.createRange()}}if(/^\s*$/.test(k(s))){var q=n(s);if(!q){return false}var r=q.toLowerCase().indexOf("<img ")!=-1;if(!r){return false}}if(!m(h(".wiki-content"),s)){return false}return s}function m(p,s){var q=d(s);var r=function(){var t=false;h.each(p,function(u,v){if(v===q||h.contains(v,q)){t=true;return false}});return t};return r()}function b(r,q){var p=k(o(r,q));var t=h.trim(k(q));var s=a(t,r);p=p.replace(/\s*$/,"");return{pageId:AJS.Meta.get("page-id"),selectedText:t,index:h.inArray(p.length-t.length,s),numMatches:s.length}}function f(p){if(document.createRange){return p.text()}else{range=document.body.createTextRange();range.moveToElementText(p.get(0));return range.text}}function o(r,q){var p;if(document.createRange){p=document.createRange();p.setStart(r.get(0),0);p.setEnd(q.endContainer,q.originalEndOffset)}else{p=document.body.createTextRange();p.moveToElementText(r.get(0));p.setEndPoint("EndToEnd",q)}return p}function a(u,s){var q=f(s);q=l(u,s.clone(),q);q=i(q);var t=0;var r=-1;var p=[];while((r=q.indexOf(u,t))>-1){p.push(r);t=r+1}return p}function l(u,t,r){var s=t.find('.user-mention, a[href^="/"]');t.find('.conf-macro[data-hasbody="false"]').each(function(){if(h(this).text().indexOf(u)>-1){s=s.add(this)}});if(s.length>0){var p=u.replace(/\S/g," ");var q=new RegExp(u.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g");s.each(function(){var v=h(this).text();h(this).text(v.replace(q,p))});return f(t)}return r}function i(p){return p.replace(/\u00a0/g,"\u0020")}return{getRangeOption:j,getUserSelectionRange:e,getSelectionRects:c,getSelectionText:k,getSelectionHTML:n,getContainingElement:d,getFirstAndLastSelectionRect:g,isSelectionInsideContent:m,computeSearchTextObject:b}})(AJS.$);AJS.toInit(function(f){var i=f(".wiki-content").first();var g={ELEMENT_NODE:1,TEXT_NODE:3};var k={IMAGE:"IMG"};var a=f("<div>").attr("id","action-dialog-target");var d;var j="selection-action-panel";var b;var e;function o(){var r=Confluence.getContextPath()+"/rest/highlighting/1.0/panel-items";var q=AJS.Meta.get("page-id");if(q!=undefined){r=r+"?pageId="+q}var s=f.get(r,function(t){if(t.length){m(t)}});h(s)}function m(v){var y=c();var q=29;var z=false;var B=v.length*q;var A=Confluence.HighlightPanel.Templates.panelContent({webItems:v});var x=false;var s=function(D,C,E){if(!x){D.append(A);D.find(".aui-button").tooltip({gravity:"s"});l(D.parent());D.find("button").click(function(H){var F=f(this).attr("data-key");var I=Confluence.HighlightAction.getButtonHandler(F);z=true;d.hide();var G=Confluence.HighlightAction.RangeHelper.getRangeOption(b);if(f.trim(G.text)!==""){G.searchText=Confluence.HighlightAction.RangeHelper.computeSearchTextObject(i,b)}I.onClick(G)})}E();x=true;return false};var w=function(C){var D=false;C.find("button").each(function(E){var G=f(this);var F=G.attr("data-key");var I=Confluence.HighlightAction.getButtonHandler(F);var H=I.shouldDisplay(b);G.css("display",H?"inline-block":"none");D=D||H});if(!D){d.hide()}else{C.find(".contents").width("auto")}};var r=function(){Confluence.HighlightAction.Analytics.sendAnalyticsForOpeningHighlightOptionPanel();w(this.popup);y.bindHideEvents();a.show()};var u=function(){y.unbindHideEvents();a.hide()};var t={centerOnHighlight:true,onTop:true,fadeTime:0,width:B,persistent:true,initCallback:r,hideCallback:u};d=Confluence.ScrollingInlineDialog(a,j,s,t)}function l(q){q.children().attr("unselectable","on").on("selectstart",false)}function h(s){var q;var r=0;var t=1000;f(document).on("mouseup",function(u){s.done(function(w){if(!(w&&w.length>0)){return}var v=f(u.target);if(v.closest(".aui-inline-dialog").length!==0){return}setTimeout(function(){clearTimeout(q);var x=t;if(f(d[0]).is(":visible")){x=r}q=setTimeout(function(){n()},x)},r)})});s.done(function(){AJS.bind("quickedit.success",function(){d.hide()})})}function n(){b=Confluence.HighlightAction.RangeHelper.getUserSelectionRange();var q=function(t){return f.trim(t.toString())!==""};b.originalEndOffset=b.endOffset;if(!b||!q(b)){d.hide();return}var s=Confluence.HighlightAction.RangeHelper.getSelectionRects(b);if(!s){return}var r=p(s);if(r||!f(d[0]).is(":visible")){f(d[0]).hide();d.show()}}function c(){var t=function(){v();s()};var w=function(){q();y()};var r=false;var x=j+".inline-dialog-check";var v=function(){if(!r){f("body").bind("click."+x,function(A){var z=f(A.target);if(z.closest("#inline-dialog-"+j+" .contents").length===0){if(!b){d.hide()}}});r=true}};var q=function(){if(r){f("body").unbind("click."+x)}r=false};var u=function(z){if(z.keyCode===27){d.hide()}};var s=function(){f(document).on("keydown",u)};var y=function(){f(document).off("keydown",u)};return{bindHideEvents:t,unbindHideEvents:w}}function p(r){Confluence.DocThemeUtils.appendAbsolutePositionedElement(a);var q=false;if(!e||r.first.top!=e.first.top||r.first.height!=e.first.height||r.first.left!=e.first.left||r.first.width!=e.first.width){a.css({top:r.first.top,height:r.first.height,left:r.first.left,width:r.first.width});e=r;q=true}return q}o()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/quote-in-comment.js' */
AJS.toInit(function(f){var a=true;var h=false;var d="com.atlassian.confluence.plugins.confluence-highlight-actions:quote-comment";function b(l){var k=l.getBody().createTextRange();k.moveToElementText(l.getBody());k.collapse(false);k.select()}function e(){var k=40;if(Confluence.DocThemeUtils.isDocTheme()){var l=Confluence.DocThemeUtils.getDocThemeContentElement();var m=l.scrollTop()-f("#header").height()+f("#rte-toolbar").offset().top;l.scrollTop(m-k)}else{var m=f("#rte-toolbar").offset().top;f(document).scrollTop(m-k)}}function j(l,m){var n="<p><br/></p>";if(f.browser.msie&&!h){b(l);n="<p></p>"}var k="<blockquote><p>"+m.html+"</p></blockquote>"+n;l.execCommand("mceInsertContent",false,k);h=false}function i(k){Confluence.HighlightAction.clearTextSelection();setTimeout(function(){var l=AJS&&AJS.Rte&&AJS.Rte.getEditor&&AJS.Rte.getEditor();if(l){Confluence.HighlightAction.Analytics.sendAnalyticsForQuoteInComment();e();j(l,k)}else{Confluence.HighlightAction.Analytics.sendAnalyticsForQuoteInComment(a);h=true;var m=function(){j(AJS.Rte.getEditor(),k);AJS.unbind("quickedit.visible",m)};AJS.bind("quickedit.visible",m);c(g(k.containingElement))}},0)}function g(k){var l=f(k).closest("div.comment");return l}function c(k){if(!k.length>0){f(".quick-comment-prompt").click()}else{k.find(".comment-actions .action-reply-comment").click()}}Confluence&&Confluence.HighlightAction&&Confluence.HighlightAction.registerButtonHandler(d,{onClick:i,shouldDisplay:Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_AND_COMMENT})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/js/highlight-analytics.js' */
Confluence.HighlightAction.Analytics=(function(c){var b="confluence.highlight.actions.open";var e="confluence.quote.in.comment.insert";var g="confluence.quote.in.comment.append";function d(h,i){AJS.trigger("analytics",{name:h,data:i})}function a(){d(b)}function f(h){if(h){d(e)}else{d(g)}}return{sendAnalyticsForOpeningHighlightOptionPanel:a,sendAnalyticsForQuoteInComment:f}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-highlight-actions:highlighting-experiment-resources', location = '/soy/templates.soy' */
// This file was automatically generated from templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.HighlightPanel.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.HighlightPanel == 'undefined') { Confluence.HighlightPanel = {}; }
if (typeof Confluence.HighlightPanel.Templates == 'undefined') { Confluence.HighlightPanel.Templates = {}; }


Confluence.HighlightPanel.Templates.panelContent = function(opt_data, opt_ignored) {
  var output = '';
  var webItemList3 = opt_data.webItems;
  var webItemListLen3 = webItemList3.length;
  for (var webItemIndex3 = 0; webItemIndex3 < webItemListLen3; webItemIndex3++) {
    var webItemData3 = webItemList3[webItemIndex3];
    output += '<button data-key="' + soy.$$escapeHtml(webItemData3.key) + '" class="aui-button aui-button-compact aui-button-subtle" title="' + soy.$$escapeHtml(webItemData3.label) + '"><span class="aui-icon aui-icon-small ' + soy.$$escapeHtml(webItemData3.styleClass) + '"/></button>';
  }
  return output;
};
if (goog.DEBUG) {
  Confluence.HighlightPanel.Templates.panelContent.soyTemplateName = 'Confluence.HighlightPanel.Templates.panelContent';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.expand-macro:expand-macro-core', location = 'com/atlassian/confluence/plugins/expand/js/expand-macro-core.js' */
(function(){var a=function(b){this.$=b;this.createToggleFunction=function(e){var d=this.$;return function c(i){if(typeof e!="undefined"&&!e(i)){return}var f=d(this),g=d(".expand-control-icon",f),h=d(".expand-content",f.closest(".expand-container")).first();var j;if(h.hasClass("expand-hidden")){h.css("display","block");h.animate({opacity:1});j="expand"}else{h.animate({opacity:0},{complete:function(){h.hide()}});j="collapse"}h.toggleClass("expand-hidden");g.toggleClass("expanded");AJS.trigger("analyticsEvent",{name:"confluence.expand-macro.expand-click",data:{userAction:j}})}};this.getExpandElements=function(c){return this.$(".expand-control",c)}};Confluence=Confluence||{};Confluence.Plugins=Confluence.Plugins||{};Confluence.Plugins.ExpandMacro={bind:function(b,c,g,f){var e=new a(b);var d=e.getExpandElements(c);d.length&&d.bind(g,e.createToggleFunction(f))}}})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.expand-macro:expand-macro-desktop-resources', location = 'com/atlassian/confluence/plugins/expand/js/expand-macro.js' */
AJS.toInit(function(a){Confluence.Plugins.ExpandMacro.bind(a,a("body"),"click keyup",function(b){return !(b.type=="keyup"&&b.keyCode!=13)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-urlmacro-resources', location = 'com/atlassian/confluence/plugins/sharelinksurlmacro/soy/sharelinks-urlmacro-templates.soy' */
// This file was automatically generated from sharelinks-urlmacro-templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Blueprints.SharelinksUrlMacro.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.SharelinksUrlMacro == 'undefined') { Confluence.Blueprints.SharelinksUrlMacro = {}; }


Confluence.Blueprints.SharelinksUrlMacro.bookmarkletLink = function(opt_data, opt_ignored) {
  return '<a class="aui-button sharelinks-urlmacro-button" href="' + Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript(opt_data) + '"><span>' + soy.$$escapeHtml("Partager sur Confluence") + '</span></a>';
};
if (goog.DEBUG) {
  Confluence.Blueprints.SharelinksUrlMacro.bookmarkletLink.soyTemplateName = 'Confluence.Blueprints.SharelinksUrlMacro.bookmarkletLink';
}


Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript = function(opt_data, opt_ignored) {
  return 'javascript:(function(){var screenWidth=screen.width,screenHeight=screen.height,popupWidth=640,popupHeight=580,popupLeft=0,popupTop=0; if(screenWidth>popupWidth){popupLeft=Math.round((screenWidth/2)-(popupWidth/2));}if(screenHeight>popupHeight){popupTop=Math.round((screenHeight/2)-(popupHeight/2));}window.open(\'' + soy.$$filterNoAutoescape(opt_data.bookmarkletActionURL) + '?bookmarkedURL=\'+encodeURIComponent(window.location.href), \'\',\'left=\'+popupLeft+\',top=\'+popupTop+\',width=\'+popupWidth+\',height=\'+popupHeight+\',personalbar=0,toolbar=0,scrollbars=1,resizable=1\');}());';
};
if (goog.DEBUG) {
  Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript.soyTemplateName = 'Confluence.Blueprints.SharelinksUrlMacro.bookmarkletScript';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:sharelinks-urlmacro-resources', location = 'com/atlassian/confluence/plugins/sharelinksurlmacro/js/sharelinks-urlmacro.js' */
AJS.toInit(function(a){a(".sharelinks-urlmacro-button").click(function(){alert("Faites glisser ce lien jusqu\u0027\u00e0 votre barre d\u0027outils");return false})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:jsUri', location = '/includes/js/third-party/jsUri.js' */
(function(){function g(a){a=decodeURIComponent(a);return a=a.replace("+"," ")}function h(a){var c,b,f,e,d=[];if("undefined"===typeof a||null===a||""===a)return d;0===a.indexOf("?")&&(a=a.substring(1));c=a.toString().split(/[&;]/);for(a=0;a<c.length;a++)b=c[a],f=b.split("="),e=f[0],b=-1===b.indexOf("=")?null:null===f[1]?"":f[1],d.push([e,b]);return d}function d(a){var c=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(a||
""),b={};"source protocol authority userInfo user password host port relative path directory file query anchor".split(" ").forEach(function(a,e){b[a]=c[e]||""});this.uriParts=b;this.queryPairs=h(this.uriParts.query);this.hasAuthorityPrefixUserPref=null}Array.prototype.forEach||(Array.prototype.forEach=function(a,c){for(var b=0,f=this.length;b<f;++b)a.call(c||this,this[b],b,this)});"protocol userInfo host port path anchor".split(" ").forEach(function(a){d.prototype[a]=function(c){typeof c!=="undefined"&&
(this.uriParts[a]=c);return this.uriParts[a]}});d.prototype.hasAuthorityPrefix=function(a){if(typeof a!=="undefined")this.hasAuthorityPrefixUserPref=a;return this.hasAuthorityPrefixUserPref===null?this.uriParts.source.indexOf("//")!==-1:this.hasAuthorityPrefixUserPref};d.prototype.query=function(a){var c="",b;if(typeof a!=="undefined")this.queryPairs=h(a);for(a=0;a<this.queryPairs.length;a++){b=this.queryPairs[a];c.length>0&&(c=c+"&");c=b[1]===null?c+b[0]:c+b.join("=")}return c.length>0?"?"+c:c};
d.prototype.getQueryParamValue=function(a){var c,b;for(b=0;b<this.queryPairs.length;b++){c=this.queryPairs[b];if(g(a)===g(c[0]))return c[1]}};d.prototype.getQueryParamValues=function(a){var c=[],b,f;for(b=0;b<this.queryPairs.length;b++){f=this.queryPairs[b];g(a)===g(f[0])&&c.push(f[1])}return c};d.prototype.deleteQueryParam=function(a,c){var b=[],f,e,d,h;for(f=0;f<this.queryPairs.length;f++){e=this.queryPairs[f];d=g(e[0])===g(a);h=g(e[1])===g(c);(arguments.length===1&&!d||arguments.length===2&&!d&&
!h)&&b.push(e)}this.queryPairs=b;return this};d.prototype.addQueryParam=function(a,c,b){if(arguments.length===3&&b!==-1){b=Math.min(b,this.queryPairs.length);this.queryPairs.splice(b,0,[a,c])}else arguments.length>0&&this.queryPairs.push([a,c]);return this};d.prototype.replaceQueryParam=function(a,c,b){var d=-1,e,h;if(arguments.length===3){for(e=0;e<this.queryPairs.length;e++){h=this.queryPairs[e];if(g(h[0])===g(a)&&decodeURIComponent(h[1])===g(b)){d=e;break}}this.deleteQueryParam(a,b).addQueryParam(a,
c,d)}else{for(e=0;e<this.queryPairs.length;e++){h=this.queryPairs[e];if(g(h[0])===g(a)){d=e;break}}this.deleteQueryParam(a);this.addQueryParam(a,c,d)}return this};"protocol hasAuthorityPrefix userInfo host port path query anchor".split(" ").forEach(function(a){var c="set"+a.charAt(0).toUpperCase()+a.slice(1);d.prototype[c]=function(b){this[a](b);return this}});d.prototype.scheme=function(){var a="";if(this.protocol()){a=a+this.protocol();this.protocol().indexOf(":")!==this.protocol().length-1&&(a=
a+":");a=a+"//"}else this.hasAuthorityPrefix()&&this.host()&&(a=a+"//");return a};d.prototype.origin=function(){var a=this.scheme();if(this.userInfo()&&this.host()){a=a+this.userInfo();this.userInfo().indexOf("@")!==this.userInfo().length-1&&(a=a+"@")}if(this.host()){a=a+this.host();this.port()&&(a=a+(":"+this.port()))}return a};d.prototype.toString=function(){var a=this.origin();if(this.path())a=a+this.path();else if(this.host()&&(this.query().toString()||this.anchor()))a=a+"/";if(this.query().toString()){this.query().toString().indexOf("?")!==
0&&(a=a+"?");a=a+this.query().toString()}if(this.anchor()){this.anchor().indexOf("#")!==0&&(a=a+"#");a=a+this.anchor()}return a};d.prototype.clone=function(){return new d(this.toString())};define("confluence/jsUri",function(){return d})})(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'js/inline-tasks.js' */
(function(g){function f(n){var i,o;if(n.offsetX===undefined){var m=0,l=0,k=n.target,j;do{if(k.scrollTop!=0||k.scrollLeft!=0){j=k}m+=k.offsetLeft;l+=k.offsetTop;k=k.offsetParent}while(k&&k!=k.offsetParent);i=n.pageX+(j?j.scrollLeft:0)-m;o=n.pageY+(j?j.scrollTop:0)-l}else{i=n.offsetX;o=n.offsetY}return i>=3&&i<=14&&o>=3&&o<=14}function e(i){return i.currentTarget===i.target}function d(j){var i="page";if(j.closest("table.tasks-report").length){i="report"}else{if(j.closest("#task-container").length){i="mytasks"}else{if(j.closest("ul.inline-task-list").length){i="task"}}}return i}function h(l,j){var i=l.attr("data-inline-task-id");var k=l.find(j).first();if(k.closest("li").attr("data-inline-task-id")===i){return k}else{return g()}}function c(j){var k=""+j.getFullYear();var l=""+(j.getMonth()+1);var i=""+j.getDate();if(l.length<2){l="0"+l}if(i.length<2){i="0"+i}return[k,l,i].join("-")}var a=false;g(window).bind("beforeunload",function(){a=true});var b=[];g(document).delegate("ul.inline-task-list > li[data-inline-task-id]",{click:function(n){if(e(n)&&f(n)){var l=g(n.target).toggleClass("checked"),i=l.hasClass("checked")?"CHECKED":"UNCHECKED",k=l.data("inline-task-id"),o=l.closest("ul").attr("data-inline-tasks-content-id")||AJS.params.pageId,j=AJS.contextPath()+"/rest/inlinetasks/1/task/"+o+"/"+k+"/";l.prop("disabled",true);var m=l.closest("tr");m.attr("aria-disabled",true);b.push(k);AJS.trigger("inline-tasks.status-update.start",{status:i,taskId:k,taskListQueue:b});g.ajax({type:"POST",url:j,data:{status:i,trigger:"VIEW_PAGE",atl_token:AJS.Meta.get("atl-token")},dataType:"text",timeout:30000,error:function(q,s,p){if(a||s==="timeout"){return}AJS.logError("Inline Task #"+k+" was not persisted to "+i+" because of "+p+" (status: "+s+")");l.toggleClass("checked");var r;if(q.status===403){r=new Confluence.InlineTasks.Notice({textMessage:"Attention, vous ne pouvez pas mettre \u00e0 jour cette t\u00e2che car vous n\u0027\u00eates pas autoris\u00e9 \u00e0 modifier la page sur laquelle elle est affich\u00e9e.",className:"forbidden-notice"})}else{r=new Confluence.InlineTasks.Notice()}r.show()},success:function(){var p={dueDate:h(l,"time").attr("datetime"),completionDate:c(new Date()),mode:"view",assigneeUsername:h(l,".user-mention").attr("data-username"),context:d(l)};if(i==="CHECKED"){AJS.trigger("analyticsEvent",{name:"confluence-spaces.tasks.completed",data:p})}}}).always(function(){l.prop("disabled",false);var p=l.closest("tr");p.attr("aria-disabled",false);b.splice(AJS.indexOf(b,k),1);AJS.trigger("inline-tasks.status-update.complete",{status:i,taskId:k,taskListQueue:b})})}},mousemove:function(i){if(e(i)){if(f(i)){g(i.target).addClass("hover")}else{g(i.target).removeClass("hover")}}},mouseout:function(i){if(e(i)){g(i.target).removeClass("hover")}},mousedown:function(i){if(e(i)&&f(i)){g(i.target).addClass("task-active")}},mouseup:function(i){if(e(i)&&f(i)){g(i.target).removeClass("task-active")}}});g("ul.inline-task-list li:not(.checked) time.date-upcoming").tooltip({title:function(){return "L\u0027\u00e9ch\u00e9ance de cette t\u00e2che est dans moins d\u0027une semaine"},live:true});g("ul.inline-task-list li:not(.checked) time.date-past").tooltip({title:function(){return "Cette t\u00e2che est en retard"},live:true});g("span.emptycompletedate").tooltip({title:function(){return "Une date d\u0027ach\u00e8vement n\u0027a pas \u00e9t\u00e9 enregistr\u00e9e pour cette t\u00e2che"},live:true});g(document).on("click","time",function(){var j=g(this);var i={date:j.attr("datetime"),mode:"view",context:d(j)};AJS.trigger("analyticsEvent",{name:"confluence-spaces.date.clicked",data:i})})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'js/inline-tasks-alert.js' */
Confluence.InlineTasks=Confluence.InlineTasks||{};(function(b){var a=function(c){this.settings=b.extend({},a.DEFAULTS,c);this.template=Confluence.InlineTasks.Templates;b("#inline-tasks-notice").remove();var d=b(this.template.notice(this.settings));d.hide().appendTo("body");d.find(".notice-close").click(function(){d.hide()});this.$notice=d};a.DEFAULTS={textMessage:"Oups! Votre changement sur cette t\u00e2che n\u0027a pas pu \u00eatre enregistr\u00e9. \u003cbr/\u003eIl peut y avoir plusieurs raisons pour cela.",className:"general-notice"};a.prototype.show=function(){this.$notice.show();return this};a.prototype.hide=function(){this.$notice.hide();return this};Confluence.InlineTasks.Notice=a}(AJS.$));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'templates/inline-tasks.soy' */
// This file was automatically generated from inline-tasks.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.InlineTasks.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.InlineTasks == 'undefined') { Confluence.InlineTasks = {}; }
if (typeof Confluence.InlineTasks.Templates == 'undefined') { Confluence.InlineTasks.Templates = {}; }


Confluence.InlineTasks.Templates.notice = function(opt_data, opt_ignored) {
  return '<div class="aui-message error' + ((opt_data.className) ? ' ' + soy.$$escapeHtml(opt_data.className) : '') + '" id="inline-tasks-notice">' + soy.$$filterNoAutoescape(opt_data.textMessage) + '&nbsp;&nbsp;<a href="#" class="notice-close">' + soy.$$escapeHtml("Cacher") + '</a></div>';
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Templates.notice.soyTemplateName = 'Confluence.InlineTasks.Templates.notice';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-resources', location = 'js/inline-tasks-focus.js' */
AJS.$(document).ready(function(f){var d="focusedTaskId";var a=require("confluence/jsUri");var c=new a(window.location.href);var g=c.getQueryParamValue(d);if(g){var b=$("li[data-inline-task-id="+g+"]");if(b.length){b.addClass("focused");window.scrollTo(b.offset().left,(b.offset().top-($(window).height()/2)))}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:sortable-table-server-side', location = 'js/jquery.tablesorter.serveronly.js' */
(function(a){a.extend({tablesorterServerOnly:new function(){this.defaults={classNameDisableSorting:"aui-table-column-unsortable",classNameHeaderDesc:"tablesorter-headerDesc",classNameHeaderAsc:"tablesorter-headerAsc",reverseSort:false,sortColumn:"",onInit:function(){},onSort:function(){},events:{clickHeader:"click.sortServerOnly",refreshHeader:"refreshHeader.sortServerOnly",simulateClickHeader:"simulateClickHeader.sortServerOnly"}};var b=this;var d={updateCurrentHeaderSort:function(e,f){d.resetHeadersSort(e,f);f.$headers.each(function(){var h=a(this),g=h.attr("data-column-name");var i=f.reverseSort;if(g===f.sortColumn){i?h.addClass(f.classNameHeaderDesc):h.addClass(f.classNameHeaderAsc)}})},resetHeadersSort:function(e,f){f.$headers.removeClass(f.classNameHeaderDesc).removeClass(f.classNameHeaderAsc)},prepareHTMLHeader:function(e,f){f.$headers.not("."+f.classNameDisableSorting).attr("unselectable","on").bind("selectstart",false).addClass("tablesorter-header").wrapInner("<span class='aui-table-header-content'/>")},bindEvents:function(f,g){var e=a(f);e.on(g.events.refreshHeader,function(){d.updateCurrentHeaderSort(f,g)});e.on(g.events.simulateClickHeader,function(i,j,h){g.reverseSort=h;g.sortColumn=j})}};var c=function(f,g){var e=a(f);g.$table=e;g.$headers=e.find("thead th");g.$tbodies=e.find("tbody");d.prepareHTMLHeader(f,g);d.updateCurrentHeaderSort(f,g);if(typeof g.onInit==="function"){g.onInit.apply(f,[g])}g.$headers.on(g.events.clickHeader,function(){var h=a(this);if(h.hasClass(g.classNameDisableSorting)){return false}var i=h.attr("data-column-name");if(i===g.sortColumn){g.reverseSort=!g.reverseSort}else{g.reverseSort=false}g.sortColumn=i;if(typeof g.onSort==="function"){g.onSort.apply(f,[g])}return false});d.bindEvents(f,g)};b.construct=function(e){return this.each(function(){var f=this,g=a.extend(true,{},a.tablesorterServerOnly.defaults,e);if(this.config&&f.hasInitialized&&a.tablesorter){a.tablesorter.destroy(f,false,function(){c(f,g)})}else{c(f,g)}})}}()});a.fn.extend({tablesorterServerOnly:a.tablesorterServerOnly.construct})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:sortable-table-server-side', location = 'js/tasks-table-sortable.js' */
(function(a){var b=function(d){this.ajaxUrl=d.ajaxUrl;this.restUrlPagination=d.restUrlPagination;this.$wrapper=d.$wrapper;this.table=d.table;this.$table=a(this.table);this.analyticEventKey=d.analyticEventKey;this.sortColumnDefault=d.sortColumnDefault||"duedate";this.sortReverseSortDefault=d.sortReverseSortDefault||false;this.reportParametersDefault=d.reportParametersDefault;this.pageIndex=d.pageIndex||0;this.pageSize=d.pageSize||10;this.pageTotal=d.pageTotal||0;this.pageLimit=d.pageLimit||7;this.adaptive=d.adaptive;this.columns=d.columns;this.templates=d.templates;this.onRenderEmptyTable=d.onRenderEmptyTable;this.onBusySorting=d.onBusySorting};b.getColumnNameFromSortBy=function(e){var d={"due date":"duedate","page title":"location",assignee:"assignee"};return d[e]?d[e]:"duedate"};b.getSortByFromColumnName=function(d){var e={duedate:"due date",location:"page title"};return e[d]?e[d]:d};b.prototype.updateOptions=function(d){a.extend(this,d);this.$table=a(this.table)};b.prototype.getCurrentPageIndex=function(){var e=this.$wrapper.find(".macro-auto-pagination").last();var d=parseInt(e.attr("data-initial-page-index"),10);return isNaN(d)?0:d};b.prototype.renderPagination=function(e,g){var d=this;if(!e){e=d.$table}if(!g){g=d.reportParametersDefault}this.$wrapper.find(".macro-auto-pagination").remove();if(!(d.pageTotal>1)){return}c.UI.Components.Pagination.build({scope:e,pageSize:d.pageSize,totalPages:d.pageTotal,pageLimit:d.pageLimit,path:d.restUrlPagination,adaptive:d.adaptive,currentPage:d.pageIndex,data:{reportParameters:JSON.stringify(g)},success:function f(h,j){var k={task:h,columns:d.columns};var i=d.templates.tasksReportLine(k);j.append(i)}})};b.prototype.toggleBusyState=function(d){this.$wrapper.attr("data-loading",d);if(d){this.$wrapper.find(".task-blanket").show()}else{this.$wrapper.find(".task-blanket").hide()}if(typeof this.onBusySorting==="function"){this.onBusySorting.apply(this,[d])}};b.prototype.renderTable=function(e){var d=this;var f=_.map(e,function(g){return d.templates.tasksReportLine({task:g,columns:d.columns})}).join("");d.$table.find("tbody").html(f);c.Binder.userHover()};b.prototype._triggerAnalyticsSorting=function(){var d=this.analyticEventKey;var e={column:this.sortColumn,direction:this.reverseSort?"desc":"asc"};AJS.trigger("analyticsEvent",{name:d,data:e})};b.prototype._buildAjaxData=function(e){var d={url:this.ajaxUrl,cache:false,dataType:"json",data:{pageIndex:this.pageIndex,pageSize:this.pageSize,reportParameters:JSON.stringify(e)}};return d};b.prototype.init=function(){var d=this;d.sortColumn=d.sortColumnDefault;d.reverseSort=d.sortReverseSortDefault;this.$table.tablesorterServerOnly({sortColumn:d.sortColumn,reverseSort:d.reverseSort,onInit:function(){var e=a(this);e.addClass("aui-table-sortable")},onSort:function(i){var h=this,f=a(h);d.pageIndex=d.getCurrentPageIndex();d.sortColumn=i.sortColumn;d.reverseSort=i.reverseSort;d.toggleBusyState(true);var g=a.extend({},d.reportParametersDefault,{sortColumn:b.getSortByFromColumnName(d.sortColumn),reverseSort:d.reverseSort});var e=d._buildAjaxData(g);a.ajax(e).done(function(j){d.pageIndex=d.getCurrentPageIndex();d.pageTotal=j.totalPages;if(d.pageIndex===0&&d.pageTotal===0){if(typeof d.onRenderEmptyTable==="function"){d.$wrapper.find(".macro-auto-pagination").remove();f.remove();d.onRenderEmptyTable.apply(d)}return}d.renderTable(j.detailLines);d.renderPagination(null,g);f.trigger("refreshHeader.sortServerOnly");d._triggerAnalyticsSorting()}).fail(function(){var j=new c.InlineTasks.Notice({textMessage:"Nous ne pouvons pas organiser vos t\u00e2ches pour le moment. Veuillez rafra\u00eechir la page et r\u00e9essayer.",className:"forbidden-notice"});j.show()}).always(function(){d.toggleBusyState(false)})}})};var c=window.Confluence||{};c.InlineTasks=c.InlineTasks||{};c.InlineTasks.TasksTableSortable=b})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:common', location = '/js/namespace.js' */
window.Confluence||(window.Confluence={});window.Confluence.UI||(window.Confluence.UI={});window.Confluence.UI.Components||(window.Confluence.UI.Components={});window.Confluence.UI.Components.Pagination||(window.Confluence.UI.Components.Pagination={});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:common', location = '/js/internal/dark-features.js' */
define("confluence-ui-components/dark-features",["ajs"],function(a){return a.DarkFeatures});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:pagination', location = '/js/pagination.js' */
(function(e,c){var d=function(j,k,i){var h=j.find("a").attr("aria-disabled",i);if(i){h.attr("disabled","disabled")}else{h.removeAttr("disabled");var g=e(".aui-nav-selected",j).data("index")+1;j.find(".aui-nav-next > a").attr("aria-disabled",g==k);j.find(".aui-nav-previous > a").attr("aria-disabled",g==1)}};var b={scope:null,success:null,data:null,path:"",url:"#",pageLimit:7,currentPage:0,adaptive:false,totalPages:0,pageSize:0};var f=function(i,j,k){var g=Math.floor(k/2);var h=j-1;if(!k||j<=k||i-g<0){return 0}if(i+g>h){return j-k}return i-g};var a=function(l){var k=l.totalPages,j=l.currentPage,m=l.pageLimit,h=l.adaptive,g;if(m){if(h){k=j+m}g=m}else{g=k}var i=f(j,k,m);return Confluence.UI.Components.Pagination.Templates.paginationFooter({currentPage:j||0,startPage:i,itemsToRender:g,totalPages:k,pageSize:l.pageSize,url:l.url||"#"})};c.build=function(j){var h=_.extend({},b,j);if(typeof h.success!=="function"){h.success=function(){}}var k=a(h);h.scope.after(k);var i=h.scope.next();var g=i.data("initial-page-index");i.on("click","a",function(p){var o=e(this),r=o.parents("ol").prev(),n=r.is("table")?r:r.find("table");var l=n.data("pageIndex")||g,q=o.parent("li");if(q.hasClass("aui-nav-selected")||q.find("> a[aria-disabled=true]").length){return}if(q.hasClass("aui-nav-next")){l++}else{if(q.hasClass("aui-nav-previous")){l--}else{l=q.data("index")}}d(i,h.totalPages,true);var m=e.extend({},{pageSize:h.pageSize,pageIndex:l},h.data);e.getJSON(Confluence.getContextPath()+h.path,m).done(function(t){l=t.currentPage;var s=n.find("tbody");s.find("tr").remove();n.data("pageIndex",l);_.each(t.detailLines,function(v){h.success(v,s)});AJS.trigger("ui.components.pagination.updated",[t,h]);var u=e.extend({},h,{totalPages:t.totalPages,adaptive:t.adaptive,currentPage:l});i.html(a(u));d(i,u.totalPages,false);Confluence.Binder.userHover()}).fail(function(){d(i,h.totalPages,false)});p.preventDefault()})}})(AJS.$,window.Confluence.UI.Components.Pagination);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:pagination', location = '/soy/pagination.soy' */
// This file was automatically generated from pagination.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.UI.Components.Pagination.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.UI == 'undefined') { Confluence.UI = {}; }
if (typeof Confluence.UI.Components == 'undefined') { Confluence.UI.Components = {}; }
if (typeof Confluence.UI.Components.Pagination == 'undefined') { Confluence.UI.Components.Pagination = {}; }
if (typeof Confluence.UI.Components.Pagination.Templates == 'undefined') { Confluence.UI.Components.Pagination.Templates = {}; }


Confluence.UI.Components.Pagination.Templates.paginationFooter = function(opt_data, opt_ignored) {
  var output = '<ol class="aui-nav aui-nav-pagination macro-auto-pagination" data-page-size="' + soy.$$escapeHtml(opt_data.pageSize) + '" data-initial-page-index="' + soy.$$escapeHtml(opt_data.currentPage) + '"><li class="aui-nav-previous"><a ' + ((opt_data.currentPage == 0) ? 'aria-disabled="true"' : 'href="#"') + '>' + soy.$$escapeHtml("Pr\xe9c.") + '</a></li>';
  var startIdx__soy16 = opt_data.startPage + 1;
  var currentIdx__soy17 = opt_data.currentPage + 1;
  var endIdx__soy18 = startIdx__soy16 + opt_data.itemsToRender;
  var totalRange__soy19 = opt_data.totalPages + 1;
  var indexInit20 = startIdx__soy16;
  var indexLimit20 = endIdx__soy18 < totalRange__soy19 ? endIdx__soy18 : totalRange__soy19;
  for (var index20 = indexInit20; index20 < indexLimit20; index20++) {
    output += (index20 == currentIdx__soy17) ? '<li class="aui-nav-selected" data-index="' + soy.$$escapeHtml(index20 - 1) + '">' + soy.$$escapeHtml(index20) + '</li>' : '<li data-index="' + soy.$$escapeHtml(index20 - 1) + '"><a href="#">' + soy.$$escapeHtml(index20) + '</a></li>';
  }
  output += '<li class="aui-nav-next"><a ' + ((currentIdx__soy17 == opt_data.totalPages) ? 'aria-disabled="true"' : 'href="' + soy.$$escapeHtml(opt_data.url) + '"') + '>' + soy.$$escapeHtml("Suivant") + '</a></li></ol>';
  return output;
};
if (goog.DEBUG) {
  Confluence.UI.Components.Pagination.Templates.paginationFooter.soyTemplateName = 'Confluence.UI.Components.Pagination.Templates.paginationFooter';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:blank-placeholder-box', location = 'soy/blank-placeholder-box.soy' */
// This file was automatically generated from blank-placeholder-box.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.UI.Components.BlankPlaceholderBox.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.UI == 'undefined') { Confluence.UI = {}; }
if (typeof Confluence.UI.Components == 'undefined') { Confluence.UI.Components = {}; }
if (typeof Confluence.UI.Components.BlankPlaceholderBox == 'undefined') { Confluence.UI.Components.BlankPlaceholderBox = {}; }
if (typeof Confluence.UI.Components.BlankPlaceholderBox.Templates == 'undefined') { Confluence.UI.Components.BlankPlaceholderBox.Templates = {}; }


Confluence.UI.Components.BlankPlaceholderBox.Templates.blankBox = function(opt_data, opt_ignored) {
  return '<div class="blank-placeholder-box ' + ((opt_data.customClass) ? soy.$$escapeHtml(opt_data.customClass) : '') + '"><div class="content"><h2>' + soy.$$escapeHtml(opt_data.blankTitle) + '</h2><p>' + soy.$$escapeHtml(opt_data.blankDescription) + '</p></div>' + ((opt_data.customHtml) ? soy.$$filterNoAutoescape(opt_data.customHtml) : '') + '</div>';
};
if (goog.DEBUG) {
  Confluence.UI.Components.BlankPlaceholderBox.Templates.blankBox.soyTemplateName = 'Confluence.UI.Components.BlankPlaceholderBox.Templates.blankBox';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:tasks-report-resources', location = 'templates/tasks-report.soy' */
// This file was automatically generated from tasks-report.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.InlineTasks.Report.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.InlineTasks == 'undefined') { Confluence.InlineTasks = {}; }
if (typeof Confluence.InlineTasks.Report == 'undefined') { Confluence.InlineTasks.Report = {}; }
if (typeof Confluence.InlineTasks.Report.Templates == 'undefined') { Confluence.InlineTasks.Report.Templates = {}; }


Confluence.InlineTasks.Report.Templates.tasksReport = function(opt_data, opt_ignored) {
  var output = '<div class="table-wrapper" data-loading="false"><div class="task-blanket"></div><input type="hidden" name="reportParameters" value="' + soy.$$escapeHtml(opt_data.reportParameters) + '" /><table class="aui aui-table-interactive tasks-report" data-sortable="false" data-total-pages="' + soy.$$escapeHtml(opt_data.totalPages) + '" data-page-size="' + soy.$$escapeHtml(opt_data.pageSize) + '" data-adaptive="' + soy.$$escapeHtml(opt_data.adaptive) + '" data-page-limit="' + soy.$$escapeHtml(opt_data.pageLimit) + '"><thead><tr class="tablesorter-headerRow">';
  var headingList14 = opt_data.headings;
  var headingListLen14 = headingList14.length;
  for (var headingIndex14 = 0; headingIndex14 < headingListLen14; headingIndex14++) {
    var headingData14 = headingList14[headingIndex14];
    output += '<th class="header-' + soy.$$escapeHtml(headingData14) + ((headingData14 == 'description') ? ' aui-table-column-unsortable' : '') + '" data-column-name="' + soy.$$escapeHtml(headingData14) + '">' + soy.$$escapeHtml(opt_data.headingTexts[headingData14]) + '</th>';
  }
  output += '</tr></thead><tbody>';
  if (opt_data.tasks.length) {
    var taskList29 = opt_data.tasks;
    var taskListLen29 = taskList29.length;
    for (var taskIndex29 = 0; taskIndex29 < taskListLen29; taskIndex29++) {
      var taskData29 = taskList29[taskIndex29];
      output += Confluence.InlineTasks.Report.Templates.tasksReportLine({task: taskData29, columns: opt_data.headings});
    }
  } else {
    output += '<tr><td colspan="' + soy.$$escapeHtml(opt_data.headings.length) + '">' + soy.$$escapeHtml("Cr\xe9ez une liste de t\xe2ches dans une page Confluence pour suivre les t\xe2ches que vous avez \xe0 effectuer.") + '</td></tr>';
  }
  output += '</tbody></table></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.tasksReport.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.tasksReport';
}


Confluence.InlineTasks.Report.Templates.tasksFeatureDiscoveryNotification = function(opt_data, opt_ignored) {
  return '<h2>' + soy.$$escapeHtml("Saviez-vous que...") + '</h2><p>' + soy.$$escapeHtml("Vous pouvez afficher les t\xe2ches que vous avez cr\xe9\xe9es ou qui vous ont \xe9t\xe9 attribu\xe9es dans les onglets de t\xe2ches de votre profil.") + '</p>';
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.tasksFeatureDiscoveryNotification.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.tasksFeatureDiscoveryNotification';
}


Confluence.InlineTasks.Report.Templates.tasksReportLine = function(opt_data, opt_ignored) {
  var output = '<tr data-task-id="' + soy.$$escapeHtml(opt_data.task.taskId) + '" aria-disabled="false">';
  var columnList51 = opt_data.columns;
  var columnListLen51 = columnList51.length;
  for (var columnIndex51 = 0; columnIndex51 < columnListLen51; columnIndex51++) {
    var columnData51 = columnList51[columnIndex51];
    if (columnData51 == 'duedate') {
      output += '<td class=\'tasks-report-date\'>' + ((opt_data.task.dueDate) ? soy.$$escapeHtml(opt_data.task.dueDate) : '') + '</td>';
    } else if (columnData51 == 'description') {
      output += '<td>' + soy.$$filterNoAutoescape(opt_data.task.taskHtml) + '</td>';
    } else if (columnData51 == 'assignee') {
      output += '<td class=\'tasks-report-assignee\'>' + ((opt_data.task.assigneeUserName) ? Confluence.Templates.User.usernameLink({username: opt_data.task.assigneeUserName, fullName: opt_data.task.assigneeFullName, canView: false}) : '') + '</td>';
    } else if (columnData51 == 'location') {
      output += '<td><a class=\'task-location\' href="' + soy.$$escapeHtml("") + soy.$$escapeHtml(opt_data.task.pageUrl) + '">' + soy.$$escapeHtml(opt_data.task.pageTitle) + '</a></td>';
    } else if (columnData51 == 'completedate') {
      output += '<td class=\'tasks-report-date\'>' + ((opt_data.task.completeDate) ? soy.$$escapeHtml(opt_data.task.completeDate) : (opt_data.task.taskCompleted) ? '<span class="emptycompletedate">--</span>' : '') + '</td>';
    } else if (columnData51 == 'labels') {
      output += '<td>';
      var labelList90 = opt_data.task.labels;
      var labelListLen90 = labelList90.length;
      for (var labelIndex90 = 0; labelIndex90 < labelListLen90; labelIndex90++) {
        var labelData90 = labelList90[labelIndex90];
        output += aui.labels.label({text: labelData90});
      }
      output += '</td>';
    }
  }
  output += '</tr>';
  return output;
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.tasksReportLine.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.tasksReportLine';
}


Confluence.InlineTasks.Report.Templates.taskReportBrowserWarning = function(opt_data, opt_ignored) {
  var param98 = '<p>' + soy.$$escapeHtml("Impossible d\x27afficher ce rapport de t\xe2che.") + '</p>';
  var messageList102 = opt_data.messages;
  var messageListLen102 = messageList102.length;
  for (var messageIndex102 = 0; messageIndex102 < messageListLen102; messageIndex102++) {
    var messageData102 = messageList102[messageIndex102];
    param98 += '<p>' + soy.$$escapeHtml(messageData102) + '</p>';
  }
  var output = '' + aui.message.warning({content: param98});
  return output;
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.taskReportBrowserWarning.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.taskReportBrowserWarning';
}


Confluence.InlineTasks.Report.Templates.taskReportWarning = function(opt_data, opt_ignored) {
  return '' + aui.message.warning({content: '<p>' + soy.$$escapeHtml("Impossible d\x27afficher le rapport de t\xe2che. Modifiez cette page pour r\xe9soudre les demandes.") + '</p>'});
};
if (goog.DEBUG) {
  Confluence.InlineTasks.Report.Templates.taskReportWarning.soyTemplateName = 'Confluence.InlineTasks.Report.Templates.taskReportWarning';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:tasks-report-resources', location = 'js/tasks-report-blank-exp.js' */
(function(b){Confluence.InlineTasks=Confluence.InlineTasks||{};Confluence.InlineTasks.TasksReport=Confluence.InlineTasks.TasksReport||{};var a={"blank.complete.title":"Rapport de t\u00e2che","blank.complete.desc":"Remuez-vous, aucune t\u00e2che n\u0027a encore \u00e9t\u00e9 termin\u00e9e.","blank.incomplete.title":"Rapport de t\u00e2che","blank.incomplete.desc":"Tout a l\u0027air bon, pas de t\u00e2ches incompl\u00e8tes."};Confluence.InlineTasks.TasksReport.renderBlankExperiences=function(g,c){if(!c){c="incomplete"}var f=a["blank."+c+".title"],e=a["blank."+c+".desc"];var d=Confluence.UI.Components.BlankPlaceholderBox.Templates.blankBox({blankTitle:f,blankDescription:e,customClass:c+" tasks-report-blank"});g.html(d)}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:tasks-report-resources', location = 'js/tasks-report.js' */
AJS.$(function(c){var b="/rest/inlinetasks/1/task-report/",a=Confluence.InlineTasks.Report.Templates,e=Confluence.InlineTasks.TasksTableSortable;var d=c(".tasks-report").parent();_.each(d,function(i){var l=c(i),n=l.find("table.tasks-report"),m=n.data("page-size"),k=n.data("total-pages"),f=n.data("page-limit"),q=n.data("adaptive"),p=l.find("input[name=reportParameters]").val(),g=JSON.parse(p);var o=function(r,s){c(r).attr("aria-disabled",s)};AJS.bind("inline-tasks.status-update.start",function(t,s){if(s.taskListQueue.length>0){var r=c("li[data-inline-task-id="+s.taskId+"]").closest(".tasks-report").siblings(".macro-auto-pagination");o(r,true);r=r.find("li a");r.on("click.taskreport.pagination",function(u){u.preventDefault();u.stopPropagation()})}});AJS.bind("inline-tasks.status-update.complete",function(s,r){if(r.taskListQueue.length===0){o(".macro-auto-pagination",false);c(".macro-auto-pagination li a").off("click.taskreport.pagination")}});var j=n.closest(".table-wrapper");var h=new e({$wrapper:j,table:n[0],sortReverseSortDefault:g.reverseSort,sortColumnDefault:e.getColumnNameFromSortBy(g.sortColumn),reportParametersDefault:g,pageIndex:0,pageSize:m,pageTotal:k,adaptive:q,pageLimit:f,templates:a,columns:g.columns,onRenderEmptyTable:function(){Confluence.InlineTasks.TasksReport.renderBlankExperiences(j,g.status)},analyticEventKey:"confluence-spaces.tasks.report.sorted",restUrlPagination:b,ajaxUrl:Confluence.getContextPath()+b});h.init();if(q||k>1){h.renderPagination()}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-help-tips:common', location = 'js/help-tip.js' */
(function(f){function b(){return false}function d(){return true}var l=0,g=new Date().getTime();var k=AJS.contextPath()+"/rest/helptips/1.0/tips";function h(n){n=""+(n||"");return n.replace(/\./g,"-")}function j(o,n){if(AJS.EventQueue&&n&&n.attributes.id){var q={};var p=h(n.attributes.id);q.name="helptips."+p+"."+o;q.properties={};AJS.EventQueue.push(q)}}function c(){return"c"+g+(l++)}var a={dismissedTipIds:[],loaded:f.Deferred(),url:function(){return k},sync:function(o,n){o||(o="get");n||(n=null);return f.ajax(this.url(),{type:o,context:this,dataType:"json",contentType:"application/json",data:n&&JSON.stringify(n),processData:false}).promise()},fetch:function(){var n=this.sync();n.done(function(o){f.merge(this.dismissedTipIds,o);this.loaded.resolve()});return n.promise()},show:function(n){this.loaded.done(n)},dismiss:function(n){var o=n.attributes.id;if(!o){n._dismissed=true}else{this.dismissedTipIds.push(o);this.sync("post",{id:o})}},undismiss:function(n){var o=n.attributes.id;if(!o){n._dismissed=false}else{this.dismissedTipIds.splice(f.inArray(o,this.dismissedTipIds),1);this.sync("delete",{id:o})}},isDismissed:function(n){var o=n.attributes.id;return(o)?f.inArray(o,this.dismissedTipIds)>=0:n._dismissed}};var e=AJS.HelpTip=function(n){var o;this.attributes=f.extend({},n);this.attributes.id||(this.attributes.id=false);if(this.attributes.body){this.attributes.bodyHtml=this.attributes.body;delete this.attributes.body}this.cid=c();o=this.attributes.anchor;delete this.attributes.anchor;this.view=o?new i(this,o):new m(this);this.view.$el.addClass("aui-help-tip")};AJS.HelpTip.Manager=a;f.extend(e.prototype,{show:function(){var n=this;AJS.HelpTip.Manager.show(function(){if(!n.isDismissed()){if(AJS.Popups&&AJS.Popups.DisplayController){AJS.Popups.DisplayController.request({name:n.id,weight:1000,show:function(){n.view.show()}})}else{n.view.show()}j("shown",n)}})},dismiss:function(){var n=h(arguments[0]||"programmatically");this.view.dismiss();if(!this.isDismissed()){AJS.HelpTip.Manager.dismiss(this);j("dismissed."+n,this)}},isVisible:function(){return this.view.$el.is(":visible")},isDismissed:function(){return AJS.HelpTip.Manager.isDismissed(this)}});var i=function(o,n){this.initialize(o,n)};f.extend(i.prototype,{initialize:function(r,q){var o=this;var s=q.prop("ownerDocument");var p=s!=window.document;if(p){var n=f("iframe").filter(function(){return this.contentDocument==s});n.contents().scroll(function(){var v=f(this).contents().find("body").scrollTop();var w=n.offset().top;var u=o.popup.data("offset-top");var t=o.popup.find(".arrow").height();o.popup.css("top",u-v);o.popup.toggle(v<=u-w-t&&v+n.height()-t+w-o.popup.height()>=u)})}this.model=r;this.beforeHide=b;this.dismissButton=f(AJS.Templates.HelpTip.tipDismiss());this.dismissButton.click(function(t){r.dismiss("close-button");t.preventDefault()});this.popup=AJS.InlineDialog(q,r.cid,function(v,u,t){v.html(AJS.Templates.HelpTip.tipContent(r.attributes));v.find(".helptip-body").after(o.dismissButton);v.unbind("mouseover mouseout");v.find(".helptip-link").click(function(){j("learn-more.clicked",r)});t()},{container:"body",noBind:true,preHideCallback:function(){return o.beforeHide()},calculatePositions:function(t,y,z,x){var w=AJS.InlineDialog.opts.calculatePositions(t,y,z,x);if(p){var v=t.find(".arrow").height();var u=n.contents().find("body").scrollTop();w.popupCss.top=n.offset().top+(q.offset().top-u)+q.height()+v;w.popupCss.left=q.offset().left;n.contents().scroll()}t.data("offset-top",w.popupCss.top);return w}});this.popup.refresh();this._popupHide=this.popup.hide;this.popup.hide=b;this.$el=f(this.popup[0]);AJS.$(document).bind("showLayer",function(v,u,t){if(u==="inlineDialog"&&t.id===r.cid){AJS.InlineDialog.current=null;AJS.$(document.body).unbind("click."+r.cid+".inline-dialog-check");t._validateClickToClose=b;t.hide=b}})},show:function(){var n=this.popup,o=function(p){if(!n.has(p.target).length){n.shadow.remove();n.remove()}};n.show()},dismiss:function(){this.beforeHide=d;this._popupHide()}});var m=function(n){this.initialize(n)};f.extend(m.prototype,{initialize:function(){this.$el=f("<div />")},show:f.noop,dismiss:f.noop});if(AJS.Meta.get("remote-user")){a.fetch()}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-help-tips:common', location = 'templates/help-tip.soy' */
// This file was automatically generated from help-tip.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace AJS.Templates.HelpTip.
 */

if (typeof AJS == 'undefined') { var AJS = {}; }
if (typeof AJS.Templates == 'undefined') { AJS.Templates = {}; }
if (typeof AJS.Templates.HelpTip == 'undefined') { AJS.Templates.HelpTip = {}; }


AJS.Templates.HelpTip.tipContent = function(opt_data, opt_ignored) {
  return ((opt_data.title) ? '<h4 class="helptip-title">' + soy.$$escapeHtml(opt_data.title) + '</h4>' : '') + '<div class="helptip-body">' + soy.$$filterNoAutoescape(opt_data.bodyHtml) + '</div>' + ((opt_data.url) ? '<a class="helptip-link" href="' + soy.$$escapeHtml(opt_data.url) + '" target="_blank">' + soy.$$escapeHtml("En savoir plus") + '</a>' : '');
};
if (goog.DEBUG) {
  AJS.Templates.HelpTip.tipContent.soyTemplateName = 'AJS.Templates.HelpTip.tipContent';
}


AJS.Templates.HelpTip.tipDismiss = function(opt_data, opt_ignored) {
  return '<button class="helptip-dismiss aui-button" type="button">' + soy.$$escapeHtml("Ignorer") + '</button>';
};
if (goog.DEBUG) {
  AJS.Templates.HelpTip.tipDismiss.soyTemplateName = 'AJS.Templates.HelpTip.tipDismiss';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:tasks-feature-discovery-resources', location = 'js/tasks-discovery.js' */
(function(d){var c="com.atlassian.confluence.plugins.confluence-jira-metadata";var b="inline-tasks-flag";function a(){if(!!AJS.HelpTip){var e={id:null,body:Confluence.InlineTasks.Report.Templates.tasksFeatureDiscoveryNotification(),anchor:d("#user-menu-link")};var f=new AJS.HelpTip(e);AJS.trigger("analyticsEvent",{name:"confluence-spaces.tasks.feature.discovery.shown"});f.show();Confluence.FeatureDiscovery.forPlugin(c).markDiscovered(b)}}d(function(){if(d("meta[name=show-task-feature-discovery-flag]").length>0&&Confluence.FeatureDiscovery.forPlugin(c).shouldShow(b)){a()}})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:plupload', location = 'js/plupload.js' */
(function(){function x(){this.returnValue=!1}function y(){this.cancelBubble=!0}var z=0,p=[],u={},v={},t={},w={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},A=/[<>&\"\']/g,q=window.setTimeout,m={},h,j="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/java-archive,jar,application/java-archive,war,application/java-archive,ear,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.template,xltx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,audio/mpeg,mpga mpega mp2 mp3,audio/mp3,mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/html,htm html xhtml,text/xml,xml,text/javascript,js,text/css,css,text/rtf,rtf,text/x-java-source,java,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,text/csv,csv,text/plain,asc txt text diff log,application/octet-stream,exe".split(/,/),
k,n,o;for(k=0;k<j.length;k+=2){o=j[k+1].split(/ /);for(n=0;n<o.length;n++){v[o[n]]=j[k];var r=t[j[k]]||[];r.push(o[n]);t[j[k]]=r}}j=navigator;k=j.userAgent;o=j.vendor;r=(n=/WebKit/.test(k))&&-1!==o.indexOf("Apple");o=window.opera&&window.opera.buildNumber;var j={windows:-1!==navigator.platform.indexOf("Win"),ie:!n&&!o&&/MSIE/gi.test(k)&&/Explorer/gi.test(j.appName),webkit:n,gecko:!n&&/Gecko/.test(k),safari:r,opera:!!o},c={VERSION:"@@version@@",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,
GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:v,mineTypeToExtensionsMap:t,ua:j,extend:function(a){c.each(arguments,function(b,g){0<g&&c.each(b,function(b,c){a[c]=b})});return a},getElement:function(a){return a&&1===a.nodeType?a:document.getElementById(a)},cleanName:function(a){var b,c;c=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,
"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(b=0;b<c.length;b+=2)a=a.replace(c[b],c[b+1]);a=a.replace(/\s+/g,"_");return a=a.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(a,b){b.name=a;p[a]=b;p.push(b);return b},guid:function(){var a=(new Date).getTime().toString(32),b;for(b=0;5>b;b++)a+=Math.floor(65535*Math.random()).toString(32);return(c.guidPrefix||
"p")+a+(z++).toString(32)},buildUrl:function(a,b){var g="";c.each(b,function(a,b){g+=(g?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)});g&&(a+=(0<a.indexOf("?")?"&":"?")+g);return a},each:function(a,b){var c,f;if(a)if(c=a.length,void 0===c)for(f in a){if(a.hasOwnProperty(f)&&!1===b(a[f],f))break}else for(f=0;f<c&&!1!==b(a[f],f);f++);},formatSize:function(a){return void 0===a||/\D/.test(a)?c.translate("N/A"):1073741824<a?Math.round(a/1073741824,1)+" GB":1048576<a?Math.round(a/1048576,1)+
" MB":1024<a?Math.round(a/1024,1)+" KB":a+" b"},getPos:function(a,b){function c(a){var b,e=0;b=0;a&&(b=a.getBoundingClientRect(),a="CSS1Compat"===h.compatMode?h.documentElement:h.body,e=b.left+a.scrollLeft,b=b.top+a.scrollTop);return{x:e,y:b}}var f=0,d=0,e,h=document,b=b||h.body;if(a&&a.getBoundingClientRect&&0<navigator.userAgent.indexOf("MSIE")&&8!==h.documentMode)return f=c(a),d=c(b),{x:f.x-d.x,y:f.y-d.y};for(e=a;e&&e!=b&&e.nodeType;)f+=e.offsetLeft||0,d+=e.offsetTop||0,e=e.offsetParent;for(e=
a.parentNode;e&&e!=b&&e.nodeType;)f-=e.scrollLeft||0,d-=e.scrollTop||0,e=e.parentNode;return{x:f,y:d}},getSize:function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}},parseSize:function(a){var b;"string"==typeof a&&(a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,"")),b=a[2],a=+a[1],"g"==b&&(a*=1073741824),"m"==b&&(a*=1048576),"k"==b&&(a*=1024));return a},xmlEncode:function(a){return a?(""+a).replace(A,function(a){return w[a]?"&"+w[a]+";":a}):a},toArray:function(a){var b,
c=[];for(b=0;b<a.length;b++)c[b]=a[b];return c},addI18n:function(a){return c.extend(u,a)},translate:function(a){return u[a]||a},isEmptyObj:function(a){if(void 0===a)return!0;for(var b in a)return!1;return!0},hasClass:function(a,b){return""==a.className?!1:RegExp("(^|\\s+)"+b+"(\\s+|$)").test(a.className)},addClass:function(a,b){c.hasClass(a,b)||(a.className=""==a.className?b:a.className.replace(/\s+$/,"")+" "+b)},removeClass:function(a,b){a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)"),
function(a,b,c){return" "===b&&" "===c?" ":""})},getStyle:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return window.getComputedStyle(a,null)[b]},addEvent:function(a,b,g,f){var d,b=b.toLowerCase();void 0===h&&(h="Plupload_"+c.guid());a.addEventListener?(d=g,a.addEventListener(b,d,!1)):a.attachEvent&&(d=function(){var a=window.event;a.target||(a.target=a.srcElement);a.preventDefault=x;a.stopPropagation=y;g(a)},a.attachEvent("on"+b,d));void 0===a[h]&&(a[h]=c.guid());
m.hasOwnProperty(a[h])||(m[a[h]]={});a=m[a[h]];a.hasOwnProperty(b)||(a[b]=[]);a[b].push({func:d,orig:g,key:f})},removeEvent:function(a,b,g){var f,d;"function"==typeof g?f=g:d=g;b=b.toLowerCase();if(a[h]&&m[a[h]]&&m[a[h]][b]){for(var g=m[a[h]][b],e=g.length-1;0<=e;e--)if(g[e].key===d||g[e].orig===f)if(a.detachEvent?a.detachEvent("on"+b,g[e].func):a.removeEventListener&&a.removeEventListener(b,g[e].func,!1),g[e].orig=null,g[e].func=null,g.splice(e,1),void 0!==f)break;g.length||delete m[a[h]][b];if(c.isEmptyObj(m[a[h]])){delete m[a[h]];
try{delete a[h]}catch(k){a[h]=void 0}}}},removeAllEvents:function(a,b){void 0!==a[h]&&a[h]&&c.each(m[a[h]],function(g,f){c.removeEvent(a,f,b)})},Uploader:function(a){function b(){var a,b=0,d;if(this.state==c.STARTED){for(d=0;d<e.length;d++)!a&&e[d].status==c.QUEUED?(a=e[d],a.status=c.UPLOADING,this.trigger("BeforeUpload",a)&&this.trigger("UploadFile",a)):b++;b==e.length&&(this.stop(),this.trigger("UploadComplete",e))}}function g(){var a,b;d.reset();for(a=0;a<e.length;a++)b=e[a],void 0!==b.size?(d.size+=
b.size,d.loaded+=b.loaded):d.size=void 0,b.status==c.DONE?d.uploaded++:b.status==c.FAILED?d.failed++:d.queued++;void 0===d.size?d.percent=0<e.length?Math.ceil(100*(d.uploaded/e.length)):0:(d.bytesPerSec=Math.ceil(d.loaded/((+new Date-h||1)/1E3)),d.percent=0<d.size?Math.ceil(100*(d.loaded/d.size)):0)}var f={},d,e=[],h;d=new c.QueueProgress;a=c.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},a);c.extend(this,{state:c.STOPPED,runtime:"",features:{},files:e,settings:a,
total:d,id:c.guid(),init:function(){function f(){var a=s[k++],b,e,d;if(a){b=a.getFeatures();if(e=i.settings.required_features){e=e.split(",");for(d=0;d<e.length;d++)if(!b[e[d]]){f();return}}a.init(i,function(c){c&&c.success?(i.features=b,i.runtime=a.name,i.trigger("Init",{runtime:a.name}),i.trigger("PostInit"),i.refresh()):f()})}else i.trigger("Error",{code:c.INIT_ERROR,message:c.translate("Init error.")})}var i=this,l,s,k=0,j;"function"==typeof a.preinit?a.preinit(i):c.each(a.preinit,function(a,
b){i.bind(b,a)});a.page_url=a.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/");/^(\w+:\/\/|\/)/.test(a.url)||(a.url=a.page_url+a.url);a.chunk_size=c.parseSize(a.chunk_size);a.max_file_size=c.parseSize(a.max_file_size);i.bind("FilesAdded",function(b,d){b.trigger("Started",d);var f,g,l=0,h;if((f=a.filters)&&f.length){h=[];c.each(f,function(a){c.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?h.push("\\.*"):h.push("\\."+a.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,
"\\$&")+"]","g"),"\\$&"))})});h=RegExp(h.join("|")+"$","i")}for(f=0;f<d.length;f++){g=d[f];g.loaded=0;g.percent=0;g.status=c.QUEUED;if(h&&!h.test(g.name))b.trigger("Error",{code:c.FILE_EXTENSION_ERROR,message:c.translate("File extension error."),file:g});else if(g.size!==void 0&&g.size>a.max_file_size)b.trigger("Error",{code:c.FILE_SIZE_ERROR,message:c.translate("File size error."),file:g});else{e.push(g);l++}}if(l)q(function(){i.trigger("QueueChanged");i.refresh()},1);else return false});a.unique_names&&
i.bind("UploadFile",function(a,b){var c=b.name.match(/\.([^.]+)$/),d="tmp";c&&(d=c[1]);b.target_name=b.id+"."+d});i.bind("UploadProgress",function(a,b){b.percent=b.size>0?Math.ceil(b.loaded/b.size*100):100;g()});i.bind("StateChanged",function(a){if(a.state==c.STARTED)h=+new Date;else if(a.state==c.STOPPED)for(l=a.files.length-1;l>=0;l--)if(a.files[l].status==c.UPLOADING){a.files[l].status=c.QUEUED;g()}});i.bind("QueueChanged",g);i.bind("Error",function(a,e){if(e.file){e.file.status=c.FAILED;g();a.state==
c.STARTED&&(d.queued||q(function(){b.call(i)},1))}});i.bind("FileUploaded",function(a,d){d.status=c.DONE;d.loaded=d.size;a.trigger("UploadProgress",d);q(function(){b.call(i)},1)});if(a.runtimes){s=[];j=a.runtimes.split(/\s?,\s?/);for(l=0;l<j.length;l++)p[j[l]]&&s.push(p[j[l]])}else s=p;f();"function"==typeof a.init?a.init(i):c.each(a.init,function(a,b){i.bind(b,a)})},refresh:function(){this.trigger("Refresh")},start:function(){this.state!=c.STARTED&&(this.state=c.STARTED,this.trigger("StateChanged"),
b.call(this))},stop:function(){this.state!=c.STOPPED&&(this.state=c.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},getFile:function(a){var b;for(b=e.length-1;0<=b;b--)if(e[b].id===a)return e[b]},removeFile:function(a){var b;for(b=e.length-1;0<=b;b--)if(e[b].id===a.id)return this.splice(b,1)[0]},splice:function(a,b){var f;f=e.splice(void 0===a?0:a,void 0===b?e.length:b);this.trigger("FilesRemoved",f);this.trigger("QueueChanged");f[0].status==c.UPLOADING&&this.state==c.STARTED&&
this.trigger("CancelUpload");if(!d.queued){var g=this;q(function(){g.trigger("UploadComplete")})}return f},trigger:function(a){var b=f[a.toLowerCase()],c,d;if(b){d=Array.prototype.slice.call(arguments);d[0]=this;for(c=0;c<b.length;c++)if(!1===b[c].func.apply(b[c].scope,d))return!1}return!0},hasEventListener:function(a){return!!f[a.toLowerCase()]},bind:function(a,b,c){var d,a=a.toLowerCase();d=f[a]||[];d.push({func:b,scope:c||this});f[a]=d},unbind:function(a,b){var a=a.toLowerCase(),c=f[a],d;if(c){if(void 0!==
b)for(d=c.length-1;0<=d;d--){if(c[d].func===b){c.splice(d,1);break}}else c=[];c.length||delete f[a]}},unbindAll:function(){var a=this;c.each(f,function(b,c){a.unbind(c)})},destroy:function(){this.trigger("Destroy");this.unbindAll()}})},File:function(a,b,c){this.id=a;this.name=b;this.size=c;this.status=this.percent=this.loaded=0},Runtime:function(){this.getFeatures=function(){};this.init=function(){}},QueueProgress:function(){var a=this;a.size=0;a.loaded=0;a.uploaded=0;a.failed=0;a.queued=0;a.percent=
0;a.bytesPerSec=0;a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}},runtimes:{}};window.plupload=c})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:plupload', location = 'js/plupload.html5.js' */
(function(s,j,e,p){function G(e,f,k,g){var b,a,c,q,m=this;var d=y[e.id],r=function(d){b=j.createElement("canvas");b.style.display="none";j.body.appendChild(b);a=b.getContext("2d");c=new Image;c.onerror=c.onabort=function(){g({success:!1})};c.onload=function(){var r,t,j,o;f.width||(f.width=c.width);f.height||(f.height=c.height);q=Math.min(f.width/c.width,f.height/c.height);if(1>q||1===q&&"image/jpeg"===k){r=Math.round(c.width*q);t=Math.round(c.height*q);b.width=r;b.height=t;a.drawImage(c,0,0,r,t);
if("image/jpeg"===k){if(j=new w(atob(d.substring(d.indexOf("base64,")+7))),j.headers&&j.headers.length&&(o=new H,o.init(j.get("exif")[0])&&(o.setExif("PixelXDimension",r),o.setExif("PixelYDimension",t),j.set("exif",o.getBinary()),m.hasEventListener("ExifData")&&m.trigger("ExifData",e,o.EXIF()),m.hasEventListener("GpsData")&&m.trigger("GpsData",e,o.GPS()))),f.quality)try{d=b.toDataURL(k,f.quality/100)}catch(s){d=b.toDataURL(k)}}else d=b.toDataURL(k);d=d.substring(d.indexOf("base64,")+7);d=atob(d);
j&&(j.headers&&j.headers.length)&&(d=j.restore(d),j.purge());b.parentNode.removeChild(b);g({success:!0,data:d})}else g({success:!1})};c.src=d},t;"FileReader"in s?(t=new FileReader,t.readAsDataURL(d),t.onload=function(){r(t.result)}):r(d.getAsDataURL())}function C(){function e(b,a){var c=k?0:-8*(a-1),q=0,m;for(m=0;m<a;m++)q|=g.charCodeAt(b+m)<<Math.abs(c+8*m);return q}function f(b,a,c){c=3===arguments.length?c:g.length-a-1;g=g.substr(0,a)+b+g.substr(c+a)}var k=!1,g;return{II:function(b){if(b===p)return k;
k=b},init:function(b){k=!1;g=b},SEGMENT:function(b,a,c){switch(arguments.length){case 1:return g.substr(b,g.length-b-1);case 2:return g.substr(b,a);case 3:f(c,b,a);break;default:return g}},BYTE:function(b){return e(b,1)},SHORT:function(b){return e(b,2)},LONG:function(b,a){if(a===p)return e(b,4);var c="",q=k?0:-24,m;for(m=0;4>m;m++)c+=String.fromCharCode(a>>Math.abs(q+8*m)&255);f(c,b,4)},SLONG:function(b){b=e(b,4);return 2147483647<b?b-4294967296:b},STRING:function(b,a){for(var c="",a=a+b;b<a;b++)c+=
String.fromCharCode(e(b,1));return c}}}function w(e){var f={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},k=[],g,b,a=p,c=0;g=new C;g.init(e);if(65496===g.SHORT(0)){b=2;for(e=Math.min(1048576,e.length);b<=e;)if(a=g.SHORT(b),65488<=a&&65495>=a)b+=2;else{if(65498===a||65497===a)break;c=g.SHORT(b+2)+2;f[a]&&g.STRING(b+4,f[a].signature.length)===f[a].signature&&k.push({hex:a,app:f[a].app.toUpperCase(),
name:f[a].name.toUpperCase(),start:b,length:c,segment:g.SEGMENT(b,c)});b+=c}g.init(null);return{headers:k,restore:function(a){g.init(a);var c=new w(a);if(!c.headers)return!1;for(a=c.headers.length;0<a;a--){var d=c.headers[a-1];g.SEGMENT(d.start,d.length,"")}c.purge();b=65504==g.SHORT(2)?4+g.SHORT(4):2;a=0;for(c=k.length;a<c;a++)g.SEGMENT(b,0,k[a].segment),b+=k[a].length;return g.SEGMENT()},get:function(a){for(var c=[],d=0,b=k.length;d<b;d++)k[d].app===a.toUpperCase()&&c.push(k[d].segment);return c},
set:function(a,c){var d=[];"string"===typeof c?d.push(c):d=c;for(var b=ii=0,e=k.length;b<e&&!(k[b].app===a.toUpperCase()&&(k[b].segment=d[ii],k[b].length=d[ii].length,ii++),ii>=d.length);b++);},purge:function(){k=[];g.init(null)}}}}function H(){function e(a,c){var q=f.SHORT(a),m,d,k,h,l,j=[],n={};for(m=0;m<q;m++)if(l=a+12*m+2,k=c[f.SHORT(l)],k!==p){d=f.SHORT(l+=2);h=f.LONG(l+=2);l+=4;j=[];switch(d){case 1:case 7:4<h&&(l=f.LONG(l)+g.tiffHeader);for(d=0;d<h;d++)j[d]=f.BYTE(l+d);break;case 2:4<h&&(l=
f.LONG(l)+g.tiffHeader);n[k]=f.STRING(l,h-1);continue;case 3:2<h&&(l=f.LONG(l)+g.tiffHeader);for(d=0;d<h;d++)j[d]=f.SHORT(l+2*d);break;case 4:1<h&&(l=f.LONG(l)+g.tiffHeader);for(d=0;d<h;d++)j[d]=f.LONG(l+4*d);break;case 5:l=f.LONG(l)+g.tiffHeader;for(d=0;d<h;d++)j[d]=f.LONG(l+4*d)/f.LONG(l+4*d+4);break;case 9:l=f.LONG(l)+g.tiffHeader;for(d=0;d<h;d++)j[d]=f.SLONG(l+4*d);break;case 10:l=f.LONG(l)+g.tiffHeader;for(d=0;d<h;d++)j[d]=f.SLONG(l+4*d)/f.SLONG(l+4*d+4);break;default:continue}h=1==h?j[0]:j;
n[k]=b.hasOwnProperty(k)&&"object"!=typeof h?b[k][h]:h}return n}var f,k,g={},b;f=new C;k={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",
41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{"0":"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}};b={ColorSpace:{1:"sRGB","0":"Uncalibrated"},MeteringMode:{"0":"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",
13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{"0":"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",
16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{"0":"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{"0":"Auto white balance",1:"Manual white balance"},SceneCaptureType:{"0":"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},
Contrast:{"0":"Normal",1:"Soft",2:"Hard"},Saturation:{"0":"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{"0":"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};return{init:function(a){g={tiffHeader:10};if(a===p||!a.length)return!1;f.init(a);return 65505===f.SHORT(0)&&"EXIF\x00"===f.STRING(4,5).toUpperCase()?(a=p,a=g.tiffHeader,f.II(18761==f.SHORT(a)),42!==f.SHORT(a+=2)?a=!1:(g.IFD0=g.tiffHeader+f.LONG(a+
2),a=e(g.IFD0,k.tiff),g.exifIFD="ExifIFDPointer"in a?g.tiffHeader+a.ExifIFDPointer:p,g.gpsIFD="GPSInfoIFDPointer"in a?g.tiffHeader+a.GPSInfoIFDPointer:p,a=!0),a):!1},EXIF:function(){var a;a=e(g.exifIFD,k.exif);a.ExifVersion&&(a.ExifVersion=String.fromCharCode(a.ExifVersion[0],a.ExifVersion[1],a.ExifVersion[2],a.ExifVersion[3]));return a},GPS:function(){var a;a=e(g.gpsIFD,k.gps);a.GPSVersionID&&(a.GPSVersionID=a.GPSVersionID.join("."));return a},setExif:function(a,c){if("PixelXDimension"!==a&&"PixelYDimension"!==
a)return!1;var b;b=a;var e,d,h,j=0;if("string"===typeof b)for(hex in e=k.exif,e)if(e[hex]===b){b=hex;break}e=g.exifIFD;d=f.SHORT(e);for(i=0;i<d;i++)if(h=e+12*i+2,f.SHORT(h)==b){j=h+8;break}j?(f.LONG(j,c),b=!0):b=!1;return b},getBinary:function(){return f.SEGMENT()}}}var y={},F;e.runtimes.Html5=e.addRuntime("html5",{getFeatures:function(){var h,f,k,g,b,a;f=k=b=a=!1;s.XMLHttpRequest&&(h=new XMLHttpRequest,k=!!h.upload,f=!(!h.sendAsBinary&&!h.upload));f&&(g=!!(h.sendAsBinary||s.Uint8Array&&s.ArrayBuffer),
b=!(!File||!File.prototype.getAsDataURL&&!s.FileReader||!g),a=!(!File||!File.prototype.mozSlice&&!File.prototype.webkitSlice&&!File.prototype.slice));F=e.ua.safari&&e.ua.windows&&navigator.userAgent&&0<navigator.userAgent.indexOf("Version/4");h=f;f=j.createElement("div");return{html5:h,dragdrop:"draggable"in f||"ondragstart"in f&&"ondrop"in f,jpgresize:b,pngresize:b,multipart:b||!!s.FileReader||!!s.FormData,canSendBinary:g,cantSendBlobInFormData:!(!e.ua.gecko||!s.FormData||!s.FileReader||FileReader.prototype.readAsArrayBuffer),
progress:k,chunks:a,multi_selection:!(e.ua.safari&&e.ua.windows),triggerDialog:e.ua.gecko&&s.FormData||e.ua.webkit||e.ua.windows}},init:function(h,f){function k(a){var c,b,g=[],d,f={};for(b=0;b<a.length;b++)c=a[b],f[c.name]||(f[c.name]=!0,d=e.guid(),y[d]=c,d=new e.File(d,c.fileName||c.name,c.fileSize||c.size),d.nativeFile=c,g.push(d));g.length&&h.trigger("FilesAdded",g)}var g,b;g=this.getFeatures();g.html5?(h.upload=function(a){k(a)},h.bind("Init",function(a){var c,b,g=[],d,f,t=a.settings.filters,
l,s;d=j.body;var n;c=j.createElement("div");c.id=a.id+"_html5_container";e.extend(c.style,{position:"absolute",background:h.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:h.settings.shim_bgcolor?"":0});c.className="plupload html5";h.settings.container&&(d=j.getElementById(h.settings.container),"static"===e.getStyle(d,"position")&&(d.style.position="relative"));d.appendChild(c);d=0;a:for(;d<t.length;d++){l=t[d].extensions.split(/,/);for(f=0;f<
l.length;f++){if("*"===l[f]){g=[];break a}(s=e.mimeTypes[l[f]])&&g.push(s)}}c.innerHTML='<input id="'+h.id+'_html5"  style="font-size:999px" type="file" accept="'+g.join(",")+'" '+(h.settings.multi_selection&&h.features.multi_selection?'multiple="multiple"':"")+" />";c.scrollTop=100;n=j.getElementById(h.id+"_html5");h.settings.inputFileClazz&&(n.className+=" "+h.settings.inputFileClazz);a.features.triggerDialog?e.extend(n.style,{position:"absolute",width:"100%",height:"100%"}):e.extend(n.style,{cssFloat:"right",
styleFloat:"right"});var p=function(){k(this.files);if(navigator.appVersion.indexOf("MSIE10")===-1){n=this.cloneNode(true);n.onchange=p;this.parentNode.replaceChild(n,this)}else this.value=""};n.onchange=p;if(b="string"===typeof a.settings.browse_button?j.getElementById(a.settings.browse_button):a.settings.browse_button){var o=a.settings.browse_button_hover,B=a.settings.browse_button_active;c=a.features.triggerDialog?b:c;o&&(e.addEvent(c,"mouseover",function(){e.addClass(b,o)},a.id),e.addEvent(c,
"mouseout",function(){e.removeClass(b,o)},a.id));B&&(e.addEvent(c,"mousedown",function(){e.addClass(b,B)},a.id),e.addEvent(j.body,"mouseup",function(){e.removeClass(b,B)},a.id));a.features.triggerDialog&&e.addEvent(b,"click",function(c){j.getElementById(a.id+"_html5").click();c.preventDefault()},a.id)}}),h.bind("PostInit",function(){var a=e.getElement(h.settings.drop_element),c,b=!1;a&&(F?(e.addEvent(a,"dragenter",function(){var c,d;c=j.getElementById(h.id+"_drop");c||(c=j.createElement("input"),
c.setAttribute("type","file"),c.setAttribute("id",h.id+"_drop"),c.setAttribute("multiple","multiple"),e.addEvent(c,"change",function(){k(this.files);e.removeEvent(c,"change",h.id);c.parentNode.removeChild(c)},h.id),a.appendChild(c),b=!0);e.getPos(a,j.getElementById(h.settings.container));d=e.getSize(a);"static"===e.getStyle(a,"position")&&e.extend(a.style,{position:"relative"});e.extend(c.style,{position:"absolute",display:"block",top:0,left:0,width:d.w+"px",height:d.h+"px",opacity:0})},h.id),e.addEvent(a,
"dragleave",function(){b||(c&&c.parentElement.removeChild(c),c=null);b=!1})):(e.addEvent(a,"dragover",function(a){a.preventDefault()},h.id),e.addEvent(a,"drop",function(a){if(!$(".disable-attachment-uploader").length){var b=a.dataTransfer;b&&b.files&&k(b.files)}c&&c.parentElement.removeChild(c);c=null;a.preventDefault();h.settings.stop_propagation&&(a.cancelBubble?a.cancelBubble=!0:a.stopPropagation())},h.id)))}),h.bind("Refresh",function(a){var c,b,f;if(c=j.getElementById(h.settings.browse_button))b=
e.getPos(c,j.getElementById(a.settings.container)),f=e.getSize(c),a=j.getElementById(h.id+"_html5_container"),e.extend(a.style,{top:b.y+"px",left:b.x+"px",width:f.w+"px",height:f.h+"px"}),h.features.triggerDialog&&("static"===e.getStyle(c,"position")&&e.extend(c.style,{position:"relative"}),b=parseInt(e.getStyle(c,"z-index"),10),isNaN(b)&&(b=0),e.extend(c.style,{zIndex:b}),e.extend(a.style,{zIndex:b-1}))}),h.bind("CancelUpload",function(){b&&b.abort&&b.abort()}),h.bind("UploadFile",function(a,c){function f(d){function k(){function f(d){var h=
0,m="----pluploadboundary"+e.guid(),n,r="";b=new XMLHttpRequest;b.upload&&(b.upload.onprogress=function(b){c.loaded=Math.min(c.size,q+b.loaded-h);a.trigger("UploadProgress",c)});b.onreadystatechange=function(){var f,g;if(b.readyState==4){try{f=b.status}catch(h){f=0}if(f>=400)a.trigger("Error",{code:e.HTTP_ERROR,message:e.translate("HTTP Error."),file:c,status:f,response:b.responseText||""});else{if(p){g={chunk:j,chunks:p,response:b.responseText,status:f};a.trigger("ChunkUploaded",c,g);q=q+z;if(g.cancelled){c.status=
e.FAILED;return}c.loaded=Math.min(c.size,(j+1)*u)}else c.loaded=c.size;a.trigger("UploadProgress",c);d=o=n=r=null;if(!p||++j>=p){c.status=e.DONE;a.trigger("FileUploaded",c,{response:b.responseText,status:f})}else k()}}};if(a.settings.multipart&&g.multipart){x.name=c.target_name||c.name;b.open("post",D,!0);e.each(a.settings.headers,function(a,c){b.setRequestHeader(c,a)});if("string"!==typeof d&&s.FormData){n=new FormData;e.each(e.extend(x,a.settings.multipart_params),function(a,b){n.append(b,a)});
n.append(a.settings.file_data_name,d);b.send(n);return}if("string"===typeof d){b.setRequestHeader("Content-Type","multipart/form-data; boundary="+m);e.each(e.extend(x,a.settings.multipart_params),function(a,b){r=r+("--"+m+'\r\nContent-Disposition: form-data; name="'+b+'"\r\n\r\n');r=r+(unescape(encodeURIComponent(a))+"\r\n")});y=e.mimeTypes[c.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream";r+="--"+m+'\r\nContent-Disposition: form-data; name="'+a.settings.file_data_name+
'"; filename="'+unescape(encodeURIComponent(c.name))+'"\r\nContent-Type: '+y+"\r\n\r\n"+d+"\r\n--"+m+"--\r\n";h=r.length-d.length;d=r;if(b.sendAsBinary)b.sendAsBinary(d);else if(g.canSendBinary){for(var w=new Uint8Array(d.length),v=0;v<d.length;v++)w[v]=d.charCodeAt(v)&255;b.send(w.buffer)}return}}D=e.buildUrl(a.settings.url,e.extend(x,a.settings.multipart_params));b.open("post",D,!0);b.setRequestHeader("Content-Type","application/octet-stream");d.encoding&&b.setRequestHeader("Content-Encoding",d.encoding);
e.each(a.settings.headers,function(a,c){b.setRequestHeader(c,a)});b.send(d.getData?d.getData():d)}var o,p,x,u,z,y,D=a.settings.url;if(!(c.status==e.DONE||c.status==e.FAILED||a.state==e.STOPPED)){x={name:c.target_name||c.name};if(h.chunk_size&&c.size>h.chunk_size&&(g.chunks||"string"==typeof d)){u=h.chunk_size;p=Math.ceil(c.size/u);z=Math.min(u,c.size-j*u);if("string"==typeof d)o=d.substring(j*u,j*u+z);else{var v=d,A=j*u,E=j*u+z,w;if(File.prototype.slice)try{v.slice(),o=v.slice(A,E)}catch(C){o=v.slice(A,
E-A)}else o=(w=File.prototype.webkitSlice||File.prototype.mozSlice)?w.call(v,A,E):null}x.chunk=j;x.chunks=p}else z=c.size,o=d;"string"!==typeof o&&n&&g.cantSendBlobInFormData&&g.chunks&&a.settings.chunk_size?(n.onload=function(){f(n.result)},n.readAsBinaryString(o)):f(o)}}var j=0,q=0,n="FileReader"in s?new FileReader:null;k()}var h=a.settings,d;d=y[c.id];g.jpgresize&&a.settings.resize&&/\.(png|jpg|jpeg)$/i.test(c.name)?G.call(a,c,a.settings.resize,/\.png$/i.test(c.name)?"image/png":"image/jpeg",function(a){a.success?
(c.size=a.data.length,f(a.data)):f(d)}):f(d)}),h.bind("Destroy",function(a){var b,f,g=j.body,d={inputContainer:a.id+"_html5_container",inputFile:a.id+"_html5",browseButton:a.settings.browse_button,dropElm:a.settings.drop_element};for(b in d)(f=j.getElementById(d[b]))&&e.removeAllEvents(f,a.id);e.removeAllEvents(j.body,a.id);a.settings.container&&(g=j.getElementById(a.settings.container));g.removeChild(j.getElementById(d.inputContainer))}),f({success:!0})):f({success:!1})}})})(window,document,plupload);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:jquery-ui-position', location = 'node_modules/@atlassian/aui/src/js-vendor/jquery/jquery-ui/jquery.ui.position.js' */
(function(c){c.ui=c.ui||{};var k=/left|center|right/,l=/top|center|bottom/,n=c.fn.position,o=c.fn.offset;c.fn.position=function(b){if(!b||!b.of)return n.apply(this,arguments);var b=c.extend({},b),a=c(b.of),d=a[0],g=(b.collision||"flip").split(" "),f=b.offset?b.offset.split(" "):[0,0],h,j,e;9===d.nodeType?(h=a.width(),j=a.height(),e={top:0,left:0}):d.setTimeout?(h=a.width(),j=a.height(),e={top:a.scrollTop(),left:a.scrollLeft()}):d.preventDefault?(b.at="left top",h=j=0,e={top:b.of.pageY,left:b.of.pageX}):
(h=a.outerWidth(),j=a.outerHeight(),e=a.offset());c.each(["my","at"],function(){var a=(b[this]||"").split(" ");a.length===1&&(a=k.test(a[0])?a.concat(["center"]):l.test(a[0])?["center"].concat(a):["center","center"]);a[0]=k.test(a[0])?a[0]:"center";a[1]=l.test(a[1])?a[1]:"center";b[this]=a});1===g.length&&(g[1]=g[0]);f[0]=parseInt(f[0],10)||0;1===f.length&&(f[1]=f[0]);f[1]=parseInt(f[1],10)||0;"right"===b.at[0]?e.left+=h:"center"===b.at[0]&&(e.left+=h/2);"bottom"===b.at[1]?e.top+=j:"center"===b.at[1]&&
(e.top+=j/2);e.left+=f[0];e.top+=f[1];return this.each(function(){var a=c(this),d=a.outerWidth(),m=a.outerHeight(),k=parseInt(c.curCSS(this,"marginLeft",true))||0,l=parseInt(c.curCSS(this,"marginTop",true))||0,n=d+k+(parseInt(c.curCSS(this,"marginRight",true))||0),o=m+l+(parseInt(c.curCSS(this,"marginBottom",true))||0),i=c.extend({},e),p;if(b.my[0]==="right")i.left=i.left-d;else if(b.my[0]==="center")i.left=i.left-d/2;if(b.my[1]==="bottom")i.top=i.top-m;else if(b.my[1]==="center")i.top=i.top-m/2;
p={left:i.left-k,top:i.top-l};c.each(["left","top"],function(a,e){if(c.ui.position[g[a]])c.ui.position[g[a]][e](i,{targetWidth:h,targetHeight:j,elemWidth:d,elemHeight:m,collisionPosition:p,collisionWidth:n,collisionHeight:o,offset:f,my:b.my,at:b.at})});c.fn.bgiframe&&a.bgiframe();a.offset(c.extend(i,{using:b.using}))})};c.ui.position={fit:{left:function(b,a){var d=c(window),d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft();b.left=0<d?b.left-d:Math.max(b.left-a.collisionPosition.left,
b.left)},top:function(b,a){var d=c(window),d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop();b.top=0<d?b.top-d:Math.max(b.top-a.collisionPosition.top,b.top)}},flip:{left:function(b,a){if("center"!==a.at[0]){var d=c(window),d=a.collisionPosition.left+a.collisionWidth-d.width()-d.scrollLeft(),g="left"===a.my[0]?-a.elemWidth:"right"===a.my[0]?a.elemWidth:0,f="left"===a.at[0]?a.targetWidth:-a.targetWidth,h=-2*a.offset[0];b.left+=0>a.collisionPosition.left?g+f+h:0<d?g+f+h:0}},top:function(b,
a){if("center"!==a.at[1]){var d=c(window),d=a.collisionPosition.top+a.collisionHeight-d.height()-d.scrollTop(),g="top"===a.my[1]?-a.elemHeight:"bottom"===a.my[1]?a.elemHeight:0,f="top"===a.at[1]?a.targetHeight:-a.targetHeight,h=-2*a.offset[1];b.top+=0>a.collisionPosition.top?g+f+h:0<d?g+f+h:0}}}};c.offset.setOffset||(c.offset.setOffset=function(b,a){/static/.test(c.curCSS(b,"position"))&&(b.style.position="relative");var d=c(b),g=d.offset(),f=parseInt(c.curCSS(b,"top",!0),10)||0,h=parseInt(c.curCSS(b,
"left",!0),10)||0,g={top:a.top-g.top+f,left:a.left-g.left+h};"using"in a?a.using.call(b,g):d.css(g)},c.fn.offset=function(b){var a=this[0];return!a||!a.ownerDocument?null:b?c.isFunction(b)?this.each(function(a){c(this).offset(b.call(this,a,c(this).offset()))}):this.each(function(){c.offset.setOffset(this,b)}):o.call(this)});c.curCSS||(c.curCSS=c.css)})(jQuery);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-progress-indicator', location = 'node_modules/@atlassian/aui/src/js/aui/progress-indicator.js' */
("undefined"===typeof window?global:window).__1c558839792cc96767a648eae1c96903=function(){function g(a,b,c){(0,h.recomputeStyle)(a);a.css("width",100*c+"%");b.attr("data-value",c)}var d={};"use strict";Object.defineProperty(d,"__esModule",{value:!0});var a=__2fd777cca7fe187ff4048afabed6a6b5,i=a&&a.__esModule?a:{"default":a},h=__e3af25d9bced0eef741f71bd383fd36d,a=(a=__dd0dee18d8910035abf3563b0855343d)&&a.__esModule?a:{"default":a},j={update:function(a,b){var c=(0,i.default)(a).first(),d=c.children(".aui-progress-indicator-value"),
e=c.attr("data-value"),f=parseFloat(e)||0;if(!(e&&f===b))return e||d.css("width",0),"number"===typeof b&&(1>=b&&0<=b)&&(c.trigger("aui-progress-indicator-before-update",[f,b]),e=(document.body||document.documentElement).style,"string"===typeof e.transition||"string"===typeof e.WebkitTransition?(d.one("transitionend webkitTransitionEnd",function(){c.trigger("aui-progress-indicator-after-update",[f,b])}),g(d,c,b)):(g(d,c,b),c.trigger("aui-progress-indicator-after-update",[f,b]))),c},setIndeterminate:function(a){var a=
(0,i.default)(a).first(),b=a.children(".aui-progress-indicator-value");a.removeAttr("data-value");(0,h.recomputeStyle)(a);b.css("width","100%")}};(0,a.default)("progressBars",j);d.default=j;return d=d["default"]}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/drag-and-drop-utils.js' */
define("confluence-drag-and-drop/drag-and-drop-utils",["jquery","window","ajs"],function(c,d,f){return{defaultMimeType:"application/octet-stream",base:/^\w+:\/\/[^\/?#]+/.exec(location.href),bindDragEnter:function(a,b){if(a.addEventListener)(b=this.isFireFox35OrLater()?this.firefox35DragEnterAndOverCallbackWrapper(b):b)&&a.addEventListener("dragenter",b,!1);else if(a.attachEvent){var e=this.ieDragEnterAndDragOverCallbackWrapper(b);a.attachEvent("ondragenter",e);c(d).unload(function(){a.detachEvent("ondragenter",
e)})}},bindDragOver:function(a,b){if(a.addEventListener)this.isFireFox35OrLater()?b=this.firefox35DragEnterAndOverCallbackWrapper(b):c.browser.safari&&(b=this.safariDragOverCallbackWrapper(b)),b&&a.addEventListener("dragover",b,!1);else if(a.attachEvent){var e=this.ieDragEnterAndDragOverCallbackWrapper(b);a.attachEvent("ondragover",e);c(d).unload(function(){a.detachEvent("ondragover",e)})}},bindDragLeave:function(a,b){b&&(c.browser.safari||this.isFireFox35OrLater()||tinymce.isIE11?a.addEventListener("dragleave",
b,!1):c.browser.msie?(a.attachEvent("ondragleave",b),c(d).unload(function(){a.detachEvent("ondragleave",b)})):c.browser.mozilla&&a.addEventListener("dragexit",b,!1))},bindDrop:function(a,b){if(c.browser.mozilla){var e=this.isFireFox35OrLater()?"drop":"dragdrop";a.addEventListener(e,this.mozillaDropCallbackWrapper(b),!1)}else if(c.browser.msie){if(b){var g=function(a){b(a);f.DragAndDropUtils.stopPropagation(a)};a.attachEvent("ondrop",g);c(d).unload(function(){a.detachEvent("ondrop",g)})}}else c.browser.safari&&
b&&a.addEventListener("drop",function(a){b(a);f.DragAndDropUtils.stopPropagation(a)},!1)},niceSize:function(a){for(var b=" B; kB; MB; GB; TB; PB; EB; ZB; YB".split(";"),c=0,d=b.length;c<d;c++)if(a<Math.pow(2,10*(c+1)))return(!c?a:(a/Math.pow(2,10*c)).toFixed(2))+b[c];return(a/Math.pow(2,10*(c+1))).toFixed(2)+b[b.length-1]},ieDragEnterAndDragOverCallbackWrapper:function(a){return function(b){if(b=b||d.event)a&&a(b),c.browser.msie&&(b.returnValue=!1)}},safariDragOverCallbackWrapper:function(a){return function(b){if((b=
b||d.event)&&"file"!==b.target.type)a&&a(b),-1!=c.inArray("public.file-url",b.dataTransfer.types)&&b.preventDefault()}},mozillaDropCallbackWrapper:function(a){return function(b){b&&(a&&a(b),b.preventDefault(),f.DragAndDropUtils.isFireFox35OrLater()?f.DragAndDropUtils.firefox35FileDataInEvent(b)&&b.stopPropagation():b.stopPropagation())}},firefox35DragEnterAndOverCallbackWrapper:function(a){return function(b){b&&(a&&a(b),f.DragAndDropUtils.firefox35FileDataInEvent(b)&&b.preventDefault())}},firefox35FileDataInEvent:function(a){return-1!=
c.inArray("application/x-moz-file",a.dataTransfer.types)},stopPropagation:function(a){if(a=a||d.event)a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){if(a=a||d.event)a.preventDefault?a.preventDefault():a.returnValue=!1},isFireFox35OrLater:function(){return!this.isFireFox30()&&-1!=c.browser.version.indexOf("1.9.")},isFireFox30:function(){return-1!=c.browser.version.indexOf("1.9.0")},enableDropZoneOn:function(a,b){if(!a)throw Error("Cannot enable drop zone on invalid container. Received: "+
a);b=b||f.DragAndDrop.defaultDropHandler;this.bindDragEnter(a);this.bindDragOver(a);this.bindDragLeave(a);this.bindDrop(a,b)}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-drag-and-drop/drag-and-drop-utils","AJS.DragAndDropUtils");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/default-drop-handler.js' */
define("confluence-drag-and-drop/default-drop-handler","ajs document confluence/meta jquery confluence/legacy underscore plupload window".split(" "),function(a,h,j,f,k,p,l,q){var m={initialise:function(){function n(){var a=f(".aui-blanket:visible");return a.length&&a.css("visibility")!=="hidden"&&!f("#drag-and-drop-progress-dialog:visible").length}function m(){for(;e.files.length;)e.removeFile(e.files[0])}var d,i=h.getElementById("fileuploadShim");if(!i){i=h.createElement("div");i.setAttribute("id",
"fileuploadShim");h.body.appendChild(i)}var e=new l.Uploader({runtimes:"html5",dragdrop:true,drop_element:f("body")[0],browse_button:i.getAttribute("id"),multipart:false,stop_propagation:true,max_file_size:+j.get("global-settings-attachment-max-size")}),o=function(){d=a.Editor&&a.Editor.isVisible()&&k.EditorUploadProgressDialog?k.EditorUploadProgressDialog:new a.DragAndDropProgressDialog};d=null;e.init();a.DragAndDrop.defaultDropHandler=null;e.bind("FilesAdded",function(g,b){function r(a,b){!d&&o();
for(var c=0;c<b.length;c++){var g=b[c];g.status!==l.FAILED&&d.render({workId:g.id,status:g.status,file:g})}e.start()}if(n())m();else if(a.Editor&&a.Editor.isVisible()){var c=p.reject(b,function(a){return a.status===l.FAILED});k.Uploader&&k.Uploader.trigger("FilesAdded",c)}else a.UploadUtils.filterFiles(g,b,r)});e.bind("BeforeUpload",function(g,b){if(!a.Editor||!a.Editor.isVisible()){var e=a.DragAndDropUtils.base+a.contextPath()+"/plugins/drag-and-drop/upload.action",c=j.get("page-id"),c=c!=0?{pageId:c}:
{draftId:j.get("draft-id")},f=b.name.substr(b.name.lastIndexOf(".")+1);c.filename=b.name;c.size=b.size;c.mimeType=l.mimeTypes[f.toLowerCase()]||a.DragAndDropUtils.defaultMimeType;c.spaceKey=j.get("space-key");c.atl_token=j.get("atl-token");g.settings.url=l.buildUrl(e,c);d.cancelListeners.push(function(b,c){var e=g.getFile(c.workId);e&&g.removeFile(e);d.renderInfo(c.workId,"Le fichier a \u00e9t\u00e9 retir\u00e9 manuellement de la file d\u0027attente.")});d.show()}});e.bind("UploadProgress",function(a,b){d.renderUpdateToBytesUploaded(b.id,
b.loaded,b.size);d.hideCloseButton()});e.bind("FileUploaded",function(e,b,f){f.status===0?d.renderError(b.id,"Le serveur ne r\u00e9pond pas. Veuillez v\u00e9rifier qu\u0027il est bien activ\u00e9."):d.renderComplete(b.id)});e.bind("Error",function(e,b){if(n())m();else if(a.Editor&&a.Editor.isVisible())k.Uploader&&k.Uploader.trigger("Error",b);else{var h,c;if(b.response){try{h=f.parseJSON(b.response);c=h.actionErrors[0]}catch(i){c=i.name==="SyntaxError"?"R\u00e9ponse incorrecte envoy\u00e9e par le serveur.":b.message}d.renderError(b.file.id,
c);a.trigger("analyticsEvent",{name:"confluence.default-drop.upload.error.server-unknown"})}else{c=b.message;if(b.code===l.FILE_SIZE_ERROR){c=a.format("{0} est trop volumineux pour \u00eatre charg\u00e9. Les fichiers doivent \u00eatre inf\u00e9rieurs \u00e0 {0}.",a.DragAndDropUtils.niceSize(j.get("global-settings-attachment-max-size")));a.trigger("analyticsEvent",{name:"confluence.default-drop.upload.error.file-size"})}else if(b.code===a.UploadUtils.ErrorCode.FILE_IS_A_FOLDER_ERROR){c="Il s\u0027agit peut-\u00eatre d\u0027un dossier ou d\u0027un type de fichier non pris en charge.";a.trigger("analyticsEvent",{name:"confluence.default-drop.upload.error.file-type"})}!d&&
o();d.render({workId:b.file.id,status:b.file.status,file:b.file,errorMessage:c});if(!d.isVisible()){d.show();d.showCloseButton()}}}});e.bind("UploadComplete",function(){if(!e.total.queued&&d){d.showCloseButton();d.hasErrors()||setTimeout(function(){d.hide();d.clearRenderOutput();q.location.reload()},1E3)}})},bind:function(){function a(){f(h).unbind("dragenter",a);m.initialise()}f(h).bind("dragenter",a)}};return m});
require("confluence/module-exporter").safeRequire("confluence-drag-and-drop/default-drop-handler",function(a){require("ajs").toInit(a.bind)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/observable-array-list.js' */
define("confluence-drag-and-drop/observable-array-list",["ajs","jquery"],function(g,f){var e=function(){this._data=[];this._pushObservers=[]};e.prototype={push:function(a){this._data.push(a);this._notifyPushObservers(a)},length:function(){return this._data.length},remove:function(a,b){return this._remove.call(this._data,a,b)},_remove:function(a,b){var c=this.slice((b||a)+1||this.length);this.length=0>a?this.length+a:a;return this.push.apply(this,c)},shift:function(){return this._data.shift()},removeByPredicate:function(a){for(var b=
[],c=this._data.length,d=0;d<c;d++)a(this._data[d])||b.push(this._data[d]);this._data=b;return c-this._data.length},addPushObserver:function(a){if(f.isFunction(a))this._pushObservers.push(a);else throw Error("Attempting to add an observer that is not a function: "+a);},_notifyPushObservers:function(a){for(var b=0,c=this._pushObservers.length;b<c;b++)this._pushObservers[b](a)}};return e});require("confluence/module-exporter").exportModuleAsGlobal("confluence-drag-and-drop/observable-array-list","AJS.ObservableArrayList");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/upload-progress-dialog.js' */
define("confluence-drag-and-drop/upload-progress-dialog",["ajs","plupload","jquery","document"],function(b,g,c,i){var h=function(a){var d=this,e={header:"Joindre des fichiers",width:600,height:400};this._options=c.extend({},e,a);this.id="drag-and-drop-progress-dialog";this._dialog=new b.Dialog(this._options.width,this._options.height,this.id);this._dialog.addHeader(this._options.header).addPanel("Panel 1",b.DragAndDrop.Templates.uploadFileStatusContainer()).addButton("Termin\u00e9",
function(){d.hide();d.clearRenderOutput()},"all-file-uploads-complete");this._dialog.getCurrentPanel().setPadding(0);this._$closeButton=this.find(".all-file-uploads-complete");c(i).keydown(function(a){if(27===a.which)return d._$closeButton.prop("disabled")||(d.hide(),d.clearRenderOutput()),b.stopEvent(a)});this._$container=this.find("#upload-statuses");this._workIdsOfFilesInProgress=[];this.cancelListeners=[];this.onShowListeners=[];this._hidden=!0;this.hasErrorMessage=!1};h.prototype={show:function(){this._hidden&&
(this._dialog.show(),this._hidden=!1,c.each(this.onShowListeners,function(a,c){c()}));this.hideCloseButton()},hide:function(){this._hidden||(this._dialog.hide(),this._hidden=!0)},isVisible:function(){return!this._hidden},_getProgressElementId:function(a){return"file-"+a+"-progress"},render:function(a){this._workIdsOfFilesInProgress.push(a.workId);var d=this._getProgressElementId(a.workId);this._$container.append(b.DragAndDrop.Templates.fileStatus({filename:a.file.name,progressElementId:d,workId:a.workId,
showCancel:a.status==g.QUEUED}));b.progressBars.update("#"+d,0);a.status==g.QUEUED?c("#file-upload-cancel-"+a.workId).click(function(b){return function(d){c.each(b,function(c,b){b(d,a)})}}(this.cancelListeners)):this.renderError(a.workId,a.errorMessage)},renderError:function(a,d){if(-1==c.inArray(a,this._workIdsOfFilesInProgress))throw Error("No file status found with id: "+a);var e=c("#file-status-block-"+a),f=b.escapeEntities(e.attr("data-filename"));e.html(aui.message.warning({content:d,titleContent:f}));
this.hasErrorMessage=!0},renderInfo:function(a,d){if(-1==c.inArray(a,this._workIdsOfFilesInProgress))throw Error("No file status found with id: "+a);var e=c("#file-status-block-"+a),f=b.escapeEntities(e.attr("data-filename"));e.html(aui.message.info({content:d,titleContent:f}));this.hasErrorMessage=!0},hasErrors:function(){return this.hasErrorMessage},renderUpdateToBytesUploaded:function(a,d,e){if(-1==c.inArray(a,this._workIdsOfFilesInProgress))throw Error("No file status found with id: "+a);var f=
b.DragAndDropUtils.niceSize(d),g=c("#file-"+a+"-uploaded");g.length?g.text(f):c("#file-upload-progress-text-"+a).html(b.DragAndDrop.Templates.uploadFileStatusProgressMessage({fileId:a,uploadedSizeNice:f,totalSizeNice:b.DragAndDropUtils.niceSize(e)}));b.progressBars.update("#"+this._getProgressElementId(a),d/e)},renderComplete:function(a){if(-1==c.inArray(a,this._workIdsOfFilesInProgress))throw Error("No file status found with id: "+a);c("#cancel-or-success-placeholder-"+a).html(b.DragAndDrop.Templates.uploadFileStatusSuccessIcon())},
renderCancelled:function(a){if(-1==c.inArray(a,this._workIdsOfFilesInProgress))throw Error("No file status found with id: "+a);b.progressBars.setIndeterminate("#"+this._getProgressElementId(a));c("#file-upload-progress-text-"+a).html("Annul\u00e9.");c("#cancel-or-success-placeholder-"+a).hide()},clearRenderOutput:function(){this.showCloseButton();this._$container.empty();this._workIdsOfFilesInProgress=[];this.hasErrorMessage=!1},hideCloseButton:function(){this._$closeButton.hide()},
showCloseButton:function(){this._$closeButton.show()},find:function(a){return this._dialog.getCurPanel().page.body.parent().find(a)}};return h});require("confluence/module-exporter").exportModuleAsGlobal("confluence-drag-and-drop/upload-progress-dialog","AJS.DragAndDropProgressDialog");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'templates/drag-and-drop.soy' */
// This file was automatically generated from drag-and-drop.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace AJS.DragAndDrop.Templates.
 */

if (typeof AJS == 'undefined') { var AJS = {}; }
if (typeof AJS.DragAndDrop == 'undefined') { AJS.DragAndDrop = {}; }
if (typeof AJS.DragAndDrop.Templates == 'undefined') { AJS.DragAndDrop.Templates = {}; }


AJS.DragAndDrop.Templates.fileStatus = function(opt_data, opt_ignored) {
  return '<li id="file-status-block-' + soy.$$escapeHtml(opt_data.workId) + '" data-filename="' + soy.$$escapeHtml(opt_data.filename) + '"><div class="aui-group aui-group-split file-status-item"><div class="aui-item"><label>' + soy.$$escapeHtml(opt_data.filename) + '</label></div><div class="aui-item"><div id="file-upload-progress-text-' + soy.$$escapeHtml(opt_data.workId) + '" class="file-upload-progress-text">' + soy.$$escapeHtml("En attente...") + '</div></div></div><div class="file-upload-progress-block"><div class="aui-progress-indicator" id="' + soy.$$escapeHtml(opt_data.progressElementId) + '"><span class="aui-progress-indicator-value"></span></div>' + ((opt_data.showCancel) ? '<div id="cancel-or-success-placeholder-' + soy.$$escapeHtml(opt_data.workId) + '" class="cancel-or-success-placeholder ui-state-default"><span id="file-upload-cancel-' + soy.$$escapeHtml(opt_data.workId) + '" class="aui-icon aui-icon-small aui-iconfont-remove" title="' + soy.$$escapeHtml("Annuler le chargement") + '">' + soy.$$escapeHtml("Annuler") + '</span></div>' : '') + '</div></li>';
};
if (goog.DEBUG) {
  AJS.DragAndDrop.Templates.fileStatus.soyTemplateName = 'AJS.DragAndDrop.Templates.fileStatus';
}


AJS.DragAndDrop.Templates.uploadFileStatusContainer = function(opt_data, opt_ignored) {
  return '<ul id="upload-statuses"></ul>';
};
if (goog.DEBUG) {
  AJS.DragAndDrop.Templates.uploadFileStatusContainer.soyTemplateName = 'AJS.DragAndDrop.Templates.uploadFileStatusContainer';
}


AJS.DragAndDrop.Templates.uploadFileStatusSuccessIcon = function(opt_data, opt_ignored) {
  return '<span class=\'aui-icon aui-icon-small aui-iconfont-success\'></span>';
};
if (goog.DEBUG) {
  AJS.DragAndDrop.Templates.uploadFileStatusSuccessIcon.soyTemplateName = 'AJS.DragAndDrop.Templates.uploadFileStatusSuccessIcon';
}


AJS.DragAndDrop.Templates.uploadFileStatusProgressMessage = function(opt_data, opt_ignored) {
  return '<span id="file-' + soy.$$escapeHtml(opt_data.fileId) + '-uploaded">' + soy.$$escapeHtml(opt_data.uploadedSizeNice) + '</span> ' + soy.$$escapeHtml("sur") + ' ' + soy.$$escapeHtml(opt_data.totalSizeNice);
};
if (goog.DEBUG) {
  AJS.DragAndDrop.Templates.uploadFileStatusProgressMessage.soyTemplateName = 'AJS.DragAndDrop.Templates.uploadFileStatusProgressMessage';
}


AJS.DragAndDrop.Templates.dropZone = function(opt_data, opt_ignored) {
  return '<div class="attachments-drop-zone"><div class="drop-zone-image"></div><div class="drop-zone-text">' + soy.$$escapeHtml("D\xe9posez les fichiers ici pour les joindre") + '</div></div>';
};
if (goog.DEBUG) {
  AJS.DragAndDrop.Templates.dropZone.soyTemplateName = 'AJS.DragAndDrop.Templates.dropZone';
}


AJS.DragAndDrop.Templates.dragOverlay = function(opt_data, opt_ignored) {
  return '<div id="dragOverlay"><div class="overlay-blanket"></div><div class="overlay-center"><p>' + soy.$$escapeHtml("D\xe9poser des fichiers pour les ins\xe9rer dans la page") + '</p></div><span class="overlay-baseline"></span><div class="overlay-drop-zone"></div></div>';
};
if (goog.DEBUG) {
  AJS.DragAndDrop.Templates.dragOverlay.soyTemplateName = 'AJS.DragAndDrop.Templates.dragOverlay';
}


AJS.DragAndDrop.Templates.dragAndDropTip = function(opt_data, opt_ignored) {
  return '<div class="attach-tip-discovery"><span class="img"></span><div class="text"><strong>' + soy.$$escapeHtml("Astuce\xa0:") + ' </strong><p>' + soy.$$escapeHtml("D\xe9poser des fichiers directement sure votre page pour les ins\xe9rer en place.") + '</p><div><a class="close-tip" href="#">' + soy.$$escapeHtml("Ok, compris") + '</a></div></div></div>';
};
if (goog.DEBUG) {
  AJS.DragAndDrop.Templates.dragAndDropTip.soyTemplateName = 'AJS.DragAndDrop.Templates.dragAndDropTip';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:support', location = 'js/upload-utils.js' */
define("confluence-drag-and-drop/upload-utils",["ajs"],function(h){return{ErrorCode:{FILE_IS_A_FOLDER_ERROR:-602},filterFiles:function(d,a,g){for(var e=[],b=0,c=0;c<a.length;c++)if(4096>=a[c].nativeFile.size){var f=new FileReader;f.onload=function(){b++;e.push(this.currentFile);b===a.length&&g(d,e)};f.onerror=function(){d.removeFile(this.currentFile);d.trigger("Error",{code:h.UploadUtils.ErrorCode.FILE_IS_A_FOLDER_ERROR,message:"File is a folder",file:this.currentFile});b++;b===a.length&&g(d,e)};
f.currentFile=a[c];f.readAsText(a[c].nativeFile)}else b++,e.push(a[c]),b===a.length&&g(d,e)}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-drag-and-drop/upload-utils","AJS.UploadUtils");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:util-resource', location = 'util/utils.js' */
define("confluence/ic/util/utils",["jquery","underscore","ajs","backbone","exports"],function(w,R,u,x,F){var m={INLINE_COMMENTS:u.DarkFeatures.isEnabled("confluence-inline-comments"),RESOLVED_INLINE_COMMENTS:u.DarkFeatures.isEnabled("confluence-inline-comments-resolved"),RICH_TEXT_EDITOR:u.DarkFeatures.isEnabled("confluence-inline-comments-rich-editor"),DANGLING_COMMENT:u.DarkFeatures.isEnabled("confluence-inline-comments-dangling-comment")},t=["dateautocomplete","confluencemacrobrowser","propertypanel","jiraconnector","dfe"],n=["autoresize","confluenceleavecomment"],r=["code"];var a,C,q;function O(){return R.clone(m)}function N(){return R.clone(t)}function j(){return R.clone(n)}function d(U,T){var W;if(!U||!T){return}var S=w(U.containingElement);if(!S.is(".inline-comment-marker.valid")){S=w("<div/>").append(U.html).find(".inline-comment-marker.valid")}if(S.length>0&&f(S)){var V=S.first().data("ref");W=T.findWhere({markerRef:V});return W}}function f(S){return S.filter(function(){return w(this).text().length>0}).length>0}function h(S){return u.contextPath()+"/pages/viewpage.action?pageId="+u.Meta.get("latest-page-id")+"&focusedCommentId="+S+"#comment-"+S}function s(Y,X,S){var V=X.match(/(focusedCommentId|replyToComment)=(\d+)/);if(V==null){return}var U=V[1]==="replyToComment";var W=parseInt(V[2],10);var T=Y.findWhere({id:W});if(T!=null){o(Y,T,S,U)}else{w.ajax({url:u.contextPath()+"/rest/inlinecomments/1.0/comments/replies/"+W+"/commentId"}).done(function(Z){T=Y.findWhere({id:Z});o(Y,T,S,U)})}}function o(V,U,S,T){if(U!=null){if(U.isResolved()){new S({collection:V,focusCommentId:U.get("id")}).render()}else{if(!U.isDangling()){x.trigger("ic:view",U,"permalink",{isReplyComment:T})}}}}function K(){if(u.Meta.get("current-user-avatar-url")){return u.contextPath()+u.Meta.get("current-user-avatar-url")}return u.Meta.get("static-resource-url-prefix")+"/images/icons/profilepics/anonymous.png"}function P(){return u.Meta.get("user-display-name")||u.Meta.get("current-user-fullname")}function b(U){if(typeof U.selectionStart==="number"){var S=U.value.length;U.selectionStart=S;U.selectionEnd=S}else{if(typeof U.createTextRange!=null){U.focus();var T=U.createTextRange();T.collapse(false);T.select()}}}function L(S){b(S);window.setTimeout(function(){b(S)},1)}function E(X,W){var U="webkitAnimationEnd oanimationend msAnimationEnd animationend";var T=X.$wikiContent;var S=w.Deferred();if(W){var Y=w(".inline-comment-marker.active");T.addClass("ic-fade-in-animation");T.one(U,function(){w(this).removeClass("ic-fade-in-animation")});X.$el.addClass("ic-slide-in");X.$el.one(U,function(){w(this).removeClass("ic-slide-in");Y.addClass("ic-highlight-pulse");Y.one(U,function(){Y.removeClass("ic-highlight-pulse")})});S.resolve()}else{T.bind(U,function(Z){if(Z.originalEvent.animationName=="ic-fade-out-animation"){X.$wikiContent.removeClass("ic-fade-out-animation");X.$wikiContent.css("opacity","0.5")}else{if(Z.originalEvent.animationName=="ic-fade-in-animation"){X.$wikiContent.css("opacity","1");X.$wikiContent.removeClass("ic-fade-in-animation");X.$wikiContent.unbind(U)}}});T.addClass("ic-fade-out-animation");X.$el.addClass("ic-slide-out");var V=function(){X.$el.removeClass("ic-slide-out");X._emptySidebar();y().css("padding-right","0");T.addClass("ic-fade-in-animation");T.css("position","static");S.resolve();X.$el.off(U,V)};X.$el.on(U,V)}return S.promise()}function k(S){var T=w(S).closest("a");if(!T.length){T=w(S).find("a")}return T}function A(S){S.each(function(){var T=k(this);T.length&&T.off("mousemove")})}function Q(){return document.body.style.animation!==undefined||document.body.style.webkitAnimation!==undefined}function c(T){var S=T.parents(".expand-content.expand-hidden");S.each(function(U){w(this).siblings(".expand-control").click()})}function v(T){var S=u.Rte&&u.Rte.getEditor();if(T===true){if(M()&&S&&S.isDirty()){return confirm("Votre commentaire sera perdu.")}}else{if(S&&S.isDirty()&&Confluence.Editor&&!Confluence.Editor.getContentType){return confirm("Votre commentaire sera perdu.")}}return true}function M(){return !!w(".ic-sidebar #wysiwygTextarea_ifr").length}function G(){return u.Meta.get("use-keyboard-shortcuts")&&Confluence.KeyboardShortcuts&&Confluence.KeyboardShortcuts.enabled}function p(S){S.$("button.ic-action-hide").tooltip({gravity:"se"});S.$("#ic-nav-next").tooltip({gravity:"s"});S.$("#ic-nav-previous").tooltip({gravity:"s"})}function B(W){if(J()){W.css("padding-bottom","20px");return}var U=W.height();var V=W.offset().top;var T=V+U;var X=this.getPageContainer().offset().top;var S=T-X;this.getPageContainer().css({"min-height":S+"px"})}function z(W){W=W.closest(".ic-display-comment-view");var V=this;var T=w(".confluence-embedded-image, .confluence-embedded-file img",W);var U=T.length;var S=0;if(U>0){T.off("load").one("load",function(){if(++S===U){V.recalculateContentHeight(W)}}).each(function(){if(this.complete){w(this).load()}})}}function J(){if(q===undefined){q=!!D().length}return q}function y(){if(a===undefined){a=w("#content")}return a}function D(){if(C===undefined){C=w("#splitter-content")}return C}function g(S,T){if(T&&!T.is(":visible")){return}if(S){if(this.isDocTheme()){this.getSplitterContent().scrollTop(T.offset().top-S)}else{window.scrollTo(0,T.offset().top-S)}}}function e(T){var S=w.Deferred();w.ajax({url:u.contextPath()+"/rest/api/content/"+T+"?expand=body.editor",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(U){var V=U.body.editor.value;S.resolve(V)}).fail(function(U,W,V){S.reject(U,W,V)});return S.promise()}function I(S){var T=S.closest(".conf-macro");return(T.data("hasbody")===false||S.find('.conf-macro[data-hasbody="false"]').length>0)||r.indexOf(T.data("macro-name"))!=-1}function i(S){return S.closest(".user-mention").length>0||S.find(".user-mention").length>0}function l(S){return S.closest("a[href^='/']:not('.user-mention')").length>0||S.find("a[href^='/']:not('.user-mention')").length>0}function H(){var S={isDefault:true,path:u.Meta.get("static-resource-url-prefix")+"/images/icons/profilepics/default.png"};if(u.Meta.get("current-user-avatar-url")!=="/images/icons/profilepics/default.png"){S={isDefault:false,path:u.contextPath()+u.Meta.get("current-user-avatar-url")}}var T=u.Meta.get("remote-user");return{userName:T==""?null:T,displayName:u.Meta.get("current-user-fullname"),profilePicture:S}}F.overlappedSelection=d;F.focusedCommentUrl=h;F.showFocusedComment=s;F.getAuthorAvatarUrl=K;F.moveCaretToEnd=L;F.animateSidebar=E;F.getDarkFeatures=O;F.getInlineLinks=k;F.removeInlineLinksDialog=A;F.isAnimationSupported=Q;F.showHighlightContent=c;F.getUnsupportedRtePlugins=N;F.getSupportedRtePlugins=j;F.confirmProcess=v;F.getAuthorDisplayName=P;F.isKeyboardShortcutsEnable=G;F.addSidebarHeadingTooltip=p;F.hasEditorInSidebar=M;F.recalculateContentHeight=B;F.resizeContentAfterLoadingImages=z;F.isDocTheme=J;F.getPageContainer=y;F.getSplitterContent=D;F.scrollToCommentAfterToggleSideBar=g;F.getEditorFormat=e;F.containUnsupportedMacro=I;F.containInternalLink=i;F.containUserMetion=l;F.getCurrentUserInfo=H});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:util-resource', location = 'util/text-highlighter.js' */
define("confluence/ic/util/text-highlighter",["jquery"],function(c){var a="ic-current-selection";function b(){c.textHighlighter.createWrapper=function(d){return c("<span></span>").addClass(d.highlightedClass)};this.$el=c("#content .wiki-content").first();if(this.$el.length>0){this.$el.textHighlighter({highlightedClass:a})}}b.prototype.highlight=function(e){if(this.$el.length===0){return}var d=c(this.$el.getHighlighter().doHighlight(e));return this.$el.getHighlighter().serializeHighlights(d)};b.prototype.removeHighlight=function(){if(this.$el.length===0){return}this.$el.getHighlighter().removeHighlights();return this};b.prototype.deserializeHighlights=function(d,e){if(this.$el.length===0){return}var f='<span class="inline-comment-marker" data-ref="'+e+'"></span>';return this.$el.getHighlighter().deserializeHighlights(d,f)};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:models', location = '/model/comment.js' */
define("confluence/ic/model/comment",["jquery","underscore","backbone","ajs","confluence/ic/util/utils","confluence/ic/model/reply-collection"],function(d,b,g,a,c,f){var e=g.Model.extend({defaults:{authorDisplayName:c.getAuthorDisplayName(),authorUserName:a.Meta.get("remote-user"),authorAvatarUrl:a.contextPath()+a.Meta.get("current-user-avatar-url"),body:"",originalSelection:"",containerId:a.Meta.get("latest-page-id"),parentCommentId:"0",lastFetchTime:d("meta[name=confluence-request-time]").attr("content"),hasDeletePermission:true,hasEditPermission:true,hasResolvePermission:true,resolveProperties:{resolved:false,resolvedTime:0},serializedHighlights:"",deleted:false},urlRoot:a.contextPath()+"/rest/inlinecomments/1.0/comments",initialize:function(h){h=h||{};this._setHighlights(h.markerRef);var i=this;this.replies=new f();this.replies.url=function(){return i.url()+"/replies"};if(c.getDarkFeatures().DANGLING_COMMENT&&a.Meta.get("page-id")===a.Meta.get("latest-page-id")){if(this.isDangling()&&!this.isResolved()){this.resolve(true,{wait:true,dangling:true,success:b.bind(function(){g.trigger("ic:open:dangled",this)},this),error:b.bind(function(){g.trigger("ic:resolve:dangled:failed",this)},this)})}}},validate:function(){if(!this.get("body")){return true}},resolve:function(h,i){i=i||{};this.save({},b.extend(i,{url:this.urlRoot+"/"+this.get("id")+"/resolve/"+h+"/dangling/"+(i.dangling===true)}))},isResolved:function(){return this.get("resolveProperties").resolved},isDangling:function(){return this.highlight===undefined},isDeleted:function(){return this.get("deleted")},_setHighlights:function(i){var h;if(i!==undefined){h=d("#content .wiki-content:first").find('.inline-comment-marker[data-ref="'+i+'"]')}else{h=d(".ic-current-selection")}if(h.length!==0){this.highlights=h;this.highlight=h.first()}else{this.highlights=undefined;this.highlight=undefined}},destroy:function(i){i=i?b.clone(i):{};var h=this;var k=i.success;var j=function(n,m){var l=m.error;m.error=function(o){if(l){l(n,o,m)}n.trigger("error",n,o,m)}};i.success=function(l){if(k){k(h,l,i)}};j(this,i);return this.sync("delete",this,i)}});return e});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:models', location = '/model/comment-collection.js' */
define("confluence/ic/model/comment-collection",["jquery","backbone","ajs","underscore","confluence/ic/model/comment"],function(d,f,a,b,e){var c=f.Collection.extend({model:e,initialize:function(){this.listenTo(this,"sort",this._removeCachedMarkers)},url:function(){var h=a.contextPath();var g=a.Meta.get("page-id");return h+"/rest/inlinecomments/1.0/comments?containerId="+g},getResolvedCount:function(){return this.getResolvedComments().length},getUnresolveCount:function(){return this.reject(function(g){return g.isResolved()===true&&g.isDeleted()===false}).length},getResolvedComments:function(){return this.filter(function(g){return g.isResolved()===true&&g.isDeleted()===false})},getResolvedCommentsDesc:function(){return b.sortBy(this.getResolvedComments(),function(g){return 0-g.get("resolveProperties").resolvedTime})},getNextCommentOnPage:function(){return this._getCommentAtRelativeOffset(1)},getPrevCommentOnPage:function(){return this._getCommentAtRelativeOffset(-1)},_getCommentAtRelativeOffset:function(j){var k=this.getCommentsOnPage();var g=this.findWhere({active:true});if(g===undefined||k.length<=1){return null}var i=b.pluck(k,"id");var h=b.indexOf(i,g.get("id"));return k[(h+j+k.length)%k.length]},getCommentsOnPage:function(){return this.filter(function(g){return((g.isResolved()===false)&&!g.isDangling()&&(g.isDeleted()===false))||g.get("active")===true})},getCommentsOnPageCount:function(){return this.getCommentsOnPage().length},getActiveIndexWithinPageComments:function(){var h=b.pluck(this.getCommentsOnPage(),"id");var g=this.findWhere({active:true});if(g===undefined){return null}var i=g.get("id");return b.indexOf(h,i)},comparator:function(h,g){if(this.markers===undefined){this.markers=d("#content .wiki-content:first").find(".inline-comment-marker")}if(h.highlight===undefined){return 1}if(g.highlight===undefined){return -1}return this.markers.index(h.highlight)-this.markers.index(g.highlight)},_removeCachedMarkers:function(){this.markers=undefined}});return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:models', location = '/model/reply.js' */
define("confluence/ic/model/reply",["jquery","backbone","ajs","confluence/ic/util/utils",],function(d,e,b,c){var a=e.Model.extend({defaults:{authorDisplayName:c.getAuthorDisplayName(),authorUserName:b.Meta.get("remote-user"),authorAvatarUrl:b.contextPath()+b.Meta.get("current-user-avatar-url"),body:"",commentId:"0",hasDeletePermission:true,hasEditPermission:!!b.Meta.get("remote-user")},urlRoot:function(){return b.contextPath()+"/rest/inlinecomments/1.0/comments/"+this.get("commentId")+"/replies"},sync:function(h,g,f){f=f||{};if(h==="create"){f.url=this.urlRoot()+"?containerId="+b.Meta.get("latest-page-id")}return e.sync.call(this,h,g,f)},validate:function(){if(!this.get("body")){return true}}});return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:models', location = '/model/reply-collection.js' */
define("confluence/ic/model/reply-collection",["backbone","confluence/ic/model/reply"],function(c,a){var b=c.Collection.extend({model:a});return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:app', location = 'analytics/ic-analytics.js' */
define("confluence/ic/analytics",["ajs","underscore","backbone"],function(b,c,d){var a={};c.extend(a,d.Events);a.start=function(){if(this.running===true){return}this.running=true;this.send=function(e,f){b.trigger("analytics",{name:e,data:f})};this.listenTo(d,"ic:highlight-panel-click",function(){this.send("confluence.highlight.actions.comment.inline")});this.listenTo(d,"ic:view",function(f,e){this.send("confluence.comment.inline.view");if(e==="nav"){this.send("confluence.comment.inline.view.nav")}if(e==="permalink"){this.send("confluence.comment.inline.view.permalink")}});this.listenTo(d,"ic:overlap",function(){this.send("confluence.comment.inline.overlap")});this.listenTo(d,"ic:edit",function(){this.send("confluence.comment.inline.edit")});this.listenTo(d,"ic:persist",function(){this.send("confluence.comment.inline.create")});this.listenTo(d,"ic:sidebar:close",function(){this.send("confluence.comment.inline.sidebar.close")});this.listenTo(d,"ic:reply:persist",function(){this.send("confluence.comment.inline.reply")});this.listenTo(d,"ic:delete ic:reply:delete",function(){this.send("confluence.comment.inline.delete")});this.listenTo(d,"ic:resolved",function(){this.send("confluence.comment.inline.resolved")});this.listenTo(d,"ic:unresolved",function(){this.send("confluence.comment.inline.unresolved")});this.listenTo(d,"ic:resolved:view",function(f){var e={total:f};this.send("confluence.comment.inline.resolved.view",e)});this.listenTo(d,"ic:resolved:dismiss:recovery",function(){this.send("confluence.comment.inline.resolved.dismiss")});this.listenTo(d,"ic:resolved:show:recovery",function(){this.send("confluence.comment.inline.resolved.discovery")});this.listenTo(d,"ic:open:dangled",function(f){var e={commentId:f.get("id"),pageId:b.Meta.get("page-id")};this.send("confluence.comment.inline.open.dangled",e)});this.listenTo(d,"ic:editor:load:fail",function(){var e={pageId:b.Meta.get("page-id")};this.send("confluence.comment.inline.editor.load.fail",e)});this.listenTo(d,"ic:resolve:dangled:failed",function(f){var e={commentId:f.get("id"),pageId:b.Meta.get("page-id")};this.send("confluence.comment.inline.resolved.dangled.failed",e)})};a.stop=function(){this.running=false;this.stopListening()};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:app', location = '/app/app.js' */
define("confluence/ic/app/app",["jquery","backbone","ajs","confluence/ic/model/comment","confluence/ic/model/comment-collection","confluence/ic/analytics","exports"],function(e,h,c,f,d,b,a){function g(){b.start();var n=true;var i=new d();function l(){q().done(function(s){s.afterSyncCommentCollection();s.displayPermalinkedComment(i)})}e("body").on("click","#view-resolved-comments",function(s){s.preventDefault();q().done(function(t){t.createResolvedCommentListView()})});i.fetch({cache:false}).done(function(){if(i.getCommentsOnPageCount()>0){l()}if(i.getResolvedCount()>0){q().done(function(s){s.updateResolvedCommentCountInToolsMenu()})}});var k=window.location.search;if(k.indexOf("focusedCommentId")!==-1){l()}h.listenTo(h,"ic:resolved",function(){l()});var o=e("#view-resolved-comments>span");o.text("Commentaires r\u00e9solus"+c.format(" ({0})",i.getResolvedCount()));var p=function(u,t){var v=i.get(t);var s=false;if(v===undefined){v=new f({id:t});s=true}v.fetch({success:function(w){w._setHighlights(w.get("markerRef"));if(s){i.add(w)}else{v.replies.isFetched=false}h.trigger("ic:view",v,"quickreload")}})};c.bind("qr:show-new-thread",function(t,s){q().done(function(){p(t,s)})});c.bind("qr:add-new-highlight",function(u,t,s){q().done(function(){c.trigger("qr:add-new-highlight-text",[t,s])})});var j;var r;function q(){if(n){n=false;if(j){return j.promise()}j=e.Deferred();WRM.require("wrc!inline-comments-load-sidebar").then(function(){var s=require("confluence/ic/app/loader");s.init(i);j.resolve(s)})}r=false;return j.promise()}var m="com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment";if(Confluence&&Confluence.HighlightAction){Confluence.HighlightAction.registerButtonHandler(m,{onClick:function(s){q().done(function(t){if(r==false){r=true;t.loadSidebarOnClick(s)}})},shouldDisplay:Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY})}}a.init=g});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-comments:bootstrap', location = '/app/bootstrap.js' */
require(["jquery","ajs","confluence/ic/app/app"],function(c,a,b){if(a.Meta.get("page-id")&&(a.Meta.get("page-id")===a.Meta.get("latest-page-id"))){c(b.init)}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-amd-resources', location = '/js/amd/confluence-amd.js' */
define("confluence",function(){return Confluence});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-amd-resources', location = '/js/amd/tinymce-amd.js' */
define("tinymce",function(){return tinymce});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:common', location = '/js/view-file-macro-utils.js' */
define("vfm/view-file-macro-utils",[],function(){var a={DEFAULT_HEIGHT:"250",DEFAULT_HEIGHT_IN_COMMENT:"150",THUMBNAIL_STATUS_IN_PROGRESS:202,THUMBNAIL_STATUS_CONVERTED:200,THUMBNAIL_STATUS_ERROR:415,THUMBNAIL_STATUS_BUSY:429,THUMBNAIL_POLLING_PERIOD:1000,THUMBNAIL_POLLING_BACKOFF_RATIO:1.25,MAP_NICE_TYPE_TO_TEXT:{"pdf document":"PDF","word document":"Document","excel spreadsheet":"Feuille de calcul","powerpoint presentation":"Pr\u00e9sentation","generic file":"Fichier"},getFileNameFromUrl:function(b){if(!b){return""}var c=b.indexOf("#");c=(c>=0)?c:b.length;b=b.substring(0,c);c=b.indexOf("?");c=(c>=0)?c:b.length;b=b.substring(0,c);c=b.lastIndexOf("/");b=b.substring(c+1,b.length);return decodeURIComponent(b)},isSupportPointerEvents:function(){var b=document.createElement("x");b.style.cssText="pointer-events:auto";return b.style.pointerEvents==="auto"},getParameterByName:function(d,c){var e=d.indexOf("#");if(e>=0){d=d.substring(0,e)}var b=new RegExp(c+"=([^&]*)","i").exec(d);return b?decodeURIComponent(b[1]):null},addParamsToUrl:function(b,h){var f="";if(b.indexOf("?")===-1){f="?"}else{f="&"}var e=Object.keys(h);for(var d=0;d<e.length;d++){var c=e[d];var g=h[c];if(d>0){f+="&"}f+=c+"="+g}return b+f},getFileTypeTextFromNiceType:function(b){b=b?b.toLowerCase():"";return this.MAP_NICE_TYPE_TO_TEXT[b]?this.MAP_NICE_TYPE_TO_TEXT[b]:b}};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:common', location = '/js/services/conversion-service.js' */
define("vfm/services/conversion-service",["ajs","jquery"],function(a,b){return{postThumbnailConversionResults:function(c){var d=a.contextPath()+"/rest/documentConversion/latest/conversion/thumbnail/results";var e=Object.keys(c);var f=_.map(e,function(g){return{id:g,v:c[g].version}});return b.ajax({type:"POST",url:d,contentType:"application/json",data:JSON.stringify(f)})},getThumbnailUrl:function(d,c){return a.contextPath()+"/rest/documentConversion/latest/conversion/thumbnail/"+d+"/"+c}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:file-types-utils-resources', location = 'utils/file-types-utils.js' */
define("confluence-editor/utils/file-types-utils",[],function(){var e={"aui-iconfont-file-image":"image/gif image/jpeg image/pjpeg image/png image/tiff image/bmp".split(" "),"aui-iconfont-file-pdf":["application/pdf"],"aui-iconfont-file-video":"audio/mpeg audio/x-wav audio/mp3 audio/mp4 video/mpeg video/quicktime video/mp4 video/x-m4v video/x-flv video/x-ms-wmv video/avi video/webm video/vnd.rn-realvideo".split(" "),"aui-iconfont-file-code":"text/html text/xml text/javascript application/javascript application/x-javascript text/css text/x-java-source".split(" "),
"aui-iconfont-file-doc":["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],"aui-iconfont-file-xls":["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],"aui-iconfont-file-ppt":["application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"],"aui-iconfont-file-txt":["text/plain"],"aui-iconfont-file-zip":["application/zip","application/java-archive"]},b={},c;for(c in e)for(var f=
e[c],d=0,g=f.length;d<g;d++)b[f[d]]=c;return{getAUIIconFromMime:function(a){return b[a]||"aui-iconfont-file-generic"},isImage:function(a){return b[a]&&0===a.indexOf("image/")}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/utils/file-types-utils","AJS.Confluence.FileTypesUtils");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-embedded-file-view-soy-resources', location = '/templates/embedded-file-view.soy' */
// This file was automatically generated from embedded-file-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.ViewFileMacro.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.ViewFileMacro == 'undefined') { Confluence.ViewFileMacro = {}; }
if (typeof Confluence.ViewFileMacro.Templates == 'undefined') { Confluence.ViewFileMacro.Templates = {}; }


Confluence.ViewFileMacro.Templates.embeddedFile = function(opt_data, opt_ignored) {
  return '<span class="confluence-embedded-file-wrapper"><a class="confluence-embedded-file" href="' + soy.$$escapeHtml(opt_data.fileSrc) + '" data-nice-type="' + soy.$$escapeHtml(opt_data.niceType) + '" data-file-src="' + soy.$$escapeHtml(opt_data.fileSrc) + '" data-linked-resource-id="' + soy.$$escapeHtml(opt_data.attachmentId) + '" data-linked-resource-type="attachment" data-linked-resource-container-id="' + soy.$$escapeHtml(opt_data.containerId) + '" data-linked-resource-default-alias="' + soy.$$escapeHtml(opt_data.fileName) + '" data-mime-type="' + soy.$$escapeHtml(opt_data.mimeType) + '" data-has-thumbnail="' + ((opt_data.hasThumbnail) ? 'true' : 'false') + '" data-linked-resource-version="' + soy.$$escapeHtml(opt_data.attachmentVersion) + '"' + ((opt_data.unresolvedCommentCount && opt_data.unresolvedCommentCount >= 0) ? 'data-unresolved-comment-count=' + soy.$$escapeHtml(opt_data.unresolvedCommentCount) : '') + '><img src="' + soy.$$escapeHtml(opt_data.placeholderSrc) + '" height="' + soy.$$escapeHtml(opt_data.height) + '" />' + ((! opt_data.hasThumbnail) ? '<span class="title">' + soy.$$escapeHtml(opt_data.fileName) + '</span>' : '') + '</a></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.embeddedFile.soyTemplateName = 'Confluence.ViewFileMacro.Templates.embeddedFile';
}


Confluence.ViewFileMacro.Templates.embeddedUnknownFile = function(opt_data, opt_ignored) {
  return '<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-file unknown-attachment" src="' + soy.$$escapeHtml(opt_data.placeholderSrc) + '" /></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.embeddedUnknownFile.soyTemplateName = 'Confluence.ViewFileMacro.Templates.embeddedUnknownFile';
}


Confluence.ViewFileMacro.Templates.overlayEmbeddedFile = function(opt_data, opt_ignored) {
  return '<span class="overlay"></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.overlayEmbeddedFile.soyTemplateName = 'Confluence.ViewFileMacro.Templates.overlayEmbeddedFile';
}


Confluence.ViewFileMacro.Templates.overlayEmbeddedFileCommentCount = function(opt_data, opt_ignored) {
  return '<span class="comment-count-overlay"><span class="content">' + soy.$$escapeHtml(opt_data.commentCountRep) + '</span></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.overlayEmbeddedFileCommentCount.soyTemplateName = 'Confluence.ViewFileMacro.Templates.overlayEmbeddedFileCommentCount';
}


Confluence.ViewFileMacro.Templates.overlayEmbeddedFileFileTypeDesc = function(opt_data, opt_ignored) {
  return '<span class="file-type-desc-overlay"><i class="aui-icon aui-icon-small ' + soy.$$escapeHtml(opt_data.iconClass) + '"></i><span class="content"> ' + soy.$$escapeHtml(opt_data.fileType) + '</span></span>';
};
if (goog.DEBUG) {
  Confluence.ViewFileMacro.Templates.overlayEmbeddedFileFileTypeDesc.soyTemplateName = 'Confluence.ViewFileMacro.Templates.overlayEmbeddedFileFileTypeDesc';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-embedded-file-view-resources', location = '/js/services/file-service.js' */
define("vfm/services/file-service",["ajs","jquery"],function(a,b){return{getCommentCount:function(c,e){var d="/rest/files/1.0/files/content/{0}/commentCount?attachmentId={1}";d=a.contextPath()+a.format(d,c,e);return b.get(d)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-embedded-file-view-resources', location = '/js/components/embedded-file-view.js' */
define("vfm/components/embedded-file-view",["jquery","backbone","ajs","confluence","vfm/view-file-macro-utils"],function(c,g,f,h,i){function b(s){var r=c(s.el);var q=r.find(".confluence-embedded-image, .confluence-embedded-file");if(q.hasClass("unknown-attachment")||(q.attr("src")&&q.attr("src").indexOf("/confluence/plugins/servlet/confluence/placeholder/unknown-attachment")>=0)){return this}var j={mimeType:"",niceType:""};var k=q.hasClass("confluence-embedded-image");var o=r.parent().is("a");var m=q.attr("data-has-thumbnail")==="true";if(k){j.mimeType="image/png"}else{j.mimeType=q.attr("data-mime-type");j.niceType=q.attr("data-nice-type")!=="null"?q.attr("data-nice-type"):"generic file"}var p=!o?e(q):"";var l=(!k&&m)?a(j):"";if(p||l){var n=h.ViewFileMacro.Templates.overlayEmbeddedFile();r.append(c(n).append(p).append(l));if(l){r.addClass("has-comment-overlay")}}}var d=function(j){j=parseInt(j,10);j=c.isNumeric(j)?j:0;return j>9?"9+":j+""};var e=function(o){var j="",k=o.attr("data-linked-resource-container-id"),m=o.attr("data-linked-resource-id");if(k&&m){var n=o.attr("data-unresolved-comment-count");var l=d(n);if(l!=="0"){j=h.ViewFileMacro.Templates.overlayEmbeddedFileCommentCount({commentCountRep:l})}}return j};var a=function(j){return h.ViewFileMacro.Templates.overlayEmbeddedFileFileTypeDesc({fileType:i.getFileTypeTextFromNiceType(j.niceType),iconClass:f.Confluence.FileTypesUtils.getAUIIconFromMime(j.mimeType)})};return{render:b}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources', location = '/js/vfm.js' */
require(["jquery","ajs","vfm/components/embedded-file-view"],function(c,a,b){c(document).on("click",".confluence-embedded-file.unknown-attachment",function(d){d.preventDefault()});a.toInit(function(){c(".confluence-embedded-file-wrapper").each(function(){b.render({el:this})})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:editor-core-resources', location = 'loader/profiles.js' */
define("confluence-editor/profiles",["jquery","ajs"],function(d,c){return{createProfileForCommentEditor:function(){return{plugins:"searchreplace confluenceimagedialog autocompletemacro confluencemacrobrowser confluenceleavecomment confluencewatch autoresize".split(" ")}},createProfileForPageEditor:function(a){var b="searchreplace confluencedrafts confluenceimagedialog autocompletemacro confluencemacrobrowser flextofullsize referrer".split(" ");c.Meta.getBoolean("shared-drafts")&&c.DarkFeatures.isEnabled("unpublished-changes-lozenge")&&
b.push("unpublishedchanges");a&&a.versionComment&&b.push("confluenceversioncomment");a&&a.notifyWatchers&&b.push("confluencenotifywatchers");return{plugins:b}},createProfileForTemplateEditor:function(){return{plugins:"searchreplace confluenceimagedialog autocompletemacro confluencemacrobrowser confluenceleavetemplate flextofullsize confluencetemplateeditor".split(" ")}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-editor/profiles","AJS.Confluence.Editor._Profiles");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-util', location = 'jscripts/util.js' */
define("confluence-quick-edit/util",["window","ajs"],function(c,d){return{generateUUID:function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},getBaseUrl:function(){var a=c.location.protocol.replace(/:$/,"")+"://"+c.location.host+"/"+c.location.pathname.replace(/^\//,""),b=c.location.search.replace(/^\?/,""),b=b.replace(/\&?focusedCommentId=\d+/,""),b=b.replace(/^\&/,"");return{url:a,search:b,addQueryParam:function(a,
b){this.search=this.search?this.search+"&"+a+"="+b:a+"="+b},toString:function(){return this.url+"?"+this.search}}},timeoutDeferred:function(a,b,c){"function"!==typeof b.reject&&d.log("WARNING: invalid, not rejectable object passed to AJS.Confluence.QuickEdit.Util.timeoutDeferred. You should use a Deferred object");setTimeout(function(){"pending"===b.state()&&(d.logError("Timeout: "+a),b.reject("timeout"))},c);return b}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/util","AJS.Confluence.QuickEdit.Util");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-message', location = 'editor/page-editor-message.js' */
define("confluence-editor/editor/page-editor-message",["jquery","ajs","aui/flag","document","underscore"],function(f,i,g,h,d){var b=Object.create(null),e=Object.create(null);h.addEventListener("aui-flag-close",function(a){a&&a.target&&(b=d.filter(Object.keys(b),function(c){return!f(a.target).find("span").hasClass(c)}))});return{handleMessage:function(a,c,d){b[a]||(e[a]?delete e[a]:c&&(b[a]=g({title:c.title?c.title:"",type:c.type,close:c.close?c.close:"manual",persistent:!1,body:"<span class='"+a+
"'>"+c.message+"</span>"}),d&&d()))},closeMessages:function(a){d.each(a,function(a){b[a]&&(b[a].close(),delete b[a])})},isDisplayed:function(a){return a in b},displayedErrors:function(){return Object.keys(b)},suppressMessage:function(a){e[a]={}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/quick-edit.js' */
define("confluence-quick-edit/quick-edit","ajs confluence/legacy jquery window document confluence-quick-edit/util wrm".split(" "),function(b,e,c,n,o,p,q){function r(){var a=new c.Deferred;b.Confluence.EditorLoader.load(function(){setTimeout(function(){a.resolve()},0)},function(){a.reject()});return a}var i={enableShortcut:function(){c("#editPageLink").addClass("full-load")},disableShortcut:function(){c("#editPageLink").removeClass("full-load")}},h=[],l={loadingContentTimeout:4E3,register:function(a){h.push(a)},
disableHandlers:function(){c.each(h,function(a,b){return b.disable()})},enableHandlers:function(){c.each(h,function(a,b){return b.enable()})},SaveBarBinder:{bind:function(a,b){a&&e.Editor.addSaveHandler(a);b&&e.Editor.addCancelHandler(b)}},activateEditor:function(a){function e(){function f(a){var b=new c.Deferred;q.require(a).done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)});return b}var h,j=new c.Deferred;if(b.Rte&&b.Rte.getEditor()){b.debug("there is already an editor open");return j.reject("there is already an editor open")}if(!a.$container||
!a.$form){b.logError("activateEditor could not be initialsed: bad arguments",a);return j.reject("bad parameters")}h=b.Confluence.BlockAndBuffer.block(c(o));a.preActivate&&a.preActivate();i.disableShortcut();var m=a.timeoutResources||b.Confluence.EditorLoader.loadingTimeout,g=l.loadingContentTimeout,k=p.timeoutDeferred;c.when(k("resources",r(),m),k("fetch content",a.fetchContent||c.Deferred().resolve(),g),k("additional resources",a.additionalResources?f(a.additionalResources):c.Deferred().resolve(),
m)).done(function(e,f){var d={$container:a.$container,content:f,$form:a.$form,replayBufferedKeys:h};a.preInitialise&&a.preInitialise(d);c(".quick-comment-prompt",d.$container).hide();c(".quick-comment-body",d.$container).addClass("comment-body");var g=b.Confluence.EditorLoader.getPreloadContainer();if(d.content&&d.content.title){var k=d.content.title;g.find("#content-title").val(k)}d.$form.append(g.children());g.show();c("#editor-precursor").hide();c("#rte-savebar").find(".toolbar-split-left").hide();
var i=function(){d.editor=b.Rte.getEditor();d.$container.find(".quick-comment-loading-container").hide();d.$form.show();d.$form.addClass("fadeIn");var e=d.editor,f=d.content?d.content.editorContent:"",g=d.replayBufferedKeys;if(f){e.setContent(f);e.startContent=e.getContent({format:"raw",no_events:1});e.undoManager.clear()}g();e.undoManager.add();b.trigger("quickedit.success");b.trigger("quickedit.visible");b.trigger("add-bindings.keyboardshortcuts");b.trigger("active.dynamic.rte");c("div.aui-message.closeable").each(function(){var a=
c(this),d;if(!a.find(".icon-close").length){d=c('<span class="aui-icon icon-close" role="button" tabindex="0"></span>').click(function(){a.closeMessage()}).keypress(function(c){if(c.which===b.keyCode.ENTER||c.which===b.keyCode.SPACE){a.closeMessage();c.preventDefault()}});a.append(d)}});a.postInitialise&&a.postInitialise(d);l.SaveBarBinder.bind(a.saveHandler,a.cancelHandler);b.trigger("rte-quick-edit-ready");b.unbind("rte-ready",i);j.resolve()};b.bind("rte-ready",i);b.bind("rte-destroyed",a.postDeactivate||
function(){});b.Rte.BootstrapManager.initialise({plugins:a.plugins,toolbar:a.toolbar,excludePlugins:a.excludePlugins,isQuickEdit:true,onInitialise:a.onInitialise})}).fail(function(c,e){j.reject(c,e);b.logError("Error loading page quick edit. Falling back to normal edit URL...");b.trigger("analytics",{name:"rte.quick-edit.activate-editor.failed"});if(a.fallbackUrl){b.log("This parameter is deprecated. To be removed in the next major version (5.8 or 6.0). Please use the promise returned to bind custom action if the editor fails to load instead.");
n.location=a.fallbackUrl}});return j.promise()}if(a.closeAnyExistingEditor&&b.Rte&&b.Rte.getEditor()){var f=new c.Deferred;this.deactivateEditor().done(function(){e().done(function(){f.resolve()}).fail(function(a){f.reject(a)})}).fail(function(){b.debug("Could not deactivate current editor.");f.reject("Could not deactivate current editor.")});return f}return e()},deactivateEditor:function(){require("tinymce").execCommand("mceRemoveControl",true,"wysiwygTextarea");e.Editor.UI.toggleSavebarBusy(false);
var a=b.Confluence.EditorLoader.getPreloadContainer().empty();c(".editor-container").remove();c("#editor-precursor").remove();c("#anonymous-warning").remove();c(".quick-comment-prompt").show();c(".bottom-comment-panels").show();c("#editor-notification-container").empty();c(".action-reply-comment").removeAttr("reply-disabled");i.enableShortcut();e.Editor.removeAllSaveHandlers();e.Editor.removeAllCancelHandlers();return b.Confluence.EditorLoader.getEditorPreloadMarkup().done(function(c){a.append(c);
a.hide();(new b.Confluence.QuickEditCaptchaManager(a)).refreshCaptcha();b.trigger("rte-destroyed");b.unbind("rte-destroyed")})}};return l});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/quick-edit","AJS.Confluence.QuickEdit");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/handlers/view.js' */
define("confluence-quick-edit/handlers/view",["jquery","ajs","window"],function(c,d,e){return function(){var a;sessionStorage.viewPort&&(a=JSON.parse(sessionStorage.viewPort));if(a&&a.pageId==d.params.pageId){var b;b=c("#main-content");var f=c("#header");b=-1!==a.blockIndex?b.children().first().children().eq(a.blockIndex).find(".innerCell").eq(a.columnIndex).children().eq(a.index):b.children().eq(a.index);e.scrollTo(0,b.offset().top+a.offset-f.outerHeight())}delete sessionStorage.viewPort}});
require("confluence/module-exporter").safeRequire("confluence-quick-edit/handlers/view",function(c){require("ajs").toInit(c)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/captcha-manager.js' */
define("confluence-quick-edit/captcha-manager",["jquery","ajs"],function(d,e){return function(f){function a(a){return d(f||"body").find(a)}return{refreshCaptcha:function(){var b=a("img.captcha-image");if(0<b.length){var c=Math.random();b.attr("src",e.contextPath()+"/jcaptcha?id="+c);a('input[name="captchaId"]').val(c);a('input[name="captchaResponse"]').val("")}},getCaptchaData:function(){return{id:a('input[name="captchaId"]').val(),response:a('input[name="captchaResponse"]').val()}}}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/captcha-manager","AJS.Confluence.QuickEditCaptchaManager");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/handlers/shortcut.js' */
define("confluence-quick-edit/handlers/shortcut",["ajs"],function(a){var d=!1;a.bind("initialize.keyboardshortcuts add-bindings.keyboardshortcuts",function(){d=!0});a.bind("remove-bindings.keyboardshortcuts",function(){d=!1});return{createShortcut:function(f,g){function b(){c=c||a.whenIType(f).moveToAndClick(g)}function e(){c&&c.unbind();c=null}var c;return{bind:function(){d&&b();a.bind("initialize.keyboardshortcuts",b);a.bind("add-bindings.keyboardshortcuts",b);a.bind("remove-bindings.keyboardshortcuts",
e)},unbind:function(){e();a.unbind("initialize.keyboardshortcuts",b);a.unbind("add-bindings.keyboardshortcuts",b);a.unbind("remove-bindings.keyboardshortcuts",e)}}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/shortcut","AJS.Confluence.QuickEdit.KeyboardShortcuts");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/handlers/page.js' */
define("confluence-quick-edit/handlers/page","jquery ajs confluence/legacy confluence-quick-edit/handlers/shortcut confluence/aui-overrides window".split(" "),function(c,b,j,o,p,k){function n(a,b,e){var d={pageId:e,blockIndex:-1,columnIndex:-1,index:-1,offset:0,hasBlock:function(){return this.blockIndex!==-1}},h=false,l=function(a,c){var e=a.offset();if(g(a)){d.index=c;d.offset=b-e.top;h=true}},g=function(a){var c=a.offset();return c.top-8<=b&&c.top+a.height()>=b};if(a.children().length===1&&a.children().first().hasClass("contentLayout2")){a.children().first().children().each(function(a){if(!d.hasBlock()&&
g(c(this)))d.blockIndex=a});if(d.hasBlock()){a=a.children().first().children().eq(d.blockIndex).find(".innerCell");a.each(function(a){if(d.columnIndex===-1){var b=c(this).children().length;if(b>0)if(b<2){if(c(this).children().first().height()>25)d.columnIndex=a}else d.columnIndex=a}});a.eq(d.columnIndex).children().each(function(a){h||l(c(this),a)})}}else a.children().each(function(a){h||l(c(this),a)});return h?d:null}function q(a){var f=require("tinymce");g.disable();p.metaToParams();if(b.DarkFeatures.isEnabled("confluence.view.edit.transition")){var e=
c("#main-content"),d=c("#header"),h=c("#main-header"),d=k.pageYOffset+d.outerHeight()+h.outerHeight();i=n(e,d,b.params.pageId);b.trigger("quick-edit.viewport.saved");var l=function(){c(f.activeEditor.getWin().document).find("body#tinymce").addClass("page-edit");c("#content").css({paddingRight:0});b.unbind("quickedit.visible",l)};b.bind("quickedit.visible",l)}e=a.$form;d=b.Meta.get("content-type")==="page"?"doeditpage":"doeditblogpost";d=b.contextPath()+"/pages/"+d+".action?pageId="+j.getContentId();
c(".ia-splitter-left").remove();try{c("#main").unwrap()}catch(m){}c("#rte").removeClass("editor-default").addClass("editor-fullheight");a.$container.children().remove();c(".editor-container").children().eq(0).unwrap();e.attr({"class":"editor aui",action:d,name:"editpageform",id:"editpageform",style:""});a.$container.append(e);a.$container.removeClass("view").addClass("edit");c("body").addClass("contenteditor edit")}function r(a){require("tinymce");c("#editor-precursor").show();c("#rte-savebar").find(".toolbar-split-left").show();
if(k.history.pushState){var f=c("#editPageLink").attr("href");if(f!=k.location.pathname+k.location.search){history.pushState({quickEdit:true},"",f);b.trigger("rte-quick-edit-push-state",f)}}else{k.location.hash="editor";b.trigger("rte-quick-edit-push-hash")}f=a.content;if(f.permissions)for(var e in f.permissions)c("#"+e).attr("value",f.permissions[e]);c("#originalVersion").val(a.content.pageVersion);b.Meta.set("page-version",a.content.pageVersion);b.Meta.set("page-title",a.content.title);c('meta[name="page-version"]').attr("content",
a.content.pageVersion);c('meta[name="ajs-page-version"]').attr("content",a.content.pageVersion);c("#syncRev").val(a.content.syncRev);b.Meta.set("conf-revision",a.content.confRev);c('meta[name="ajs-conf-revision"]').attr("content",a.content.confRev);b.Meta.set("shared-drafts",a.content.sharedDrafts);c('meta[name="ajs-shared-drafts"]').attr("content",a.content.sharedDrafts);if(b.Meta.getBoolean("fallback-mode")!=="undefined"&&b.Meta.getBoolean("fallback-mode")!==a.content.fallbackMode){e=a.content.fallbackMode?
"La modification collaborative est actuellement hors ligne. Rafra\u00eechissez la page pour continuer \u00e0 effectuer des modifications":"La modification collaborative \u00e9tait d\u00e9sactiv\u00e9e, mais elle fonctionne \u00e0 nouveau. Actualisez la page pour poursuivre la modification.";b.trigger("editor.error.message",{messageKey:"fallback-mode-transition",message:e,disablePublish:true})}b.Meta.set("fallback-mode",a.content.fallbackMode);c('meta[name="ajs-fallback-mode"]').attr("content",a.content.fallbackMode);e=a.content.atlToken;b.Meta.set("atl-token",e);c('input[name="atl_token"]').val(e);b.trigger("analyticsEvent",{name:"quick-edit-success"});c("#navigation").remove();
var d=new Date,h=function(b,c){if(d&&!(c.type==="keydown"&&[91,92,93,224,33,34,37,38,39,40,16,17,18,20,112,113,114,115,116,117,118,119,120,121,122,123].indexOf(c.keyCode)>-1)){var e=new Date-d;d=null;j.Analytics.publish("confluence.editor.transition.firstkeydown",{delay:e});a.editor.onKeyDown.remove(h);a.editor.onChange.remove(h)}};a.editor.onKeyDown.add(h);a.editor.onChange.add(h)}function s(a){setTimeout(function(){if(i){var b;b=c(a.getBody());b=i.hasBlock()?b.children().first().children().eq(i.blockIndex).find(".innerCell").eq(i.columnIndex).children().eq(i.index):
b.children().eq(i.index);a.getWin().scrollTo(0,b.offset().top+i.offset);c("#main").css("visibility","visible")}})}function t(){var a=new c.Deferred,f=c.ajax({url:b.contextPath()+"/rest/tinymce/1/content/"+j.getContentId()+".json",cache:false});f.success(function(b){a.resolve(b)});f.error(function(b){a.reject("error fetching content",b)});return a}var m,i,g={editShortcut:o.createShortcut("e","#editPageLink"),activateEventHandler:function(a){if(!a.metaKey&&!a.shiftKey&&!a.ctrlKey&&!a.altKey&&!(a.which===
2||a.which===3)){a.preventDefault();if(m&&m.state()==="pending")b.debug("Editor is being activated. Ignoring handler...");else{m=g.activateEditor();a=c("#editPageLink");a.find(".aui-icon").css("visibility","hidden");a.parent().spin({left:"10px"})}}},enable:function(){if(c("body").is(".theme-default")){var a=c("#editPageLink");a.bind("click",g.activateEventHandler);a.removeClass("full-load");g.editShortcut.bind();b.debug("QuickPageEdit enabled")}else b.debug("QuickPageEdit not enabled")},activateEditor:function(){var a=
c("#content").find(".quick-comment-form"),f=function(){var a=require("tinymce").activeEditor.getWin(),d=c(a.document).find("#tinymce");if(a=n(d,a.pageYOffset,b.params.pageId))sessionStorage.viewPort=JSON.stringify(a)};return b.Confluence.QuickEdit.activateEditor({fetchContent:t(),$container:c("#content"),$form:a.length?a:c('<form method="post"></form>'),preInitialise:q,postInitialise:r,saveHandler:function(){b.DarkFeatures.isEnabled("confluence.view.edit.transition")&&f();j.Editor.getNumConcurrentEditors()>
1&&b.Confluence.Analytics.publish("rte.notification.concurrent-editing.save",{numEditors:j.Editor.getNumConcurrentEditors(),pageId:b.params.pageId,draftType:b.params.draftType})},cancelHandler:function(){b.DarkFeatures.isEnabled("confluence.view.edit.transition")&&f();j.Editor.getNumConcurrentEditors()>1&&b.Confluence.Analytics.publish("rte.notification.concurrent-editing.cancel",{numEditors:j.Editor.getNumConcurrentEditors(),pageId:b.params.pageId,draftType:b.params.draftType})},plugins:b.Confluence.Editor._Profiles.createProfileForPageEditor({versionComment:true,
notifyWatchers:true}).plugins,onInitialise:function(a){b.DarkFeatures.isEnabled("confluence.view.edit.transition")&&a.onLoad.add(s)}}).fail(function(a,d){if(d&&d.status===423){var f=JSON.parse(d.responseText).user,g=c("#editPageLink");g.find(".aui-icon").css("visibility","visible");g.parent().spinStop();b.MessageHandler.flag({type:"info",title:"Impossible de modifier",body:b.format("La modification collaborative est actuellement hors ligne, et {0} est en train de modifier cette page. Veuillez essayer \u00e0 nouveau dans quelques instants.",f),close:"manual"})}else k.location=c("#editPageLink").attr("href")})},
disable:function(){b.debug("QuickPageEdit disabled.");g.editShortcut.unbind();c("#editPageLink").unbind("click",g.activateEventHandler)}};b.Confluence.QuickEdit.register(g);return{disable:g.disable}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/page","AJS.Confluence.QuickEdit.QuickEditPage");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-edit-general', location = 'jscripts/init.js' */
define("confluence-quick-edit/init",["ajs","jquery","window"],function(a,b,c){return function(){b("body").hasClass("page-gadget")?a.debug("QuickComment: editor preload is disabled"):b(c).load(function(){a.debug("QuickComment: instigated background loading of the comment editor.");a.Confluence.EditorLoader.load()});a.Confluence.QuickEdit.enableHandlers();a.trigger("rte-quick-edit-enable-handlers")}});
require("confluence/module-exporter").safeRequire("confluence-quick-edit/init",function(a){var b=require("ajs");b.DarkFeatures.isEnabled("disable-quick-edit")?b.log("disable-quick-edit is turned on; run AJS.Confluence.EditorLoader.load() manually."):b.toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/handlers/comment.js' */
define("confluence-quick-edit/handlers/comment","ajs confluence/legacy jquery aui/flag confluence-quick-edit/util confluence-editor/editor/page-editor-message".split(" "),function(a,f,d,m,k,g){function l(a,c){var h=a.match(RegExp("[?&]"+c+"=(\\d+)"));return h&&h.length>1?parseInt(h[1]):0}d(function(){a.AppLinksInitialisationBinder=function(b){a.bind("init.rte",b)}});var e={timeout:8E3,showLoadingEditorErrorMessage:function(){a.trigger("rte-quick-comment-loading-failed");m({type:"error",title:"Erreur",
persistent:false,body:"Erreur pendant le chargement de l\u0027\u00e9diteur de commentaires. Veuillez rafra\u00eechir la page et recommencer."})},preInitialise:function(){a.Confluence.QuickEdit.QuickEditPage.disable();a.Meta.set("content-type","comment");a.Meta.set("draft-type","");a.params.contentType="comment";a.params.draftType="";a.Meta.set("use-inline-tasks","false");d("#editor-precursor").children().eq(0).hide();d("#pagelayout-menu").parent().hide();d("#page-layout-2-group").hide();d("#rte-button-tasklist").remove();d("#pluggable-status-container").remove();
d("#rte-insert-tasklist").parent().remove()},postInitialise:function(b){a.Rte.editorFocus(b.editor)},delegatingSaveCommentHandler:function(a){return a.asyncRenderSafe?e.ajaxSaveCommentHandler(a):e.reloadPageSaveCommentHandler(a)},reloadPageSaveCommentHandler:function(a){var c=k.getBaseUrl();c.addQueryParam("focusedCommentId",a.id);c.addQueryParam("refresh",+new Date);window.location.href=c.toString()+"#comment-"+a.id},ajaxSaveCommentHandler:function(b){var c={isDefault:true,path:a.Meta.get("static-resource-url-prefix")+
"/images/icons/profilepics/default.png"};a.Meta.get("current-user-avatar-uri-reference")!==a.contextPath()+"/images/icons/profilepics/default.png"&&(c={isDefault:false,path:a.Meta.get("current-user-avatar-uri-reference")});var h=a.Meta.get("remote-user"),d={userName:h===""?null:h,displayName:a.Meta.get("current-user-fullname"),profilePicture:c};e.cancelComment().done(function(){f.CommentDisplayManager.addOrUpdateComment(d,b,true,false);a.trigger("page.commentAddedOrUpdated",{commentId:b.id})})},cancelHandler:function(){if(a.Confluence.QuickEdit){a.Rte.Content.editorResetContentChanged();
a.Confluence.QuickEdit.deactivateEditor()}},createCommenterParam:function(b,c,d){return{userName:c||a.Meta.get("remote-user")||null,displayName:d||a.Meta.get("user-display-name"),profilePicture:{isDefault:b.hasClass("defaultLogo"),path:b.attr("src")}}},createSaveHandler:function(b,c){var h=k.generateUUID();return function(e){e.preventDefault();if(a.Rte.Content.isEmpty()){a.Confluence.EditorNotification.notify("warning","Le texte du commentaire est vide. La cr\u00e9ation de commentaires vides est impossible.");f.Editor.UI.toggleSavebarBusy(false)}else{var i=
e=0,j=a.Confluence.EditorLoader.getEditorForm();if(j.is("form")){i=j.attr("action");e=l(i,"parentId");i=l(i,"commentId")}var g=new a.Confluence.QuickEditCaptchaManager(j),j=function(a){c(a);g.refreshCaptcha()},k=d("#watchPage").is(":checked");i>0?f.Editor.CommentManager.updateComment(f.getContentId(),i,a.Rte.Content.getHtml(),k,g.getCaptchaData(),b,j):f.Editor.CommentManager.saveComment(f.getContentId(),e,a.Rte.Content.getHtml(),k,h,g.getCaptchaData(),b,j)}}},saveCommentErrorHandler:function(b){f.Editor.UI.toggleSavebarBusy(false);
var c;if(b&&b.search(/captcha/i)!==-1){c="Le mot saisi ne correspond pas au texte de l\u0027image.";g.closeMessages(["captcha-response-failed"]);g.handleMessage("captcha-response-failed",{type:"error",message:c})}else{c="L\u0027enregistrement du commentaire a \u00e9chou\u00e9. Veuillez r\u00e9essayer plus tard.";g.closeMessages(["server-offline"]);g.handleMessage("server-offline",{type:"error",message:c})}a.logError("Error saving comment",b)},cancelComment:function(){a.Rte.Content.editorResetContentChanged();return a.Confluence.QuickEdit.deactivateEditor()},
proceedWithActivation:function(){var b=new d.Deferred,c=a.Rte&&a.Rte.getEditor();if(c)if(c.isDirty()&&!f.Editor.isEmpty())if(confirm("Votre commentaire sera perdu."))b=e.cancelComment();else return b.reject();else b=e.cancelComment();else b.resolve();return b}};return e});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment","AJS.Confluence.QuickEdit.QuickComment");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/handlers/comment/top-level.js' */
define("confluence-quick-edit/handlers/comment/top-level",["ajs","jquery","confluence-quick-edit/handlers/shortcut","confluence-quick-edit/handlers/comment","window"],function(b,a,e,c,f){function g(a){c.preInitialise(a)}function h(b){a("#comments-section").one("click",".quick-comment-prompt",d.activateEventHandler);a("#rte-savebar").scrollWindowToElement();c.postInitialise(b)}function i(){b.Confluence.EditorLoader.resourcesLoaded()||(b.trigger("analytics",{name:"rte.quick-edit.top-comment.spinner"}),
a(".quick-comment-prompt").hide(),a(".quick-comment-loading-container").fadeIn().spin("medium"))}function j(b){b.preventDefault();f.location=a("#add-comment-rte").attr("href")}var k=b.DarkFeatures.isEnabled("editor.slow.comment.disable"),d={commentShortcut:e.createShortcut("m",".quick-comment-prompt"),activateEventHandler:function(e){e.preventDefault();c.proceedWithActivation().done(function(){var d=c.createSaveHandler(c.delegatingSaveCommentHandler,c.saveCommentErrorHandler);return b.Confluence.QuickEdit.activateEditor({preActivate:i,
$container:a("form[name=inlinecommentform]").closest(".quick-comment-container"),$form:a("form[name=inlinecommentform]"),preInitialise:g,saveHandler:d,cancelHandler:c.cancelHandler,postInitialise:h,plugins:b.Confluence.Editor._Profiles.createProfileForCommentEditor().plugins,additionalResources:["wrc!comment-editor"],timeoutResources:c.timeout}).fail(function(){k?c.showLoadingEditorErrorMessage():f.location=a("#add-comment-rte").attr("href")})}).fail(function(){a("#comments-section").one("click",
".quick-comment-prompt",d.activateEventHandler)})},enable:function(){a("#comments-section").one("click",".quick-comment-prompt",d.activateEventHandler);a("#add-comment-rte").removeClass("full-load");this.commentShortcut.bind()},disable:function(){a("#comments-section").off("click",".quick-comment-prompt");this.commentShortcut.unbind()}};b.Confluence.QuickEdit.register(d);return{bindCommentAreaFallbackHandler:function(){a("#comments-section").delegate(".quick-comment-prompt","click",j)},cancelComment:function(){b.log("'AJS.Confluence.QuickEdit.QuickComment.TopLevel.cancelComment' is deprecated in 5.7, consider using 'AJS.Confluence.QuickEdit.QuickComment.cancelComment' instead.");
return b.Confluence.QuickEdit.QuickComment.cancelComment()}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment/top-level","AJS.Confluence.QuickEdit.QuickComment.TopLevel");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/handlers/comment/reply.js' */
define("confluence-quick-edit/handlers/comment/reply",["ajs","confluence/legacy","jquery"],function(a,g,b){function i(b){a.Confluence.QuickEdit.QuickComment.preInitialise(b);b.$container.scrollWindowToElement()}function j(b){a.Confluence.QuickEdit.QuickComment.postInitialise(b)}function h(b){var e=b.attr("id").match(/comment-(\d+)/),f=0;e?f=parseInt(e[1]):(a.trigger("analytics",{name:"rte.quick-edit.get-reply-parent.failed"}),a.logError("replyHandler: activateEventHandler - could not extract a parent comment Id from the comment id "+
b.attr("id")));return f}function k(){b(".comment.reply").closest(".comment-threads").remove()}var l=a.DarkFeatures.isEnabled("editor.slow.comment.disable"),d={activateEventHandler:function(d){d.preventDefault();d.stopPropagation();var e=this;if(b(e).attr("reply-disabled"))return!1;a.Confluence.QuickEdit.QuickComment.proceedWithActivation().done(function(){var f=b(e).closest("div.comment"),c=b(".quick-comment-container img.userLogo"),c=a.Confluence.QuickEdit.QuickComment.createCommenterParam(c),c=
{contentId:g.getContentId(),parentCommentId:h(f),commenter:c,context:{contextPath:a.Meta.get("context-path"),staticResourceUrlPrefix:a.Meta.get("static-resource-url-prefix")}},c=b(g.Templates.Comments.displayReplyEditorLoadingContainer(c)),d=b(".quick-comment-loading-container",c);d.hide();f.after(c);a.Confluence.EditorLoader.resourcesLoaded()?a.trigger("analytics",{name:"rte.quick-edit.reply-comment.no-spinner"}):(a.trigger("analytics",{name:"rte.quick-edit.reply-comment.spinner"}),f.after(c),d.fadeIn(),
d.spin("medium"),d[0].scrollIntoView());c=b(e).closest(".comment-thread").find(".quick-comment-container");a.Meta.set("form-name",b("form",c).attr("name"));a.Confluence.QuickEdit.activateEditor({$container:c,$form:b("form.quick-comment-form[name=threadedcommentform]"),preInitialise:i,postInitialise:j,saveHandler:a.Confluence.QuickEdit.QuickComment.createSaveHandler(a.Confluence.QuickEdit.QuickComment.delegatingSaveCommentHandler,a.Confluence.QuickEdit.QuickComment.saveCommentErrorHandler),cancelHandler:a.Confluence.QuickEdit.QuickComment.cancelHandler,
plugins:a.Confluence.Editor._Profiles.createProfileForCommentEditor().plugins,postDeactivate:k,additionalResources:["wrc!comment-editor"],timeoutResources:a.Confluence.QuickEdit.QuickComment.timeout}).fail(function(){l?a.Confluence.QuickEdit.QuickComment.showLoadingEditorErrorMessage():window.location=b("#reply-comment-"+h(f)).attr("href")});b(e).attr("reply-disabled",!0)})},enable:function(){b("#comments-section").delegate(".action-reply-comment","click",d.activateEventHandler)},disable:function(){b("#comments-section").undelegate(".action-reply-comment",
"click")}};a.Confluence.QuickEdit.register(d);return{cancelComment:function(){a.log("'AJS.Confluence.QuickEdit.QuickComment.Reply.cancelComment' is deprecated in 5.7, consider using 'AJS.Confluence.QuickEdit.QuickComment.cancelComment' instead.");return a.Confluence.QuickEdit.QuickComment.cancelComment()}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment/reply","AJS.Confluence.QuickEdit.QuickComment.Reply");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/handlers/comment/edit.js' */
define("confluence-quick-edit/handlers/comment/edit",["ajs","confluence-quick-edit/handlers/comment","jquery","confluence/legacy"],function(e,b,d,i){function j(a){b.preInitialise(a);a.$container.scrollWindowToElement()}function k(a){b.postInitialise(a)}function h(a){return(a=a.attr("id").match(/comment-(\d+)/))?parseInt(a[1]):0}function l(a){var b=new d.Deferred;d.ajax({url:e.contextPath()+"/rest/api/content/"+a+"?expand=body.editor",cache:!1}).done(function(a){!a||!a.body||!a.body.editor?b.reject("invalid response from loading comment rest endpoint"):
b.resolve({editorContent:a.body.editor.value})}).fail(function(){b.reject("error fetching content")});return b}function m(){var a=d(".comment.edit");a.prev(".comment").show();a.remove()}var n=e.DarkFeatures.isEnabled("editor.slow.comment.disable"),g={activateEventHandler:function(a){var g=this;a.preventDefault();a.stopPropagation();b.proceedWithActivation().done(function(){var a=d(g).closest("div.comment"),c;c=a.find(".author .confluence-userlink");var f=a.find(".comment-user-logo img.userLogo");
c=b.createCommenterParam(f,c.attr("data-username"),c.text());c={contentId:i.getContentId(),commentId:h(a),commenter:c,context:{contextPath:e.Meta.get("context-path"),staticResourceUrlPrefix:e.Meta.get("static-resource-url-prefix")},mode:"edit"};c=d(i.Templates.Comments.displayEditEditorContainer(c));f=d(".quick-comment-loading-container",c);a.hide();a.after(c);f.fadeIn().spin("medium");f[0].scrollIntoView();c=a.next(".quick-comment-container");e.Meta.set("form-name",d("form",c).attr("name"));e.Confluence.QuickEdit.activateEditor({$container:c,
$form:d("form.quick-comment-form[name=editcommentform]"),fetchContent:l(h(a)),preInitialise:j,postInitialise:k,saveHandler:b.createSaveHandler(b.delegatingSaveCommentHandler,b.saveCommentErrorHandler),cancelHandler:b.cancelHandler,plugins:e.Confluence.Editor._Profiles.createProfileForCommentEditor().plugins,postDeactivate:m,additionalResources:["wrc!comment-editor"],timeoutResources:b.timeout}).fail(function(){n?b.showLoadingEditorErrorMessage():window.location=d("#edit-comment-"+h(a)).attr("href")})})},
enable:function(){d("#comments-section").delegate(".comment-action-edit","click",g.activateEventHandler)},disable:function(){d("#comments-section").undelegate(".comment-action-edit","click")}};e.Confluence.QuickEdit.register(g);return{cancelComment:function(){e.log("'AJS.Confluence.QuickEdit.QuickComment.Edit.cancelComment' is deprecated in 5.7, consider using 'AJS.Confluence.QuickEdit.QuickComment.cancelComment' instead.");return b.cancelComment()}}});
require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/handlers/comment/edit","AJS.Confluence.QuickEdit.QuickComment.Edit");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-initial', location = 'jscripts/editor-comment-manager.js' */
define("confluence-quick-edit/editor-comment-manager",["ajs","jquery","confluence/legacy"],function(d,e,j){return function(){function k(a,f,l,i,b,g,h){d.trigger("analytics",{name:"confluence.page.comment.create",data:{pageID:d.Meta.get("page-id")}});a={type:"POST",url:a,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{html:f,watch:l,uuid:i},dataType:"json",cache:!1,headers:{"X-Atlassian-Token":"no-check"},success:function(a){g(a)},error:function(a,c,b){c=c+": "+b;a.responseText&&
(c=c+" - "+a.responseText);h(c)},timeout:12E4};b&&b.id&&(a.headers["X-Atlassian-Captcha-Id"]=b.id,a.headers["X-Atlassian-Captcha-Response"]=b.response);e.ajax(a)}return{addComment:function(a,f,d,i,b,g,h,e,c){j.Editor.CommentManager.saveComment(a,f,d,function(a){j.CommentDisplayManager.addComment(h,a,g);e(a)},c)},saveComment:function(a,f,e,i,b,g,h,j){var c=null,c=f?d.contextPath()+"/rest/tinymce/1/content/"+a+"/comments/"+f+"/comment?actions=true":d.contextPath()+"/rest/tinymce/1/content/"+a+"/comment?actions=true";
k(c,e,i,b,g,h,j)},updateComment:function(a,f,e,i,b,g,h){a=d.contextPath()+"/rest/tinymce/1/content/"+a+"/comments/"+f+"?actions=true";k(a,e,i,null,b,g,h)}}}});require("confluence/module-exporter").safeRequire("confluence-quick-edit/editor-comment-manager",function(d){var e=require("confluence/legacy");require("ajs").bind("init.rte",function(){e.Editor.CommentManager=d()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:editor-view-resources', location = 'jscripts/view-content/pushed-navigation-util.js' */
define("confluence-quick-edit/view-content/pushed-navigation-util",["ajs","jquery","window"],function(d,f,a){function c(){return d.Rte&&d.Rte.getEditor()&&!!f("#editpageform").length}var b=a.location.hash,e=a.location.search;return{isInEditPage:c,filterPreviewHashChange:function(){var g=c()||a.history.pushState||!(a.location.hash&&0===a.location.hash.indexOf("#!"))&&!(b&&0===b.indexOf("#!"));b=a.location.hash;return g},filterPreviewNavigationEvent:function(){var b=c()||!/[?&]preview=([^&]*)/.test(a.location.search)&&
!/[?&]preview=([^&]*)/.test(e);e=a.location.search;return b}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-quick-edit/view-content/pushed-navigation-util","Confluence.Editor.PushedNavUtil");
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:editor-view-resources', location = 'jscripts/view-content/pushed-navigation.js' */
define("confluence-quick-edit/view-content/pushed-navigation","jquery underscore window confluence/legacy ajs confluence-quick-edit/view-content/pushed-navigation-util".split(" "),function(b,n,a,g,c,d){function e(){if(h){if(f.split("#")[0]!=a.location.href.split("#")[0]){b(a).unbind("popstate",k);a.location.reload()}}else f.split("#")[0]==a.location.href.split("#")[0]&&f.split("#")[1]!=="editor"||a.location.reload()}function i(){f=a.location.href}function l(){var b=g.Editor.Drafts.unloadMessage();
if(b){g.Editor.Drafts.unBindUnloadMessage();if(confirm(b+"\n\n"+"Appuyez sur OK pour continuer ou Annuler pour rester sur la page actuelle.")){c.trigger("analytics",{name:"rte.quick-edit.confirmation.leaving"});e()}else{c.trigger("analytics",{name:"rte.quick-edit.confirmation.staying"});if(h){j=true;a.history.forward()}else a.location.hash="editor";g.Editor.Drafts.bindUnloadMessage()}}else e()}function o(){d.isInEditPage()?a.location.hash!=="#editor"&&l():e()}function k(){j?j=false:d.isInEditPage()?l():e()}function m(a,b){return function(){n.every(b,
function(a){return a()})&&a()}}var h=!!a.history.pushState,j=false,f=a.location.href,p=[d.filterPreviewHashChange],q=[d.filterPreviewNavigationEvent];c.bind("rte-quick-edit-enable-handlers",function(){a.location.hash==="#editor"&&b("#editPageLink").click()});return function(){i();if(h){b(a).bind("popstate",m(k,q));b(a).bind("rte-quick-edit-push-state",i)}else{b(a).bind("hashchange",m(o,p));b(a).bind("rte-quick-edit-push-hash",i)}}});
require("confluence/module-exporter").safeRequire("confluence-quick-edit/view-content/pushed-navigation",function(b){require("ajs").toInit(function(){setTimeout(b,0)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-trigger', location = 'node_modules/@atlassian/aui/src/js/aui/trigger.js' */
("undefined"===typeof window?global:window).__95749f652ed34ee0455a0368fbf75645=function(){function e(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(a.isEnabled()){var c=document.getElementById(a.getAttribute("aria-controls"));c&&c.message&&c.message(b)}}"use strict";var g=e(__2fd777cca7fe187ff4048afabed6a6b5),h=e(__7e0423727525720eec50a0fbce0cace2),f=e(__7a4f1c37715fcec19fc8ec09205ad4f4);(0,f.default)("data-aui-trigger",{type:f.default.type.ATTRIBUTE,events:{click:function(a,b){var c=
b.target,c=(0,g.default)(c).closest("a[href]",a);c.length&&c[0]!==a||(d(a,b),b.preventDefault())},mouseenter:function(a,b){d(a,b)},mouseleave:function(a,b){d(a,b)},focus:function(a,b){d(a,b)},blur:function(a,b){d(a,b)}},prototype:{disable:function(){this.setAttribute("aria-disabled","true")},enable:function(){this.setAttribute("aria-disabled","false")},isEnabled:function(){return"true"!==this.getAttribute("aria-disabled")}}});(0,h.default)("aui/trigger");return{}}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:aui-trigger', location = 'src/soy/trigger.soy' */
// This file was automatically generated from trigger.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.trigger.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.trigger == 'undefined') { aui.trigger = {}; }


aui.trigger.trigger = function(opt_data, opt_ignored) {
  return '<' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'a') + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '" ' : '') + ' class="' + aui.renderExtraClasses(opt_data) + '" aria-controls="' + soy.$$escapeHtml(opt_data.menu.id) + '" aria-haspopup="true" role="button"' + ((opt_data.title) ? ' title="' + soy.$$escapeHtml(opt_data.title) + '"' : '') + ((opt_data.container) ? ' data-container="' + soy.$$escapeHtml(opt_data.container) + '"' : '') + (((! opt_data.tagName || opt_data.tagName == 'a') && (! opt_data.extraAttributes || Object.prototype.toString.call(opt_data.extraAttributes) === '[object Object]' && ! opt_data.extraAttributes.href && ! opt_data.extraAttributes.tabindex || (! opt_data.extraAttributes.href || ! opt_data.extraAttributes.tabindex))) ? ' tabindex="0"' : '') + ' data-aui-trigger' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + ((! (opt_data.showIcon == false)) ? '<span class="icon ' + soy.$$escapeHtml(opt_data.iconClasses ? opt_data.iconClasses : 'aui-icon-dropdown') + '">' + ((opt_data.iconText) ? soy.$$escapeHtml(opt_data.iconText) : '') + '</span>' : '') + '</' + soy.$$escapeHtml(opt_data.tagName ? opt_data.tagName : 'a') + '>';
};
if (goog.DEBUG) {
  aui.trigger.trigger.soyTemplateName = 'aui.trigger.trigger';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-internal-attributes', location = 'node_modules/@atlassian/aui/src/js/aui/internal/attributes.js' */
("undefined"===typeof window?global:window).__188d80192fc203276ef4023d49a19fca=function(){function d(a){return null!==a}function e(a,b,c){c?a.setAttribute(b,""):a.removeAttribute(b)}function f(a,b){var c=function(a){return a.toLowerCase()===b.toLowerCase()},d=null===b,e=!d&&!a.values.filter(c).length;return d?a.hasOwnProperty("missingDefault")?a.missingDefault:null:e?a.hasOwnProperty("invalidDefault")?a.invalidDefault:a.hasOwnProperty("missingDefault")?a.missingDefault:null:a.values.length?a.values.filter(c)[0]:
null}function g(a,b,c){a.setAttribute(b.attribute,c)}var b={};"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.computeBooleanValue=d;b.setBooleanAttribute=e;b.computeEnumValue=f;b.setEnumAttribute=g;b.default={computeBooleanValue:d,setBooleanAttribute:e,computeEnumValue:f,setEnumAttribute:g};return b}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-internal-enforcer', location = 'node_modules/@atlassian/aui/src/js/aui/internal/enforcer.js' */
("undefined"===typeof window?global:window).__db30000271e9ecc5679f29c76598f9cd=function(){var c={};"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d;var a=__4f4d08f5cd21aa65e83ce6be211355f4;if(a&&a.__esModule)d=a;else{var b={};if(null!=a)for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(b[e]=a[e]);b.default=a;d=b}c.default=function(a){function c(b){return e(function(){return a.hasAttribute(b)},b+" wasn't defined")}function b(d){if(!c(d,a))return!1;var f=a.getAttribute(d);
return e(function(){return document.getElementById(f)},'an element with id set to "'+f+'" was not found')}function e(b,c){return!b()?(a?d.error(c,a):d.error(c),!1):!0}return{attributeExists:c,refersTo:b,satisfiesRules:e,ariaControls:function(){return b("aria-controls")},ariaOwns:function(){return b("aria-owns")}}};return c=c["default"]}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:internal-@atlassian-aui-src-js-aui-inline-dialog2', location = 'node_modules/@atlassian/aui/src/js/aui/inline-dialog2.js' */
("undefined"===typeof window?global:window).__44e8af835fb6de354c20ddffb240864c=function(){function c(a){return a&&a.__esModule?a:{"default":a}}function k(a,b){var c=document.querySelector('[aria-controls="'+a.id+'"]');c&&b(c)}function m(a){a=a.target;(0,d.default)(a).set("mouse-inside",!0);a.message({type:"mouseenter"})}function n(a){a=a.target;(0,d.default)(a).set("mouse-inside",!1);a.message({type:"mouseleave"})}function l(a){(0,d.default)(a).set("mouse-inside",void 0);a.removeEventListener("mouseenter",
m);a.removeEventListener("mouseleave",n);"hover"===a.respondsTo&&((0,d.default)(a).set("mouse-inside",!1),a.addEventListener("mouseenter",m),a.addEventListener("mouseleave",n))}function i(a){var b=!a.hasAttribute("aria-hidden"),c=a.hasAttribute("open");if(b||a.open!==c)c?((0,d.default)(a).set("is-processing-show",!0),(0,e.default)(a).show(),(0,e.default)(a).isVisible()?k(a,function(b){a._auiAlignment||(a._auiAlignment=new o.default(a,b));a._auiAlignment.enable();b.setAttribute("aria-expanded","true")}):
a.open=!1,(0,d.default)(a).set("is-processing-show",!1)):((0,e.default)(a).hide(),(0,e.default)(a).isVisible()?a.open=!0:k(a,function(b){a._auiAlignment||(a._auiAlignment=new o.default(a,b));a._auiAlignment.disable();b.setAttribute("aria-expanded","false")}))}var j={};"use strict";Object.defineProperty(j,"__esModule",{value:!0});var p=c(__2fd777cca7fe187ff4048afabed6a6b5),o=c(__c3a107a0f74c5ec71c09a1f1f4b838f9),q=c(__7e0423727525720eec50a0fbce0cace2),f=c(__188d80192fc203276ef4023d49a19fca),r=c(__db30000271e9ecc5679f29c76598f9cd),
s=c(__dd0dee18d8910035abf3563b0855343d),e=c(__32c9c638c13fb3cc78ab29b878f9b179),g=c(__7a4f1c37715fcec19fc8ec09205ad4f4),d=c(__57064c5323b462d4619db8aa6f7d7eb4),t={click:function(a){if(a.open){if(!(0,e.default)(a).isPersistent())a.open=!1}else a.open=!0},mouseenter:function(a){a.open||(a.open=!0);a._clearMouseleaveTimeout&&a._clearMouseleaveTimeout()},mouseleave:function(a){if(!(0,e.default)(a).isPersistent()&&a.open){a._clearMouseleaveTimeout&&a._clearMouseleaveTimeout();var b=setTimeout(function(){if(!(0,
d.default)(a).get("mouse-inside"))a.open=!1},1E3);a._clearMouseleaveTimeout=function(){clearTimeout(b);a._clearMouseleaveTimeout=null}}},focus:function(a){a.open||(a.open=!0)},blur:function(a){if(!(0,e.default)(a).isPersistent()&&a.open)a.open=!1}},h={attribute:"responds-to",values:["toggle","hover"],missingDefault:"toggle",invalidDefault:"toggle"},g=(0,g.default)("aui-inline-dialog",{prototype:{get open(){return(0,e.default)(this).isVisible()},set open(a){f.default.setBooleanAttribute(this,"open",
a);i(this)},get persistent(){return this.hasAttribute("persistent")},set persistent(a){f.default.setBooleanAttribute(this,"persistent",a)},get respondsTo(){return f.default.computeEnumValue(h,this.getAttribute(h.attribute))},set respondsTo(a){var b=this.respondsTo;f.default.setEnumAttribute(this,h,a);b!==this.respondsTo&&l(this)},message:function(a){var b={toggle:["click"],hover:["mouseenter","mouseleave","focus","blur"]}[this.respondsTo];if(b&&-1<b.indexOf(a.type))t[a.type](this,a);return this}},
created:function(a){(0,d.default)(a).set("is-processing-show",!1);k(a,function(b){b.setAttribute("aria-expanded",a.open);b.setAttribute("aria-haspopup","true")})},attributes:{"aria-hidden":function(a,b){f.default.setBooleanAttribute(a,"open","false"===b.newValue)},open:function(a){document.body.contains(a)&&i(a)},"responds-to":function(a,b){var c=f.default.computeEnumValue(h,b.oldValue),d=f.default.computeEnumValue(h,b.newValue);c!==d&&l(a)}},attached:function(a){(0,r.default)(a).attributeExists("id");
a.hasAttribute("open")?(0,d.default)(a).get("is-processing-show")||i(a):i(a);l(a)},detached:function(a){a._auiAlignment&&a._auiAlignment.destroy()},template:function(a){var b=(0,p.default)('<div class="aui-inline-dialog-contents"></div>').append(a.childNodes);(0,p.default)(a).addClass("aui-layer").html(b)}});(0,q.default)("aui/inline-dialog2",g);(0,s.default)("InlineDialog2",g);j.default=g;return j=j["default"]}.call(this);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.auiplugin:aui-inline-dialog2', location = 'src/soy/inline-dialog2.soy' */
// This file was automatically generated from inline-dialog2.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace aui.inlineDialog2.
 */

if (typeof aui == 'undefined') { var aui = {}; }
if (typeof aui.inlineDialog2 == 'undefined') { aui.inlineDialog2 = {}; }


aui.inlineDialog2.inlineDialog2 = function(opt_data, opt_ignored) {
  return '<aui-inline-dialog' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="' + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.alignment) ? ' alignment="' + soy.$$escapeHtml(opt_data.alignment) + '"' : '') + ((opt_data.open) ? ' open' : '') + ((opt_data.persistent) ? ' persistent' : '') + ((opt_data.respondsTo) ? ' responds-to="' + soy.$$escapeHtml(opt_data.respondsTo) + '"' : '') + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</aui-inline-dialog>';
};
if (goog.DEBUG) {
  aui.inlineDialog2.inlineDialog2.soyTemplateName = 'aui.inlineDialog2.inlineDialog2';
}


aui.inlineDialog2.trigger = function(opt_data, opt_ignored) {
  return '' + aui.trigger.trigger(soy.$$augmentMap(opt_data, {showIcon: opt_data.showIcon ? opt_data.showIcon : false}));
};
if (goog.DEBUG) {
  aui.inlineDialog2.trigger.soyTemplateName = 'aui.inlineDialog2.trigger';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-previews:confluence-previews-jquery', location = '/js/confluence/preview-support.js' */
define("cp/confluence/preview-support",["ajs"],function(a){var d=function(){var e=b.SELECTOR_STRINGS.IMAGE+", "+b.SELECTOR_STRINGS.LINK_IMAGE+", "+b.SELECTOR_STRINGS.EXTERNAL_IMAGE;if(b.isPDFSupported()){e+=", "+b.SELECTOR_STRINGS.PDF+", "+b.SELECTOR_STRINGS.LINK_PDF}return e};var c=function(){return b.SELECTOR_STRINGS.IMAGE+", "+b.SELECTOR_STRINGS.EXTERNAL_IMAGE+", "+b.SELECTOR_STRINGS.FILE+", "+b.SELECTOR_STRINGS.LINK_FILE+", "+b.SELECTOR_STRINGS.ATTACHMENT_MACRO};var b={SELECTOR_STRINGS:{IMAGE:"img.confluence-embedded-image[data-linked-resource-id]",EXTERNAL_IMAGE:"img.confluence-embedded-image.confluence-external-resource",PDF:"a.confluence-embedded-file[data-nice-type='PDF Document']",LINK_IMAGE:"a[data-linked-resource-type='attachment'][data-nice-type='Image']",LINK_PDF:"a[data-linked-resource-type='attachment'][data-nice-type='PDF Document']",FILE:"a.confluence-embedded-file",LINK_FILE:"a[data-linked-resource-type='attachment']",FILE_OVERLAY:"span.confluence-embedded-file-wrapper .overlay",ATTACHMENT_MACRO:".plugin_attachments_container a.previewAttachmentLink"},VIEW_MODE:{FULL:"full",COMMENT:"comment",SIMPLE:"simple"},isPDFSupported:function(){return a.DarkFeatures.isEnabled("pdf-preview")},getFileSelectorString:function(){if(a.DarkFeatures.isEnabled("previews.trigger-all-file-types")){return c()}else{return d()}}};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-previews:confluence-previews-jquery', location = '/js/confluence/preview.js' */
define("cp/confluence/preview",["underscore","jquery","cp/confluence/preview-support","ajs","confluence/jsUri"],function(k,e,f,i,b){var j,l;e(document).ready(g);function g(){var o=e(f.getFileSelectorString());o.off("click.fb");e(document.body).off("click.filePreviews");e(document.body).on("click.filePreviews",f.getFileSelectorString(),n);e(document.body).on("click.filePreviews",f.SELECTOR_STRINGS.FILE_OVERLAY,h);e(window).on("popstate",function(){if(!l&&i.DarkFeatures.isEnabled("previews.sharing.pushstate")){a()}});a()}function n(o){if(!o.altKey&&!o.ctrlKey&&!o.metaKey&&!e(this).parent().closest("a, #draft-changes-dialog, #cp-annotations").length){o.preventDefault();m(this)}}function h(p){p.preventDefault();var o=e(p.target);var q=o.closest("span.confluence-embedded-file-wrapper");m(q.find(f.SELECTOR_STRINGS.IMAGE+","+f.SELECTOR_STRINGS.FILE),undefined,undefined,o.closest(".comment-count-overlay").length>0)}function m(p,q,o,v){if(!l){var r="confluence-previews-css";WRM.require("wr!com.atlassian.confluence.plugins.confluence-previews:"+r);var w=e.Deferred(),t=w.promise();var s=setInterval(function(){for(var y=0;y<document.styleSheets.length;y++){if(document.styleSheets[y].href&&document.styleSheets[y].href.indexOf(r)!==-1){u();return}if(document.styleSheets[y].imports&&document.all&&!window.atob){for(var x=0;x<document.styleSheets[y].imports.length;x++){if(document.styleSheets[y].imports[x].href.indexOf(r)!==-1){u();return}}}}},100);var u=function(){w.resolve();clearInterval(s)};l=e.when(WRM.require(["wr!com.atlassian.confluence.plugins.confluence-previews:confluence-previews-js","wrc!file-viewer"]),t);l.done(function(){j=require("cp/confluence/file-preview-loader");d(p,q,o,v)});Confluence.PageLoadingIndicator(e("body")).showUntilResolved(l,"Nous n\u0027avons pas pu charger l\u0027aper\u00e7u du fichier")}else{l.done(k.partial(d,p,q,o,v))}return l}var d=function(q,p,s,t){var o=e("#content");var r=e(q).closest(".comment,.cq-content,.ic-content");if(!p){if(!(o.hasClass("page")||o.hasClass("blogpost"))){p=f.VIEW_MODE.SIMPLE}else{if(r.length){p=f.VIEW_MODE.COMMENT}}}if(p===f.VIEW_MODE.COMMENT){j.showPreviewerForComment(q,r,p,t)}else{if(p===f.VIEW_MODE.SIMPLE){j.showPreviewerForSingleFile(q,p,s)}else{p=f.VIEW_MODE.FULL;j.showPreviewer(undefined,q,p,t)}}};function a(){if(c()){var q=new b(window.location.href);var p=window.history.pushState&&i.DarkFeatures.isEnabled("previews.sharing.pushstate");if(q.getQueryParamValue("preview")&&!p){var r="#!/preview"+q.getQueryParamValue("preview");var o=decodeURIComponent(q.deleteQueryParam("preview").setAnchor(r).toString());if(window.history.replaceState){window.history.replaceState({},"",o)}else{window.location=o}}else{if(q.anchor().indexOf("!/preview")===0&&p){var o;if(q.getQueryParamValue("preview")){o=q.setAnchor("")}else{o=q.addQueryParam("preview",q.anchor().substr("!/preview".length,q.anchor().length)).setAnchor("")}window.history.replaceState({},"",o)}}m()}}function c(){var o=new b(window.location.href);return i.DarkFeatures.isEnabled("previews.sharing")&&(o.getQueryParamValue("preview")||(o.anchor()&&o.anchor().indexOf("!/preview")===0))}return{loadConfluencePreviews:m}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-previews:confluence-previews-jquery', location = '/js/confluence/jquery-previewer.js' */
require(["cp/confluence/preview","jquery"],function(b,a){a.fn.previewer=function(c){if(!a(this).length){return this}var d=a.extend({},c);return this.each(function(){var f=a(this);var e=f.closest("li");var g=d.src||f.attr("data-image-src")||f.attr("src");if(g){f.click(function(j){var i={src:g,type:d.type,thumbnail:g,title:d.title||e.attr("data-file-name")||g,id:e.attr("data-attachment-id"),ownerId:e.attr("data-owner-id")};var h=b.loadConfluencePreviews([i],d.viewMode||"simple",d.from||"custom");d.zindex&&h.done(function(){a("#cp-container").css({"z-index":d.zindex})})})}})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'org.randombits.confluence.toc:toc-plugin-analytics', location = 'net/customware/confluence/plugin/toc/analytics/analytics.js' */
AJS.toInit(function(){AJS.$(".toc-macro a").click(function(){AJS.trigger("analyticsEvent",{name:"confluence.toc-macro.heading-click"})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'org.randombits.confluence.toc:client-side-toc-resources', location = 'net/customware/confluence/plugin/toc/js/client-side-toc.js' */
require(["ajs"],function(a){a.toInit(function(f){function b(n){var m=f({});m.data("precedenceLevel",n);return m}function g(m){return f(m).data("precedenceLevel")}function i(n,m){f(n).data("precedenceLevel",m);return n}function h(n,m){return m===g(n)}function d(s,m,o){if(s.length===0){return f()}var n=s.map(g).reduce(function(u,t){return Math.min(u,t)});if(!h(s[0],n)){s.unshift(b(n))}var q=m.createTocLevelContainer();var r={subElements:[],currentItem:undefined,outline:undefined,flush:function(){if(this.subElements.length>0&&this.currentItem){d(this.subElements,m,this.outline).appendTo(this.currentItem);this.subElements=[]}},add:function(t){this.subElements.push(t)},resetItem:function(t){this.outline=(o||[]).slice(0);this.outline.push(t);this.currentItem=m.createTocItemContainer();this.currentItem.appendTo(q);return this.currentItem}};var p=0;s.forEach(function(t){if(h(t,n)){p++;r.flush();r.resetItem(p);if(t.textContent){c(t,r.outline.join(".")).appendTo(r.currentItem)}else{r.currentItem.addClass("toc-empty-item")}}else{r.add(t)}});r.flush();if(o.length===0&&m.decorateToc){m.decorateToc(q)}return q}function c(m,n){return f(Confluence.Plugins.TableOfContents.Client.tocItemBody({outline:n,linkHref:"#"+m.id,linkText:m.textContent}))}function l(m){return{createTocLevelContainer:function(){return this.createTocItemContainer()},createTocItemContainer:function(){return f(Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer({cssClass:"toc-item-container"}))},decorateToc:function(o){function n(r,p){var s=r in m?m[r]:p;if(s){var q=f(Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator({separator:s}));q.appendTo(o)}}n("preseparator","[ ");f(o).find("span.toc-item-body").each(function(p,q){if(p>0){n("midseparator"," ] [ ")}f(q).appendTo(o)});n("postseparator"," ]");f(o).find(".toc-item-container").remove()}}}function e(m){return{createTocLevelContainer:function(){return f(Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer({cssliststyle:m.cssliststyle,csslistindent:m.csslistindent}))},createTocItemContainer:function(){return f(Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer())}}}function j(m){var o;if(m.includeheaderregex){o=new RegExp(m.includeheaderregex)}var n;if(m.excludeheaderregex){n=new RegExp(m.excludeheaderregex)}return function(){var p=f(this).text();if(o&&!o.test(p)){return false}if(n&&n.test(p)){return false}return true}}function k(o,q){var m=q.headerelements;var r=m.split(",");var p=j(q);var n=f("#main-content").find(m).filter(p).each(function(){i(this,r.indexOf(this.nodeName))}).toArray();return d(n,o,[])}f(".client-side-toc-macro").each(function(){var o=f(this);var n=o.data()||{};var m;if(n.structure==="flat"){m=l(n)}else{m=e(n)}if(n.numberedoutline!==true){o.addClass("hidden-outline")}o.html(k(m,n))})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'org.randombits.confluence.toc:client-side-toc-resources', location = 'net/customware/confluence/plugin/toc/templates/client.soy' */
// This file was automatically generated from client.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Plugins.TableOfContents.Client.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Plugins == 'undefined') { Confluence.Plugins = {}; }
if (typeof Confluence.Plugins.TableOfContents == 'undefined') { Confluence.Plugins.TableOfContents = {}; }
if (typeof Confluence.Plugins.TableOfContents.Client == 'undefined') { Confluence.Plugins.TableOfContents.Client = {}; }


Confluence.Plugins.TableOfContents.Client.tocItemBody = function(opt_data, opt_ignored) {
  return '<span class="toc-item-body" data-outline="' + soy.$$escapeHtml(opt_data.outline) + '"><span class="toc-outline">' + soy.$$escapeHtml(opt_data.outline) + '</span><a href="' + soy.$$escapeHtml(opt_data.linkHref) + '" class="toc-link">' + soy.$$escapeHtml(opt_data.linkText) + '</a></span>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.tocItemBody.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.tocItemBody';
}


Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer = function(opt_data, opt_ignored) {
  return '<ul style="' + ((opt_data.cssliststyle) ? ' list-style: ' + soy.$$escapeHtml(opt_data.cssliststyle) + ';' : '') + ((opt_data.csslistindent) ? ' padding-left: ' + soy.$$escapeHtml(opt_data.csslistindent) + ';' : '') + '"></ul>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.listStyleTocLevelContainer';
}


Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer = function(opt_data, opt_ignored) {
  return '<li></li>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.listStyleTocItemContainer';
}


Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer = function(opt_data, opt_ignored) {
  return '<span class="' + soy.$$escapeHtml(opt_data.cssClass) + '"></span>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.flatStyleTocItemContainer';
}


Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator = function(opt_data, opt_ignored) {
  return '<span class="toc-separator">' + soy.$$escapeHtml(opt_data.separator) + '</span>';
};
if (goog.DEBUG) {
  Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator.soyTemplateName = 'Confluence.Plugins.TableOfContents.Client.flatStyleTocSeparator';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:jirachart-resources', location = '/jirachart/jirachart.js' */
AJS.toInit(function(){AJS.$(".jira-chart-macro-img").load(function(a){AJS.log("Jira Chart Macro - chart image loaded");AJS.$(".insert-jira-chart-macro-button",window.parent.document).enable()}).error(function(d){AJS.log("Jira Chart Macro - chart image loaded error");AJS.$(".insert-jira-chart-macro-button",window.parent.document).disable();var e=AJS.$(d.target);var c=e.parent();var b=c.parent();c.remove();var a="Impossible d\u0022afficher la macro de graphique JIRA, en raison d\u0027une erreur d\u0027ex\u00e9cution.";AJS.messages.error(b,{body:a})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:jirachart-resources', location = '/jirachart/twodimensionalchart-showlink.js' */
var TwoDimensionalShowLink=(function(e){var d=function(i){var h=e("#two-dimensional-chart-"+i);var g=h.position();e("<div />",{id:"twodimensional-dark-layout-"+i,"class":"jim-sortable-dark-layout",css:{top:g.top+"px",left:g.left+"px",width:h.width()+"px",height:h.height()+"px"}}).appendTo(h.parent())};var a=function(g){e("#twodimensional-dark-layout-"+g).remove()};var b=function(){var h=e(this).attr("data-chart-id");d(h);var g={pageId:e("#chart-page-id-"+h).val(),wikiMarkup:e("#chart-wiki-"+h).val(),isShowMore:e(this).attr("data-is-show-more")};AJS.$.ajax({type:"POST",dataType:"html",url:Confluence.getContextPath()+"/plugins/servlet/twoDimensionalShowMoreRenderer",data:g,success:function(i){if(e(i).find(".aui-message.error").length){var j=e(i).find(".message").text();e("#two-dimensional-chart-"+h).find(".show-error").html(j)}else{var k=e(i).find(".show-link-container a").attr("data-chart-id");e("#two-dimensional-chart-"+h).replaceWith(i);c(k)}a(h)},error:function(){e("#two-dimensional-chart-"+h).find(".show-error").html("Impossible d\u0027afficher la macro de graphique JIRA. L\u0027ex\u00e9cution a expir\u00e9.");a(h)}})};var c=function(g){e("#show-link-"+g).on("click",b)};var f=function(){e(".show-link-container a").each(function(){c(e(this).attr("data-chart-id"))})};return{init:f}})(AJS.$);AJS.$(function(){TwoDimensionalShowLink.init()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'js/watch-model.js' */
define("confluence-watch-button/watch-model",["ajs","backbone"],function(a,b){return b.Model.extend({saveSettings:function(d,e){this.trigger("request");var c=this;return a.safe.ajax({url:d,type:"POST",dataType:"json",data:e}).done(function(){c.trigger("sync",c)}).fail(function(){c.trigger("error")})},saveWatchPage:function(d){var c=a.contextPath()+"/users/"+(d?"add":"remove")+"pagenotificationajax.action";this.set("watchingPage",d);return this.saveSettings(c,{pageId:this.get("pageId")})},saveWatchBlogs:function(d){var c=a.contextPath()+"/users/"+(d?"add":"remove")+"spacenotificationajax.action";this.set("watchingBlogs",d);return this.saveSettings(c,{spaceKey:this.get("spaceKey"),contentType:"blogpost"})},saveWatchSpace:function(d){var c=a.contextPath()+"/users/"+(d?"add":"remove")+"spacenotificationajax.action";this.set("watchingSpace",d);return this.saveSettings(c,{spaceKey:this.get("spaceKey")})}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'js/watch-view.js' */
define("confluence-watch-button/watch-view",["jquery","ajs","backbone"],function(b,a,c){return c.View.extend({events:{"change #cw-watch-page":"changeWatchPage","change #cw-watch-blogs":"changeWatchBlogs","change #cw-watch-space":"changeWatchSpace"},initialize:function(){_.bindAll(this,"render","initTooltips","changeWatchPage","changeWatchBlogs","changeWatchSpace","togglePageEnabledState","toggleBlogsEnabledState","startLoading","stopLoading","setTitle");this.model.on("sync change:watchingSpace",this.togglePageEnabledState,this);this.model.on("change:watchingSpace",this.toggleBlogsEnabledState,this);this.model.on("request",this.startLoading,this);this.model.on("sync",this.setTitle,this);this.model.on("sync",this.stopLoading,this)},render:function(){this.$el.html(Confluence.Watch.Templates.dialogBody(this.model.toJSON()));this.initTooltips();this.setTitle(this.model);return this},initTooltips:function(){this.$(".cw-tooltip").tooltip({gravity:"e",offset:5,delayIn:0});this.togglePageEnabledState(this.model);this.toggleBlogsEnabledState(this.model)},changeWatchPage:function(f){var d=b(f.target).is(":checked");this.model.saveWatchPage(d)},changeWatchBlogs:function(f){var d=b(f.target).is(":checked");this.model.saveWatchBlogs(d)},changeWatchSpace:function(f){var d=b(f.target).is(":checked");this.model.saveWatchSpace(d)},togglePageEnabledState:function(d){var e=d.get("watchingPage");var g=d.get("watchingSpace");this.$("#cw-watch-page").prop("disabled",g);this.$("#cw-watch-page").prop("checked",e||g);var f=g?"Vous recevrez des mises \u00e0 jour pour cette page car vous observez cet espace.":"";this.$(".cw-tooltip-watch-page").attr("original-title",f)},toggleBlogsEnabledState:function(d){var g=d.get("watchingBlogs");var f=d.get("watchingSpace");this.$("#cw-watch-blogs").prop("disabled",f);this.$("#cw-watch-blogs").prop("checked",g||f);var e=f?"Vous \u00eates abonn\u00e9 \u00e0 tous les billets de blog car vous observez cet espace.":"";this.$(".cw-tooltip-watch-blogs").attr("original-title",e)},startLoading:function(){this.$(".cw-status").addClass("loading")},stopLoading:function(){this.$(".cw-status").removeClass("loading")},setTitle:function(){var e=this.model.get("watchingPage");var i=this.model.get("watchingBlogs");var g=this.model.get("watchingSpace");var d=this.model.get("isBlogPost");function h(){if(g){return{title:"Vous observez cet espace",description:"Recevoir par courrier \u00e9lectronique les notifications concernant tous les contenus dans cet espace.",}}if(e&&d&&i){return{title:"Vous observez ce billet de blog",description:"Recevoir par courrier \u00e9lectronique les notifications des modifications de ce billet de blog et de tous les nouveaux billets de blog dans cet espace.",}}if(e&&d){return{title:"Vous observez ce billet de blog",description:"Recevoir par courrier \u00e9lectronique les notifications des modifications de ce billet de blog.",}}if(e){return{title:"Vous observez cette page",description:"Recevoir par courrier \u00e9lectronique les notifications de modification de cette page.",}}if(d&&i){return{title:"Vous surveillez les nouveaux billets de blog",description:"Recevoir par courrier \u00e9lectronique les notifications de cr\u00e9ation de nouveaux billets de blog dans cet espace.",}}if(d){return{title:"Vous n\u0027observez pas ce billet de blog",description:"Commencez votre observation afin de recevoir par courrier \u00e9lectronique les notifications de modification de ce blog.",}}return{title:"Vous n\u0027observez pas cette page",description:"Commencez votre observation afin de recevoir par courrier \u00e9lectronique les notifications de modification de cette page.",}}var f=h();this.$(".cw-title").text(f.title);this.$(".cw-title-description").text(f.description)}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'js/watch.js' */
require(["jquery","underscore","ajs","confluence-watch-button/watch-model","confluence-watch-button/watch-view","confluence-watch-button/watch-notification"],function(b,i,h,f,d,g){h.toInit(function(){var j=b("#watch-content-button");if(!j.length){return}j.click(function(l){l.preventDefault()});var k=h.Meta.get("page-id");b.getJSON(h.contextPath()+"/rest/watch-button/1.0/watchState/"+k,function(l){i.extend(l,{pageId:k,spaceKey:h.Meta.get("space-key"),spaceName:h.Meta.get("space-name")});a(j,l);j.addClass("watch-state-initialised")})});function a(j,n){e(j,n);var m=new f(n);var l=new d({model:m});h.InlineDialog(j,"confluence-watch",function(p,o,q){l.setElement(p);l.render();q()},{width:325,offsetX:-180,cacheContent:false,hideDelay:null,hideCallback:function(){b(".tipsy").hide()}});m.on("change:watchingPage change:watchingBlogs change:watchingSpace",function(o){e(j,o.toJSON())});m.on("change:watchingPage",function(o,q){var p=q?"watch-page":"unwatch-page";h.trigger("analytics",{name:p})});m.on("change:watchingBlogs",function(o,q){var p=q?"watch-blogs":"unwatch-blogs";h.trigger("analytics",{name:p})});m.on("change:watchingSpace",function(o,q){var p=q?"watch-space":"unwatch-space";h.trigger("analytics",{name:p})});c(m);var k=false;b(document).on("keyup",function(){k=false});window.CW_watchPage=function(){if(k){return}k=true;var q=m.get("watchingSpace");var p=m.get("watchingPage");if(q){b("body, #splitter-content").animate({scrollTop:0},300,function(){j.click();setTimeout(function(){b(".cw-tooltip-watch-page").tipsy("show")},50)})}else{var r=!p;m.saveWatchPage(r);var o=r?"Vous commencer \u00e0 surveiller cette page.":"Vous avez arr\u00eater de surveiller cette page.";g(o)}}}function e(k,q){var m=q.watchingPage;var j=q.isBlogPost&&q.watchingBlogs;var o=q.watchingSpace;if(m||j||o){var l=k.find(".aui-icon").removeClass("aui-iconfont-unwatch").addClass("aui-iconfont-watch");var n=h.format("{0}O{1}bservation","<u>","</u>");k.prop("title","Arr\u00eater l\u0027observation").children("span").empty().append(l).append(" "+n)}else{var l=k.find(".aui-icon").removeClass("aui-iconfont-watch").addClass("aui-iconfont-unwatch");var p=h.format("{0}O{1}bserver","<u>","</u>");k.prop("title","Observer (w)").children("span").empty().append(l).append(" "+p)}}function c(j){j.on("change:watchingPage",function(k,m){var l=m?"watchpage.pageoperation":"unwatchpage.pageoperation";h.trigger(l)})}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'js/notification.js' */
define("confluence-watch-button/watch-notification",["jquery","aui/flag"],function(b,a){return function(e){var c=document.getElementById("watch-notification");if(c!=null){c.close()}var d=a({type:"success",body:e,close:"auto"});d.setAttribute("id","watch-notification")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.watch-button:watch-resources', location = 'templates/watch.soy' */
// This file was automatically generated from watch.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Watch.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Watch == 'undefined') { Confluence.Watch = {}; }
if (typeof Confluence.Watch.Templates == 'undefined') { Confluence.Watch.Templates = {}; }


Confluence.Watch.Templates.dialogBody = function(opt_data, opt_ignored) {
  return '<div class="cw-status"><h2 class="cw-title"></h2><p class="cw-title-description"></p></div><form class="aui cw-dialog"><div class="cw-tooltip cw-tooltip-watch-page"><div class="checkbox"><input class="checkbox" type="checkbox" id="cw-watch-page" ' + ((opt_data.watchingPage) ? 'checked' : '') + '><label for="cw-watch-page">' + ((opt_data.isBlogPost) ? soy.$$escapeHtml("Observez un billet de blog") : soy.$$escapeHtml("Observez la page")) + '</label></div></div>' + ((opt_data.isBlogPost) ? '<div class="cw-tooltip cw-tooltip-watch-blogs"><div class="checkbox"><input class="checkbox" type="checkbox" id="cw-watch-blogs" ' + ((opt_data.watchingBlogs) ? 'checked' : '') + '><label for="cw-watch-blogs">' + soy.$$escapeHtml("Observez les nouveaux billets de blog dans cet espace") + '</label></div></div>' : '') + '<div class="checkbox"><input class="checkbox" type="checkbox" id="cw-watch-space" ' + ((opt_data.watchingSpace) ? 'checked' : '') + '><label for="cw-watch-space">' + soy.$$escapeHtml("Observez tous les contenus dans cet espace") + '</label></div></form>' + ((opt_data.isAdmin) ? '<div class="cw-manage-watchers-wrapper"><button class="aui-button aui-button-link cw-manage-watchers">' + soy.$$escapeHtml("G\xe9rer les observateurs") + '</button></div>' : '');
};
if (goog.DEBUG) {
  Confluence.Watch.Templates.dialogBody.soyTemplateName = 'Confluence.Watch.Templates.dialogBody';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.share-page:mail-page-resources', location = 'templates/sharepage/share-dialog.soy' */
// This file was automatically generated from share-dialog.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Share.Dialog.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Share == 'undefined') { Confluence.Templates.Share = {}; }
if (typeof Confluence.Templates.Share.Dialog == 'undefined') { Confluence.Templates.Share.Dialog = {}; }


Confluence.Templates.Share.Dialog.shareContentPopup = function(opt_data, opt_ignored) {
  return '<form action="#" method="post" class="aui share-content-popup"><div class="field-group"><div class="autocomplete-user-target"><input class="text autocomplete-sharepage" id="users" data-max="10" data-dropdown-target=".autocomplete-user-target" data-none-message="' + soy.$$escapeHtml("Pas de correspondances") + '" placeholder="' + soy.$$escapeHtml("Nom de l\x27utilisateur, du groupe ou adresse \xe9lectronique") + '"/></div><ol class="recipients"></ol></div><div class="field-group"><textarea class="textarea" id="note" placeholder="' + soy.$$escapeHtml("Ajouter une note") + '"/></div><div class="field-group button-panel"><div class="progress-messages-icon"></div><div class="progress-messages"></div><input class="button submit" type="submit" value="' + soy.$$escapeHtml("Partager") + '" disabled/><a class="close-dialog" href="#">' + soy.$$escapeHtml("Annuler") + '</a></div></form>';
};
if (goog.DEBUG) {
  Confluence.Templates.Share.Dialog.shareContentPopup.soyTemplateName = 'Confluence.Templates.Share.Dialog.shareContentPopup';
}


Confluence.Templates.Share.Dialog.recipientUser = function(opt_data, opt_ignored) {
  return '<li data-userkey="' + soy.$$escapeHtml(opt_data.userKey) + '" style="display: none" class="recipient-user"><img src="' + soy.$$escapeHtml(opt_data.thumbnailLink.href) + '" title="' + soy.$$escapeHtml(opt_data.title) + '"/><span class="title" title="' + soy.$$escapeHtml(opt_data.title) + '">' + soy.$$escapeHtml(opt_data.title) + '</span><span class="remove-recipient"/></li>';
};
if (goog.DEBUG) {
  Confluence.Templates.Share.Dialog.recipientUser.soyTemplateName = 'Confluence.Templates.Share.Dialog.recipientUser';
}


Confluence.Templates.Share.Dialog.recipientEmail = function(opt_data, opt_ignored) {
  return '<li data-email="' + soy.$$escapeHtml(opt_data.email) + '" style="display: none" class="recipient-email"><img src="' + soy.$$escapeHtml(opt_data.icon) + '" title="' + soy.$$escapeHtml(opt_data.email) + '"/><span class="title" title="' + soy.$$escapeHtml(opt_data.email) + '">' + soy.$$escapeHtml(opt_data.email) + '</span><span class="remove-recipient"/></li>';
};
if (goog.DEBUG) {
  Confluence.Templates.Share.Dialog.recipientEmail.soyTemplateName = 'Confluence.Templates.Share.Dialog.recipientEmail';
}


Confluence.Templates.Share.Dialog.recipientGroup = function(opt_data, opt_ignored) {
  return '<li data-group="' + soy.$$escapeHtml(opt_data.title) + '" style="display: none" class="recipient-group"><span><img src="' + soy.$$escapeHtml(opt_data.thumbnailLink.href) + '" title="' + soy.$$escapeHtml(opt_data.title) + '"/><span>' + soy.$$escapeHtml(opt_data.title) + '</span><span class="remove-recipient"/></span></li>';
};
if (goog.DEBUG) {
  Confluence.Templates.Share.Dialog.recipientGroup.soyTemplateName = 'Confluence.Templates.Share.Dialog.recipientGroup';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.share-page:mail-page-resources', location = 'js/mailpage.js' */
AJS.Confluence.SharePage={};AJS.Confluence.SharePage.autocompleteUser=function(d){d=d||document.body;var e=AJS.$,a=/^([a-zA-Z0-9_\.\-\+\!#\$%&'\*/=\?\^_`{|}~])+\@.*/;var c=function(j){if(!j||!j.result){throw new Error("Invalid JSON format")}var f=[];for(var g=0;g<j.result.length;g++){var h=j.result[g];if(h.type=="group"){h=b(h)}}f.push(j.result);return f};function b(f){if(f.name=="confluence-users"||f.name=="confluence-administrators"){return f}f.title=f.name;f.group=f.name;f.thumbnailLink={href:Confluence.getContextPath()+"/download/resources/com.atlassian.confluence.plugins.share-page:mail-page-resources/images/group.png",type:"image/png",rel:"thumbnail"};f.link=[{href:Confluence.getContextPath(),rel:"self"}];return f}e("input.autocomplete-sharepage[data-autocomplete-user-bound!=true]",d).each(function(){var h=e(this).attr("data-autocomplete-sharepage-bound","true").attr("autocomplete","off");var g=h.attr("data-max")||10,j=h.attr("data-alignment")||"left",i=h.attr("data-dropdown-target"),f=null;if(i){f=e(i)}else{f=e("<div></div>");h.after(f)}f.addClass("aui-dd-parent autocomplete");h.quicksearch(AJS.REST.getBaseUrl()+"search/user-or-group.json",function(){h.trigger("open.autocomplete-sharepage")},{makeParams:function(k){return{"max-results":g,query:k.replace("{|}","")}},dropdownPlacement:function(k){f.append(k)},makeRestMatrixFromData:c,addDropdownData:function(l){var k=e.trim(h.val());if(a.test(k)){l.push([{name:k,email:k,href:"#",icon:Confluence.getContextPath()+"/download/resources/com.atlassian.confluence.plugins.share-page:mail-page-resources/images/envelope.png"}])}if(!l.length){var m=h.attr("data-none-message");if(m){l.push([{name:m,className:"no-results",href:"#"}])}}return l},ajsDropDownOptions:{alignment:j,displayHandler:function(k){if(k.restObj&&k.restObj.username){return k.name+" ("+k.restObj.username+")"}return k.name},selectionHandler:function(m,l){if(l.find(".search-for").length){h.trigger("selected.autocomplete-sharepage",{searchFor:h.val()});return}if(l.find(".no-results").length){this.hide();m.preventDefault();return}var k=e("span:eq(0)",l).data("properties");if(!k.email){k=k.restObj}h.trigger("selected.autocomplete-sharepage",{content:k});this.hide();m.preventDefault()}}})})};(function(a){jQuery.fn.extend({elastic:function(){var b=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight","border-top-width","border-right-width","border-bottom-width","border-left-width","borderTopStyle","borderTopColor","borderRightStyle","borderRightColor","borderBottomStyle","borderBottomColor","borderLeftStyle","borderLeftColor"];return this.each(function(){if(this.type!=="textarea"){return false}var g=jQuery(this),c=jQuery("<div />").css({position:"absolute",display:"none","word-wrap":"break-word","white-space":"pre-wrap"}),j=parseInt(g.css("line-height"),10)||parseInt(g.css("font-size"),"10"),l=parseInt(g.css("height"),10)||j*3,k=parseInt(g.css("max-height"),10)||Number.MAX_VALUE,d=0;if(k<0){k=Number.MAX_VALUE}c.appendTo(g.parent());var f=b.length;while(f--){c.css(b[f].toString(),g.css(b[f].toString()))}function h(){var i=Math.floor(parseInt(g.width(),10));if(c.width()!==i){c.css({width:i+"px"});e(true)}}function m(i,o){var n=Math.floor(parseInt(i,10));if(g.height()!==n){g.css({height:n+"px",overflow:o})}}function e(p){var o=g.val().replace(/&/g,"&amp;").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />");var i=c.html().replace(/<br>/ig,"<br />");if(p||o+"&nbsp;"!==i){c.html(o+"&nbsp;");if(Math.abs(c.height()+j-g.height())>3){var n=c.height()+j;if(n>=k){m(k,"auto")}else{if(n<=l){m(l,"hidden")}else{m(n,"hidden")}}}}}g.css({overflow:"hidden"});g.bind("keyup change cut paste",function(){e()});a(window).bind("resize",h);g.bind("resize",h);g.bind("update",e);g.bind("input paste",function(i){setTimeout(e,250)});e()})}})})(AJS.$);(function(f){var e,c={hideCallback:a,width:250,hideDelay:3600000,calculatePositions:function(h,o,w,s){var p;var y;var u;var l=-7;var m;var q;var x=o.target.offset();var g=o.target.outerWidth();var j=x.left+g/2;var t=(window.pageYOffset||document.documentElement.scrollTop)+f(window).height();var k=10;u=x.top+o.target.outerHeight()+s.offsetY;p=x.left+s.offsetX;var n=x.top>h.height();var i=(u+h.height())<t;q=(!i&&n)||(s.onTop&&n);var r=f(window).width()-(p+s.width+k);if(q){u=x.top-h.height()-8;var v=s.displayShadow?(AJS.$.browser.msie?10:9):0;l=h.height()-v}m=j-p+s.arrowOffsetX;if(s.isRelativeToMouse){if(r<0){y=k;p="auto";m=w.x-(f(window).width()-s.width)}else{p=w.x-20;y="auto";m=w.x-p}}else{if(r<0){y=k;p="auto";m=j-(f(window).width()-h.outerWidth())}else{if(s.width<=g/2){m=s.width/2;p=j-s.width/2}}}return{displayAbove:q,popupCss:{left:p,right:y,top:u},arrowCss:{position:"absolute",left:m,right:"auto",top:l}}}};var a=function(){f(".dashboard-actions .explanation").hide()};var d=function(j,h,i){if(j.find("input").length){i();return}j.append(Confluence.Templates.Share.Dialog.shareContentPopup());AJS.Confluence.SharePage.autocompleteUser();var k=function(m){AJS.Confluence.SharePage.current.hide();if(m){setTimeout(function(){j.empty()},300)}return false};f(document).keyup(function(m){if(m.keyCode==27){k(true);f(document).unbind("keyup",arguments.callee);return false}return true});j.find(".close-dialog").click(function(){k(true)});j.find("#note").elastic();j.find("form").submit(function(){var r=[];j.find(".recipients li").each(function(s,t){r.push(f(t).attr("data-userKey"))});if(r.length<=0){return false}f("button,input,textarea",this).attr("disabled","disabled");j.find(".progress-messages-icon").removeClass("error");j.find(".progress-messages").text("Envoi");j.find(".progress-messages").attr("title","Envoi");var o=Raphael.spinner(j.find(".progress-messages-icon")[0],7,"#666");j.find(".progress-messages-icon").css("position","absolute").css("left","0").css("margin-top","3px");j.find(".progress-messages").css("padding-left",j.find(".progress-messages-icon").innerWidth()+20);var r=[];j.find(".recipients li[data-userKey]").each(function(s,t){r.push(f(t).attr("data-userKey"))});var q=[];j.find(".recipients li[data-email]").each(function(s,t){q.push(f(t).attr("data-email"))});var m=[];j.find(".recipients li[data-group]").each(function(s,t){m.push(f(t).attr("data-group"))});var n=j.find("#note");var p={users:r,emails:q,groups:m,note:n.hasClass("placeholded")?"":n.val(),entityId:AJS.params.pageId};f.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:Confluence.getContextPath()+"/rest/share-page/latest/share",data:JSON.stringify(p),dataType:"text",success:function(){setTimeout(function(){o();j.find(".progress-messages-icon").addClass("done");j.find(".progress-messages").text("Envoy\u00e9");j.find(".progress-messages").attr("title","Envoy\u00e9");setTimeout(function(){j.find(".progress-messages").text("");j.find(".progress-messages-icon").removeClass("done");j.find("#note").val("");f("button,input,textarea",j).removeAttr("disabled");k(false)},1000)},500)},error:function(t,s){o();j.find(".progress-messages-icon").addClass("error");j.find(".progress-messages").text("Erreur d\u0027envoi");j.find(".progress-messages").attr("title","Erreur d\u0027envoi"+": "+s);f("button,input,textarea",j).removeAttr("disabled")}});return false});var l=j.find("#users");var g=j.find("input.submit");l.bind("selected.autocomplete-sharepage",function(n,m){var o=function(r,q,s){var u=j.find(".recipients"),t,p;t="li[data-"+r+'="'+s.content[r]+'"]';if(u.find(t).length>0){u.find(t).hide()}else{u.append(q(s.content))}p=u.find(t);p.find(".remove-recipient").click(function(){p.remove();if(u.find("li").length==0){g.attr("disabled","true")}AJS.Confluence.SharePage.current.refresh();l.focus();return false});p.fadeIn(200)};if(m.content.email){o("email",Confluence.Templates.Share.Dialog.recipientEmail,m)}else{if(m.content.type=="group"){o("group",Confluence.Templates.Share.Dialog.recipientGroup,m)}else{o("userKey",Confluence.Templates.Share.Dialog.recipientUser,m)}}AJS.Confluence.SharePage.current.refresh();g.removeAttr("disabled");l.val("");l.focus();return false});l.bind("open.autocomplete-sharepage",function(n,m){if(f("a:not(.no-results)",AJS.dropDown.current.links).length>0){AJS.dropDown.current.moveDown()}});l.keypress(function(m){return m.keyCode!=13});f(document).bind("showLayer",function(o,n,m){if(n=="inlineDialog"&&m.popup==AJS.Confluence.SharePage.current){m.popup.find("#users").focus()}});f(h).parents().filter(function(){return this.scrollTop>0}).scrollTop(0);i()};var b=function(g){var h=f("#splitter-content");if(h.length!==0){g.container=h;g.offsetY=AJS.InlineDialog.opts.offsetY-h.offset().top}return g};AJS.Confluence.SharePage.initDialog=function(g,i,h){if(g.length){var j=f.extend(false,b(c),h);AJS.Confluence.SharePage.current=AJS.InlineDialog(g,i,d,j)}};AJS.toInit(function(g){AJS.Confluence.SharePage.initDialog(g("#shareContentLink"),"shareContentPopup")})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-browser-metrics:legacy-browser-metrics', location = '/js/legacy/browser-metrics.js' */
(function(){var a=window.BrowserMetrics||{};a.isFunction=function(b){return !!(b&&b.constructor&&b.call&&b.apply)};a.isEnabled=function(){if(a.enabled===undefined){a.enabled=true}return a.enabled};window.BrowserMetrics=a}());(function(){var b=window.BrowserMetrics||{};if(b.isEnabled()){var f=5;var e=12000;var c=function(g){return Math.round(g)};var a=function(g){return Math.round(g*100)/100};var d=function(k){var h=(function(){var n=/^(\w+):\/\/([^\/]*)(.*)$/;return function(p){var o=p.match(n);if(!o){return{path:p}}return{scheme:o[1],host:o[2],path:o[3]}}}());var i=(function(){var n=["secureConnectionStart","requestStart","responseStart","responseEnd","domContentLoadedEventStart","domContentLoadedEventEnd","loadEventEnd"];return function(o){if(k.performance){var s=k.performance.timing;var p=s.navigationStart;if(p){for(var r=0;r<n.length;++r){var q=n[r];var t=s[q];if(t){o(q,t-p)}}}}}}());var g=(function(){var o=[{key:"LOGIN",pattern:/^\/login.*/i},{key:"J-DASH",pattern:/^\/secure\/dashboard\.jspa.*/i},{key:"J-ISSUE",pattern:/^\/browse\/\w+\-\w+.*/i},{key:"J-NAV",pattern:/^\/issues.*/i},{key:"J-RAPID",pattern:/secure\/rapidboard\.jspa/i},{key:"SD-AGENT",pattern:/^(\/\w+)?\/servicedesk\/agent\/.*/i},{key:"SD-CUSTOMER",pattern:/^(\/\w+)?\/servicedesk\/customer\/.*/i},{key:"C-DASH",pattern:/^\/wiki(\/)?(\?.*|#.*)?$/i},{key:"C-DASH",pattern:/^\/wiki\/dashboard\.action.*$/i},{key:"C-SPACE",pattern:/^\/wiki\/display\/\w+(\?.*|#.*)?$/i},{key:"C-PAGE",pattern:/^\/wiki\/display\/\w+\/.*/i},{key:"C-PAGE",pattern:/^\/wiki\/pages\/viewpage\.action.*/i},{key:"C-BLOG",pattern:/^\/wiki\/display\/~\w+\/\d+\/\d+\/\d+\/.*/i},{key:"C-EDITOR",pattern:/^\/wiki\/pages\/editpage\.action.*/i},{key:"C-CREATE",pattern:/^\/wiki\/pages\/createpage\.action.*/i}];return function n(){var r=h(k.location.href).path;for(var p=0;p<o.length;++p){var q=o[p];if(r.match(q.pattern)){return q.key}}return null}}());function j(){var n=g();if(n){i(function(p,r){var o="browser.metrics."+p,q={version:f,page:n,value:r>e?"x":Math.ceil((r)/100),rawValue:c(r)};AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent(o,q):AJS.trigger("analyticsEvent",{name:o,data:q})})}}function m(){try{j()}catch(n){if(window.console){window.console.log("Error reporting browser metrics: "+n)}}}function l(){if(k.performance.timing.loadEventEnd){m()}else{setTimeout(l,1000)}}if(k.performance&&k.performance.timing){l()}};if(!window.ATL_PERF){window.ATL_PERF={}}window.ATL_PERF.initPageLoad=d}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-browser-metrics:legacy-browser-metrics', location = '/js/legacy/browser-metrics-events.js' */
(function(){var b=window.BrowserMetrics||{};if(b.isEnabled()){var e=5;var d=12000;var a=function(f){return Math.round(f*100)/100};var c=function(g){var l={};function h(){return g.performance&&g.performance.now?g.performance.now():new Date().getTime()}function n(o){return o===Object(o)}function k(o){if(n(o)){return o.eventName+"."+o.eventType}else{return o}}function m(o){if(n(o)){return o.eventName}else{return o}}function j(o){if(n(o)){return o.eventType}else{return""}}function f(o){var p=k(o);l[p]=h()}function i(r,u){var v=k(r);if(!l[v]){throw ("Error logging browser metrics event end: no start event for key '"+v+"'")}var t=h()-l[v];l[v]=null;var o=m(r),q=j(r);var p="browser.metrics.e."+o+(u?"."+u:""),s={version:e,value:t>d?"x":Math.ceil((t)/100),rawValue:a(t),eventType:q};g.AJS.Analytics?g.AJS.Analytics.triggerPrivacyPolicySafeEvent(p,s):g.AJS.trigger("analyticsEvent",{name:p,data:s})}return{start:f,end:i}};if(!window.ATL_PERF){window.ATL_PERF={}}window.ATL_PERF.initEvents=c}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-browser-metrics:legacy-browser-metrics', location = '/js/legacy/browser-metrics-init.js' */
(function(){var a=window.BrowserMetrics||{};if(a.isEnabled()){if(Math.random()<0.1){window.ATL_PERF&&window.ATL_PERF.initPageLoad&&window.ATL_PERF.initPageLoad(window)}window.ATL_PERF&&window.ATL_PERF.initEvents&&(function(){window.BrowserMetrics=window.ATL_PERF.initEvents(window)}())}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:querystring', location = '/includes/js/api/querystring.js' */
define("confluence/api/querystring",[],function(){return{stringify:function(a){var b="",c;for(c in a)for(var d=0;d<a[c].length;d++)b+="&"+c,a[c][d]&&(b+="="+a[c][d]);return b.substring(1)},parse:function(a){var b={};if(a){"?"===a.substr(0,1)&&(a=a.substr(1));for(var a=a.split("&"),c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]||(b[d[0]]=[]);b[d[0]].push(a[c].substring(d[0].length+1))}}return b}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:url', location = '/includes/js/api/url.js' */
define("confluence/api/url",["confluence/api/querystring","jquery"],function(d,e){var g=/([^\?|#]+)[\?]?([^#]*)[#]?(.*)/,f=["source","urlPath","queryParams","anchor"];return{parse:function(a){var b={};if(a=g.exec(a)){for(var c=0;c<f.length;c++)b[f[c]]=a[c];b.queryParams=d.parse(b.queryParams)}return b},format:function(a){return e.isEmptyObject(a)?"":(!a.urlPath?"":a.urlPath)+(e.isEmptyObject(a.queryParams)?"":"?"+d.stringify(a.queryParams))+(!a.anchor?"":"#"+a.anchor)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:analytics-support', location = '/includes/js/analytics-support.js' */
define("confluence/analytics-support","jquery ajs confluence/meta window document confluence/api/url".split(" "),function(j,o,n,k,l,h){var b={},m;b.setAnalyticsSource=function(a,d){if(typeof m==="undefined"){var c=j._data(k,"events");m=c&&c.analytics&&c.analytics.length>0}m&&a.attr("href",function(a,c){var b=encodeURIComponent(d),g=h.parse(c);if(!j.isEmptyObject(g))g.queryParams.src=[b];return h.format(g)})};b.srcRemovedUrl=function(a){a=h.parse(a);delete a.queryParams.src;for(var d=Object.keys(a.queryParams),
c=0;c<d.length;c++){var b=d[c],f=b.split(".");f.length===3&&f[0]==="src"&&delete a.queryParams[b];b==="jwt"&&delete a.queryParams[b]}return h.format(a)};b.srcParamValues=function(a){return(a=h.parse(a).queryParams)&&a.src?a.src:[]};b.srcAttrParamValues=function(a){for(var a=h.parse(a).queryParams,b={},c=Object.keys(a),e=0;e<c.length;e++){var f=c[e],i=f.split(".");if(i.length===3&&i[0]==="src"){var g=i[1],i=i[2];b[g]=b[g]||{};b[g][i]=decodeURIComponent(a[f][0])}}return b};b.extractAnalyticsData=function(a){for(var d=
[],c=b.srcParamValues(a),a=b.srcAttrParamValues(a),e=0;e<c.length;e++){var f=c[e];d.push({src:f,attr:a[f]||{}})}return d};b.publish=function(a,b){o.trigger("analytics",{name:a,data:b||{}})};b.init=function(){var a=b.extractAnalyticsData(l.URL),d={userKey:n.get("remote-user-key"),pageID:n.get("page-id")};if(a.length>0){for(var c=0;c<a.length;c++){var e=a[c],f=j.extend({},d,e.attr);b.publish("confluence.viewpage.src."+e.src,f)}if(k.history&&k.history.replaceState){a=b.srcRemovedUrl(l.URL);l.URL!==a&&
k.history.replaceState(null,"",a)}}else b.publish("confluence.viewpage.src.empty",d)};return b});require("confluence/module-exporter").exportModuleAsGlobal("confluence/analytics-support","AJS.Confluence.Analytics",function(j){require("ajs").toInit(j.init)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:page-analytics', location = '/includes/js/page.js' */
define("confluence/page",["ajs","jquery","confluence/analytics-support","window","document"],function(a,b,e,f,g){var i=a.Meta.get("page-id"),d=function(c,a){e.publish("confluence.page."+c,b.extend({pageID:i},a||{}))},j=(new Date).getTime();return function(){var c=b("#main-content");d("view");c.on("click","a",function(a){a=-1<a.currentTarget.href.indexOf(f.location.host)?"internal":"external";d("link.click",{linkType:a})});var h=b(f),e=(new Date).getTime();h.on("scroll.content",a.debounce(function(){var a=
g.body.scrollTop+g.body.offsetHeight,b=c.offset().top+c.height();a>b&&(d("scroll-to-bottom",{secondsSinceReadyEvent:((new Date).getTime()-e)/1E3,secondsSincePageLoad:((new Date).getTime()-j)/1E3}),h.off("scroll.content"))},200));setTimeout(function(){d("reading")},3E5)}});require("confluence/module-exporter").safeRequire("confluence/page",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.macros.advanced:blog-post-resources', location = 'com/atlassian/confluence/plugins/macros/advanced/blog-posts.js' */
jQuery(function(a){a(".macro-blank-experience .create-post").bind("click",function(){var b=AJS.Meta.get("base-url")+"/pages/createblogpost.action?spaceKey="+AJS.Meta.get("space-key");window.location=b})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.macros.multimedia:flash-autosize', location = 'javascript/flash-autosize.js' */
AJS.toInit(function(b){function a(e,d){var c;if(d>=20){AJS.log("unable to auto size flash - took too long to load");return}c=b([]);e.each(function(){var g=b(this);var i;var f;if(this.GetVariable){if(!g.attr("height")){i=this.GetVariable("height");if(i){g.height(i)}else{c=c.add(g);return}}if(!g.attr("width")){f=this.GetVariable("width");if(f){g.width(f)}else{c=c.add(g);return}}}});if(c.length){setTimeout(function(){a(c,d+1)},100)}}a(b('embed[type="application/x-shockwave-flash"]'),0);b(window).bind("render-content-loaded",function(d,c){a(b('embed[type="application/x-shockwave-flash"]',c),0)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.view-source:view-source-menu-resources', location = 'com/atlassian/confluence/plugins/viewsource/js/viewsource.js' */
define("confluence-view-source/viewsource",["jquery","window"],function(a,b){return function(){a("#action-view-source-link").click(function(a){b.open(this.href,(this.id+"-popupwindow").replace(/-/g,"_"),"width=800, height=600, scrollbars, resizable");a.preventDefault();return!1})}});require("confluence/module-exporter").safeRequire("confluence-view-source/viewsource",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.view-storage-format:view-storage-menu-resources', location = 'com/atlassian/confluence/plugins/viewstorage/js/viewstorage.js' */
AJS.toInit(function(a){a(".view-storage-link, .view-storage-link a").click(function(b){window.open(this.href,(this.id+"-popupwindow").replace(/-/g,"_"),"width=800, height=600, scrollbars, resizable");b.preventDefault();return false})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/store-1.3.1.js' */
(function(){var l={},h=window,k=h.document,c="localStorage",n="globalStorage",d="__storejs__",g;l.disabled=false;l.set=function(e,o){};l.get=function(e){};l.remove=function(e){};l.clear=function(){};l.transact=function(e,o){var p=l.get(e);if(typeof p=="undefined"){p={}}o(p);l.set(e,p)};l.serialize=function(e){return JSON.stringify(e)};l.deserialize=function(e){if(typeof e!="string"){return undefined}return JSON.parse(e)};function b(){try{return(c in h&&h[c])}catch(e){return false}}function m(){try{return(n in h&&h[n]&&h[n][h.location.hostname])}catch(e){return false}}if(b()){g=h[c];l.set=function(e,o){if(o===undefined){return l.remove(e)}g.setItem(e,l.serialize(o))};l.get=function(e){return l.deserialize(g.getItem(e))};l.remove=function(e){g.removeItem(e)};l.clear=function(){g.clear()}}else{if(m()){g=h[n][h.location.hostname];l.set=function(e,o){if(o===undefined){return l.remove(e)}g[e]=l.serialize(o)};l.get=function(e){return l.deserialize(g[e]&&g[e].value)};l.remove=function(e){delete g[e]};l.clear=function(){for(var e in g){delete g[e]}}}else{if(k.documentElement.addBehavior){var j,f;try{f=new ActiveXObject("htmlfile");f.open();f.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></frame>');f.close();j=f.w.frames[0].document;g=j.createElement("div")}catch(i){g=k.createElement("div");j=k.body}function a(e){return function(){var p=Array.prototype.slice.call(arguments,0);p.unshift(g);j.appendChild(g);g.addBehavior("#default#userData");g.load(c);var o=e.apply(l,p);j.removeChild(g);return o}}l.set=a(function(p,e,o){if(o===undefined){return l.remove(e)}p.setAttribute(e,l.serialize(o));p.save(c)});l.get=a(function(o,e){return l.deserialize(o.getAttribute(e))});l.remove=a(function(o,e){o.removeAttribute(e);o.save(c)});l.clear=a(function(q){var o=q.XMLDocument.documentElement.attributes;q.load(c);for(var p=0,e;e=o[p];p++){q.removeAttribute(e.name)}q.save(c)})}}}try{l.set(d,d);if(l.get(d)!=d){l.disabled=true}l.remove(d)}catch(i){l.disabled=true}if(typeof module!="undefined"){module.exports=l}else{if(typeof define==="function"&&define.amd){define(l)}else{this.store=l}}})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/page-visibility.js' */
define("atlassian/analytics/page-visibility",function(){var a=(document.hidden!==undefined);var b={supported:a,isHidden:function(){return a?document.hidden:false}};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/user-activity-xhr-header.js' */
define("atlassian/analytics/user-activity-xhr-header",["atlassian/analytics/page-visibility"],function(c){var e="x-atlassian-mau-ignore";var d=XMLHttpRequest.prototype.send;var a=window.fetch;var b=false;return{install:function(){if(!b&&c.supported){XMLHttpRequest.prototype.send=function(){if(c.isHidden()){this.setRequestHeader(e,c.isHidden())}d.apply(this,arguments)};if(a){window.fetch=function(f,i){var g=i||{};var h=g.headers;if(c.isHidden()){g.headers=(h)?new Headers(h):new Headers();g.headers.append(e,c.isHidden())}return a.call(this,f,g)}}b=true}},uninstall:function(){if(b){XMLHttpRequest.prototype.send=d;if(a){window.fetch=a}}b=false}}});require("atlassian/analytics/user-activity-xhr-header").install();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/atlassian-analytics.js' */
(function(d){var p=AJS.$.ajax;var k="atlassian-analytics";var i=typeof AJS.contextPath=="function"?AJS.contextPath():typeof AJS.Confluence!="undefined"?AJS.Confluence.getContextPath():window.contextPath!=null?window.contextPath:"";var o=null;var l=null;var f=null;var q="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(y){var x=Math.random()*16|0,w=y=="x"?x:(x&3|8);return w.toString(16)});var s=function(){var w="unknown";if(document.body.id=="jira"){w="jira"}else{if(document.body.id=="com-atlassian-confluence"){w="confluence"}}l=k+"."+w;f=l+".lock"};var e=function(){if(store.get(f)){return false}store.set(f,q);return(store.get(f)===q)};var t=function(){store.set(f,null)};var h=function(){var x=[],z,A,w,y;if(AJS.EventQueue.length==0){return}x=store.get(l)||x;for(w=0,y=AJS.EventQueue.length;w<y;++w){A=AJS.EventQueue[w];if(A.name){z={name:A.name,properties:A.properties,time:A.time||0};x.push(z)}}AJS.EventQueue.length=0;store.set(l,x)};var u=0;var a=function(w){return Math.min(5000*Math.pow(2,w),5*60*1000)};var g=function(){var z;function x(){setTimeout(g,a(u=0))}function w(){setTimeout(g,a(++u))}if(!e()){return x()}h();z=store.get(l);if(!z||!z.length){t();return x()}store.remove(l);t();if(!n(z)){return x()}var A=new Date().getTime();for(var y=0;y<z.length;y++){if(z[y].time>0){z[y].timeDelta=z[y].time-A}else{z[y].timeDelta=y-z.length}delete z[y].time}o=p({type:"POST",url:i+"/rest/analytics/1.0/publish/bulk",data:JSON.stringify(z),contentType:"application/json",dataType:"json"});o.fail(function(){AJS.EventQueue.concat(z);h();w()});o.done(function(){x()})};var n=function(y){for(var x=y.length-1;x>=0;x--){var A="";var z=y[x];var w=z.properties;if(typeof z.name==="undefined"){A="you must provide a name for the event."}else{if(typeof w!=="undefined"&&w!==null){if(w.constructor!==Object){A="properties must be an object with key value pairs."}else{b(w)}}}if(A!==""){AJS.log("WARN: Invalid analytics event detected and ignored, "+A+"\nEvent: "+JSON.stringify(z));y.splice(x,1)}}return y.length};var b=function(y){for(var x in y){if(y.hasOwnProperty(x)){var w=y[x];if(c(w)&&j(w)){}else{if(c(w)&&w.toString){y[x]=w.toString()}else{y[x]=""}}}}};function c(w){return typeof w!=="undefined"&&w!==null}function j(w){return typeof w==="number"||typeof w==="string"||typeof w==="boolean"}var m=function(){if(o&&!(o.state()==="resolved"||o.state()==="rejected")){o.abort()}};AJS.EventQueue=AJS.EventQueue||[];var r=Array.prototype.push;AJS.EventQueue.push=function(w){w.time=new Date().getTime();r.call(AJS.EventQueue,w)};AJS.toInit(function(){s();setTimeout(g,500);v()});d(window).unload(function(){m();h()});AJS.Analytics={triggerPrivacyPolicySafeEvent:function(w,x){AJS.log("WARN: 'triggerPrivacyPolicySafeEvent' has been deprecated");AJS.EventQueue.push({name:w,properties:x})}};AJS.bind("analytics",function(w,x){AJS.EventQueue.push({name:x.name,properties:x.data})});AJS.bind("analyticsEvent",function(w,x){AJS.EventQueue.push({name:x.name,properties:x.data})});var v=function(){if(window.location.pathname.indexOf("/secure/admin/ViewApplicationProperties")>-1){AJS.$("[data-property-id='analytics-enabled']").remove()}else{if(window.location.pathname.indexOf("/secure/admin/EditApplicationProperties")>-1){var x=AJS.$(":contains(Enable Atlassian analytics)");if(x.size()>0){var w=x[x.size()-2];if(w){w.remove()}}}}}}(AJS.$));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:application-header-administration-cog-resource', location = 'header/cog.js' */
var NavLinks=(function(a){a.ApplicationHeader=function(b){b.Cog=(function(){var c=function(){var d=AJS.$("#system-admin-menu-content");if(d.length>0){return d}var e=AJS.$("#admin-menu-link-content");if(e.length>0){return e}return AJS.$("#bamboo\\.global\\.header-admin\\.menu")};return{getDropdown:c}}());return b}(a.ApplicationHeader||{});return a}(NavLinks||{}));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts-resources', location = 'adminshortcuts/adminshortcuts.soy' */
// This file was automatically generated from adminshortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.adminshortcuts.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.adminshortcuts == 'undefined') { navlinks.templates.adminshortcuts = {}; }


navlinks.templates.adminshortcuts.section = function(opt_data, opt_ignored) {
  var param5 = '<ul class="aui-list-truncate">';
  var linkList7 = opt_data.links;
  var linkListLen7 = linkList7.length;
  for (var linkIndex7 = 0; linkIndex7 < linkListLen7; linkIndex7++) {
    var linkData7 = linkList7[linkIndex7];
    param5 += '<li><a href="' + soy.$$escapeHtml(linkData7.link) + '">' + soy.$$escapeHtml(linkData7.label) + '</a></li>';
  }
  param5 += '</ul>';
  var output = '' + aui.dropdown2.section({id: 'nl-remote-admin-section', label: "Autres applications", content: param5});
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.adminshortcuts.section.soyTemplateName = 'navlinks.templates.adminshortcuts.section';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts-resources', location = 'adminshortcuts/adminnavlinks.js' */
var NavLinks=(function(a){a.AdminShortcuts=(function(){var c=function(){return AJS.$.ajax({url:AJS.contextPath()+"/rest/menu/latest/admin",cache:false,dataType:"json"})};var b=function(){AJS.$("#nl-remote-admin-section").on("click","a",function(){NL.trackEvent("remoteAdminItemSelected",NL.getCurrentApplication(),$(this).attr("href"))})};return{render:function(){c().done(function(e){e=_.reject(e,function(f){return f.local===true});if(e.length){var d=navlinks.templates.adminshortcuts.section({links:e});a.ApplicationHeader.Cog.getDropdown().append(d);b()}})}}}());return a}(NavLinks||{}));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts', location = 'adminshortcuts/adminshortcuts-cdn.js' */
AJS.toInit(function(){if(AJS.DarkFeatures&&AJS.DarkFeatures.isEnabled("rotp.admin.shortcuts")){NavLinks.AdminShortcuts.render()}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.soy' */
// This file was automatically generated from projectshortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.projectshortcuts.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.projectshortcuts == 'undefined') { navlinks.templates.projectshortcuts = {}; }


navlinks.templates.projectshortcuts.dialogContent = function(opt_data, opt_ignored) {
  return '' + ((opt_data.localShortcuts && opt_data.localShortcuts.length > 0) ? navlinks.templates.projectshortcuts.dialogContentShortcuts({shortcuts: opt_data.localShortcuts, listClass: 'projectshortcut-links'}) : '') + ((opt_data.remoteShortcuts != null) ? (opt_data.remoteShortcuts.length > 0) ? '<h2 class="projectshortcuts-heading">Related Links</h2>' + navlinks.templates.projectshortcuts.dialogContentShortcuts(soy.$$augmentMap(opt_data.remoteShortcuts, {shortcuts: opt_data.remoteShortcuts, listClass: 'projectshortcut-links'})) : '' : navlinks.templates.projectshortcuts.dialogLoading(null));
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContent.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContent';
}


navlinks.templates.projectshortcuts.headingWrapper = function(opt_data, opt_ignored) {
  return '<div class="project-dialog-header-wrapper"><div class="project-header"><img class="project-img" src="' + soy.$$escapeHtml(opt_data.logoUrl) + '"><h2 class="dialog-title">' + soy.$$escapeHtml(opt_data.title) + '</h2></div><div class="project-content-wrapper">' + soy.$$filterNoAutoescape(opt_data.contentHtml) + '</div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.headingWrapper.soyTemplateName = 'navlinks.templates.projectshortcuts.headingWrapper';
}


navlinks.templates.projectshortcuts.dialogContentShortcuts = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  var output = '<ul' + ((opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '') + '>';
  var shortcutList35 = opt_data.shortcuts;
  var shortcutListLen35 = shortcutList35.length;
  for (var shortcutIndex35 = 0; shortcutIndex35 < shortcutListLen35; shortcutIndex35++) {
    var shortcutData35 = shortcutList35[shortcutIndex35];
    output += '<li' + ((shortcutIndex35 == shortcutListLen35 - 1) ? ' class="last"' : '') + '>' + navlinks.templates.projectshortcuts.dialogContentShortcut(shortcutData35) + '</li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContentShortcuts.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContentShortcuts';
}


navlinks.templates.projectshortcuts.dialogContentShortcut = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml(opt_data.link) + '"' + ((opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.label) + '</a>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogContentShortcut.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContentShortcut';
}


navlinks.templates.projectshortcuts.dialogLoading = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '<div class="projectshortcuts-loading">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.projectshortcuts.dialogLoading.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogLoading';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.js' */
(function(e,g){var i,k={},m="key",b="name",j="entity-type";function f(s){var n=e(this),o=n.data(m),q=n.data(b),p=n.data(j);if(typeof o==="undefined"){return}s.preventDefault();i=new AJS.Dialog({width:600,keypressListener:function(u){if(u.which==jQuery.ui.keyCode.ESCAPE){i.remove()}},id:"project-shortcuts-dialog"}).addCancel("Close",function(){i.remove()}).addPanel("",navlinks.templates.projectshortcuts.headingWrapper({title:q,logoUrl:h(),contentHtml:navlinks.templates.projectshortcuts.dialogLoading({text:"Retrieving links"})})).show();c(i);if(!k[o]){k[o]={entity:{title:q},localShortcuts:null,remoteShortcuts:null};d(AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+o,{entityType:p}).done(t);d(AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+o,{entityType:p}).done(r).fail(function(){var u=i.getCurrentPanel().body.find(".project-content-wrapper");u.find(".projectshortcuts-loading").remove();AJS.messages.error(u,{body:"Impossible de r\u00e9cup\u00e9rer les raccourcis des projets distants",closeable:false});c(i)})}else{l(k[o])}function t(u){k[o].localShortcuts=u.shortcuts;l(k[o])}function r(u){k[o].remoteShortcuts=u.shortcuts;l(k[o])}}function h(){return e(".project-shortcut-dialog-trigger img").attr("src")}function l(n){if(n.localShortcuts){i.getCurrentPanel().html(navlinks.templates.projectshortcuts.headingWrapper({title:n.entity.title,logoUrl:h(),contentHtml:navlinks.templates.projectshortcuts.dialogContent(n)}));c(i)}}function a(p){var o=210;if(!p||p.length<=o){return p}var n=o;while(n>0&&p.charAt(n)!=" "){n--}if(n==0){n=o}p=p.substring(0,n);if(p.length>=n){p=p+"..."}return p}function c(n){var q=n.popup.element,p=q.find(".dialog-panel-body"),o=q.find(".dialog-components");p.height("auto");q.height(o.outerHeight()-1);e(".aui-shadow").remove()}function d(n,o){return e.ajax({url:n,cache:false,data:o,dataType:"json"})}e(document).on("click",".project-shortcut-dialog-trigger",f)}(jQuery,window.NL=(window.NL||{})));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:atlassian-ui-popup-display-controller', location = 'popups/DisplayController.js' */
AJS.Popups=AJS.Popups||{};AJS.Popups.DisplayController=function(){var c=[];var a=false;var b=false;AJS.toInit(function(){setTimeout(function(){AJS.Popups.DisplayController.render()},0)});return{request:function(d){c.push(d);if(a&&b===false){this.render()}},render:function(){c.sort(function(e,d){return e.weight-d.weight});a=true;if(c.length!==0){b=true;c[0].show()}}}}();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:jira-issues-view-mode-resources', location = 'jira/jira-issues-view-mode/main.js' */
require(["ajs","jquery"],function(b,d){var a="wr!confluence.extra.jira:jira-issues-view-mode-async-resource";var c=function(){var e=d(".wiki-content [data-jira-key][data-client-id]");if(e.length==0){return false}WRM.require(a,function(){require(["confluence/jim/jira/jira-issues-view-mode/lazy-loading","confluence/jim/jira/jira-issues-view-mode/fix-ui"],function(g,f){g.init(e).done(function(){f.fixBreakIconInOldConf()})})})};b.toInit(c);b.bind("ic-jim-async-supported",c)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:amd-support', location = 'amd/confluence-shim.js' */
define("confluence/jim/confluence-shim",function(){return window.Confluence});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:amd-support', location = 'amd/amd-exporter.js' */
define("confluence/jim/amd/module-exporter",[],function(){var a={};a.namespace=function(e,f,d){var g=e.split(".");d=d||window;for(var c=0,h=g.length-1;c<h;c++){var b=d[g[c]];d=(b!=null)?b:d[g[c]]={}}if(d[g[c]]){if(window.console&&window.console.warn){window.console.warn('Value of "'+e+'" was overridden')}}d[g[c]]=f||d[g[c]]||{};return d[g[c]]};a.safeRequire=function(c,b){if(define&&define.amd===undefined){var d=require(c);if(b){b(d)}}};a.exportModuleAsGlobal=function(c,d,b){a.safeRequire(c,function(e){a.namespace(d,e);if(b){b(e)}})};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:lodash-amd', location = 'applinks/internal/lib/lodash-amd-global.js' */
define("applinks/lib/lodash",function(){if(!window._){throw"lodash not found"}return window._});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/lib-version.js' */
define("applinks/lib/version",["applinks/lib/lodash"],function(c){function d(f,g){if(c.isUndefined(f)){return 0}else{if(typeof f!=="number"||isNaN(f)){throw new Error(g+": expected a number, was: <"+f+">")}else{return Math.floor(f)}}}function a(f,g){if(!f||!(f instanceof e)){throw new Error(g+": expected a Version object, was: <"+f+">")}return f}function b(f,g){return f>g?1:f==g?0:-1}function e(g,h,f){this.major=d(g,"major");this.minor=d(h,"minor");this.bugfix=d(f,"bugfix")}e.parse=function(g,h){h=h||"versionString";if(!g){throw new Error(h+": expected a non-empty string")}var f=g.split(".");if(f.length!==3){throw new Error(h+": expected <major>.<minor>.<bugfix> string, was: <"+g+">")}return new e(parseInt(f[0]),parseInt(f[1]),parseInt(f[2]))};e.comparator=function(g,f){return a(g,"versionOne").compareTo(a(f,"versionTwo"))};e.prototype.compareTo=function(h){a(h,"that");var f=b(this.major,h.major);if(f!=0){return f}var g=b(this.minor,h.minor);if(g!=0){return g}return b(this.bugfix,h.bugfix)};e.prototype.greaterThan=function(f){return this.compareTo(f)>0};e.prototype.greaterThanOrEqual=function(f){return this.compareTo(f)>=0};e.prototype.lessThan=function(f){return this.compareTo(f)<0};e.prototype.lessThanOrEqual=function(f){return this.compareTo(f)<=0};e.prototype.equals=function(f){return this.compareTo(f)==0};e.prototype.toMinor=function(){return new e(this.major,this.minor)};e.prototype.toMajor=function(){return new e(this.major)};e.prototype.toString=function(){return this.major+"."+this.minor+"."+this.bugfix};return e});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/aui-version-details.js' */
define("applinks/lib/aui-version-details",["applinks/lib/version"],function(g){var d=new g(5,8,15);var f=new g(5,9,13);var e=new g(5,8);var c=new g(5,9);function a(h){if(h.lessThan(d)){throw new Error("AUI version "+h+" is too low, you need to upgrade AUI to "+d+" or "+f+" for Applinks to work")}if(h.greaterThanOrEqual(c)&&h.lessThan(f)){throw new Error("AUI version "+h+" is too low, you need to upgrade AUI to "+f+" for Applinks to work")}}function b(h){var i=g.parse(h.version,"AUI version");a(i);h.versionDetails=i;h.versionDetails.is58=i.toMinor().equals(e);h.versionDetails.is59=i.toMinor().equals(c);return h}return{addVersionDetails:b}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/console-amd.js' */
define("applinks/lib/console",function(){return window.console});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/jquery-amd.js' */
define("applinks/lib/jquery",function(){return window.jQuery});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/aui-amd.js' */
define("applinks/lib/aui",["applinks/lib/window","applinks/lib/aui-version-details"],function(b,c){var a=b.AJS;if(!a){throw new Error("window.AJS not defined, cannot load AUI")}return c.addVersionDetails(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/wrm-amd.js' */
define("applinks/lib/wrm",function(){return window.WRM});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/skate-amd.js' */
define("applinks/lib/skate",function(){return window.skate});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-lib', location = 'applinks/internal/lib/window-amd.js' */
define("applinks/lib/window",function(){return window});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/docs.js' */
define("applinks/common/docs",["applinks/lib/jquery","applinks/lib/aui","applinks/common/help-paths"],function(c,b,a){return{createDocLink:function(d,f,e){if(!e){e=""}else{e=" "+e}return c("<a/>",{"class":"ual-help-link help-link"+e,href:this.getDocHref(d,f),target:"_blank","data-help-link-key":d,text:"Aide",title:"Aide"})},getDocHref:function(e,f){var d=a.getFullPath(e);if(f){d+="#"+a.getPath(f)}return d}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/help-paths.js' */
define("applinks/common/help-paths",["applinks/lib/console","applinks/lib/wrm","applinks/lib/lodash","applinks/common/modules","applinks/common/preconditions"],function(b,a,g,e,d){var f=g.memoize(function(){var j=a.data.claim(e.dataFqn(e.COMMON_EXPORTED,"applinks-help-paths"));if(!j.entries){b.warn("Help paths not found, all help links are likely to be broken.")}return j.entries||{}});var i=function(j,m){d.nonEmptyString(j,"key");var l=f()[j]||j;if(m){d.nonEmptyString(m,"sectionKey");var k=l.replace(/\+/g,"");l+="#"+k+"-"+m}return l};function c(j,k){return j.indexOf(k,j.length-k.length)!==-1}function h(j,k){return c(j,k)?j:j+k}return{getPath:i,getFullPath:function(j,l){var k=this.baseUrl();return h(k,"/")+this.getPath(j,l)},baseUrl:g.partial(i,"applinks.docs.root")}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/events.js' */
define("applinks/common/events",["applinks/lib/jquery","applinks/lib/lodash","applinks/lib/window","applinks/common/preconditions"],function(e,b,d,f){var c="applinks.event.";function a(g){return c+f.nonEmptyString(g,"eventId")}return{PREREADY:a("preready"),READY:a("ready"),APPLINKS_LOADED:a("loaded"),APPLINKS_UPDATED:a("updated"),NEW_APPLINK_CREATED:a("created"),ORPHANED_UPGRADE:a("orphaned.upgrade"),V3_ONBOARDING_FINISHED:a("v3-onboarding-finished"),Legacy:{MESSAGE_BOX_DISPLAYED:a("message-box-displayed")},applinksEvent:a,on:function(h,i,g){var j=g?b.bind(i,g):i;e(d.document).on(h,j)},off:function(g,h){e(d.document).off(g,h)},trigger:function(g,h){e(d.document).trigger(g,h)}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/i18n.js' */
define("applinks/common/i18n",["applinks/lib/lodash","applinks/lib/jquery","applinks/lib/wrm","applinks/common/modules","applinks/common/preconditions","applinks/common/products"],function(e,g,c,f,h,b){var a=e.memoize(function(){var i=c.data.claim(f.dataFqn(f.COMMON_EXPORTED,"entity-types"));return h.hasValue(i,"entity-types","Entity Types data not found")});var d=e.memoize(function(){var i=c.data.claim(f.dataFqn(f.COMMON_EXPORTED,"authentication-types"));return h.hasValue(i,"authentication-types","Authentication Types data not found")});return{getApplicationTypeName:function(i){return b.getTypeName(i)},getEntityTypeName:function(i){return a().singular[i]||i},getPluralizedEntityTypeName:function(i){return a().plural[i]||i},getAuthenticationTypeName:function(i){return d()[i]||i}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/modules.js' */
define("applinks/common/modules",function(){return{PLUGIN_KEY:"com.atlassian.applinks.applinks-plugin",COMMON_EXPORTED:"applinks-common-exported",COMMON:"applinks-common",fqn:function(a){return this.PLUGIN_KEY+":"+a},dataFqn:function(a,b){return this.fqn(a)+"."+b}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/preconditions.js' */
define("applinks/common/preconditions",["applinks/lib/lodash"],function(c){function f(i,j,h){return d(c.isString(i)&&!c.isEmpty(i),h,b(j,": expected a non-empty string, was: <"+i+">"),i)}function g(i,j,h){return d(c.isFunction(i),h,b(j,": expected a function, was: "+i),i)}function a(i,j,h){return d(c.isArray(i),h,b(j,": expected an array, was: "+i),i)}function e(i,j,h){return d(i,h,b(j,": expected a value"),i)}function d(l,i,h,k){var j=i?i:h;if(!l){throw new Error(j)}return k||l}function b(i,h){return(i||"[unspecified]")+h}return{checkArgument:c.partial(d,c,c,"",c),nonEmptyString:f,isArray:a,isFunction:g,hasValue:e}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-common-exported', location = 'applinks/internal/common/products.js' */
define("applinks/common/products",["applinks/lib/lodash","applinks/lib/wrm","applinks/common/modules","applinks/common/preconditions"],function(c,b,d,f){var a=c.memoize(function(){var g=b.data.claim(d.dataFqn(d.COMMON_EXPORTED,"applinks-types"));return f.hasValue(g,"types","Application Types data not found")});function e(g){return a()[g]||g}return{BAMBOO:"bamboo",BITBUCKET:"stash",CONFLUENCE:"confluence",FECRU:"fecru",JIRA:"jira",REFAPP:"refapp",STASH:"stash",getTypeName:e}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'applinks/internal/non-amd/rest-service.js' */
(function(a,c,b){AppLinks=AJS.$.extend(window.AppLinks||{},{Event:{NAMESPACE:"applinks"},I18n:a,Docs:c});AppLinks.Event=AJS.$.extend(window.AppLinks.Event,b);if(AJS.AppLinksInitialisationBinder){AppLinks.initialisationBinder=AJS.AppLinksInitialisationBinder}else{AppLinks.initialisationBinder=function(d){AJS.toInit(d)}}AppLinks.initialisationBinder(function(){var d=AJS.$;AppLinks=d.extend(window.AppLinks||{},{failure:function(g){if(g.status==401){window.location.reload()}else{var e=AppLinks.parseError(g);var f=d(".page-error");if(f.length>0){f.html(e).fadeIn("slow")}else{alert("REST request failed: "+e)}}},jsonRequest:function(f,g,h,i,e){if(h){h=JSON.stringify(h)}d(".page-error").fadeOut("fast");if(!e){e=AppLinks.failure}return jQuery.ajax({url:f,type:g,data:h,dataType:"json",contentType:"application/json; charset=utf-8",cache:false,success:i,error:e})},xmlRequest:function(f,g,h,i,e){if(h){h=JSON.stringify(h)}d(".page-error").fadeOut("fast");if(!e){e=AppLinks.failure}return jQuery.ajax({url:f,type:g,data:h,dataType:"xml",contentType:"application/xml; charset=utf-8",cache:false,success:i,error:e})},parseError:function(h){var f;try{f=JSON.parse(h.responseText)}catch(g){if(h.statusText){return f=h.statusText}else{return h}}if(f.message){if(d.isArray(f.message)){return f.message.join(" ")}return f.message}else{return h.statusText}},put:function(f,g,h,e){return AppLinks.jsonRequest(f,"PUT",g,h,e)},post:function(f,g,h,e){return AppLinks.jsonRequest(f,"POST",g,h,e)},update:function(f,g,e){AppLinks.put(AppLinks.self_link(f),f,g,e)},get:function(f,g,e){return AppLinks.jsonRequest(f,"GET",null,g,e)},getXml:function(f,g,e){return AppLinks.xmlRequest(f,"GET",null,g,e)},self_link:function(g){for(var e=0,h=g.link.length;e<h;e++){var f=g.link[e];if(f.rel=="self"){return f.href}}throw"No self-link found"},del:function(h,g,f){var e;if(typeof(h)=="string"){e=h}else{e=AppLinks.self_link(h)}return AppLinks.jsonRequest(e,"DELETE",null,g,f)},SPI:d.extend({},{API_VERSION:"1.0",REST_RESOURCE_URL:AJS.contextPath()+"/rest/applinks/",BASE_URL:AJS.contextPath()+"/rest/applinks/1.0",OAUTH_REST_RESOURCE_URL:AJS.contextPath()+"/rest/applinks-oauth/",OAUTH_BASE_URL:AJS.contextPath()+"/rest/applinks-oauth/1.0",setApiVersion:function(e){AppLinks.SPI.API_VERSION=e;AppLinks.SPI.setBaseUrl(AppLinks.SPI.REST_RESOURCE_URL+AppLinks.SPI.API_VERSION)},setBaseUrl:function(e){AppLinks.SPI.BASE_URL=e},setOAuthBaseUrl:function(e){AppLinks.SPI.OAUTH_BASE_URL=e},getRemoteRestBaseUrl:function(e){return e+"/rest/applinks/"+AppLinks.SPI.API_VERSION},getRemotePluginServletBaseUrl:function(e){return e+"/plugins/servlet"},getAllLinks:function(g,f){var e=AppLinks.SPI.BASE_URL+"/applicationlink";return AppLinks.get(e,g,f)},getAllLinksWithAuthInfo:function(g,f){var e=AppLinks.SPI.BASE_URL+"/listApplicationlinks";return AppLinks.get(e,g,f)},getApplicationLinkState:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/listApplicationlinkstates/id/"+h;return AppLinks.get(e,g,f)},getLinksOfType:function(g,h,f){var e=AppLinks.SPI.BASE_URL+"/applicationlink/type/"+g;return AppLinks.get(e,h,f)},tryToFetchManifest:function(g,h,f){var e=AppLinks.SPI.BASE_URL+"/applicationlinkForm/manifest.json?url="+encodeURIComponent(g);return AppLinks.get(e,h,f)},getManifestFor:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/manifest/"+h+".json";return AppLinks.get(e,g,f)},getLocalManifest:function(g,f){var e=AppLinks.SPI.BASE_URL+"/manifest.json";return AppLinks.get(e,g,f)},getRemoteManifest:function(g,h,f){var e=AppLinks.SPI.getRemoteRestBaseUrl(g)+"/manifest.json";return AppLinks.get(e,h,f)},getRemoteOAuthConsumerInfo:function(g,h,f){var e=AppLinks.SPI.getRemotePluginServletBaseUrl(g)+"/oauth/consumer-info";return AppLinks.getXml(e,h,f)},getApplinkStatus:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/status/"+h;return AppLinks.get(e,g,f)},createStaticUrlAppLink:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createStaticUrlAppLink?typeId="+h;return AppLinks.post(e,null,g,f)},createLink:function(l,j,n,f,k,m,h,o,g){var e=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createAppLink";var i={applicationLink:l,username:j,password:n,createTwoWayLink:f,customRpcURL:k,rpcUrl:m,configFormValues:h};return AppLinks.post(e,i,o,g)},createLinkWithOrphanedTrust:function(l,j,o,f,k,m,h,n,p,g){var e=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createAppLink";var i={applicationLink:l,username:j,password:o,createTwoWayLink:f,customRpcURL:k,rpcUrl:m,configFormValues:h,orphanedTrust:n};return AppLinks.post(e,i,p,g)},verifyTwoWayLinkDetails:function(e,k,l,h,j,g){var f=AppLinks.SPI.BASE_URL+"/applicationlinkForm/details";var i={username:l,password:h,remoteUrl:e,rpcUrl:k};return AppLinks.post(f,i,j,g)},getApplicationLinkInfo:function(g,h,f){var e=AppLinks.SPI.BASE_URL+"/applicationlinkInfo/id/"+g;return AppLinks.get(e,h,f)},deleteLink:function(i,e,h,g){var f=AppLinks.SPI.BASE_URL+"/applicationlink/"+i.id;if(e){f+="?reciprocate=true"}return AppLinks.del(f,h,g)},makePrimary:function(g,f){var e=AppLinks.SPI.BASE_URL+"/applicationlink/primary/"+g.id;return AppLinks.post(e,null,f)},relocate:function(j,h,e,i,g){var f=AppLinks.SPI.BASE_URL+"/relocateApplicationlink/"+j.id+"?newUrl="+encodeURIComponent(h)+"&nowarning="+(e?"true":"false");return AppLinks.post(f,null,i,g)},legacyUpgrade:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/upgrade/legacy/"+h.id;return AppLinks.post(e,null,g,f)},ualUpgrade:function(i,e,h,g){var f=AppLinks.SPI.BASE_URL+"/upgrade/ual/"+i.id;return AppLinks.post(f,e,h,g)},getEntityTypesForApplicationType:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/type/entity/"+h;return AppLinks.get(e,g,f)},getLocalEntitiesWithLinksToApplication:function(e,h,g){var f=AppLinks.SPI.BASE_URL+"/entitylink/localEntitiesWithLinksTo/"+e+".json";return AppLinks.get(f,h,g)},getEntityLinksForApplication:function(e,h,g){var f=AppLinks.SPI.BASE_URL+"/entities/"+e+".json";AppLinks.get(f,h,g)},getEntityLinksForApplicationUsingAnonymousAccess:function(e,h,g){var f=AppLinks.SPI.BASE_URL+"/entities/anonymous/"+e+".json";return AppLinks.get(f,h,g)},createNonUalEntityLink:function(n,i,f,h,l,g,m,k){var e=AppLinks.SPI.BASE_URL+"/entitylink/"+n+"/"+i+"?reciprocate=false";var j={applicationId:f,typeId:h,key:l,name:g,isPrimary:false};return AppLinks.put(e,j,m,k)},createEntityLink:function(j,i,f,e,k,h){var g=AppLinks.SPI.BASE_URL+"/entitylink/"+j+"/"+i+"?reciprocate=";g+=(e?"true":"false");return AppLinks.put(g,f,k,h)},getConfiguredEntityLinks:function(h,g,i,f){var e=AppLinks.SPI.BASE_URL+"/entitylink/primaryLinks/"+h+"/"+g+".json";return AppLinks.get(e,i,f)},deleteEntityLink:function(j,i,f,e,k,h){var g=AppLinks.SPI.BASE_URL+"/entitylink/"+j+"/"+i+"?typeId="+f.typeId+"&key="+f.key+"&applicationId="+f.applicationId+"&reciprocate="+e;return AppLinks.del(g,k,h)},makePrimaryEntityLink:function(i,h,e,j,g){var f=AppLinks.SPI.BASE_URL+"/entitylink/primary/"+i+"/"+h+"?typeId="+e.typeId+"&key="+e.key+"&applicationId="+e.applicationId;return AppLinks.post(f,null,j,g)},canDeleteAppLink:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/permission/reciprocate-application-delete/"+h;return AppLinks.get(e,g,f)},canDeleteEntityLink:function(i,h,e,j,g){var f=AppLinks.SPI.BASE_URL+"/permission/reciprocate-entity-delete/"+e.applicationId+"/"+i+"/"+h+"/"+e.typeId+"/"+e.key;return AppLinks.get(f,j,g)},canCreateReciprocateEntityLink:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/permission/reciprocate-entity-create/"+h;return AppLinks.get(e,g,f)},processPermissionCode:function(f){var e={noPermission:function(){},missing:function(){},credentialsRequired:function(g){},authenticationFailed:function(g){},noAuthentication:function(g){},noAuthenticationConfigured:function(){},noConnection:function(){},allowed:function(){},unrecognisedCode:function(g){},updateView:function(i,h,g){}};if(!f){f={}}f=d.extend(e,f);return function(h){var g=h.code;if(g=="NO_PERMISSION"){f.noPermission()}else{if(g=="MISSING"){f.missing()}else{if(g=="CREDENTIALS_REQUIRED"){f.credentialsRequired(h.url)}else{if(g=="AUTHENTICATION_FAILED"){f.authenticationFailed(h.url)}else{if(g=="NO_AUTHENTICATION"){f.noAuthentication(h.url)}else{if(g=="NO_AUTHENTICATION_CONFIGURED"){f.noAuthenticationConfigured()}else{if(g=="NO_CONNECTION"){f.noConnection()}else{if(g=="ALLOWED"){f.allowed()}else{f.unrecognisedCode(h.code)}}}}}}}}}},addAuthenticationTrigger:function(g,e,f){if(!f){f={}}if(typeof f.onSuccess=="undefined"){f.onSuccess=function(){location.reload()}}if(typeof f.onFailure=="undefined"){f.onFailure=function(){return true}}d(g).unbind("click");d(g).click(function(){if(f.before){f.before()}AppLinks.authenticateRemoteCredentials(e,f.onSuccess,f.onFailure)})},deleteOrphanedTrust:function(i,g,h,f){var e=AppLinks.SPI.BASE_URL+"/orphaned-trust/"+g+"/"+i;return AppLinks.del(e,h,f)},getOrphanedTrust:function(g,f){var e=AppLinks.SPI.BASE_URL+"/orphaned-trust/";return AppLinks.get(e,g,f)},showCreateEntityLinkSuggestion:function(){return true},getApplicationLink:function(h,g,f){var e=AppLinks.SPI.BASE_URL+"/applicationlink/"+h;return AppLinks.get(e,g,f)},createApplicationLink:function(h,f,k,l,e,m,i){var g=AppLinks.SPI.BASE_URL+"/applicationlink";var j={id:h,name:f,rpcUrl:k,displayUrl:l,typeId:e};return AppLinks.put(g,j,m,i)},createConsumer:function(g,p,f,o,k,n,i,r,j,m,q,h){var e=AppLinks.SPI.OAUTH_BASE_URL+"/applicationlink/"+g+"/authentication/consumer";var l={key:p,name:f,description:o,sharedSecret:k,publicKey:n,outgoing:m,twoLOAllowed:i,executingTwoLOUser:r,twoLOImpersonationAllowed:j};return AppLinks.put(e,l,q,h)},createConsumerAutoConfigure:function(l,k,h,e,j,g){var f=AppLinks.SPI.OAUTH_BASE_URL+"/applicationlink/"+l+"/authentication/consumer?autoConfigure=true";var i={twoLOAllowed:k,executingTwoLOUser:h,twoLOImpersonationAllowed:e};return AppLinks.put(f,i,j,g)},registerProvider:function(k,j,g,i,f){var e=AppLinks.SPI.BASE_URL+"/applicationlink/"+k+"/authentication/provider";var h={config:g,provider:j};return AppLinks.put(e,h,i,f)},enableFeature:function(g,h,f){var e=AppLinks.SPI.BASE_URL+"/features/"+g;return AppLinks.put(e,{},h,f)},disableFeature:function(g,h,f){var e=AppLinks.SPI.BASE_URL+"/features/"+g;return AppLinks.del(e,h,f)}},(window.AppLinks&&window.AppLinks.SPI)||{})});AppLinks.UI={showInfoBox:function(e){d(".aui-message.success").remove();AppLinks.UI.createMessage("success",e,"page-info")},hideInfoBox:function(){d(".aui-message.success").remove()},showErrorBox:function(e){AppLinks.UI.createMessage("error",e,"page-error")},hideErrorBox:function(){d(".aui-message.error").remove()},showWarningBox:function(f){if(d.isArray(f)&&f.length>0){var e=d("<ul></ul>");d(f).each(function(h){e.append(d("<li/>",{text:f[h]}))});var g=d('<div class="page-warning"></div>').append(e);AppLinks.UI.createMessage("warning",g.html(),"page-warning")}else{AppLinks.UI.createMessage("warning",f,"page-warning")}},hideWarningBox:function(){d(".aui-message.warning").remove()},shortenString:function(f,e){if(f.length>e){f=f.substring(0,e)+"..."}return f},createMessage:function(f,g,e){var h=d('<div class="'+e+'">');h.html(g);AJS.messages[f](".applinks-message-bar",{title:"",body:h.wrap("<div></div>").parent().html(),closeable:true});d(document).trigger(AppLinks.Event.Legacy.MESSAGE_BOX_DISPLAYED)},displayValidationErrorMessages:function(e,g,f){if(d.isArray(f)){d(f).each(function(k,j){var l=d('<div class="error applinks-error">');l.text(j);d(g).find("."+e).append(l)})}else{if(typeof f!="undefined"){var h=d('<div class="error applinks-error">');h.text(f.toString());d(g).find("."+e).append(h)}}},displayValidationError:function(e,f,g){return function(l){if(l.status==401){window.location.reload();return}d(".applinks-error").remove();d(".loading").remove();var j=l.responseText;var k=d.parseJSON(j);var i=k.message;if(typeof k.fields=="undefined"){AppLinks.UI.displayValidationErrorMessages(e,f,i)}else{var h=k.fields;d(h).each(function(m){var n=d('<div class="error applinks-error" id="'+h[m]+'-error">');n.text(i[m]);if(d(f).find("."+h[m]).length>0){n.insertAfter(d(f).find("."+h[m]))}else{n.insertAfter(d(f).find("."+e).append(n))}})}d(f).find("."+e).addClass("fully-populated-errors");if(g){g()}}},addProtocolToURL:function(e){var h=d.trim(e);var g=h.toLowerCase();var f=false;if(g.length>=7){if(g.substring(0,7).indexOf("http")!=-1){f=true}}if(!f){h="http://"+h}return h},prettyJoin:function(f,i,h){if(!h){h="et"}var e=f.length;var g="";d.each(f,function(j,k){if(j==(e-1)&&e>1){g+=" "+h+"  "+i(k)}else{g+=i(k);if(j+2<e){g+=", "}}});return g},showLoadingIcon:function(e){d('<span class="loading">&nbsp;</span>').insertAfter(e)},hideLoadingIcon:function(e){d(e).next(".loading").remove()},findUrl:function(h){var g=undefined;var i=h.toLowerCase();var f=i.indexOf("http:");if(f==-1){f=i.indexOf("https:")}if(f>-1){var e=i.indexOf(" ",f);if(e==-1){e=i.length}g=h.substring(f,e)}return g},findApplicationType:function(e){e=e.toLowerCase();if(e.indexOf("jira")!=-1){return"jira"}else{if(e.indexOf("fisheye")!=-1){return"fecru"}else{if(e.indexOf("confluence")!=-1){return"confluence"}else{if(e.indexOf("refapp")!=-1){return"refapp"}else{return undefined}}}}},escapeSelector:function(e){return e.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")},sanitiseHTML:function(e){var f={"<":"&lt;",'"':"&quot;","&":"&amp;"};return e.replace(/[<"&]/g,function(g){return f[g]})},refreshOrphanedTrust:function(){var e=function(f){d("tr.orphaned-trust-row").each(function(){var l=d(this);var m=l.attr("data-id");var j=l.attr("data-type");var h=false;for(var g=0;g<f.orphanedTrust.length;g++){var k=f.orphanedTrust[g];if(m==k.id&&j==k.type){h=true;break}}if(!h){l.remove();if(f.orphanedTrust.length==0){d(".orphaned-trust-warning").hide()}}})};AppLinks.SPI.getOrphanedTrust(e)},removeCssClass:function(e,f){d(e).removeClass(function(h,j){var i=j.split(" ");var g="";d.each(i,function(k,l){if(l.indexOf(f)!=-1){g=l}});return g})}};(function(){var e=d({});d.each(["bind","unbind","trigger"],function(f,g){AppLinks.UI[g]=function(){return e[g].apply(e,arguments)}})})();d(document).trigger(AppLinks.Event.PREREADY);d(document).trigger(AppLinks.Event.READY)})})(require("applinks/common/i18n"),require("applinks/common/docs"),require("applinks/common/events"));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'applinks/internal/non-amd/autocomplete.js' */
AJS.$(document).bind(AppLinks.Event.READY,function(){AppLinks.autoComplete={cacheManager:function(c){var a={},b=[],c=c||30;return{get:function(d){return a[d]},put:function(d,e){a[d]=e;b.push(d);if(b.length>c){delete a[b.shift()]}},clear:function(){a={};b=[]}}}};(function(d){var c=function(f){AJS.log("InputDrivenDropDown: truncating text");var h=f.$.closest(".aui-dropdown").width(),g=20;d("a span:not(.icon)",f.$).each(function(){var j=d(this),i=AJS("var","&#8230;"),l=i.width(),k=false;j.wrapInner(d("<em>"));d("em",j).each(function(){var m=d(this);m.show();if(this.offsetLeft+this.offsetWidth>h){var t=this.childNodes,s=false;for(var o=t.length-1;o>=0;o--){var p=t[o],n=1,r=(p.nodeType==3)?"nodeValue":"innerHTML",q=p[r];do{if(n<=q.length){p[r]=q.substr(0,q.length-n++)}else{break}}while(this.offsetLeft+this.offsetWidth+l>h-g);if(n<=q.length){s=true;break}}if(s){k=true}else{m.hide()}}});if(k){j.append(i);this.elpss=i}})};var b=function(f,l){if(!l.length||!l[0]){return}AJS.log("InputDrivenDropDown: highlighting tokens");for(var h=0,j=l.length;h<j;h++){var g=l[h];l[h]=g?g.replace(/[\.\*\+\?\|\(\)\[\]{}\\]/g,"\\$"):""}var k=new RegExp("("+l.join("|")+")","gi");d("li a:not(.dropdown-prevent-highlight) span",f.$).each(function(){var m=d(this),i=m.html().replace(k,"<strong>$1</strong>");m.html(i)})};var e=function(j,g){var i=j.options,h=j.dd;if(h){h.hide();h.$.remove()}i.ajsDropDownOptions=i.ajsDropDownOptions||{};if(i.ajsDropDownOptions&&!i.ajsDropDownOptions.alignment){i.ajsDropDownOptions.alignment="left"}i.ajsDropDownOptions.selectionHandler=i.ajsDropDownOptions.selectionHandler||function(l,k){if(l.type!="click"){l.preventDefault();d("a",k).click();document.location=d("a",k).attr("href")}};i.ajsDropDownOptions.displayHandler=function(k){return AJS.escapeHtml(k.name)};var f=j.dd=new AJS.dropDown(g.matrix,i.ajsDropDownOptions)[0];if(i.ajsDropDownOptions&&i.ajsDropDownOptions.className){f.$.addClass(i.ajsDropDownOptions.className)}if(i.dropdownPlacement){i.dropdownPlacement(f.$)}else{AJS.log("No dropdownPlacement function specified. Appending dropdown to the body.");d("body").append(f.$)}b(f,g.queryTokens||[g.query]);c(f);if(i.dropdownPostprocess){i.dropdownPostprocess(f.$)}f.show(j._effect);if(typeof i.onShow=="function"){i.onShow.call(f,f.$)}return f};function a(g,f){this._effect="appear";this._timer=null;this.id=g;this.options=f;this.inactive=false;this.busy=false;this.cacheManager=AppLinks.autoComplete.cacheManager()}a.prototype.clearCache=function(){this.cacheManager.clear()};a.prototype.change=function(h,g){var f=this;if(h!=f._value||g){f._value=h;f.busy=false;clearTimeout(f._timer);if(g||(/\S{0,}/).test(h)){var i=f.cacheManager.get(h);if(i){e(f,i)}else{f.busy=true;f._timer=setTimeout(function(){f.options.getDataAndRunCallback.call(f,h,f.show)},200)}}else{f.dd&&f.dd.hide()}}};a.prototype.dropDownLength=function(){return this.dd.links?this.dd.links.length:0};a.prototype.dropDownItem=function(f){return this.dropDownLength()>f?this.dd.links[f]:null};a.prototype.hide=function(){this.dd&&this.dd.hide()};a.prototype.remove=function(){var f=this.dd;if(f){this.hide();f.$.remove()}this.inactive=true;this.options.onDeath&&this.options.onDeath()};a.prototype.show=function(g,i,h){if(this.inactive){AJS.log("Quick search abandoned before server response received, ignoring. "+this);return}var f={matrix:g,query:i,queryTokens:h};this.cacheManager.put(i,f);e(this,f);this.busy=false};AppLinks.inputDrivenDropdown=function(f){return new a("inputdriven-dropdown",f)}})(jQuery)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/fecru-compatibility.js' */
if(jQuery!=undefined&&AJS!=undefined){jQuery=AJS.$};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:feature-oauth-dance', location = 'applinks/internal/feature/oauth/oauth-callback.js' */
define("applinks/feature/oauth-callback",["applinks/lib/window","applinks/lib/lodash","applinks/common/preconditions"],function(c,a,d){function b(e){d.nonEmptyString(e,"url");this._url=e}b.prototype.source=function(e){d.hasValue(e,"source");this._source=e;return this};b.prototype.onSuccess=function(e){d.isFunction(e,"onSuccess");this._onSuccess=e;return this};b.prototype.onFailure=function(e){d.isFunction(e,"onFailure");this._onFailure=e;return this};b.prototype.success=function(){this.oauthWindow.close();if(this._onSuccess){this._onSuccess(this._source)}delete c.oauthCallback};b.prototype.failure=function(){this.oauthWindow.close();if(this._onFailure){this._onFailure(this._source)}delete c.oauthCallback};b.prototype.open=function(){c.oauthCallback=this;this.oauthWindow=c.open(this._url,"com_atlassian_applinks_authentication")};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:feature-oauth-dance', location = 'applinks/internal/feature/oauth/oauth-dance.js' */
define("applinks/feature/oauth-dance",["applinks/lib/console","applinks/lib/jquery","applinks/lib/lodash","applinks/lib/window","applinks/common/events","applinks/common/preconditions","applinks/feature/oauth-callback"],function(a,f,c,e,b,h,d){function g(j,i){this._scope=j||e.document;this._selector=i}g.prototype.onSuccess=function(i){h.isFunction(i,"onSuccess");this._onSuccess=i;return this};g.prototype.onFailure=function(i){h.isFunction(i,"onFailure");this._onFailure=i;return this};g.prototype.defaultSuccess=function(){return this.onSuccess(function(){e.location.reload()})};g.prototype.defaultFailure=function(){return this.onFailure(function(){return true})};g.prototype.initialize=function(){var i=this;if(this._selector){f(this._scope).on("click",this._selector,function(j){j.preventDefault();i._open(f(this))})}else{f(this._scope).on("click",function(j){j.preventDefault();i._open(f(this))})}};g.prototype.start=function(){var j=f(this._scope);var i=this._selector?j.find(this._selector):j;this._open(i)};g.prototype._open=function(i){if(i.length!==1){a.warn("Could not trigger OAuth dance, the source is not a single HTML element: "+i);return}var j=i.attr("data-authorisation-uri");if(j){this._onSuccess||this.defaultSuccess();this._onFailure||this.defaultFailure();new d(j).source(i).onSuccess(this._onSuccess).onFailure(this._onFailure).open()}else{a.warn("Could not trigger OAuth dance, data-authorisation-uri missing for: "+i)}};return g});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-oauth-ui', location = 'js/oauth-dialog.js' */
(function(c,a,b){AppLinks.authenticateRemoteCredentials=function(d,f,e){c(".applinks-error").remove();new b(d).onSuccess(f).onFailure(e).open()}})(require("applinks/lib/jquery"),require("applinks/common/events"),require("applinks/feature/oauth-callback"));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:common', location = 'util/retry-caller.js' */
define("confluence/jim/util/retry-caller",["ajs","jquery","underscore"],function(b,d,c){var a=function(g,p){p=p||{};var h=p.args;var j=(typeof p.tester==="function")?p.tester:function(){return true};var i=p.delays||[0.1,0.3,0.5,0.7,1];var l=i.length;var e=p.name||"";var k=d.Deferred(),o=k.promise();var f=p.context||k;var n=0;var m=function(){if(n===l){return k.rejectWith(f,[f,"exceed-maximum-called-times",""])}var r=i[n++];var q=function(){d.when(g.apply(f,h)).then(function(){k.notify.apply(f,arguments);if(j.apply(f,arguments)){m()}else{k.resolveWith(f,arguments)}},function(){k.rejectWith(f,arguments)})};c.delay(q,r)};m();return o};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:common', location = 'util/common.js' */
AJS.JiraIssues={Remote:{}};var appLinksI18n={entries:{}};jQuery(document).ready(function(){AJS.JiraIssues=jQuery.extend(AJS.JiraIssues||{},{bindOAuthLink:function(c,f){var e={onSuccess:function(){f()},onFailure:function(){}};var d=c.attr("href");c.click(function(g){AppLinks.authenticateRemoteCredentials(d,e.onSuccess,e.onFailure);g.preventDefault()})},getOAuthRealm:function(f){var d=f.getResponseHeader("WWW-Authenticate")||"";var c=/OAuth realm\=\"([^\"]+)\"/;var e=c.exec(d);if(e){return e[1]}else{return null}}});jQuery("a.static-oauth-init").each(function(){AJS.JiraIssues.bindOAuthLink(jQuery(this),function(){window.location.reload()})});jQuery("a.anonymous-init").each(function(f,e){var c=encodeURIComponent(window.location.pathname.replace(Confluence.getContextPath(),""));var d=Confluence.getContextPath()+"/login.action?os_destination="+c;AJS.$(e).attr("href",d)});var a=function(j){var e=AJS.JiraIssues.Remote[j];var h="";for(var g=0;g<e.length;g++){h=h+(e[g].key+(g<e.length-1?",":""))}var d=function(l){var i="issuekey in ("+l+")";var m="/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery="+encodeURIComponent(i)+"&returnMax=true";var k=contextPath+"/plugins/servlet/issue-retriever?appId="+j+"&url="+encodeURIComponent(m)+"&columns=summary&columns=type&columns=resolution&columns=status";return k};var f=function(k){var i=AJS.$("item",k);i.each(function(){var u=AJS.$("link",this).text();var v=AJS.$("key",this).text();var r=AJS.$("summary",this).text();var s=AJS.$("type",this);var m=AJS.$("resolution",this);var w=m.attr("id")!="-1";var o=AJS.$("status",this);var n=AJS.$(".unknown-jira-issue."+v);for(var p=0;p<n.length;p++){var t=AJS.$("<a style=\"background-image: url('"+s.attr("iconUrl")+'\')" href="'+u+'"></a>');t.text(v);var l=AJS.$('<span class="jira-status"></span>');l.text(o.text().toUpperCase());var q=AJS.$('<span class="jira-issue'+(w?" resolved":"")+'" ></span>');q.append(t);q.append(document.createTextNode(" - "+r+" - "));q.append(l);AJS.$(n[p]).replaceWith(q)}})};var c=d(h);AJS.$.ajax({url:c,success:f,error:function(l){if(l.status==401){var k=AJS.JiraIssues.getOAuthRealm(l);if(k){var i={};AJS.$(e).each(function(){if(!i[this.key]){i[this.key]=true;var m=AJS.$('<span class="oauth-msg"> - <a class="oauth-init" href="'+k+'">'+"Authentifier"+"</a> "+"pour voir les d\u00e9tails de la demande"+"</span>");AJS.$(".unknown-jira-issue."+this.key).addClass("single-issue-oauth").append(m)}});AJS.JiraIssues.bindOAuthLink(AJS.$(".single-issue-oauth a.oauth-init"),function(){window.location.reload()})}}else{if(l.status==400&&e.length>1){AJS.$(e).each(function(){var m=this.key;var n=d(m);AJS.$.ajax({url:n,success:f,error:function(p){var o=AJS.$(".unknown-jira-issue."+m);o.removeClass("single-issue-oauth");AJS.$(".oauth-msg",o).remove();o.addClass("jira-error")}})})}}}})};AJS.$(".unknown-jira-issue").each(function(e,f){var d=AJS.$(f);var g=d.attr("data-app-link");var c=d.attr("data-key");AJS.JiraIssues.Remote[g]=AJS.JiraIssues.Remote[g]||[];AJS.JiraIssues.Remote[g].push({key:c})});for(var b in AJS.JiraIssues.Remote){a(b)}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.extra.jira:web-resources', location = 'templates/extra/jira/jiraIssues.js' */
jQuery(document).ready(function(){var a=jQuery.extend(window.JiraIssues||{},{ADG_ENABLED:AJS.Meta.getNumber("build-number")>=4000,ADG_FONT_SIZE_OVER_FLEXIGRID_FONT_SIZE_RATIO:14/11,fixMenusShowingUnderWidgetInIE:function(){if(jQuery.browser.msie){jQuery("ul.ajs-menu-bar li.ajs-menu-item").each(function(){jQuery(this).hover(function(){jQuery("div.ajs-drop-down",jQuery(this)).parents().each(function(){var c=jQuery(this);var b=c.css("position");if(b&&b!="auto"){c.addClass("ajs-menu-bar-z-index-fix-for-ie")}})},function(){jQuery("div.ajs-drop-down",jQuery(this)).parents().removeClass("ajs-menu-bar-z-index-fix-for-ie")})})}},onSuccessFunction:function(d){if(!jQuery("fieldset input[name='height']",d).length){var b=jQuery(".bDiv table[id^='jiraissues_table']",d)[0];var e=b.grid;var c=b.clientHeight+jQuery(".hDiv",d)[0].clientHeight;jQuery(".bDiv",d).css("height",c+"px");e.options.height=c;e.fixHeight(c)}},onErrorFunction:function(h,c,b,n,f){var o=jQuery("#"+c);var g=b+": ";if(n.status=="200"){g+=f}else{g+=n.responseText}var i=n.getResponseHeader("WWW-Authenticate")||"";if(n.status=="401"&&i.indexOf("OAuth")!=-1){var m=/OAuth realm\=\"([^\"]+)\"/;var e=m.exec(i);if(e){o.empty();a.bigMessageFunction(c,'<a class="oauth-init" href="'+e[1]+'">'+"Authentifier"+"</a> "+"pour r\u00e9cup\u00e9rer vos demandes"+"</span>");jQuery(".bmDiv",h).css({"z-index":2});var j={onSuccess:function(){window.location.reload()},onFailure:function(){}};var l=jQuery(".oauth-init",o.parent());var d=l.attr("href");l.click(function(p){AppLinks.authenticateRemoteCredentials(d,j.onSuccess,j.onFailure);p.preventDefault()});AJS.$(".gBlock").remove()}}else{if(n.status=="400"){a.bigMessageFunction(c,"Le serveur JIRA n\u0027a pas pu traiter la recherche. Il s\u0027agit peut-\u00eatre d\u0027un probl\u00e8me dans la syntaxe de la macro. Il est aussi possible que vous ne soyez pas autoris\u00e9 \u00e0 afficher lune de ces demandes si ce tableau n\u00e9cessite des cl\u00e9s de demande sp\u00e9cifiques. ")}else{var k=jQuery("iframe.jiraissues_errorMsgSandbox",h);k.load(function(){var r=this.contentWindow||this.contentDocument;var q=jQuery((r.document?r.document:r).body);jQuery("a",q).each(function(){this.target="_top"});jQuery(".pPageStat",h).empty().text(q.text());var p=jQuery("div.bmDiv",h)[0];k.removeClass("hidden");k.css({height:p.clientHeight+"px",width:p.clientWidth+"px"})});k[0].src=jQuery("fieldset input[name='retrieverUrlHtml']",h).val();a.bigMessageFunction(c,k)}}jQuery(h).find(".pReload").removeClass("loading");o[0].grid.loading=false;jQuery(h).find(".pButton").each(function(){jQuery(this).removeClass("pBtnOver");jQuery(this).css({cursor:"default",opacity:"0.3"})});jQuery(h).find("span.pcontrol input").attr("readonly","true")},onReloadFunction:function(b,d,c){jQuery(".bmDiv",d).remove();jQuery(".bmDistance",d).remove();c.onSubmit=function(){a.reloadOnSubmitFunction(b,c);return true}},reloadOnSubmitFunction:function(b,c){c.params=[{name:"useCache",value:false}];c.onSubmit=function(){a.onSubmitFunction(b,c);return true}},onSubmitFunction:function(b,c){c.params=[{name:"useCache",value:b}]},showTrustWarningsFunction:function(d,c){var b=jQuery(d).children(".trusted_warnings");if(c.trustedMessage){b.find("td:last").html(c.trustedMessage);b.css("display","block")}else{b.css("display","none")}},preProcessFunction:function(e,b,d,c,f){if(d){a.showTrustWarningsFunction(e,c)}if(c.total==0){jQuery(".pPageStat",e).html(f);a.bigMessageFunction(b,f);jQuery(".pReload",e).removeClass("loading");return}},bigMessageFunction:function(e,f){var d=jQuery("<div></div>");var b=jQuery("<div></div>");d.addClass("bmDistance");b.addClass("bmDiv");if(typeof f=="string"){b.html("<p><strong>"+f+"</strong></p>")}else{f.appendTo(b)}var c=jQuery("#"+e);c.after(b).after(d)},getParamsFrom:function(c){var b={};c.children("input").each(function(){b[jQuery(this).attr("name")]=jQuery(this).attr("value")});return b},initializeColumnWidth:function(f,p){var d={},m=function(i){return a.ADG_ENABLED?Math.round(i*a.ADG_FONT_SIZE_OVER_FLEXIGRID_FONT_SIZE_RATIO):i};if(!(p&&p.length)){return d}var h=37,n=11,k=f.width()-(h+(p.length*n)),j=false,q=false,o=0,c=m(140);for(var l=0,e=p.length;l<e;l++){var g=p[l].name;switch(g){case"summary":j=true;o++;break;case"description":q=true;o++;break;case"type":o++;d[g]=30;k-=30;break;case"priority":o++;d[g]=50;k-=50;break;case"status":o++;d[g]=m(100);k-=m(100);break;case"key":o++;d[g]=m(90);k-=m(90);break;case"comments":case"attachments":case"version":case"component":case"resolution":o++;d[g]=m(80);k-=m(80);break;default:d[g]=c}}if(j||q){k-=(c*(p.length-o));var b=250;if(j&&q){d.summary=Math.max(k/2,b);d.description=Math.max(k/2,b)}else{if(j){d.summary=Math.max(k,b)}else{d.description=Math.max(k,b)}}}else{if(!j&&!q&&(p.length>o)){c=k/(p.length-o);for(l=0;l<e;l++){if(!{resolution:true,key:true,type:true,priority:true,status:true}[p[l]]){d[p[l]]=c}}}}return d}});a.fixMenusShowingUnderWidgetInIE();jQuery(".jiraissues_table").each(function(f,j){var k=jQuery(j),h=k.children("fieldset"),e=a.getParamsFrom(h),c="jiraissues_table_"+f;k.append('<table id="'+c+'" style="display:none"></table>');k.css("width",e.width);var d=[];h.children(".columns").each(function(l){var m=jQuery(this).hasClass("nowrap");d[l]={display:this.name,name:this.value,nowrap:m,sortable:true,align:"left"}});var b=a.initializeColumnWidth(k,d);jQuery.each(d,function(l,m){m.width=b[m.name]});var g=jQuery("<div></div>");jQuery("<a></a>").attr({rel:"nofollow",href:e.clickableUrl}).text(e.title).appendTo(g);jQuery("#"+c).flexigrid({url:e.retrieverUrlHtml,method:"GET",dataType:"json",colModel:d,sortname:e.sortField,sortorder:e.sortOrder,usepager:true,title:g.html(),page:parseInt(e.requestedPage,10),useRp:false,rp:parseInt(e.resultsPerPage,10),showTableToggleBtn:true,height:(function(){return e.height?parseInt(e.height,10):480})(),onSuccess:function(){a.onSuccessFunction(j)},onSubmit:function(){a.onSubmitFunction(e.useCache,this);return true},preProcess:function(i){a.preProcessFunction(j,c,e.showTrustWarnings,i,e.nomsg);return i},onError:function(m,l,i){a.onErrorFunction(j,c,e.jiraissuesError,m,l,i)},onReload:function(){a.onReloadFunction(e.useCache,j,this);return true},errormsg:e.errormsg,pagestat:e.pagestat,procmsg:e.procmsg,nomsg:e.nomsg})});jQuery(".jiraissues_count").each(function(b,d){var c=jQuery(d);jQuery.ajax({cache:false,type:"GET",url:c.find(".url").text(),data:{useCache:c.find(".use-cache").text(),rp:c.find(".rp").text(),showCount:"true"},success:function(f){var e=c.find(".result");if(f==1){e.text(AJS.format("Demande {0}",f))}else{e.text(AJS.format("Demandes {0}",f))}e.removeClass("hidden");jQuery(".calculating, .error, .data",c).remove()},error:function(h){var f=jQuery(".error",c).removeClass("hidden"),g=h.getResponseHeader("WWW-Authenticate")||"",j=false;if(h.status===401&&g.indexOf("OAuth")!=-1){var e=/OAuth realm\=\"([^\"]+)\"/,i=e.exec(g);if(i){f.empty().append(AJS.$("<a/>",{href:i[1],"class":"oauth-init"}).text("Authentifier").click(function(){AppLinks.authenticateRemoteCredentials(i[1],function(){window.location.reload()},function(){});return false})).append(AJS.$("<span/>",{text:" "+"pour r\u00e9cup\u00e9rer vos demandes"}));j=true}}if(!j){f.text(AJS.format(f.text(),h.status))}jQuery(".calculating, .result, .data",c).remove()}})})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'templates/recently.soy' */
// This file was automatically generated from recently.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace RY.Templates.
 */

if (typeof RY == 'undefined') { var RY = {}; }
if (typeof RY.Templates == 'undefined') { RY.Templates = {}; }


RY.Templates.body = function(opt_data, opt_ignored) {
  return '<div id="recently-viewed" class="aui-group"><div class="aui-item"><div class="top"><div class="filter"><form class="aui"><input class="filter-input text" type="text" placeholder="' + soy.$$escapeHtmlAttribute("Filtrer") + '"></form></div></div><div class="pages"></div></div></div>';
};
if (goog.DEBUG) {
  RY.Templates.body.soyTemplateName = 'RY.Templates.body';
}


RY.Templates.pageCollection = function(opt_data, opt_ignored) {
  return '<div class="groups"></div><div class="empty"></div>';
};
if (goog.DEBUG) {
  RY.Templates.pageCollection.soyTemplateName = 'RY.Templates.pageCollection';
}


RY.Templates.pageGroup = function(opt_data, opt_ignored) {
  return '<h3>' + soy.$$escapeHtml(opt_data.title) + '</h3><ul/>';
};
if (goog.DEBUG) {
  RY.Templates.pageGroup.soyTemplateName = 'RY.Templates.pageGroup';
}


RY.Templates.pageItem = function(opt_data, opt_ignored) {
  return '<div class="page-icon"><a href=' + soy.$$escapeHtmlAttributeNospace(soy.$$filterNormalizeUri(opt_data.href)) + ' class="icon icon-' + soy.$$escapeHtmlAttribute(opt_data.type) + '"></a></div><div class="page-title"><a class="ellipsis" href=' + soy.$$escapeHtmlAttributeNospace(soy.$$filterNormalizeUri(opt_data.href)) + '>' + soy.$$escapeHtml(opt_data.title) + ' - ' + soy.$$escapeHtml(opt_data.space) + '</a></div>';
};
if (goog.DEBUG) {
  RY.Templates.pageItem.soyTemplateName = 'RY.Templates.pageItem';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/util.js' */
var RY=RY||{};(function(){var b=new Date();var c=new Date(b).getTime();var a=new Date(b.getFullYear(),b.getMonth(),b.getDate()).getTime();var d=new Date(b.getFullYear(),b.getMonth(),b.getDate()-1).getTime();RY.util=RY.Util={analytics:{trackDialogOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-dialog-open"})},trackPageOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-page-open"})}},quote:function(e){return(e).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},diffInDays:function(g,f){var e=1000*60*60*24;return Math.floor((g-f)/e)},daysSince:function(e){if(e>=a){return 0}else{if(e>=d){return 1}else{return RY.util.diffInDays(c,e)}}},wait:function(h,j,f){var i,k,e;var g=function(){k=setTimeout(function(){h.apply(f,e)},j)};return function(){e=arguments;var l=new Date();if(i&&l-i<j){clearTimeout(k)}g();i=l}}}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/page-storage.js' */
var RY=RY||{};RY.RecentPageStorage=function(h){var f="com.atlassian.confluence.plugins.recently.viewed.pages.v1";var d=100;var c={};var b=function(){var i=function(k,l){if(k==="lastSeen"&&_.isString(l)){if(AJS.$.browser.msie){l=l.replace(/\-/g,"/");l=l.replace(/T.*$/,"")}return new Date(l).getTime()}else{return l}};try{c=JSON.parse(h.getItem(f),i)||{}}catch(j){c={}}return c};var g=function(){var i=_.values(c);var k=i.length-d;if(k>0){var j=_.sortBy(i,function(l){return l.lastSeen});_.times(k,function(){var l=j.shift();delete c[l.id]})}};var e=function(){g();try{h.setItem(f,JSON.stringify(c))}catch(i){}};this.addCurrentPage=function(i){if(!(i.id&&i.title)){return}b();a(i);e()};var a=function(i){var j=c[i.id];if(!j){c[i.id]=j={}}j=_.extend(j,i);j.lastSeen=new Date().getTime();j.count=j.count+1||1};this.getPages=function(){return _.values(b())}};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/filter.js' */
var RY=RY||{};RY.FilterView=Backbone.View.extend({className:"filter",events:{"input .filter-input":"onInput","keyup .filter-input":"onInput","keydown .filter-input":"onKeydown"},initialize:function(){_.bindAll(this,"render","onInput","onKeydown","search");this.navigationEvents=this.options.navigationEvents;this.onInput=RY.util.wait(this.onInput,100,this)},render:function(){this.$input=this.$(".filter-input");return this},onInput:function(a){if(a&&_.contains([37,38,39,40],a.which)){return}this.search()},onKeydown:function(a){switch(a.which){case 13:this.navigationEvents.trigger("select");a.preventDefault();a.stopPropagation();break;case 38:this.navigationEvents.trigger("previous");a.preventDefault();break;case 40:this.navigationEvents.trigger("next");a.preventDefault();break}},search:function(){var a=this.$input.val();this.collection.search(a)}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/page-model.js' */
var RY=RY||{};(function(){var a;if(typeof ConfluenceMobile!="undefined"){a=ConfluenceMobile.AppData.get("confluence-context-path")}else{a=AJS.contextPath()}RY.Page=Backbone.Model.extend({href:function(){return a+this.get("url")},daysSinceLastSeen:function(){return RY.util.daysSince(this.get("lastSeen"))}});RY.PageCollection=Backbone.Collection.extend({model:RY.Page,url:a+"/rest/recentlyviewed/1.0/recent",search:function(c){var b;if(this._queryLength(c)===0){b=this.models}else{var d=c.match(/[^\s-]+/g);b=this.filter(function(g){var h=g.get("title");var f=g.get("space");var e=(h+f).toLowerCase();return _.all(d,function(i){return e.indexOf(i.toLowerCase())!==-1})})}this.trigger("filter",b,c);return b},_queryLength:function(b){if(!String.prototype.trim){return AJS.$.trim(b).length}return b.trim().length},comparator:function(b){return -(b.get("lastSeen"))}})})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/page.js' */
var RY=RY||{};RY.PageView=Backbone.View.extend({tagName:"li",className:"ry-page",template:RY.Templates.pageItem,initialize:function(){_.bindAll(this,"hide","show","render")},hide:function(){this.$el.hide().removeClass("shown")},show:function(){this.$el.show().addClass("shown")},render:function(){var a=this.model.toJSON();a.href=this.model.href();this.$el.html(this.template(a));return this}});RY.PageGroupView=Backbone.View.extend({className:"group",template:RY.Templates.pageGroup,initialize:function(){_.bindAll(this,"hide","hideAll","show","showBorder","showPages","add","render");this.title=this.options.title;this.modelViews={}},hide:function(){this.$el.hide()},hideAll:function(){this.$el.removeClass("border").hide();_.invoke(_.values(this.modelViews),"hide")},show:function(){this.$el.show()},showBorder:function(){this.$el.addClass("border")},showPages:function(a){var c=this;var b=false;_.each(a,function(e){var d=c.modelViews[e.cid];if(d){b=true;d.show()}});if(b){this.show()}return b},add:function(b){var a=new RY.PageView({model:b});this.modelViews[b.cid]=a;this.$list.append(a.render().el)},render:function(){this.$el.html(this.template({title:this.title}));this.$list=this.$("ul");return this}});RY.PageNavigator=function(a,e,c){var g=null;function f(){return a.find("li.shown")}function b(i){pageItems=f();var h=pageItems.index(pageItems.filter(".highlight"));if(g){g.removeClass("highlight")}i+=h;if(i<0){i=pageItems.length-1}if(i>=pageItems.length){i=0}g=pageItems.eq(i);g.addClass("highlight")}function d(){if(!g.length){return}var k=e;var l=k.children();var j=k.height();var i=g.outerHeight(true);var h=g.position().top;if(h<0){if(f().index(g)===0){k.scrollTop(0);return}k.scrollTop(g.offset().top-l.offset().top)}else{if(h>j){k.scrollTop(g.offset().top-l.offset().top-j+i)}}}c.on("select",function(){if(g&&g.is(":visible")){RY.util.analytics.trackPageOpen();var h=g.find(".page-title a").attr("href");window.location=h}},this);c.on("previous",function(){b(-1);d()},this);c.on("next",function(){b(1);d()},this)};RY.PageCollectionView=Backbone.View.extend({template:RY.Templates.pageCollection,events:{"click .page-title a":RY.util.analytics.trackPageOpen},initialize:function(){_.bindAll(this,"checkEmpty","filter","_groupForPage","addOne","showEmptyMessage","clearEmptyMessage","addAll","render");this.modelViews={};this.collection.on("reset",this.addAll,this);this.collection.on("add",this.addOne,this);this.collection.on("filter",this.filter,this)},checkEmpty:function(a,e){var f=this.collection.isEmpty();var b=a.length===0;if(f||b){var c;if(f){c="D\u00e9sol\u00e9, vous n\u0027avez apparemment consult\u00e9 aucune page jusqu\u0027\u00e0 pr\u00e9sent."}else{var d=AJS.contextPath()+"/dosearchsite.action?queryString="+encodeURIComponent(e);c="Nous n\u0027avons trouv\u00e9 aucune pages qui correspondent dans votre historique."+" "+AJS.format("\u003ca href=\u0022{0}\u0022\u003eCliquez ici\u003c/a\u003e pour chercher ce terme \u00e0 la place.",d)}this.showEmptyMessage(c)}else{this.clearEmptyMessage()}},filter:function(b,d){d=d||"";this.checkEmpty(b,d);var a=[this.$today,this.$yesterday,this.$older];_.invoke(a,"hideAll");var c=[];_.each(a,function(f){var e=f.showPages(b);if(e){c.push(f)}});if(c.length>1){c.pop();_.invoke(c,"showBorder")}},_groupForPage:function(a){var b=a.daysSinceLastSeen();if(b===0){return this.$today}else{if(b===1){return this.$yesterday}else{return this.$older}}},addOne:function(a){var b=this._groupForPage(a);b.add(a)},showEmptyMessage:function(a){this.$(".empty").html(AJS.$("<p>").html(a))},clearEmptyMessage:function(){this.$(".empty").html("")},addAll:function(){this.collection.each(this.addOne)},render:function(){this.$el.html(this.template());this.$today=new RY.PageGroupView({title:"Aujourd\u0027hui"});this.$yesterday=new RY.PageGroupView({title:"Hier"});this.$older=new RY.PageGroupView({title:"Plus anciennes"});var a=this.$(".groups");a.append(this.$today.render().el);a.append(this.$yesterday.render().el);a.append(this.$older.render().el);_.invoke([this.$today,this.$yesterday,this.$older],"hideAll");return this}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/quicknav/util.js' */
var RYQ=RYQ||{};(function(){RYQ.util={analytics:{trackQuickNavOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-quicknav-open"})},trackQuickNavPageOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-quicknav-click-page"})},trackQuickNavRecentlyDialogOpen:function(){AJS.trigger("analytics",{name:"recently-viewed-quicknav-click-more-recent"})}}}}());
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:app-resources', location = 'js/quicknav/quicknav.js' */
var RYQ=RYQ||{};RYQ.QuickNavEntry=Backbone.Model.extend({classNameByType:{blogpost:"content-type-blogpost",page:"content-type-page"},parse:function(a){return{className:this.classNameByType[a.type],name:a.title,href:AJS.contextPath()+a.url,id:a.id,spaceName:a.space,lastSeen:a.lastSeen}}},{escape:function(b){var a=_.map(b,_.clone);_.each(a,function(c){c.name=_.escape(c.name);c.spaceName=_.escape(c.spaceName)});return a}});RYQ.QuickNavEntryCollection=Backbone.Collection.extend({model:RYQ.QuickNavEntry,url:AJS.contextPath()+"/rest/recentlyviewed/1.0/recent?limit=8",search:function(b){var a;if(AJS.$.trim(b).length===0){a=this.models}else{var c=b.match(/[^\s-]+/g);a=this.filter(function(e){var f=e.get("name");var d=f.toLowerCase();return _.all(c,function(g){return d.indexOf(g.toLowerCase())!==-1})})}this.trigger("filter",a);return a},comparator:function(a){return -(a.get("lastSeen"))}});(function(a){RYQ.QuickNav=Backbone.View.extend({initialize:function(){this.moreLink={className:"recently-viewed",href:"#",name:"Autres pages affich\u00e9es r\u00e9cemment..."};this.$input=a("#quick-search-query");this.makeDropdown();this.addShowHideHandlers();this.getHistory=_.once(this._getHistory);_.bindAll(this,"makeDropdown","addSearchResultBoostingHandler","_getHistory","render","addShowHideHandlers","_getItemsToShow","showQuickResults","onQuickSearch")},makeDropdown:function(){var c=function(d){a("a",d).each(function(){var h=a(this);var e=h.find("span");var g=e.data("properties");var f=g?g.spaceName:null;if(f&&!h.is(".content-type-spacedesc")){h.after(h.clone().attr("class","space-name").html(f));h.parent().addClass("with-space-name")}})};var b=this;this.$dropdown=AJS.inputDrivenDropdown({dropdownPlacement:function(d){b.$input.closest("form").find(".quick-nav-drop-down").append(d)},dropdownPostprocess:function(d){c(d)},ajsDropDownOptions:{className:"recently-viewed-dropdown"}})},addSearchResultBoostingHandler:function(){var b=this;a(window).on("quicksearch.ajax-success",function(g,f){var d=f.url.match("/json/contentnamesearch.action");var c=f.url.match(/rest\/quicknav\/\d\/search/);if(d||c){b.onQuickSearch(g,f)}})},_getHistory:function(){return this.collection.fetch().done(this.addSearchResultBoostingHandler)},render:function(){if(!AJS.Meta.get("remote-user")){return}var b=this.getHistory();b.done(_.bind(function(){if(AJS.dropDown.current==null&&this.collection.length!==0&&this.$input.val().length===0){this.showQuickResults()}},this));var c=this.$input;c.trigger("quick-search-loading-start");b.always(function(){c.trigger("quick-search-loading-stop")})},addShowHideHandlers:function(){var b=this;this.$input.on("focus",function(){b.render()}).on("click",function(c){c.stopPropagation();b.render()}).on("keyup",function(f){var c=f.which===27;var g=f.which===13;var d=a(this).val().length!==0;if(d||c){if(b.$dropdown.dd&&b.$dropdown.dd.$.is(":visible")){b.$dropdown.hide()}}else{if(!g){b.render()}}})},_getItemsToShow:function(){var c=this.collection.toJSON();var b=c.length>0&&c[0].id==AJS.Meta.get("page-id");if(b){c.shift()}return c},showQuickResults:function(){var b=RYQ.QuickNavEntry.escape(this._getItemsToShow());this.$dropdown.show([b,[this.moreLink]],"","");a(".recently-viewed-dropdown").on("click",".recently-viewed",function(c){c.preventDefault();a("#view-user-history-link").click();RYQ.util.analytics.trackQuickNavRecentlyDialogOpen()});a(".recently-viewed-dropdown").on("click",".with-space-name",function(c){RYQ.util.analytics.trackQuickNavPageOpen()});RYQ.util.analytics.trackQuickNavOpen()},onQuickSearch:function(l,f){var o=f.json.query;var c=_.map(this.collection.search(o),function(e){return e.attributes});c=RYQ.QuickNavEntry.escape(c);if(c.length==0){return}var m=f.json.contentNameMatches;var p=-1;for(var g=0;g<m.length;g++){var n=m[g][0].className;if(n=="content-type-blogpost"||n=="content-type-page"){p=g;break}}if(p!=-1){var h=m[p];var b=Math.min(h.length>4?2:6-h.length,c.length);h.unshift.apply(h,_(c).first(b));m[p]=_.uniq(h,function(e){return +e.id});if(h.length>6){var k=6-b;for(var d=k;d>0;d--){h.pop()}}}else{m.unshift(_(c).first(6))}}})}(AJS.$));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:main-resources', location = 'js/main.js' */
var RY=RY||{};AJS.toInit(function(a){a("#view-user-history-link").unbind("click");a("#view-user-history-link").click(function(g){g.preventDefault();var c=new AJS.Dialog({width:600,height:500,id:"recently-viewed-dialog",closeOnOutsideClick:true});var f=a(RY.Templates.body());c.addHeader("Pages affich\u00e9es r\u00e9cemment");c.addPanel("SinglePanel",f);c.addLink("Fermer",function(e){e.hide()});var d=a("<div>",{"class":"dialog-tip"}).text("Astuce&nbsp;: saisissez \u0022g\u0022 puis \u0022r\u0022 n\u0027importe o\u00f9 pour ouvrir rapidement ce menu");c.popup.element.find(".dialog-button-panel").append(d);var i=new RY.PageCollection();var b=new RY.PageCollectionView({collection:i});f.find(".pages").html(b.render().el);c.gotoPanel(0);c.show();var h=a("#recently-viewed-dialog").spin("large");i.fetch({success:function(){h.spinStop();var j=_.extend({},Backbone.Events);var k=new RY.PageNavigator(b.$el,f.parent(),j);var e=new RY.FilterView({collection:i,el:f.find(".filter"),navigationEvents:j}).render();e.search()}});RY.util.analytics.trackDialogOpen()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.recently-viewed-plugin:main-resources', location = 'js/quicknav/main.js' */
var RYQ=RYQ||{};AJS.toInit(function(){var b=new RYQ.QuickNavEntryCollection();var a=new RYQ.QuickNav({collection:b})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacemenu-resources', location = 'js/space-menu.js' */
AJS.toInit(function(a){var c=a(Confluence.Templates.BrowseSpaces.spacesLink());a("#space-directory-link").replaceWith(a(c));var b=function(d){var e=a("#space-menu-link-content");e.html(d.template);if(AJS&&AJS.Confluence&&AJS.Confluence.Analytics&&AJS.Confluence.Analytics.setAnalyticsSource){AJS.Confluence.Analytics.setAnalyticsSource(e.find("a"),"spacemenu")}a("#create-space-header").click(function(){AJS.trigger("analytics",{name:"create-space-from-header"});Confluence.SpaceBlueprint.Dialog.launch();return false})};a("#space-menu-link-content").on("aui-dropdown2-show",function(){AJS.trigger("analytics",{name:"open-space-menu"});if(!a("#space-menu-link-content .aui-dropdown2-section")||!a("#space-menu-link-content .aui-dropdown2-section").length){a.ajax({url:Confluence.getContextPath()+"/rest/ia/1.0/spacesmenu",type:"GET",dataType:"json",cache:false,success:b})}return false})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:spacemenu-resources', location = 'soy/space-menu.soy' */
// This file was automatically generated from space-menu.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.BrowseSpaces.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.BrowseSpaces == 'undefined') { Confluence.Templates.BrowseSpaces = {}; }


Confluence.Templates.BrowseSpaces.spacesLink = function(opt_data, opt_ignored) {
  return '' + aui.dropdown2.trigger({menu: {id: 'space-menu-link-content'}, id: 'space-menu-link', tagName: 'a', extraClasses: 'aui-nav-link', title: "Espaces", showIcon: true, text: "Espaces"}) + aui.dropdown2.contents({id: 'space-menu-link-content', extraClasses: 'aui-style-default aui-dropdown2-in-header'});
};
if (goog.DEBUG) {
  Confluence.Templates.BrowseSpaces.spacesLink.soyTemplateName = 'Confluence.Templates.BrowseSpaces.spacesLink';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-space-ia:space-ia-analytics', location = 'js/space-ia-analytics.js' */
(function(b){var c=AJS.Confluence.Analytics.setAnalyticsSource;function d(){var g=b(".acs-side-bar");var f=g.find("a:not(.external_link a, #acs-configure-link)");c(f,"sidebar");var e=g.find(".quick-links-section li:not(.external_link) a");c(e,"spaceshortcut");var h=g.find(".ia-secondary-container a:not(.more-children-link)");if(g.find(".ia-secondary-container").data("tree-type")=="pages"){c(h,"contextnavchildmode")}else{if(g.find(".ia-secondary-container").data("tree-type")=="page-tree"){c(h,"contextnavpagetreemode")}else{c(h,"contextnav")}}}function a(e){return function(){AJS.trigger("analytics",{name:"space-ia-nav",data:{linkType:e}})}}AJS.toInit(function(e){e(".acs-side-bar").find(".ia-secondary-container .more-children-link").click(a("context-nav.more-children"));AJS.bind("sidebar.exit-configure-mode",d);AJS.bind("sidebar.flyout-triggered",function(g,f){a("flyout-triggered."+f.flyout)()});AJS.bind("pagetree-children-loaded",d);d()})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugin.jslibs:skate-0.12.6', location = 'libs/skate/0.12.6/skate-0.12.6.js' */
(function e(g,c,j){function h(a,k){if(!c[a]){if(!g[a]){var d="function"==typeof require&&require;if(!k&&d)return d(a,!0);if(f)return f(a,!0);d=Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d;}d=c[a]={exports:{}};g[a][0].call(d.exports,function(c){var f=g[a][1][c];return h(f?f:c)},d,d.exports,e,g,c,j)}return c[a].exports}for(var f="function"==typeof require&&require,d=0;d<j.length;d++)h(j[d]);return h})({1:[function(b,g,c){Object.defineProperty(c,"__esModule",{value:!0});"use strict";
c.ATTR_IGNORE="data-skate-ignore";c.types={ANY:"act",ATTR:"a",CLASS:"c",NOATTR:"ct",NOCLASS:"at",NOTAG:"ac",TAG:"t"}},{}],2:[function(b,g){g.exports={get:function(c,b){if(c.__SKATE_DATA)return c.__SKATE_DATA[b]},set:function(c,b,h){c.__SKATE_DATA||(c.__SKATE_DATA={});c.__SKATE_DATA[b]=h;return c}}},{}],3:[function(b,g){function c(c){for(var f=c.length,b=0;b<f;b++){var i=c[b],o=i.addedNodes,i=i.removedNodes;o&&(o.length&&!p(o[0].parentNode))&&d(o);i&&i.length&&a(i)}}var j=function(c){return c&&c.__esModule?
c["default"]:c},h=j(b("./globals")),f=b("./lifecycle"),d=f.initElements,a=f.removeElements,k=j(b("./mutation-observer")),p=b("./utils").getClosestIgnoredElement;g.exports={register:function(a){a&&(k.fixIe(),this.unregister());h.observer||(a=new k(c),a.observe(document,{childList:!0,subtree:!0}),h.observer=a);return this},unregister:function(){h.observer&&(h.observer.disconnect(),h.observer=void 0);return this}}},{"./globals":4,"./lifecycle":5,"./mutation-observer":6,"./utils":9}],4:[function(b,g){window.__skate||
(window.__skate={observer:void 0,registry:{}});g.exports=window.__skate},{}],5:[function(b,g,c){function j(o,c,a){if(k.get(o,c.id+":lifecycle:"+a))return!0;k.set(o,c.id+":lifecycle:"+a,!0);return!1}function h(c,a){if(!j(c,a,"created")){m(c,a.prototype,!0);a.template&&a.template(c);var b=function(a,b){return function(f){if(!b)return a(c,f,c);for(var d=f.target;d&&d!==document&&d!==c.parentNode;){if(i.call(d,b))return a(c,f,d);d=d.parentNode}}};"object"===typeof a.events&&l(a.events,function(a,d){var f,
i;i=d.split(" ");f=i.shift();i=i.join(" ");c.addEventListener(f,b(a,i),!!i&&("blur"===f||"focus"===f))});var f=function(i,f,d,b){var k;a.attributes&&a.attributes[f]&&"function"===typeof a.attributes[f][i]?k=a.attributes[f][i]:a.attributes&&"function"===typeof a.attributes[f]?k=a.attributes[f]:"function"===typeof a.attributes&&(k=a.attributes);k&&k(c,{type:i,name:f,newValue:d,oldValue:b})},d,k=c.attributes,h=[],g=k.length;(new p(function(a){a.forEach(function(a){var c,i=a.attributeName,d=k[i];d&&null===
a.oldValue?c="created":d&&null!==a.oldValue?c="updated":d||(c="removed");f(c,i,d?d.value||d.nodeValue:void 0,a.oldValue)})})).observe(c,{attributes:!0,attributeOldValue:!0});for(d=0;d<g;d++)h.push(k[d]);for(d=0;d<g;d++){var n=h[d];f("created",n.nodeName,n.value||n.nodeValue)}a.created&&a.created(c)}}function f(c){for(var i=c.length,d=0;d<i;d++){var b=c[d];if(!(1!==b.nodeType||b.attributes[a])){for(var k=n.getForElement(b),g=k.length,m=0;m<g;m++){var l=b,p=k[m];h(l,p);j(l,p,"attached")||(l.removeAttribute(p.unresolvedAttribute),
l.setAttribute(p.resolvedAttribute,""),p.attached&&p.attached(l))}b=b.childNodes;b.length&&f(b)}}}function d(a){for(var c=a.length,i=0;i<c;i++){var f=a[i];if(1===f.nodeType){d(f.childNodes);for(var b=n.getForElement(f),g=b.length,j=0;j<g;j++){var h=f,m=b[j];m.detached&&m.detached(h);k.set(h,m.id+":lifecycle:attached",!1)}}}}g=function(a){return a&&a.__esModule?a["default"]:a};Object.defineProperty(c,"__esModule",{value:!0});"use strict";var a=b("./constants").ATTR_IGNORE,k=g(b("./data")),p=g(b("./mutation-observer")),
n=g(b("./registry")),b=b("./utils"),m=b.inherit,l=b.objEach,b=window.HTMLElement.prototype,i=b.matches||b.msMatchesSelector||b.webkitMatchesSelector||b.mozMatchesSelector||b.oMatchesSelector;c.triggerCreated=h;c.initElements=f;c.removeElements=d},{"./constants":1,"./data":2,"./mutation-observer":6,"./registry":7,"./utils":9}],6:[function(b,g){function c(a,c){return{addedNodes:null,attributeName:null,attributeNamespace:null,nextSibling:null,oldValue:null,previousSibling:null,removedNodes:null,target:a,
type:c||"childList"}}function j(a,c){var f=a.childNodes;if(f)for(var d=f.length,b=0;b<d;b++){var k=f[b];c(k);j(k,c)}}function h(a){if(n&&!m)return new n(a);this.callback=a;this.elements=[]}var f=b("./utils"),d=f.debounce,a=f.objEach,k=window.HTMLElement.prototype,p=window.HTMLElement.prototype.contains,n=window.MutationObserver||window.WebkitMutationObserver||window.MozMutationObserver,m=!1,l=-1<window.navigator.userAgent.indexOf("Trident");h.fixIe=function(){if(l&&!m){var a=Object.getOwnPropertyDescriptor(k,
"innerHTML");Object.defineProperty(k,"innerHTML",{get:function(){return a.get.call(this)},set:function(c){j(this,function(a){var c=document.createEvent("MutationEvent");c.initMutationEvent("DOMNodeRemoved",!0,!1,null,null,null,null,null);a.dispatchEvent(c)});a.set.call(this,c)}});m=!0}};Object.defineProperty(h,"isFixingIe",{get:function(){return m}});h.prototype={observe:function(a,f){function b(a){h.push(a);n()}var k=this,j,g,h=[],l=[],n=d(function(){for(var b=h.length,d=0;d<b;d++){var n=h[d],r=
n.target;if(r){var n=n.type,q=r.parentNode;if(f.childList&&(f.subtree||q===a)){var s=m&&"DOMNodeRemoved"===n,t=j&&(1!==j.nodeType?!1:j.contains?j.contains(r):p.call(j,r));if(s||!t){if(!g||g.target!==q)l.push(g=c(q));"DOMNodeInserted"===n?(g.addedNodes||(g.addedNodes=[]),g.addedNodes.push(r)):(g.removedNodes||(g.removedNodes=[]),g.removedNodes.push(r));j=r}}}}k.callback(l);h=[];l=[];g=j=void 0}),t={},q=[],u=d(function(){var a=q.length;k.callback(q);q.splice(0,a)}),s={target:a,options:f,insertHandler:b,
removeHandler:b,attributeHandler:function(d){var b=d.target;if(f.attributes&&(f.subtree||b===a)){var k=d.attrName,g=d.prevValue,d=d.newValue,b=c(b,"attributes");b.attributeName=k;f.attributeOldValue&&(b.oldValue=t[k]||g||null);q.push(b);f.attributeOldValue&&(t[k]=d);u()}}};this.elements.push(s);f.childList&&(a.addEventListener("DOMNodeInserted",s.insertHandler),a.addEventListener("DOMNodeRemoved",s.removeHandler));f.attributes&&a.addEventListener("DOMAttrModified",s.attributeHandler);return this},
disconnect:function(){a(this.elements,function(a){a.target.removeEventListener("DOMNodeInserted",a.insertHandler);a.target.removeEventListener("DOMNodeRemoved",a.removeHandler);a.target.removeEventListener("DOMAttrModified",a.attributeHandler)});this.elements=[];return this}};g.exports=h},{"./utils":9}],7:[function(b,g){function c(a,c){return d(j.registry,a)&&-1<j.registry[a].type.indexOf(c)}var j,h=b("./globals");j=h&&h.__esModule?h["default"]:h;var f=b("./constants.js").types,d=b("./utils").hasOwn;
g.exports={clear:function(){j.registry={};return this},getForElement:function(a){var d=a.attributes,b=d.length,g=[],h=d.is,l=h&&(h.value||h.nodeValue),h=a.tagName.toLowerCase(),i=l||h,o;c(i,f.TAG)&&(i=j.registry[i],o=i["extends"],l?h===o&&g.push(i):o||g.push(i));for(l=0;l<b;l++)i=d[l].nodeName,c(i,f.ATTR)&&(i=j.registry[i],o=i["extends"],(!o||h===o)&&g.push(i));(d=a.classList)?a=d:(a=a.attributes,a=a["class"]&&a["class"].nodeValue.split(/\s+/)||[]);d=a.length;for(b=0;b<d;b++)i=a[b],c(i,f.CLASS)&&
(i=j.registry[i],o=i["extends"],(!o||h===o)&&g.push(i));return g},has:function(a){return d(j.registry,a)},set:function(a,c){if(this.has(a))throw Error('A definition of type "'+c.type+'" with the ID of "'+a+'" already exists.');j.registry[a]=c;return this},remove:function(a){this.has(a)&&delete j.registry[a];return this}}},{"./constants.js":1,"./globals":4,"./utils":9}],8:[function(b,g){function c(a,b){b=n(b||{},c.defaults);b.id=a;if(k.has(b.id))throw Error('A definition of type "'+b.type+'" with the ID of "'+
a+'" already exists.');k.set(b.id,b);i();h.register(b.remove);if(-1<b.type.indexOf(m.TAG)){var f=b,g=function(){var a;a=f["extends"];var b=f.id;a?(a=document.createElement(a),a.setAttribute("is",b)):a=document.createElement(b);f.prototype=g.prototype;d(a,f);return a};g.prototype=f.prototype;return g}}var j=function(a){return a&&a.__esModule?a["default"]:a},h=j(b("./document-observer")),f=b("./lifecycle"),d=f.triggerCreated,a=f.initElements,k=j(b("./registry")),p=b("./utils"),f=p.debounce,n=p.inherit,
j=j(b("./version")),m=b("./constants").types,l=!!document.attachEvent,i=f(function(){var b=function(){a(document.getElementsByTagName("html"))},c;c=l?"complete"===document.readyState:"interactive"===document.readyState||"complete"===document.readyState;c?b():l?window.addEventListener("load",b):document.addEventListener("DOMContentLoaded",b)});c.init=function(b){if(b)return"string"===typeof b&&(b=document.querySelectorAll(b)),a("undefined"===typeof b.length?[b]:b),b};c.types=m;c.version=j;c.defaults=
{attributes:void 0,events:void 0,"extends":"",id:"",prototype:{},resolvedAttribute:"resolved",template:void 0,type:m.ANY,unresolvedAttribute:"unresolved"};var o=window.skate;c.noConflict=function(){window.skate=o;return this};window.skate=c;g.exports=c},{"./constants":1,"./document-observer":3,"./lifecycle":5,"./registry":7,"./utils":9,"./version":10}],9:[function(b,g,c){function j(b,c){return Object.prototype.hasOwnProperty.call(b,c)}c.hasOwn=j;c.debounce=function(b){var c=!1;return function(){c||
(c=!0,setTimeout(function(){c=!1;b()},1))}};c.getClosestIgnoredElement=function(b){for(;b&&b!==document&&!(b instanceof DocumentFragment);){if(b.hasAttribute(h))return b;b=b.parentNode}};c.inherit=function(b,c,a){for(var g=Object.getOwnPropertyNames(c),h=g.length,j=0;j<h;j++){var m=g[j];if(a||void 0===b[m]){var l=Object.getOwnPropertyDescriptor(c,m);l.get||l.set||!l.writable||!l.enumerable||!l.configurable?Object.defineProperty(b,m,l):b[m]=c[m]}}return b};c.objEach=function(b,c){for(var a in b)j(b,
a)&&c(b[a],a)};Object.defineProperty(c,"__esModule",{value:!0});"use strict";var h=b("./constants").ATTR_IGNORE},{"./constants":1}],10:[function(b,g){g.exports="0.12.6"},{}]},{},[8]);(function(b){var g=b.skate.noConflict();define("atlassian/libs/skate-0.12.6",[],function(){return g})})(window);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.aui.staging:skate', location = '/includes/js/amd/shim/skate-amd.js' */
define("skate",["atlassian/libs/skate-0.12.6"],function(a){return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.aui.staging:persistable', location = 'js/persistable.js' */
define("confluence/persistable",["skate","confluence/storage-manager"],function(f,g){var d=g("confluence","userSettings");return f("data-persist",{type:f.types.ATTRIBUTE,created:function(b){if(!b.name)throw'Missing attribute "name"';var c=b.getAttribute("data-persist"),a=b.getAttribute("data-persist-scope"),a=a?b.name+"."+a.replace(/\./g,"-"):b.name,a=d.getItem(a),e=b.getAttribute("data-default-value");if(/value|checked/.test(c))a=a||e||null,null!==a&&("checked"===c&&(a="true"===a),b[c]=a);else throw"Persistable only works with 'value' or 'checked' attributes!";
},events:{change:function(b){var c=b.getAttribute("data-persist"),a=b.getAttribute("data-persist-scope"),a=a?b.name+"."+a.replace(/\./g,"-"):b.name,e=b.getAttribute("data-default-value");String(b[c])===e?d.removeItem(a):d.setItem(a,b[c],2592E3)}}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-feature-discovery-plugin:confluence-feature-discovery-plugin-resources', location = '/js/confluence-feature-discovery-plugin.js' */
(function(f){Confluence.FeatureDiscovery={};var c,e=false,i=3;var d="com.atlassian.confluence.plugins.confluence-feature-discovery-plugin";var g=d+":confluence-feature-discovery-plugin-resources.test-mode";var a=WRM.data.claim(g);function j(k){if(c===undefined){c=JSON.parse(AJS.Meta.get("discovered-plugin-features")||"{}")}if(k){return c[k]||[]}return c}function b(m,o){var n=j(m);for(var l=0,k=n.length;l<k;l++){if(n[l]==o){return true}}return false}function h(n,p){var l="com.atlassian.webdriver.discovery="+n+":"+p;var k=document.cookie.split(";");for(var m=0;m<k.length;m++){var o=k[m];while(o.charAt(0)==" "){o=o.substring(1)}if(o.indexOf(l)!=-1){return true}}return false}Confluence.FeatureDiscovery.forPlugin=function(m,l){var p=Confluence.storageManager("feature-discovery."+m);l=l||i;function o(r){var q=parseInt(p.getItem(r),10);return isNaN(q)?0:q}function n(r,q){return p.setItem(r,q)}function k(q){return p.removeItem(q)}return{addDiscoveryView:function(q){n(q,o(q)+1)},shouldShow:function(r,q){if(q===true&&a&&!h(m,r)){return false}if(e||b(m,r)){return false}if(o(r)>=l){this.markDiscovered(r);return false}e=true;return true},markDiscovered:function(r,q){if(b(m,r)){return}AJS.safeAjax({url:AJS.contextPath()+"/rest/feature-discovery/1.0/discovered/"+m+"/"+r,type:"POST",data:{},success:function(){j(m).unshift(r);k(r);AJS.trigger("feature-discovered",{pluginKey:m,featureKey:r});if(q&&f.isFunction(q)){q()}}})},listDiscovered:function(){return j(m).slice(0)}}}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources', location = '/js/confluence-license-banner.js' */
require(["ajs","jquery"],function(a,b){a.toInit(function(){var d=WRM.data.claim("com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources.license-details");if(!d){a.warn("Unable to claim my required data");return}var c={destroyBanner:function(){b("#license-banner").slideUp(function(){b("#license-banner").remove()})},remindMeLater:function(){b.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({atl_token:a.Meta.get("atl-token")}),url:a.contextPath()+"/rest/licensebanner/1.0/reminder/later"});c.destroyBanner()},remindMeNever:function(){b.ajax({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({atl_token:a.Meta.get("atl-token")}),url:a.contextPath()+"/rest/licensebanner/1.0/reminder/never"});c.destroyBanner()},createBanner:function(g){var e;if(g.showLicenseExpiryBanner){e=Confluence.Templates.LicenseBanner.expiryBanner({days:g.daysBeforeLicenseExpiry,mac:g.renewUrl,sales:g.salesEmail})}else{if(g.showMaintenanceExpiryBanner){e=Confluence.Templates.LicenseBanner.maintenanceBanner({days:g.daysBeforeMaintenanceExpiry,mac:g.renewUrl,sales:g.salesEmail})}}if(e){var f=b(e);b("#full-height-container").prepend(f);b("#license-banner-later").click(function(h){h.preventDefault();c.remindMeLater()});b("#license-banner-never").click(function(h){h.preventDefault();c.remindMeNever()});f.find(".icon-close").click(function(h){h.preventDefault();c.remindMeLater()})}}};c.createBanner(d)})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources', location = 'soy/confluence-license-banner.soy' */
// This file was automatically generated from confluence-license-banner.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.LicenseBanner.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.LicenseBanner == 'undefined') { Confluence.Templates.LicenseBanner = {}; }


Confluence.Templates.LicenseBanner.wrapper = function(opt_data, opt_ignored) {
  return '<div>' + soy.$$filterNoAutoescape(opt_data.contentHTML) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.LicenseBanner.wrapper.soyTemplateName = 'Confluence.Templates.LicenseBanner.wrapper';
}


Confluence.Templates.LicenseBanner.expiryBanner = function(opt_data, opt_ignored) {
  var output = '';
  var renewTag__soy8 = '<a id="license-banner-my-link" target="_blank" href="' + soy.$$escapeHtml(opt_data.mac) + '">';
  var end__soy12 = '</a>';
  var mailTag__soy14 = '<a id="license-banner-sales-link" href="mailto:' + soy.$$escapeHtml(opt_data.sales) + '">';
  output += Confluence.Templates.LicenseBanner.wrapper({contentHTML: '' + aui.message.warning({content: '<div id="license-banner-content" data-days="' + soy.$$escapeHtml(opt_data.days) + '" data-subscription="true">' + ((opt_data.days < 0) ? soy.$$filterNoAutoescape(AJS.format("Votre licence a expir\xe9. Cette instance est accessible en lecture seule uniquement. Veuillez renouveler {0}en ligne{1} ou contacter {2}le service commercial{3}.",renewTag__soy8,end__soy12,mailTag__soy14,end__soy12)) : (opt_data.days == 0) ? soy.$$filterNoAutoescape(AJS.format("Votre licence va expirer aujourd\x27\x27hui et Confluence se mettra en lecture seule. Merci de renouveler {0}en ligne{1} ou de contacter {2}nos \xe9quipes commerciales{3}.",renewTag__soy8,end__soy12,mailTag__soy14,end__soy12)) : soy.$$filterNoAutoescape(AJS.format("Votre licence va expirer dans 0,choice,1#{0} jour|1\x3c{0} jours}. Confluence se mettra en lecture lecture seule apr\xe8s l\x27\x27expiration. Merci de renouveler {1}en ligne{2} ou de contacter {3}nos \xe9quipes commerciales{4}.",opt_data.days,renewTag__soy8,end__soy12,mailTag__soy14,end__soy12))) + '</div>', isCloseable: opt_data.days > 7, id: 'license-banner'})});
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.LicenseBanner.expiryBanner.soyTemplateName = 'Confluence.Templates.LicenseBanner.expiryBanner';
}


Confluence.Templates.LicenseBanner.maintenanceBanner = function(opt_data, opt_ignored) {
  var output = '';
  var renewTag__soy39 = '<a id="license-banner-my-link" target="_blank" href="' + soy.$$escapeHtml(opt_data.mac) + '">';
  var end__soy43 = '</a>';
  var later__soy45 = '<a href="#" id="license-banner-later">';
  var never__soy47 = '<a href="#" id="license-banner-never">';
  output += Confluence.Templates.LicenseBanner.wrapper({contentHTML: '' + aui.message.warning({content: '<div id="license-banner-content" data-days="' + soy.$$escapeHtml(opt_data.days) + '" data-subscription="false">' + ((opt_data.days < 0) ? soy.$$filterNoAutoescape(AJS.format("Vous n\x27\x27avez plus acc\xe8s aux fonctionnalit\xe9s Assistance et Mises \xe0 jour. {0}Renouveler en ligne{1}, {2}me le rappeler ult\xe9rieurement{3} ou {4}ne plus me le rappeler{5}.",renewTag__soy39,end__soy43,later__soy45,end__soy43,never__soy47,end__soy43)) : (opt_data.days == 0) ? soy.$$filterNoAutoescape(AJS.format("Votre acc\xe8s aux fonctionnalit\xe9s Assistance et Mises \xe0 jour prendra fin aujourd\x27\x27hui. {0}Renouveler en ligne{1}, {2}me le rappeler ult\xe9rieurement{3} ou {4}ne plus me le rappeler{5}.",renewTag__soy39,end__soy43,later__soy45,end__soy43,never__soy47,end__soy43)) : soy.$$filterNoAutoescape(AJS.format("Votre acc\xe8s aux fonctionnalit\xe9s Assistance et Mises \xe0 jour prendra fin dans {0,choice,1#{0} jour|1\x3c{0} jours}. {1}Renouveler en ligne{2}, {3}me le rappeler ult\xe9rieurement{4} ou {5}ne plus me le rappeler{6}.",opt_data.days,renewTag__soy39,end__soy43,later__soy45,end__soy43,never__soy47,end__soy43))) + '</div>', id: 'license-banner'})});
  return output;
};
if (goog.DEBUG) {
  Confluence.Templates.LicenseBanner.maintenanceBanner.soyTemplateName = 'Confluence.Templates.LicenseBanner.maintenanceBanner';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.soy' */
// This file was automatically generated from appswitcher.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.appswitcher.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher == 'undefined') { navlinks.templates.appswitcher = {}; }


navlinks.templates.appswitcher.linkSection = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.list.length > 0) {
    output += '<div class="aui-nav-heading sidebar-section-header">' + soy.$$escapeHtml(opt_data.title) + '</div><ul class="aui-nav nav-links">';
    var linkList8 = opt_data.list;
    var linkListLen8 = linkList8.length;
    for (var linkIndex8 = 0; linkIndex8 < linkListLen8; linkIndex8++) {
      var linkData8 = linkList8[linkIndex8];
      output += navlinks.templates.appswitcher.applicationsItem(linkData8);
    }
    output += '</ul>';
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.linkSection.soyTemplateName = 'navlinks.templates.appswitcher.linkSection';
}


navlinks.templates.appswitcher.applicationsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link"><a href="' + soy.$$escapeHtml(opt_data.link) + '" ' + ((opt_data.self) ? 'class="checked"' : '') + ' title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span></a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.applicationsItem.soyTemplateName = 'navlinks.templates.appswitcher.applicationsItem';
}


navlinks.templates.appswitcher.shortcutsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link"><a href="' + soy.$$escapeHtml(opt_data.link) + '" ' + ((opt_data.self) ? 'class="checked"' : '') + ' title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' + ((opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '') + '</a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.shortcutsItem.soyTemplateName = 'navlinks.templates.appswitcher.shortcutsItem';
}


navlinks.templates.appswitcher.error = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-error">' + soy.$$filterNoAutoescape("Oups! Quelque chose a mal tourn\xe9. \x3cspan class\x3d\x22app-switcher-retry\x22\x3eEssayez encore\x3c/span\x3e.") + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.error.soyTemplateName = 'navlinks.templates.appswitcher.error';
}


navlinks.templates.appswitcher.sidebarContents = function(opt_data, opt_ignored) {
  return '<div class="aui-page-panel-nav"><nav class="aui-navgroup aui-navgroup-vertical"><div class="app-switcher-section app-switcher-applications"><div class="aui-nav-heading">' + soy.$$escapeHtml("Application Links") + '</div><div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Chargement\x26hellip;") + '</div></div><div class="app-switcher-section app-switcher-shortcuts"><div class="aui-nav-heading">' + soy.$$escapeHtml("Raccourcis") + '</div><div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Chargement\x26hellip;") + '</div></div></nav></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.sidebarContents.soyTemplateName = 'navlinks.templates.appswitcher.sidebarContents';
}


navlinks.templates.appswitcher.trigger = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">' + soy.$$escapeHtml("Applications Li\xe9es") + '</span>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.trigger.soyTemplateName = 'navlinks.templates.appswitcher.trigger';
}


navlinks.templates.appswitcher.projectHeaderSection = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-title">' + aui.avatar.avatar({size: 'large', avatarImageUrl: opt_data.avatarUrl, isProject: true, title: opt_data.name}) + '<div class="sidebar-project-name">' + soy.$$escapeHtml(opt_data.name) + '</div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.projectHeaderSection.soyTemplateName = 'navlinks.templates.appswitcher.projectHeaderSection';
}


navlinks.templates.appswitcher.cogDropdown = function(opt_data, opt_ignored) {
  var output = '';
  var dropdownList__soy74 = '' + navlinks.templates.appswitcher.dropdownList({list: opt_data.links});
  output += aui.dropdown2.dropdown2({menu: {id: opt_data.id, content: dropdownList__soy74, extraClasses: 'aui-style-default sidebar-customize-section'}, trigger: {showIcon: false, content: '<span class="aui-icon aui-icon-small aui-iconfont-configure"></span>', container: '#app-switcher'}});
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.cogDropdown.soyTemplateName = 'navlinks.templates.appswitcher.cogDropdown';
}


navlinks.templates.appswitcher.dropdownList = function(opt_data, opt_ignored) {
  var output = '<ul class="sidebar-admin-links">';
  var linkList82 = opt_data.list;
  var linkListLen82 = linkList82.length;
  for (var linkIndex82 = 0; linkIndex82 < linkListLen82; linkIndex82++) {
    var linkData82 = linkList82[linkIndex82];
    output += '<li class="nav-link"><a href="' + soy.$$escapeHtml(linkData82.href) + '" title="' + soy.$$escapeHtml(linkData82.title) + '"><span class="nav-link-label">' + soy.$$escapeHtml(linkData82.label) + '</span></a></li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.dropdownList.soyTemplateName = 'navlinks.templates.appswitcher.dropdownList';
}


navlinks.templates.appswitcher.switcher = function(opt_data, opt_ignored) {
  var output = '';
  if (true) {
    if (AJS.DarkFeatures.isEnabled('rotp.sidebar')) {
      var sidebarContents__soy97 = '' + navlinks.templates.appswitcher.sidebarContents(null);
      var triggerContent__soy99 = '' + navlinks.templates.appswitcher.trigger(null);
      output += navlinks.templates.appswitcher.sidebar({sidebar: {id: 'app-switcher', content: sidebarContents__soy97}, trigger: {showIcon: false, content: triggerContent__soy99}});
    } else {
      output += navlinks.templates.appswitcher_old.switcher(null);
    }
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.switcher.soyTemplateName = 'navlinks.templates.appswitcher.switcher';
}


navlinks.templates.appswitcher.sidebar = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml(opt_data.sidebar.id) + '" class="sidebar-trigger app-switcher-trigger" aria-owns="' + soy.$$escapeHtml(opt_data.sidebar.id) + '" aria-haspopup="true" data-is-user-admin="' + soy.$$escapeHtml(false) + '" data-is-sidebar="true" >' + soy.$$filterNoAutoescape(opt_data.trigger.content) + '</a><div id=' + soy.$$escapeHtml(opt_data.sidebar.id) + ' class="app-switcher-sidebar aui-style-default sidebar-offscreen">' + soy.$$filterNoAutoescape(opt_data.sidebar.content) + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher.sidebar.soyTemplateName = 'navlinks.templates.appswitcher.sidebar';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.js' */
(function(e,a){var d="is-user-admin";var c="#app-switcher";a.SideBar=function(f){var g=this;this.$sidebar=null;f=e.extend({sidebarContents:null},f);this.getLinks=function(){return e.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateAppLinks).fail(this.showAppSwitcherError)};this.populateProjectHeader=function(i,h){g.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").after(navlinks.templates.appswitcher.projectHeaderSection({avatarUrl:h,name:i}))};this.getProjectData=function(){var h=e(".project-shortcut-dialog-trigger"),i=h.data("key"),j=h.data("entity-type");if(h.size()==0||!i||!j){e(".app-switcher-shortcuts").remove();return}var l,k;k=e.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+i,cache:false,data:{entityType:j},dataType:"json"});l=e.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+i,cache:false,data:{entityType:j},dataType:"json"});e.when(k,l).then(function(n,m){g.updateProjectShortcuts(n,m,{key:i,entityType:j,name:h.data("name"),avatarUrl:h.find("img").prop("src")})},g.showProjectShortcutsError)};this.getSidebar=function(){if(!this.$sidebar){this.$sidebar=e(f.sidebarContents)}return this.$sidebar};this.addApplicationsCog=function(){e(".app-switcher-applications .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-applications-admin-dropdown",links:[{href:AJS.contextPath()+"/plugins/servlet/customize-application-navigator",label:"Configurer le navigateur",title:"Ajouter des nouvelles entr\u00e9es, cacher ce qui existe our restreigner qui voit quoi"},{href:AJS.contextPath()+"/plugins/servlet/applinks/listApplicationLinks",label:"Configurer les liens entre applications",title:"Lien vers plus d\u0027applications Atlassian"}]}))};this.addProjectShortcutsCog=function(h,j){var i=[{href:AJS.contextPath()+"/plugins/servlet/custom-content-links-admin?entityKey="+h,label:"Configurer les raccourcis",title:""}];if(g.entityMappings[j]){i.push({href:g.generateEntityLinksUrl(h,g.entityMappings[j]),label:"G\u00e9rer les liens inter-applications",title:""})}g.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-project-shortcuts-admin-dropdown",links:i}))};this.updateAppLinks=function(h){e(function(){g.getSidebar().find(".app-switcher-applications").html(navlinks.templates.appswitcher.linkSection({title:"Application Links",list:h}));if(g.getSidebar().data(d)){g.addApplicationsCog()}g.bindAnalyticsHandlers(g.getSidebar(),h)})};this.updateProjectShortcuts=function(k,i,j){var l=k[0].shortcuts,h=i[0].shortcuts;g.getSidebar().find(".app-switcher-shortcuts").html(navlinks.templates.appswitcher.linkSection({title:"Raccourcis",list:l.concat(h)}));if(g.getSidebar().data(d)){g.addProjectShortcutsCog(j.key,j.entityType)}g.populateProjectHeader(j.name,j.avatarUrl);g.bindAnalyticsHandlers(g.getSidebar(),data)};this.entityMappings={"confluence.space":"com.atlassian.applinks.api.application.confluence.ConfluenceSpaceEntityType","jira.project":"com.atlassian.applinks.api.application.jira.JiraProjectEntityType","bamboo.project":"com.atlassian.applinks.api.application.bamboo.BambooProjectEntityType","stash.project":"com.atlassian.applinks.api.application.stash.StashProjectEntityType"};this.generateEntityLinksUrl=function(h,i){if(i===g.entityMappings["confluence.space"]){return AJS.contextPath()+"/spaces/listentitylinks.action?typeId="+i+"&key="+h}else{return AJS.contextPath()+"/plugins/servlet/applinks/listEntityLinks/"+i+"/"+h}};this.showAppSwitcherError=function(){e(function(){var h=g.getSidebar();h.find(".app-switcher-applications .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());h.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",e.proxy(g.retryLoading,g))})};this.showProjectShortcutsError=function(){e(function(){var h=g.getSidebar();h.find(".app-switcher-shortcuts .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());h.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",e.proxy(g.retryLoading,g))})};this.retryLoading=function(h){this.getSidebar().html(navlinks.templates.appswitcher.sidebarContents());this.getLinks();this.getProjectData();h&&h.stopPropagation()};this.bindAnalyticsHandlers=function(h,i){};this.getLinks();e(this.getProjectData);this.toggleSidebar=function(j){var k=g.getSidebar(),i=e("body"),h=e(window.document);if(!i.hasClass("app-switcher-open")){var m=e("#header");k.css("left",-k.width());k.parent("body").length||k.appendTo("body");b({data:k});k.animate({left:0},300);function l(n){var p=n.target&&e(n.target),o=n.keyCode;if(n.originalEvent===j.originalEvent){return}if(p&&!o&&!(p.closest(k).length||p.closest(m).length)&&j.which==1&&!(n.shiftKey||n.ctrlKey||n.metaKey)){g.toggleSidebar()}else{if(o===27){g.toggleSidebar()}}}h.on("click.appSwitcher",l);h.on("keydown.appSwitcher",l);h.on("scroll.appSwitcher",k,b)}else{h.off(".appSwitcher")}i.toggleClass("app-switcher-open")};e("#header").on("click",".app-switcher-trigger",this.toggleSidebar)};function b(h){var f=e(document).scrollTop(),i=e("#header"),g=(i.height()+i.offset().top)-f;if(g>=0){h.data.css({top:g,position:"fixed"})}else{h.data.css({top:0,left:0,position:"fixed"})}}e(function(){if(e(c).data("is-sidebar")===true){new a.SideBar({sidebarContents:c})}})}(jQuery,window.NL=(window.NL||{})));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.js' */
var APPSWITCHER_TRIGGER_CLICK="appswitcher.trigger.click";var APPSWITCHER_DROPDOWN_SHOW="appswitcher.dropdown.show";var APPSWITCHER_DROPDOWN_DISPLAY_ERROR="appswitcher.dropdown.display.error";var APPSWITCHER_APP_LINK_CLICK="appswitcher.app.link.click";var APPSWITCHER_CONFIGURE_LINK_CLICK="appswitcher.configure.link.click";(function(c,f){var b="isAppSuggestionAvailable";var d="isSiteAdminUser";var e="isUserAdmin";var a="#app-switcher";f.AppSwitcher=function(j){var l=AJS.contextPath()+"/plugins/servlet/customize-application-navigator";var k="unified.usermanagement";var m=this;this.$dropdown=null;j=c.extend({dropdownContents:null},j);this.getLinks=function(){return c.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateDropdown).fail(this.showError)};this.getDropdown=function(){if(!this.$dropdown){this.$dropdown=c(j.dropdownContents);this.envData=this.$dropdown.data("environment")}return this.$dropdown};this.updateDropdown=function(n){c(function(){m.getDropdown().html(navlinks.templates.appswitcher_old.applications({apps:n,showAdminLink:m.envData[e],adminLink:l}));m.bindAnalyticsHandlers();if(m.envData[b]===true){m.handleSuggestionApps(n)}})};this.bindAnalyticsHandlers=function(){c(".app-switcher-trigger").on("click",function(){AJS.trigger("analyticsEvent",{name:APPSWITCHER_TRIGGER_CLICK})});c("#app-switcher").on("aui-dropdown2-show",function(){AJS.trigger("analyticsEvent",{name:APPSWITCHER_DROPDOWN_SHOW})});c("#app-switcher .nav-link").on("click",function(){var p="custom";var q=c(this).find("a");var o=q.attr("href");var n=window.location.hostname;if(o&&o.indexOf("bitbucket.org")>-1){p="bitbucket-cloud"}else{if(o.indexOf(n+"/wiki")>-1){p="confluence"}else{if(o.indexOf(n+"/build")>-1){p="bamboo"}else{if(o.indexOf(n)>-1){p="jira"}}}}AJS.trigger("analyticsEvent",{name:APPSWITCHER_APP_LINK_CLICK,data:{product:p}})});c(".nav-link-edit-wrapper").on("click",function(){AJS.trigger("analyticsEvent",{name:APPSWITCHER_CONFIGURE_LINK_CLICK})})};this.isBillingSystemEnabled=function(){return(this.envData[d]===true)&&AJS.DarkFeatures.isEnabled(k)};this.handleSuggestionApps=function(q){var r=_.map(q,function(s){return s.applicationType.toLowerCase()});var o=c("<div id='app-switcher-suggestion-apps' class='aui-dropdown2-section'/>");o.html(navlinks.templates.appswitcher_old.suggestionApps);var p=o.find(".suggestion-apps");var n=false;_.each(g,function(s){if(!_.contains(r,s.appName)){n=true;p.append(navlinks.templates.appswitcher_old.suggestionApp({suggestionApp:s,isBillingSystemEnabled:m.isBillingSystemEnabled()}))}});if(!n){return}c("#app-switcher").append(o);c(".app-discovery-suggestion-app").click(function(){var t=c(this).find("a");var s;if(m.envData[d]===true){s="appswitcher.discovery.siteadmin.select.inproduct."}else{s="appswitcher.discovery.user.select."}s=s+t.attr("id").toLowerCase();AJS.trigger("analytics",{name:s})});c(".app-discovery-suggestion-app").hover(function(){c(this).find("a").removeClass("active").removeClass("aui-dropdown2-active")});c(".app-discovery-cancel-button").click(function(){AJS.trigger("analytics",{name:"appswitcher.discovery.nothanks.button.click"});i(h,"true");o.remove()})};this.showError=function(){c(function(){AJS.trigger("analyticsEvent",{name:APPSWITCHER_DROPDOWN_DISPLAY_ERROR});m.getDropdown().html(navlinks.templates.appswitcher_old.error()).off(".appswitcher").on("click.appswitcher",".app-switcher-retry",c.proxy(m.retryLoading,m))})};this.retryLoading=function(n){this.getDropdown().html(navlinks.templates.appswitcher_old.loading());this.getLinks();n&&n.stopPropagation()};this.getLinks()};var h="key-no-thanks";var g=[{appName:"jira",appDesc:"Logiciel de suivi des demandes et des projets",discoveryUrl:"https://www.atlassian.com/software/jira",billingSystemDiscoveryUrl:"/admin/billing/addapplication"},{appName:"confluence",appDesc:"Collaboration et partage de contenu",discoveryUrl:"https://www.atlassian.com/software/confluence",billingSystemDiscoveryUrl:"/admin/billing/addapplication?product=confluence.ondemand"},{appName:"bamboo",appDesc:"Int\u00e9gration continue",discoveryUrl:"https://www.atlassian.com/software/bamboo",billingSystemDiscoveryUrl:"/admin/billing/addapplication?product=bamboo.ondemand"}];var i=function(j,k){c.ajax({url:AJS.contextPath()+"/rest/menu/latest/userdata/",type:"PUT",contentType:"application/json",data:JSON.stringify({key:j,value:k})})};c(function(){if(c(a).data("is-switcher")===true){new f.AppSwitcher({dropdownContents:a})}})}(jQuery,window.NL=(window.NL||{})));
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.soy' */
// This file was automatically generated from appswitcher_old.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.appswitcher_old.
 */

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher_old == 'undefined') { navlinks.templates.appswitcher_old = {}; }


navlinks.templates.appswitcher_old.applications = function(opt_data, opt_ignored) {
  return '' + navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.apps, listClass: 'nav-links', showDescription: opt_data.showDescription}) + ((opt_data.custom) ? navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.custom, showDescription: opt_data.showDescription}) : '') + ((opt_data.showAdminLink) ? navlinks.templates.appswitcher_old.adminSection(opt_data) : '');
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applications.soyTemplateName = 'navlinks.templates.appswitcher_old.applications';
}


navlinks.templates.appswitcher_old.applicationsSection = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.list.length > 0) {
    var param19 = '<ul' + ((opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '') + '>';
    var linkList27 = opt_data.list;
    var linkListLen27 = linkList27.length;
    for (var linkIndex27 = 0; linkIndex27 < linkListLen27; linkIndex27++) {
      var linkData27 = linkList27[linkIndex27];
      param19 += navlinks.templates.appswitcher_old.applicationsItem(soy.$$augmentMap(linkData27, {showDescription: opt_data.showDescription}));
    }
    param19 += '</ul>';
    output += aui.dropdown2.section({content: param19});
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applicationsSection.soyTemplateName = 'navlinks.templates.appswitcher_old.applicationsSection';
}


navlinks.templates.appswitcher_old.applicationsItem = function(opt_data, opt_ignored) {
  return '<li class="nav-link' + ((opt_data.self) ? ' nav-link-local' : '') + '"><a href="' + soy.$$escapeHtml(opt_data.link) + '" class="aui-dropdown2-radio ' + ((opt_data.self) ? 'aui-dropdown2-checked' : '') + '" title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' + ((opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '') + '</a></li>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.applicationsItem.soyTemplateName = 'navlinks.templates.appswitcher_old.applicationsItem';
}


navlinks.templates.appswitcher_old.adminSection = function(opt_data, opt_ignored) {
  return '' + aui.dropdown2.section({content: '<ul class="nav-links"><li><a class="nav-link-edit-wrapper" href="' + soy.$$escapeHtml(opt_data.adminLink) + '"><span class="nav-link-edit">' + soy.$$filterNoAutoescape("Configurer\x26hellip;") + '</span></a></li></ul>'});
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.adminSection.soyTemplateName = 'navlinks.templates.appswitcher_old.adminSection';
}


navlinks.templates.appswitcher_old.error = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-error">' + soy.$$filterNoAutoescape("Oups! Quelque chose a mal tourn\xe9. \x3cspan class\x3d\x22app-switcher-retry\x22\x3eEssayez encore\x3c/span\x3e.") + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.error.soyTemplateName = 'navlinks.templates.appswitcher_old.error';
}


navlinks.templates.appswitcher_old.loading = function(opt_data, opt_ignored) {
  return '<div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Chargement\x26hellip;") + '</div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.loading.soyTemplateName = 'navlinks.templates.appswitcher_old.loading';
}


navlinks.templates.appswitcher_old.trigger = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">' + soy.$$escapeHtml("Applications Li\xe9es") + '</span>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.trigger.soyTemplateName = 'navlinks.templates.appswitcher_old.trigger';
}


navlinks.templates.appswitcher_old.switcher = function(opt_data, opt_ignored) {
  var output = '';
  if (true) {
    var loadingContent__soy81 = '' + navlinks.templates.appswitcher_old.loading(null);
    var triggerContent__soy83 = '' + navlinks.templates.appswitcher_old.trigger(null);
    output += aui.dropdown2.dropdown2({menu: {id: 'app-switcher', content: loadingContent__soy81, extraClasses: 'aui-style-default', extraAttributes: {'data-environment': {}, 'data-is-switcher': 'true'}}, trigger: {showIcon: false, content: triggerContent__soy83, extraClasses: 'app-switcher-trigger', extraAttributes: {href: '#app-switcher'}}});
  }
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.switcher.soyTemplateName = 'navlinks.templates.appswitcher_old.switcher';
}


navlinks.templates.appswitcher_old.suggestionApp = function(opt_data, opt_ignored) {
  var output = '';
  var href__soy89 = opt_data.isBillingSystemEnabled == true ? opt_data.suggestionApp.billingSystemDiscoveryUrl : opt_data.suggestionApp.discoveryUrl;
  output += '<li class="app-discovery-suggestion-app"><a id="' + soy.$$escapeHtml(opt_data.suggestionApp.appName) + '" href="' + soy.$$escapeHtml(href__soy89) + '" class="app-discovery-link aui-icon-container app-discovery-' + soy.$$escapeHtml(opt_data.suggestionApp.appName) + '-product-icon" title="' + soy.$$escapeHtml(href__soy89) + '" target="_blank"/><div class="app-discovery-small">' + soy.$$escapeHtml(opt_data.suggestionApp.appDesc) + '</div></li>';
  return output;
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.suggestionApp.soyTemplateName = 'navlinks.templates.appswitcher_old.suggestionApp';
}


navlinks.templates.appswitcher_old.suggestionApps = function(opt_data, opt_ignored) {
  return '<ul class=\'nav-links suggestion-apps\'><li><span class=\'app-discovery-suggest-title nav-link-label\'><h6>' + soy.$$escapeHtml("Essayer d\x27autres applications Atlassian") + '</h6></span></li></ul><div class=\'buttons-container app-discovery-suggest-apps-buttons\'><div class=\'buttons\'><button class=\'aui-button aui-button-link app-discovery-cancel-button\' name=\'cancel\' accesskey=\'c\' href=\'#\'>' + soy.$$escapeHtml("Ne plus afficher ce message") + '</button></div></div>';
};
if (goog.DEBUG) {
  navlinks.templates.appswitcher_old.suggestionApps.soyTemplateName = 'navlinks.templates.appswitcher_old.suggestionApps';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:common-header-resources', location = '/includes/js/header-user-menu.js' */
define("confluence/header-user-menu",["jquery","confluence/meta","underscore"],function(a,c,b){function d(){var b=c.get("current-user-avatar-uri-reference");a("#user-menu-link").find(".aui-avatar-inner img").attr("src",b)}return function(){b.defer(d)}});require("confluence/module-exporter").safeRequire("confluence/header-user-menu",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.web.resources:general-analytics-bindings', location = '/includes/js/analytics-bindings.js' */
define("confluence/analytics-bindings",["jquery","confluence/analytics-support"],function(b,d){return function(){function e(a,c){b(a).on("click",".view-historical-version-trigger",function(){d.publish("confluence.page.view-historical.from-"+(c||"unknown"))})}function f(a,c){b(a).on("click",".restore-historical-version-trigger",function(){d.publish("confluence.page.restore-historical.from-"+(c||"unknown"))})}function g(a,c){b("#header .aui-header-secondary "+a).on("click",function(){var a=b(this).hasClass("aui-dropdown2-active")?
"expanded":"collapsed";d.publish("confluence.header.dropdown."+c,{state:a})})}e("#page-history-warning","navigation");e("#page-history-container","history");e(".diff-menu","diff");f("#page-history-warning","navigation");f("#page-history-container","history");g("#admin-menu-link","administration");g("#user-menu-link","profile")}});require("confluence/module-exporter").safeRequire("confluence/analytics-bindings",function(b){require("ajs").toInit(b)});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.mywork.mywork-confluence-host-plugin:mw-header-anchor', location = 'templates/anchor.soy' */
// This file was automatically generated from anchor.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace MyWork.Templates.Anchor.
 */

if (typeof MyWork == 'undefined') { var MyWork = {}; }
if (typeof MyWork.Templates == 'undefined') { MyWork.Templates = {}; }
if (typeof MyWork.Templates.Anchor == 'undefined') { MyWork.Templates.Anchor = {}; }


MyWork.Templates.Anchor.tasksFeatureDiscovery = function(opt_data, opt_ignored) {
  return '<p>' + soy.$$escapeHtml("Consultez les t\xe2ches qui vous sont attribu\xe9es ou que vous avez cr\xe9\xe9es dans l\x27onglet T\xe2ches de votre profil.") + '</p><ul class="mw-tasks-discovery-controls"><li><a id="mw-tasks-discovery-view" href="' + soy.$$escapeHtml(opt_data.tasksUrl) + '" class="aui-button aui-style"><p>' + soy.$$escapeHtml("Afficher les t\xe2ches") + '</p></a></li><li><a id="mw-tasks-discovery-dismiss" href="#">' + soy.$$escapeHtml("Ignorer") + '</a></li></ul>';
};
if (goog.DEBUG) {
  MyWork.Templates.Anchor.tasksFeatureDiscovery.soyTemplateName = 'MyWork.Templates.Anchor.tasksFeatureDiscovery';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.mywork.mywork-confluence-host-plugin:mw-header-anchor', location = 'js/miniview-anchor.js' */
var MW=MW||{$:AJS.$||Zepto};MW.MV={};AJS.toInit(function(){if(AJS.Meta&&!AJS.Meta.get("remote-user")){return}MW.MV.AnchorManager=function(){var l=contextPath,h=l+"/plugins/servlet/notifications-miniview",p=0,e=/[?&]show-miniview/.test(window.location.search);function r(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var s="[\\?\\#&]"+t+"=([^&#]*)";var v=new RegExp(s);var u=v.exec(window.location.search);if(u!==null){return decodeURIComponent(u[1].replace(/\+/g," "))}}var o=r("show-miniview");if(o){h+="#notification/"+o}function q(){var s="badge-i aui-icon aui-icon-small aui-iconfont-workbox-empty";MW.$("#notifications-anchor").html('<div class="'+s+'"></div><span class="badge-w"><span class="badge"></span></span>').attr("title","Ouvrir les notifications")}function f(u){var t=false,s;return function(){if(t){return s}t=true;s=u.apply(this,arguments);return s}}var n=f(function(){MW.Dialog.getOptions().closeOthers=false;MW.Dialog.preload=true;MW.Dialog.show();MW.Dialog.hide();MW.Dialog.getOptions().closeOthers=true});function k(s){return s<=9?s:"9+"}function j(s){var t=MW.$("#notifications-anchor"),u=t.find(".badge"),v=t.find(".aui-icon");u.html(k(s));p=s;if(s>0){t.addClass("unread").removeClass("read");v.addClass("aui-iconfont-workbox").removeClass("aui-iconfont-workbox-empty");if(t.is(":visible")&&!e){n()}}else{t.addClass("read").removeClass("unread");v.addClass("aui-iconfont-workbox-empty").removeClass("aui-iconfont-workbox")}}function m(){c("notifications",h);d()}function d(){MW.$(document).keydown(function(s){if(AJS.InlineDialog.current&&s.which==27&&!MW.$(s.target).is(":input")){AJS.InlineDialog.current.hide()}})}function i(){MW.$("#header-menu-bar").find(".ajs-drop-down").each(function(){this.hide()})}function c(x,v){var w;var u=function(){w=this};var s=function(){if(this.preload!==true){var y=JSON.stringify({markAllRead:true});MW.$("#"+x+"-miniview-iframe")[0].contentWindow.postMessage(y,"*")}};if(!window.addEventListener){window.attachEvent("onmessage",t)}else{window.addEventListener("message",t,false)}function t(A){function B(C){return C===location.protocol+"//"+location.host}if("escKey"===A.data){w.hide();MW.$("#notifications-anchor").focus();document.activeElement.blur()}else{if("getParentConfig"===A.data&&B(A.origin)){var z=JSON.stringify({parentConfig:{parentUrl:location.href,preload:MW.Dialog.preload,unread:p}}),y=MW.$("#"+x+"-miniview-iframe")[0].contentWindow;y.postMessage(z,"*");if(MW.Dialog.preload){MW.Dialog.preload=false}else{y.focus()}}}}MW.Dialog=AJS.InlineDialog(MW.$("#"+x+"-anchor"),x+"-miniview",function(B,z,C){if(MW.$(B).children().length===0){MW.$(B).append(MW.$('<iframe id="'+x+'-miniview-iframe" src="'+v+'" frameborder="0"></iframe>'))}else{var A=JSON.stringify({unread:p}),y=MW.$("#"+x+"-miniview-iframe")[0].contentWindow;y.postMessage(A,"*");setTimeout(function(){y.focus()},100)}i();C()},{width:500,height:520,hideDelay:null,initCallback:u,hideCallback:s,noBind:true});MW.Tasks=(function(){var A=300;var z=20;var B=16;var G;var D=AJS.$("#user-menu-link");var C=AJS.$("#user-menu-link-content");var y=C.find("#view-mytasks-link");var E=function(J,H,K){var I=MyWork.Templates.Anchor.tasksFeatureDiscovery({tasksUrl:AJS.contextPath()+"/plugins/inlinetasks/mytasks.action"});J.html(I);J.find("#mw-tasks-discovery-dismiss").click(function(){G.hide()});K()};var F=function(){MW.Dialog.hide();var J=function(){return C.is(":visible")};if(!J()){D.trigger("aui-button-invoke")}var H=function(){G.hide()};C.one("aui-dropdown2-hide",H);G=AJS.InlineDialog(y,"my-tasks-discovery",E,{hideCallback:function(){G.unbind("click focusin mousedown",I);C.unbind("aui-dropdown2-hide",H);if(J()){D.trigger("aui-button-invoke")}MW.$("#inline-dialog-my-tasks-discovery").remove()},gravity:"w",useLiveEvents:true,width:A,noBind:true});C.find(".user-item.active").removeClass("active");y.addClass("active");y.focus();var I=function(K){K.stopPropagation()};G.on("click focusin mousedown",I);G.show()};return{closeAndDiscoverMyTasks:F}})();MW.$("#"+x+"-anchor").click(function(y){y.preventDefault();if(MW.$("#"+x+"-miniview-iframe").is(":visible")){MW.Dialog.hide()}else{MW.Dialog.show()}});if(e){MW.$("#"+x+"-anchor").click()}}function g(){q();m()}return{setupAnchors:g,updateNotificationCount:j}}();MW.MV.AnchorManager.setupAnchors();var b=new MW.AnchorUtil(MW.$,contextPath,MW.MV.AnchorManager.updateNotificationCount);b.setupAnchors();MW.$("#notifications-anchor").click(function(){AJS.trigger("analytics",{name:"mywork.host.button.clicked.notifications",data:{}});MW.MV.AnchorManager.updateNotificationCount(0)});var a=function(){if(document.hidden){b.stopRequests(true)}else{b.startRequests()}};document.addEventListener("visibilitychange",a,false);if(typeof document.hidden==="undefined"){MW.$(window).focus(function(){b.startRequests()})}MW.$("body").click(function(){b.startRequests()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.mywork.mywork-confluence-host-plugin:mw-header-anchor', location = 'js/util/anchor-util.js' */
MW.AnchorUtil=function(d,k,e){var f=30000,i=f,s,p=k+"/rest/mywork/latest/status/notification/count";var r=new Date().getTime();var b=5*60*1000;var t=1000*60*5;var h=1.25;var c=0;function q(u){window.clearInterval(s);s=undefined;if(u===true){i=f}}function o(){return(new Date().getTime()-r)<t}function m(){if(!o()||!s){l()}r=new Date().getTime()}function l(){if(s){clearTimeout(s)}s=setTimeout(function(){g()},c=n(c))}function a(w,u){var v=w*1000;b=u*1000||b;if(v&&v!=i){i=v;m()}}function n(u){return Math.min(o()?i:u*h,b)}function g(u){MW.$.getJSON(p+((u)?"?pageid="+u:""),function(w){a(w.timeout,w.maxTimeout);var v=w.count;e(v)});l()}function j(){var u=AJS&&AJS.Meta&&AJS.Meta.get&&(AJS.Meta.get("content-type")==="page"||AJS.Meta.get("content-type")==="blogpost");if(u){g(AJS.Meta.get("page-id"))}else{g()}m()}return{setupAnchors:j,startRequests:m,stopRequests:q,updateAnchors:g}};
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.dialog-wizard:dialog-wizard-resources', location = '/soy/dialog-wizard.soy' */
// This file was automatically generated from dialog-wizard.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.DialogWizard.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.DialogWizard == 'undefined') { Confluence.Templates.DialogWizard = {}; }


Confluence.Templates.DialogWizard.pageContainer = function(opt_data, opt_ignored) {
  return '<div class="dialog-wizard-page-wrapper"><div class="dialog-wizard-page-main"></div><div class="dialog-wizard-page-description">' + ((opt_data.descriptionHeaderLink && opt_data.descriptionHeader) ? '<h3><a href=\'' + soy.$$escapeHtml(opt_data.descriptionHeaderLink) + '\' target=\'_blank\'>' + soy.$$escapeHtml(opt_data.descriptionHeader) + '</a></h3>' : (opt_data.descriptionHeader) ? '<h3>' + soy.$$escapeHtml(opt_data.descriptionHeader) + '</h3>' : '') + '<p>' + soy.$$escapeHtml(opt_data.descriptionContent) + '</p></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.DialogWizard.pageContainer.soyTemplateName = 'Confluence.Templates.DialogWizard.pageContainer';
}


Confluence.Templates.DialogWizard.waitIcon = function(opt_data, opt_ignored) {
  return '<img class="wait-icon" src="' + soy.$$escapeHtml("") + '/images/icons/wait.gif">';
};
if (goog.DEBUG) {
  Confluence.Templates.DialogWizard.waitIcon.soyTemplateName = 'Confluence.Templates.DialogWizard.waitIcon';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.dialog-wizard:dialog-wizard-resources', location = '/js/dialog-wizard.js' */
(function($){function findNextPageId(pageId,pages){var thisPageIdIndex=-1;_.each(pages,function(element,index){if(element.id==pageId){thisPageIdIndex=index;return}});return pages[thisPageIdIndex+1].id}Confluence.DialogWizard=function(dialog,finalAction){function newPage(config,pageId,soyRenderContext,wizardData,wizard){var wizardPage=_.find(config.wizard.pages,function(page){return page.id==pageId});wizard.trigger("pre-render."+pageId,{soyRenderContext:soyRenderContext,wizardData:wizardData});try{var soyTemplateFunction=eval(wizardPage.templateKey);var $soyRender=$(soyTemplateFunction(soyRenderContext))}catch(e){throw Error("wizard points to a non-existent Soy template '"+wizardPage.templateKey+"'. Check your web-resources or server logs.")}$soyRender.find("a, area, button, input, object, select, textarea").attr("tabindex","10");var $panelContent;if(wizardPage.descriptionContent){$panelContent=$(Confluence.Templates.DialogWizard.pageContainer({descriptionHeaderLink:wizardPage.descriptionHeaderLink,descriptionHeader:wizardPage.descriptionHeader,descriptionContent:wizardPage.descriptionContent}));$panelContent.addClass("with-description").find(".dialog-wizard-page-main").append($soyRender)}else{$panelContent=$soyRender}var dialogPageId=pageId;if(dialog.id=="create-dialog"){dialogPageId="create-dialog-"+pageId}var page=dialog.addPage(dialogPageId).page[dialog.curpage];page.addHeader(wizardPage.title).addPanel("SinglePanel",$panelContent,"singlePanel");page.element.find("form").submit(function(){return false});if(wizardPage.descriptionContent){page.element.find(".dialog-panel-body").css({padding:0})}Confluence.Binder.autocompleteMultiUser($soyRender);Confluence.Binder.placeholder($soyRender);function nextCallback(ev){$soyRender.find(".placeholded").val("");var pageData={};var formArray=$soyRender.parent().find("form").serializeArray();_.each(formArray,function(item){pageData[item.name]=item.value});var e=$.Event("submit."+pageId);var state={$container:$soyRender,wizardData:wizardData,pageData:pageData};var validationDeferred=$.Deferred();validationDeferred.done(function(){wizardData.pages[pageId]=pageData;var nextPageId;if(state.nextPageId){nextPageId=state.nextPageId}else{nextPageId=!wizardPage.last&&findNextPageId(pageId,config.wizard.pages)}if(!state.nextPageId&&wizardPage.last){doFinalAction(ev,state,wizardData,finalAction,wizard);dialog.popup.element.find(":input,a").filter(":visible").disable().addClass("disabled");buttons.prepend(Confluence.Templates.DialogWizard.waitIcon())}else{newPage(config,nextPageId,soyRenderContext,wizardData,wizard)}});validationDeferred.fail(function(){AJS.log("dialog aborted by on-submit callback on page: "+pageId)});state.validationDeferred=validationDeferred;wizard.trigger(e,state);if(state.async){return}if(e.isDefaultPrevented()){validationDeferred.reject();return}validationDeferred.resolve()}var buttons=dialog.addFullButtonPanel(page,nextCallback,null,wizardPage.last);buttons.find(".button-panel-back").click(function(){delete wizardData.pages[pageId]});buttons.find(".aui-button-primary").attr("tabindex","10");$soyRender.find("input, select, textarea").eq(0).focus();wizard.trigger("post-render."+pageId,{$container:$soyRender,wizardData:wizardData})}function doFinalAction(ev,state,wizardData,finalAction,wizard){if(state.finalUrl){window.location=state.finalUrl}else{_.each(wizardData.pages,function(pageData){_.extend(wizardData,pageData)});delete wizardData.pages;finalAction(ev,wizardData,null,wizard)}}return{newPage:newPage,doFinalAction:doFinalAction}}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:common-template-resources', location = 'com/atlassian/confluence/plugins/blueprint/common/soy/common-templates.soy' */
// This file was automatically generated from common-templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Blueprints.Common.Index.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Common == 'undefined') { Confluence.Blueprints.Common = {}; }
if (typeof Confluence.Blueprints.Common.Index == 'undefined') { Confluence.Blueprints.Common.Index = {}; }


Confluence.Blueprints.Common.Index.detailsSummaryMacro = function(opt_data, opt_ignored) {
  return '<ac:macro ac:name="detailssummary"><ac:parameter ac:name="label">' + soy.$$escapeHtml(opt_data.label) + '</ac:parameter><ac:parameter ac:name="spaces">' + soy.$$escapeHtml(opt_data.spaces) + '</ac:parameter><ac:parameter ac:name="firstcolumn">' + soy.$$escapeHtml(opt_data.firstcolumn) + '</ac:parameter><ac:parameter ac:name="headings">' + soy.$$escapeHtml(opt_data.headings) + '</ac:parameter><ac:parameter ac:name="blankTitle">' + soy.$$escapeHtml(opt_data.blankTitle) + '</ac:parameter><ac:parameter ac:name="blankDescription">' + soy.$$escapeHtml(opt_data.blankDescription) + '</ac:parameter><ac:parameter ac:name="contentBlueprintId">' + soy.$$escapeHtml(opt_data.contentBlueprintId) + '</ac:parameter><ac:parameter ac:name="blueprintModuleCompleteKey">' + soy.$$escapeHtml(opt_data.blueprintModuleCompleteKey) + '</ac:parameter><ac:parameter ac:name="createButtonLabel">' + soy.$$escapeHtml(opt_data.createButtonLabel) + '</ac:parameter></ac:macro>';
};
if (goog.DEBUG) {
  Confluence.Blueprints.Common.Index.detailsSummaryMacro.soyTemplateName = 'Confluence.Blueprints.Common.Index.detailsSummaryMacro';
}


Confluence.Blueprints.Common.Index.createFromTemplateMacro = function(opt_data, opt_ignored) {
  return '<ac:macro ac:name="create-from-template"><ac:parameter ac:name="blueprintModuleCompleteKey">' + soy.$$escapeHtml(opt_data.moduleKey) + '</ac:parameter><ac:parameter ac:name="buttonLabel">' + soy.$$escapeHtml(opt_data.buttonLabel) + '</ac:parameter><ac:parameter ac:name="spaceKey">' + soy.$$escapeHtml(opt_data.spaceKey) + '</ac:parameter><ac:parameter ac:name="templateName">' + soy.$$escapeHtml(opt_data.templateName) + '</ac:parameter></ac:macro>';
};
if (goog.DEBUG) {
  Confluence.Blueprints.Common.Index.createFromTemplateMacro.soyTemplateName = 'Confluence.Blueprints.Common.Index.createFromTemplateMacro';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:meeting-notes-resources', location = 'com/atlassian/confluence/plugins/meetingnotes/soy/how-to.soy' */
// This file was automatically generated from how-to.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Blueprints.Meeting.Notes.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Blueprints == 'undefined') { Confluence.Blueprints = {}; }
if (typeof Confluence.Blueprints.Meeting == 'undefined') { Confluence.Blueprints.Meeting = {}; }
if (typeof Confluence.Blueprints.Meeting.Notes == 'undefined') { Confluence.Blueprints.Meeting.Notes = {}; }


Confluence.Blueprints.Meeting.Notes.howTo = function(opt_data, opt_ignored) {
  return '<h1>' + soy.$$escapeHtml("Avec les notes de r\xe9union vous pouvez...") + '</h1><ol class="howto-steps"><li class="howto-step"><div><h3>' + soy.$$escapeHtml("Partager l\x27ordre du jour") + '</h3><p>' + soy.$$escapeHtml("Ne d\xe9viez plus de votre agenda en partageant l\x27ordre du jour.") + '</p></div></li><li class="howto-step"><div><h3>' + soy.$$escapeHtml("Saisir des proc\xe8s-verbaux") + '</h3><p>' + soy.$$escapeHtml("Prendre des notes et les partager avec tout le monde.") + '</p></div></li><li class="howto-step"><div><h3>' + soy.$$escapeHtml("Cr\xe9er et assigner les t\xe2ches") + '</h3><p>' + soy.$$escapeHtml("Attribuer les t\xe2ches du plan d\x27action aux participants de la r\xe9union.") + '</p></div></li></ol>';
};
if (goog.DEBUG) {
  Confluence.Blueprints.Meeting.Notes.howTo.soyTemplateName = 'Confluence.Blueprints.Meeting.Notes.howTo';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-business-blueprints:meeting-notes-resources', location = 'com/atlassian/confluence/plugins/meetingnotes/soy/user-mention.soy' */
// This file was automatically generated from user-mention.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Meeting.Notes.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Meeting == 'undefined') { Confluence.Templates.Meeting = {}; }
if (typeof Confluence.Templates.Meeting.Notes == 'undefined') { Confluence.Templates.Meeting.Notes = {}; }


Confluence.Templates.Meeting.Notes.userMention = function(opt_data, opt_ignored) {
  opt_data = opt_data || {};
  return '' + ((opt_data.username) ? '<li><p><ac:link><ri:user ri:username="' + soy.$$escapeHtml(opt_data.username) + '" /></ac:link></p></li><li><p><ac:placeholder ac:type="mention">' + soy.$$escapeHtml("@mentionnez une personne pour l\x27ajouter en tant que participant et elle sera notifi\xe9e.") + '</ac:placeholder></p></li>' : '<li><p><ac:placeholder ac:type="mention">' + soy.$$escapeHtml("@mentionnez une personne pour l\x27ajouter en tant que participant et elle sera notifi\xe9e.") + '</ac:placeholder></p></li>');
};
if (goog.DEBUG) {
  Confluence.Templates.Meeting.Notes.userMention.soyTemplateName = 'Confluence.Templates.Meeting.Notes.userMention';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-request-access-plugin:confluence-request-access-plugin-resources', location = '/js/request-access.js' */
AJS.toInit(function(e){var b=AJS.Meta.get("page-id"),c=e("#page-restricted-container"),a=AJS.Meta.get("remote-user"),d=e("#page-restricted-container button");if(c.length){e("#breadcrumbs").hide();e("#title-text.with-breadcrumbs").hide();if(d.length){AJS.trigger("analyticsEvent",{name:"confluence.request.access.plugin.request.access.to.page.view",data:{pageId:b,requestAccessUser:a}})}}d.click(function(){AJS.trigger("analyticsEvent",{name:"confluence.request.access.plugin.request.access.to.page",data:{pageId:b,requestAccessUser:a}});d.attr("aria-disabled","true");var f,g=e(Confluence.Request.Access.loading({}));d.replaceWith(g);e.ajax({url:Confluence.getContextPath()+"/rest/request-access/latest/page/restriction/"+b,success:function(h){f=e(Confluence.Request.Access.result({success:true,recipient:h}));c.removeClass("page-restricted");c.addClass("access-requested")},error:function(h,i){f=e(Confluence.Request.Access.result({success:false}))},complete:function(){g.replaceWith(f);Confluence.Binder.userHover()}})})})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-request-access-plugin:confluence-request-access-plugin-resources', location = '/js/grant-access.js' */
AJS.toInit(function(d){var a=AJS.Meta.get("page-id"),f=AJS.Meta.get("remote-user"),h=j("username"),e=j("userFullName");var c=e.split("+");e=c.join(" ");var g=d("#system-content-items");var k=d("#content-metadata-page-restrictions.restricted").length!==0;if(!g.length||!k||!j("grantAccess")){return}var b=d(Confluence.Request.Access.loading());var i=AJS.InlineDialog(g,"grantAccessDialog",function(m,l,n){m.css({padding:"20px"}).html(Confluence.Grant.Access.dialog({requestAccessUsername:h,requestAccessUserFullName:e}));m.on("click",".aui-button.grant-access",function(q){q.stopPropagation();var p=m.find(".actions-result");p.replaceWith(b);AJS.trigger("analyticsEvent",{name:"confluence.request.access.plugin.grant.access.to.page",data:{pageId:a,grantAccessUser:f,requestAccessUser:h}});var o="",r=true;d.ajax({url:Confluence.getContextPath()+"/rest/request-access/latest/page/restriction/"+a,type:"POST",contentType:"application/json; charset=utf-8",data:h,success:function(t,u,s){if(s.status==202){o="L\u0027acc\u00e8s a d\u00e9j\u00e0 \u00e9t\u00e9 accord\u00e9 \u00e0 l\u0027utilisateur."}else{o="L\u0027acc\u00e8s a \u00e9t\u00e9 accord\u00e9, une notification sera envoy\u00e9e \u00e0 l\u0027utilisateur."}},error:function(s){r=false;if(s.status==412){o="L\u0027acc\u00e8s a \u00e9t\u00e9 accord\u00e9 mais il n\u0027y a pas de serveur de courrier \u00e9lectronique configur\u00e9, par cons\u00e9quent la notification n\u0027a pas pu \u00eatre envoy\u00e9e."}else{if(s.status==502){o="L\u0027acc\u00e8s a \u00e9t\u00e9 accord\u00e9 mais une erreur inattendue est survenue pendant l\u0027envoi de la notification."}else{o="Une erreur inattendue s\u0027est produite lors de l\u0027autorisation d\u0027acc\u00e8s."}}},complete:function(s){b.replaceWith(d(Confluence.Grant.Access.result({success:r,message:o})));setTimeout(function(){i.hide()},6000)}})});m.on("click",".aui-button.deny-access",function(o){AJS.trigger("analyticsEvent",{name:"confluence.request.access.plugin.deny.access.to.page",data:{pageId:a,grantAccessUser:f,requestAccessUser:h}});i.hide()});n();return false},{offsetY:2,offsetX:0,width:350,hideDelay:null,noBind:true,hideCallback:function(){setTimeout(i.hide(),5000)}});i.show();function j(l){l=l.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+l+"=([^&#]*)"),m=n.exec(location.search);return m==null?"":decodeURIComponent(m[1].replace(/\+/g," "))}})(AJS.$);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-request-access-plugin:confluence-request-access-plugin-resources', location = '/templates/soy/request-access.soy' */
// This file was automatically generated from request-access.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Request.Access.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Request == 'undefined') { Confluence.Request = {}; }
if (typeof Confluence.Request.Access == 'undefined') { Confluence.Request.Access = {}; }


Confluence.Request.Access.result = function(opt_data, opt_ignored) {
  var output = '<div id="request-access">';
  if (opt_data.success) {
    var usernameLink__soy6 = '' + Confluence.Request.Access.usernameLink({user: opt_data.recipient});
    output += '<span class="aui-icon aui-icon-small aui-iconfont-approve" data-unicode="UTF+E005" original-title=""></span><p class="title">' + soy.$$filterNoAutoescape(AJS.format("Votre requ\xeate a \xe9t\xe9 envoy\xe9e \xe0 {0}. Si elle est approuv\xe9e, vous recevrez un courrier \xe9lectronique sous peu.",usernameLink__soy6)) + '</p>';
  } else {
    output += '<span class="aui-icon aui-icon-small aui-iconfont-error" data-unicode="UTF+E011" original-title=""></span><p class="title">' + soy.$$escapeHtml("Votre requ\xeate d\x27acc\xe8s n\x27a pas \xe9t\xe9 envoy\xe9e. Contactez votre administrateur d\x27espace.") + '</p>';
  }
  output += '</div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Request.Access.result.soyTemplateName = 'Confluence.Request.Access.result';
}


Confluence.Request.Access.usernameLink = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml("") + '/display/~' + soy.$$escapeUri(opt_data.user.name) + '" class="url fn confluence-userlink" title data-username="' + soy.$$escapeHtml(opt_data.user.name) + '">' + soy.$$escapeHtml(opt_data.user.fullName) + '</a>';
};
if (goog.DEBUG) {
  Confluence.Request.Access.usernameLink.soyTemplateName = 'Confluence.Request.Access.usernameLink';
}


Confluence.Request.Access.loading = function(opt_data, opt_ignored) {
  return '<span class=\'aui-icon aui-icon-wait\'>' + soy.$$escapeHtml("Chargement, patientez s\x27il vous pla\xeet") + '</span>"';
};
if (goog.DEBUG) {
  Confluence.Request.Access.loading.soyTemplateName = 'Confluence.Request.Access.loading';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-request-access-plugin:confluence-request-access-plugin-resources', location = '/templates/soy/grant-access.soy' */
// This file was automatically generated from grant-access.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Grant.Access.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Grant == 'undefined') { Confluence.Grant = {}; }
if (typeof Confluence.Grant.Access == 'undefined') { Confluence.Grant.Access = {}; }


Confluence.Grant.Access.dialog = function(opt_data, opt_ignored) {
  var output = '<div class="grant-access-dialog">';
  var usernameLink__soy4 = '' + Confluence.Grant.Access.usernameLink({username: opt_data.requestAccessUsername, userFullName: opt_data.requestAccessUserFullName});
  output += '<h2 class="grant-access-title">' + soy.$$escapeHtml("Demande d\x27acc\xe8s") + '</h2><p class="grant-access-message">' + soy.$$filterNoAutoescape(AJS.format("{0} veut afficher cette page.",usernameLink__soy4)) + '</p><div class="actions-result"><button class="aui-button grant-access">' + soy.$$escapeHtml("Autoriser l\x27acc\xe8s") + '</button><button class="aui-button aui-button-link deny-access">' + soy.$$escapeHtml("Refuser") + '</button><div></div>';
  return output;
};
if (goog.DEBUG) {
  Confluence.Grant.Access.dialog.soyTemplateName = 'Confluence.Grant.Access.dialog';
}


Confluence.Grant.Access.result = function(opt_data, opt_ignored) {
  return '<span class="aui-icon aui-icon-small aui-iconfont-' + ((opt_data.success) ? 'approve' : 'error') + '" data-unicode="UTF+E011" original-title=""></span><p class="title">' + soy.$$escapeHtml(opt_data.message) + '</p>';
};
if (goog.DEBUG) {
  Confluence.Grant.Access.result.soyTemplateName = 'Confluence.Grant.Access.result';
}


Confluence.Grant.Access.usernameLink = function(opt_data, opt_ignored) {
  return '<a href="' + soy.$$escapeHtml("") + '/display/~' + soy.$$escapeHtml(opt_data.username) + '" class="url fn" title data-username="' + soy.$$escapeHtml(opt_data.username) + '"><strong>' + soy.$$escapeHtml(opt_data.userFullName) + '</strong> (' + soy.$$escapeHtml(opt_data.username) + ')</a>';
};
if (goog.DEBUG) {
  Confluence.Grant.Access.usernameLink.soyTemplateName = 'Confluence.Grant.Access.usernameLink';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.quickedit:quick-comment-hide-traditional', location = 'jscripts/add-comment-hider.js' */
define("confluence-quick-edit/add-comment-hider",[],function(){return function(a){a("#comments-actions").hide()}});require("confluence/module-exporter").safeRequire("confluence-quick-edit/add-comment-hider",function(a){require("ajs").toInit(a)});
}catch(e){WRMCB(e)};