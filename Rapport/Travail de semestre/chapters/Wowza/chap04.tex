%
% File: chap01.tex
% Author: Zeller Quentin
% Description: Introduction
%
%\let\textcircled=\pgftextcircled
\chapter{Wowza}
\label{chap:Wowza}
\section{Wowza transcoder and overlay}
\label{sec:sec04a}
\initial{W}owza est un serveur de distribution multimédia. Il permet aussi de transcoder les flux vidéo cependant les utilisateurs du services semblent préférer à l'heure actuelle la librairie FFmpeg pour une bonne partie des transcodage, Wowza ne supportant que l'encodage en H.264, VP8 et VP9.
Pour ce qui est du projet, Wowza possède une API de transcodage comportant certaines fonction d'overlays. Leur documentation propose un module exemple qui ajoute du texte dans un flux transcodé par Wowza. Contrairement a la facilité d'implémentation des overlays OpenCV, ici nous nous retrouvons avec plus d'un millier de lignes de code. Cette implémentation propose deux endroit où ajouter les overlays. La première est lors du décodage. Cette méthode à l'avantage d'être plus performante car les transformations sont ajoutée une seule fois à la lecture du flux. Suivant le format, il se peux que le rendu soit détérioré lors de la mise a l'échelle et l'encodage du flux. La deuxième méthode consiste à modifier la vidéo lors de l'encodage. Elle dispose d'un rendu de meilleur qualité car les overlays ajouté sont de la même résolution que le flux sortant. Il faudra cependant beaucoup plus de ressources pour traiter les vidéos si plusieurs flux de sorties sont paramétrés. Il est possible aussi d'avoir des overlays différents suivant les types ou résolutions de flux de sortie.\cite{wowza}

Le test du serveur Wowza à été fait avec la version développer de Wowza, donc la licence est disponible pendant 6 mois.
\begin{itemize}
	\item Language : Java 8
	\item OS : Windows 10
	\item technologie cartes graphiques : Nvidia Cuda + Intel iGPU
	\item Architecture : Intel x86, i7-6700
	\item Version : Wowza 4.7
	\item Visionneuse : VLC
\end{itemize}
\  \\

Le code ci-dessous est un extrait de la classe Java OverlayImage du module exemple, disponible sur le site même de Wowza \footnote{https://www.wowza.com/downloads/forums/transcoderoverlayexamplefiles/TranscoderOverlayExampleFiles.zip}. Cette fonction est appelée sur chaque image présente dans le buffer. Nous remarquons à la ligne 11 qu'il a été décidé d'utiliser la classe Graphics2D standard de Java pour retoucher les images. Cette granularité nous permet de retoucher le flux de la même manière qu'avec OpenCV mais cette fois-ci en utilisant les outils Java standard.



Dans la section suivante \ref{sec:sec04c}, nous profiterons pour expliquer comment installer des modules dans le serveur Wowza.



\definecolor{javared}{rgb}{0.6,0,0} % for strings
\definecolor{javagreen}{rgb}{0.25,0.5,0.35} % comments
\definecolor{javapurple}{rgb}{0.5,0,0.35} % keywords
\definecolor{javadocblue}{rgb}{0.25,0.35,0.75} % javadoc

\lstset{language=Java,
	basicstyle=\ttfamily,
	keywordstyle=\color{javapurple}\bfseries,
	stringstyle=\color{javared},
	commentstyle=\color{javagreen},
	morecomment=[s][\color{javadocblue}]{/**}{*/},
	numbers=left,
	numberstyle=\tiny\color{black},
	numbersep=10pt,
	tabsize=4,
	showspaces=false,
	showstringspaces=false}

\lstinputlisting[language=Java, firstline=216, lastline=261, caption={Extrait du code d'ajout d'overlay officiel de Wowza. Lignes: 216-261\cite{wowza} \label{wowza-transcoder-code}}]{../../app/wowza_overlay/src/OverlayImage.java}

%=======


\section{Clamp - Module Streamingtoolbox.com}
\label{sec:sec04c}



\begin{figure}[h]
	\centering
	\includegraphics[width=1\linewidth]{fig01/capture6}\label{fig:w6}
	\mycaption[Wowza - Flowchart appareils]{Workflow Wowza - Flowchart}
\end{figure}
\begin{figure}
	\centering
\includegraphics[width=1\linewidth]{fig01/capture7}\label{fig:w7}
	\mycaption[Wowza génération du flux d'entrée avec OBS.]{Génération du flux d'entrée de Wowza avec OBS, Open Broadcaster.}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=1\linewidth]{fig01/capture8}\label{fig:w8}
	\mycaption[Paramétrage du module Wowza Clamp.]{Paramétrage et test du module Wowza Clamp.}
\end{figure}



\begin{figure}[h]
	\centering
	\includegraphics[width=0.5\linewidth]{fig01/capture10}\label{fig:w10}
	\mycaption[Wowza - Affichage non supporté.]{Affichage non supporté - Interface test.}
	\label{fig:wowza2}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=1\linewidth]{fig01/capture11}\label{fig:w11}
	\mycaption[Paramétrage du module pour Wowza serveur.]{Paramétrage du module pour Wowza serveur.}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=1\linewidth]{fig01/capture12}\label{fig:w12}
	\mycaption[Paramétrage du module pour Wowza serveur.]{Paramétrage du module pour Wowza serveur.}
\end{figure}
	
	


%=========================================================